var $loading = $('.mdl-spinner');
var center = [3677385, 4120949];
var extent = [3652772, 4112808, 3700000, 4132797];
var lang = document.documentElement.lang;
var styleCache = {};
var geoJSONFormat = new ol.format.GeoJSON({
  defaultDataProjection: 'EPSG:4326'
});
toastr.options = {
  closeButton: false,
  debug: false,
  newestOnTop: false,
  progressBar: false,
  positionClass: 'toast-top-center',
  preventDuplicates: false,
  onclick: null,
  showDuration: '300',
  hideDuration: '1000',
  timeOut: '5000',
  extendedTimeOut: '1000',
  showEasing: 'swing',
  hideEasing: 'linear',
  showMethod: 'fadeIn',
  hideMethod: 'fadeOut'
};
var bing = new ol.layer.Tile({
  visible: true,
  source: new ol.source.BingMaps({
    key: 'Ak2Gq8VUfICsPpuf7LRANXmXt2sHWmSLPhohmVLFtFIEwYjs_5MCyAhAFwRSVpLj',
    imagerySet: 'Aerial'
  }),
  maxZoom: 19,
  crossOrigin: 'anonymous',
  preload: Infinity,
  id: 'bing'
});
var mapbox = new ol.layer.Tile({
  source: new ol.source.XYZ({
    attributions: [new ol.Attribution({
      html: '<a href="https://www.mapbox.com/about/maps/" target="_blank">&copy; Mapbox &copy; OpenStreetMap</a>'
    })],
    url: 'https://api.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZmlydmFpbiIsImEiOiJlOWYyYTM0NThiNWM0YjJjODJjNDE4ODQzNzA2MGQyNiJ9.-NVDO27Hzt-w_nQosUPfLA'
  }),
  id: 'mapbox'
});
function getIconType(estateType) {
  var iconType = {
    Apartment: function apartmentIcon() {
      return 'apartment';
    },
    'Detached House': function detachedHouceIcon() {
      return 'detached';
    },
    Villa: function villaIcon() {
      return 'villa';
    },
    Maisonette: function maisonetteIcon() {
      return 'villa';
    }
  };
  return (iconType[estateType])();
}

function getIconPath(listingType) {
  var iconPath = {
    true: function saleIcon() {
      return './images/pins/sale/';
    },
    false: function rentIcon() {
      return './images/pins/rent/';
    }
  };
  return (iconPath[listingType])();
}

function createPropertyStyle(feature) {
  var src;
  src = getIconPath(feature.get('sale')) + getIconType(feature.get('estatetype_en')) + '-48.png';
  return new ol.style.Style({
    geometry: feature.getGeometry(),
    image: new ol.style.Icon(({
      src: src,
      anchorOrigin: 'bottom-left',
      anchor: [0.5, 0],
      scale: 1
    }))
  });
}

function propertyStyleFunction(feature, resolution) {
  var size = feature.get('features').length;
  var style;
  var originalFeature;
  if (size > 1) {
    style = [new ol.style.Style({
      image: new ol.style.Circle({
        radius: 20,
        stroke: new ol.style.Stroke({
          color: [156, 39, 176, 1],
          width: 5
        }),
        fill: new ol.style.Fill({
          color: [68, 138, 255, 0.8]
        })
      }),
      text: new ol.style.Text({
        text: size.toString(),
        fill: new ol.style.Fill({
          color: '#FFFFFF'
        })
      }),
      zIndex: 101
    })];
  } else {
    originalFeature = feature.get('features')[0];
    style = [createPropertyStyle(originalFeature)];
  }
  return style;
}

// function selectStyleFunction(feature, resolution) {
//   var styles = [new ol.style.Style({})];
//   var originalFeatures = feature.get('features');
//   var originaFeature;
//   for (var i = originalFeatures.length - 1; i >= 0; --i) {
//     originalFeature = originalFeatures[i];
//     styles.push(createPropertyStyle(originalFeature));
//   }
//   return styles;
// }
var propertySource = new ol.source.Vector({
  format: geoJSONFormat,
  loader: function featreLoader() {
    var self = this;
    this.clear();
    $.ajax({
      url: 'http://127.0.0.1:3000/db/listed',
      type: 'GET',
      dataType: 'json'
    })
      .done(function succeded(response) {
        var features = geoJSONFormat.readFeatures(response, {
          featureProjection: 'EPSG:3857'
        });
        self.addFeatures(features);
      })
      .fail(function failed(jqXHR, textStatus, errorThrown) {
        toastr.clear();
        if (jqXHR.status === 404) {
          toastr.error('Sorry, we cannot find any properties!');
        } else if (jqXHR.status === 503) {
          toastr.error('Service Unavailable');
        } else {
          toastr.error('Internal Server Error');
        }
      });
  }
});
var propertyClusterSource = new ol.source.Cluster({
  distance: 40,
  source: propertySource,
  attributions: [new ol.Attribution({
    html: 'All maps © ' + '<a href="http://www.terracognita.gr/">Terra Cognita</a>'
  })]
});
var property = new ol.layer.Vector({
  source: propertyClusterSource,
  id: 'estates',
  visible: true,
  style: propertyStyleFunction
});
property.setZIndex(2);
var PSAStyleFunction = function (feature, resolution) {
  var symbol = feature.get('style');
  var text;
  if (lang === 'el') {
    text = feature.get('name_el');
  } else {
    text = feature.get('name_en');
  }
  if (!styleCache[symbol]) {
    styleCache = [new ol.style.Style({
      image: new ol.style.Icon(({
        src: '../images/maki/renders/' + symbol + '-24.png',
        anchorOrigin: 'bottom-left',
        anchor: [0.5, 0.5],
        scale: 1
      })),
      text: new ol.style.Text({
        text: text,
        stroke: new ol.style.Stroke({
          color: [156, 39, 176, 0.8],
          width: 1
        }),
        offsetY: 12
      })
    })];
  }
  return styleCache;
};
var PSA = new ol.layer.Vector({
  style: PSAStyleFunction,
  maxResolution: 3
});
PSA.setZIndex(1);

function filteredEsateStyle(feature, resolution) {
  var src;
  src = getIconPath(feature.get('sale')) + getIconType(feature.get('estatetype_en')) + '-64.png';
  styleCache = [new ol.style.Style({
    image: new ol.style.Icon(({
      src: src,
      anchorOrigin: 'bottom-left',
      anchor: [0.5, 0],
      scale: 1
    }))
  })];
  return styleCache;
}
var filteredEstates = new ol.layer.Vector({
  source: new ol.source.Vector({
    format: geoJSONFormat
  }),
  id: 'filteredEstates',
  visible: true,
  style: filteredEsateStyle
});
filteredEstates.setZIndex(2);
var selectSource = new ol.source.Vector({});
var selectBox = new ol.layer.Vector({
  source: selectSource,
  style: new ol.style.Style({
    fill: new ol.style.Fill({
      color: 'rgba(227, 72, 27, 0.2)'
    }),
    stroke: new ol.style.Stroke({
      color: '#E3481B',
      width: 2
    }),
    image: new ol.style.Circle({
      radius: 7,
      fill: new ol.style.Fill({
        color: '#E3481B'
      })
    })
  })
});
selectBox.setZIndex(3);
var map = new ol.Map({
  target: 'map',
  layers: [mapbox, property, PSA, filteredEstates, selectBox],
  // interactions: ol.interaction.defaults().extend([new ol.interaction.Select({
  //   condition: function(evt) {
  //     return evt.type === 'singleclick' && ol.events.condition.shiftKeyOnly(evt);
  //   },
  //   style: selectStyleFunction
  // })]),
  loadTilesWhileAnimating: true,
  loadTilesWhileInteracting: true,
  renderer: 'canvas',
  controls: ol.control.defaults({
    attributionOptions: {
      collapsible: false,
      collapsed: false
    }
  })
    .extend([
      new ol.control.ScaleLine({
        units: 'metric'
      }), new ol.control.OverviewMap({
        className: 'ol-overviewmap ol-custom-overviewmap',
        collapsible: true,
        collapsed: true,
        layers: [bing]
      }),
      new ol.control.ZoomToExtent({
        extent: extent
      })
    ]),
  view: new ol.View({
    center: center,
    extent: extent,
    projection: 'EPSG:3857',
    zoom: 14,
    maxZoom: 19,
    minZoom: 14
  })
});
if (lang === 'el') {
  bing.set('name', 'Δορυφορική εικόνα');
  mapbox.set('name', 'Χάρτης');
  property.set('name', 'Ακίνητα');
} else {
  bing.set('name', 'Sattelite Image');
  mapbox.set('name', 'Map');
  property.set('name', 'Properties');
}
jQuery(document).ready(function ($) {
  $('.spinner').addClass('visuallyhidden');
  $('.mdl-spinner').removeClass('is-active');
  // handleSelect();
});
$(document)
  .ajaxStart(function () {
    $loading.addClass('is-active');
  })
  .ajaxStop(function () {
    $loading.removeClass('is-active');
  });

window.app || (window.app = {});
var app = window.app;
app.Filters = function (options) {
  this.estateType = options.estateType;
  this.leaseType = options.leaseType !== undefined ? options.leaseType : 'Rent';
  this.startPrice = options.startPrice !== undefined ? options.startPrice : 0;
  this.endPrice = options.endPrice !== undefined ? options.endPrice : 2147483647;
  this.parking = options.parking !== undefined ? options.parking : false;
  this.furnished = options.furnished !== undefined ? options.furnished : false;
  this.heating = options.heating !== undefined ? options.heating : false;
  this.cooling = options.cooling !== undefined ? options.cooling : false;
  this.view = options.view !== undefined ? options.view : false;
  console.log(this.startPrice);
};
app.Filters.prototype.createValidator = function () {
  var p = $('form[name=filters]').parsley();
  return p;
};
app.Filters.prototype.setDefaults = function () {
  var epsg4326Extent;
  PSA.setSource(null);
  if (selectSource.getFeatures().length === 0) {
    epsg4326Extent = ol.proj.transformExtent(extent, 'EPSG:3857', 'EPSG:4326');
  } else {
    epsg4326Extent = ol.proj.transformExtent(selectSource.getFeatures()[0]
      .getGeometry().getExtent(), 'EPSG:3857', 'EPSG:4326');
  }
  this.extent = epsg4326Extent;
  this.p = this.createValidator();
};
app.Filters.prototype.ajaxCall = function () {
  if (this.p.validate() === true) {
    $.ajax({
      url: 'http://127.0.0.1:3000/db/listed/filters?bbox[x1]=' + this.extent[0] + '&bbox[y1]=' + this.extent[1] + '&bbox[x2]=' + this.extent[2] + '&bbox[y2]=' + this.extent[3],
      type: 'GET',
      dataType: 'json',
      data: {
        estateType: this.estateType,
        leaseType: this.leaseType,
        furnished: this.furnished,
        heating: this.heating,
        parking: this.parking,
        cooling: this.cooling,
        view: this.view,
        startPrice: this.startPrice,
        endPrice: this.endPrice
      }
    }).done(function succeded(data, textStatus, jqXHR) {
      var features = geoJSONFormat.readFeatures(data, {
        featureProjection: 'EPSG:3857'
      });
        toastr.clear();
        filteredEstates.getSource().clear();
        filteredEstates.getSource().addFeatures(features);
        filteredEstates.setVisible(true);
        property.setVisible(false);
        toastr.info('Found ' + features.length + ' properties');
    })
    .fail(function failed(jqXHR) {
      // var a = jQuery.parseJSON(jqXHR.responseText); // response is Json so we need to parse
      toastr.clear();
      if (jqXHR.status === 404) {
        toastr.error('No properties found wit these filters');
      } else if (jqXHR.status === 503) {
        toastr.error('Service Unavailable');
      } else {
        toastr.error('Internal Server Error');
      }
      filteredEstates.setVisible(false);
      property.setVisible(true);
    });
  }
};
$('#invokeFilters').click(function () {
  var filters;
  var options = {};
  options.estateType = $('#estateType').val();
  options.leaseType = $('input[name=options]:checked').val();
  options.startPrice = $('#startPrice').val();
  options.endPrice = $('#endPrice').val();
  options.parking = $('#checkbox-1').prop('checked');
  options.furnished = $('#checkbox-2').prop('checked');
  options.heating = $('#checkbox-3').prop('checked');
  options.cooling = $('#checkbox-4').prop('checked');
  options.view = $('#checkbox-5').prop('checked');
  console.log(options);
  filters = new app.Filters(options);
  filters.setDefaults();
  filters.ajaxCall();
});
$('#clearFilters').click(function () {
  var lang = document.documentElement.lang;
  $('label[for=option-1]').addClass('is-checked');
  $('#option-1').prop('checked', true);
  $('label[for=option-2]').removeClass('is-checked');
  $('#option-2').prop('checked', false);
  $('label[for=checkbox-1]').removeClass('is-checked');
  $('label[for=checkbox-2]').removeClass('is-checked');
  $('label[for=checkbox-3]').removeClass('is-checked');
  $('label[for=checkbox-4]').removeClass('is-checked');
  $('label[for=checkbox-5]').removeClass('is-checked');
  $('label[for=checkbox-6]').removeClass('is-checked');
  $('#estateType').attr('data-val', 'Apartment');
  $('#priceSelect').attr('data-val', '0');
  if (lang === 'en') {
    $('#priceSelect').val('To 300');
    $('#estateType').val('Apartment');
  } else {
    $('#priceSelect').val('Εώς 300');
    $('#estateType').val('Διαμέρισμα');
  }
  $('#startPrice').val('0').parent().eq(0).addClass('is-dirty');
  $('#endPrice').val('300').parent().eq(0).addClass('is-dirty');
  $('#estate-filters').addClass('visuallyhidden');
  $('#price-range').addClass('visuallyhidden');
  filteredEstates.getSource().clear();
  property.setVisible(true);
  PSA.setSource(null);
  selectSource.clear();
  map.removeInteraction(draw);
});
var draw;
function addInteraction() {
  selectSource.clear();
  draw = new ol.interaction.Draw({
    source: selectSource,
    type: 'LineString',
    geometryFunction: geometryFunction,
    maxPoints: 2
  });
  draw.on('drawstart', function () {
    selectSource.clear();
  });
  draw.on('drawend', function () {
    map.removeInteraction(draw);
  });
  map.addInteraction(draw);
}
function geometryFunction(coordinates, geometry) {
  if (!geometry) {
    geometry = new ol.geom.Polygon(null);
  }
  var start = coordinates[0];
  var end = coordinates[1];
  geometry.setCoordinates([
    [
      start,
      [
        start[0], end[1]
      ],
      end,
      [
        end[0], start[1]
      ],
      start
    ]
  ]);
  return geometry;
}
$('#checkbox-6').click(function () {
  if (this.checked) {
    addInteraction();
  } else {
    map.removeInteraction(draw);
    selectSource.clear();
  }
});


// var handleFilters = (function handleFilters() {
//   'use strict';

//   function selectRange() {
//     $('#priceSelect').change(function (e) {
//       var val = $(this).data('data-val');
//       alert(e);
//       if (val === 100000) {
//         $('#startPrice').val('0').parent().eq(0).addClass('is-dirty');
//         $('#endPrice').val('100000').parent().eq(0).addClass('is-dirty');
//       } else if (val === 150000) {
//         $('#startPrice').val('100000').parent().eq(0).addClass('is-dirty');
//         $('#endPrice').val('150000').parent().eq(0).addClass('is-dirty');
//       } else if (val === 200000) {
//         $('#startPrice').val('150000').parent().eq(0).addClass('is-dirty');
//         $('#endPrice').val('200000').parent().eq(0).addClass('is-dirty');
//       } else if (val === 250000) {
//         $('#startPrice').val('200000').parent().eq(0).addClass('is-dirty');
//         $('#endPrice').val('250000').parent().eq(0).addClass('is-dirty');
//       } else if (val === 300000) {
//         $('#startPrice').val('250000').parent().eq(0).addClass('is-dirty');
//         $('#endPrice').val('300000').parent().eq(0).addClass('is-dirty');
//       } else {
//         $('#startPrice').val('250000').parent().eq(0).addClass('is-dirty');
//         $('#endPrice').val('300000').parent().eq(0).addClass('is-dirty');
//       }
//     });
//   }

//   return {
//     selectRange: selectRange
//   };
// }());
function getValueRange(listingType) {
  var saleType = {
    Sale: function sale() {
      $('#startPrice').val('0').parent().eq(0).addClass('is-dirty');
      $('#endPrice').val('100000').parent().eq(0).addClass('is-dirty');
      $('#priceSelect').change(function (e) {
        var val = $(this).attr('data-val');
        if (val === '100000') {
          $('#startPrice').val('0').parent().eq(0).addClass('is-dirty');
          $('#endPrice').val('100000').parent().eq(0).addClass('is-dirty');
        } else if (val === '150000') {
          $('#startPrice').val('100000').parent().eq(0).addClass('is-dirty');
          $('#endPrice').val('150000').parent().eq(0).addClass('is-dirty');
        } else if (val === '200000') {
          $('#startPrice').val('150000').parent().eq(0).addClass('is-dirty');
          $('#endPrice').val('200000').parent().eq(0).addClass('is-dirty');
        } else if (val === '250000') {
          $('#startPrice').val('200000').parent().eq(0).addClass('is-dirty');
          $('#endPrice').val('250000').parent().eq(0).addClass('is-dirty');
        } else if (val === '300000') {
          $('#startPrice').val('250000').parent().eq(0).addClass('is-dirty');
          $('#endPrice').val('300000').parent().eq(0).addClass('is-dirty');
        } else {
          $('#startPrice').val('300000').parent().eq(0).addClass('is-dirty');
          $('#endPrice').val('');
        }
      });
    },
    Rent: function rent() {
      $('#startPrice').val('0').parent().eq(0).addClass('is-dirty');
      $('#endPrice').val('300').parent().eq(0).addClass('is-dirty');
      $('#priceSelect').change(function (e) {
        var val = $(this).attr('data-val');
        if (val === '300') {
          $('#startPrice').val('0').parent().eq(0).addClass('is-dirty');
          $('#endPrice').val('300').parent().eq(0).addClass('is-dirty');
        } else if (val === '450') {
          $('#startPrice').val('300').parent().eq(0).addClass('is-dirty');
          $('#endPrice').val('450').parent().eq(0).addClass('is-dirty');
        } else if (val === '600') {
          $('#startPrice').val('450').parent().eq(0).addClass('is-dirty');
          $('#endPrice').val('600').parent().eq(0).addClass('is-dirty');
        } else {
          $('#startPrice').val('600').parent().eq(0).addClass('is-dirty');
          $('#endPrice').val('');
        }
      });
    }
  };
  return (saleType[listingType])();
}
$(function () {
  getValueRange('Rent');
  $('input[type=radio][name=options]').change(function () {
    var lang = document.documentElement.lang;
    var value = this.value;
    var type = {
      rangeType: this.value
    };
    if (lang === 'en') {
      type.priceTitle = 'Choose Estate Price';
      type.price = 'Price';
      type.from = 'From';
      type.to = 'To';
      type.andMore = 'and more';
    } else {
      type.priceTitle = 'Επιλέξτε Τιμή Ακινήτου';
      type.price = 'Τιμή';
      type.from = 'Από';
      type.to = 'Εώς';
      type.andMore = 'και πάνω';
    }
    dust.render('valueRange', type, function (error, html) {
      $('.priceSelect').html(html);
      // componentHandler.upgradeAllRegistered();
      getmdlSelect.init('.getmdl-select');
      getValueRange(value);
    });
  }
  );
  $('#advanced-filters').on('click', function (event) {
    event.preventDefault();
    if ($('#estate-filters').hasClass('visuallyhidden')) {
      $('#estate-filters').removeClass('visuallyhidden');
    } else {
      $('#estate-filters').addClass('visuallyhidden');
    }
  });
  $('#toggle-price-range').on('click', function(event) {
    event.preventDefault();
    if ($('#price-range').hasClass('visuallyhidden')) {
      $('#price-range').removeClass('visuallyhidden');
    } else {
      $('#price-range').addClass('visuallyhidden');
    }
  });
});
function preventDotAndSpace(e) {
  var key = e.charCode ? e.charCode : e.keyCode;
  this.innerHTML = key;
  if (key === 46 || key === 32) {
    return false;
  }
}

(function () {
  var geolocation = new ol.Geolocation({
    // take the projection to use from the map's view
    projection: map.getView().getProjection(),
    trackingOptions: {
      maximumAge: 10000,
      enableHighAccuracy: true,
      timeout: 600000
    }
  });
  var accuracyFeature = new ol.Feature();
  geolocation.on('change:accuracyGeometry', function () {
    accuracyFeature.setGeometry(geolocation.getAccuracyGeometry());
  });
  var positionFeature = new ol.Feature();
  positionFeature.setStyle(new ol.style.Style({
    image: new ol.style.Circle({
      radius: 6,
      fill: new ol.style.Fill({ color: '#3399CC' }),
      stroke: new ol.style.Stroke({ color: '#fff', width: 2 })
    })
  }));
  // listen to changes in position
  geolocation.on('change:position', function () {
    var coordinates = geolocation.getPosition();
    positionFeature.setGeometry(coordinates
      ? new ol.geom.Point(coordinates)
      : null);
  });
  featuresOverlaySource = new ol.source.Vector({});
  var featuresOverlay = new ol.layer.Vector({ map: map, source: featuresOverlaySource });
  $('.geolocation').on('change', function (e) {
    e.preventDefault();
    if ($(this).prop('checked') === true) {
      geolocation.setTracking(true);
      featuresOverlaySource.addFeatures([positionFeature, accuracyFeature]);
    } else {
      geolocation.setTracking(false);
      featuresOverlaySource.clear();
    }
  });
}());

function handleInfo(evt) {
  var coordinate = evt.coordinate;
  var obj = {};
  var title = {};
  var owner = {};
  var features = [];
  var clickedFeature;
  var f;

  map.removeInteraction(draw);
  evt.preventDefault();
  obj.title = title;
  if (lang === 'el') {
    title.gid = 'Κωδικός Ιδιοκτησίας';
    title.type = 'Είδος Ιδιοκτησίας';
    title.listing_type = 'Τύπος Αγγελίας';
    title.area = 'Εμβαδό';
    title.address = 'Διευθυνση';
    title.bedrooms = 'Υπνοδωμάτια';
    title.price = 'Τιμή';
    title.isnew = 'Νεόδμητο';
    title.parking = 'Στάθμεση';
    title.furnished = 'Επιπλωμένο';
    title.pets = 'Κατοικίδια';
    title.view = 'Θέα';
    title.heating = 'Θέρμανση';
    title.cooling = 'Ψύξη';
    title.contactInfo = 'Στοιχεία Επικοινωνίας';
    title.name = 'Όνομα';
    title.lastname = 'Επίθετο';
    title.phone = 'Τηλέφωνο';
    title.email = 'Ηλεκτρονική Διεύθυνση';
  } else {
    title.gid = 'Estate Code';
    title.type = 'Property Type';
    title.listing_type = 'Listing Type';
    title.area = 'Size';
    title.address = 'Address';
    title.bedrooms = 'Bedrooms';
    title.price = 'Price';
    title.isnew = 'Newly Build';
    title.parking = 'Parking';
    title.furnished = 'Furnished';
    title.pets = 'Pets Allowed';
    title.view = 'View';
    title.heating = 'Heating';
    title.cooling = 'Cooling';
    title.contactInfo = 'Contact Info';
    title.name = 'Name';
    title.lastname = 'Last Name';
    title.phone = 'Telephone';
    title.email = 'Email';
  }
  clickedFeature = map.forEachFeatureAtPixel(evt.pixel, function (feature, layer) {
    return {
      feature: feature,
      layer: layer
    };
  }, this, function (layer) {
    if (layer.get('id') === 'estates' || layer.get('id') === 'filteredEstates') {
      return true;
    }
    return false;
  }, this);
  if (clickedFeature) {
    if (clickedFeature.layer.get('id') === 'estates' && clickedFeature.feature.get('features').length === 1) {
      f = clickedFeature.feature.getProperties().features[0];
      createPSAandCard(f, obj);
    } else if (clickedFeature.layer.get('id') === 'filteredEstates') {
      f = clickedFeature.feature;
      createPSAandCard(f, obj);
    }
  } else {
    PSA.setSource(null);
  }
}

function createPSAandCard(f, obj) {
  var feature = {};
  feature.gid = f.get('gid');
  feature.area = f.get('estatearea');
  if (lang === 'el') {
    feature.type = f.get('estatetype');
    feature.address = f.get('street_el') + ' ' + f.get('street_number');
    feature.name = f.get('name_el');
    feature.lastname = f.get('lastname_el');
    if (f.get('sale') === true) {
      feature.listing_type = 'Πώληση';
    } else {
      feature.listing_type = 'Ενοικίαση';
    }
    feature.btns = {
      info: 'πληροφοριες',
      close: 'κλεισιμο'
    };
  } else {
    feature.type = f.get('estatetype_en');
    feature.address = f.get('street_en') + ' ' + f.get('street_number');
    feature.name = f.get('name_en');
    feature.lastname = f.get('lastname_en');
    if (f.get('sale') === true) {
      feature.listing_type = 'Sale';
    } else {
      feature.listing_type = 'Rent';
    }
    feature.btns = {
      info: 'info',
      close: 'close'
    };
  }
  feature.bedrooms = f.get('bedrooms');
  feature.price = f.get('price');
  feature.isnew = f.get('isnew');
  feature.parking = f.get('parking');
  feature.furnished = f.get('furnished');
  feature.pets = f.get('pets');
  feature.view = f.get('view');
  feature.heating = f.get('heating');
  feature.cooling = f.get('cooling');
  feature.phone = f.get('phone1');
  feature.email = f.get('email');
  feature.coordinate = f.get('geometry').getCoordinates();

  var PSASource = new ol.source.Vector({
    attributions: [new ol.Attribution({
      html: 'POI by ' + '<a href="http://www.terracognita.gr/">Terra Cognita</a>'
    })],
    format: geoJSONFormat,
    loader: function (extent, resolution, projection) {
      var url = 'http://127.0.0.1:3000/db/uses/' + feature.gid;
      var self = this;
      $.ajax({
        url: url,
        type: 'GET',
        dataType: 'json'
      }).done(function succeded(data, textStatus, jqXHR) {
        var features = geoJSONFormat.readFeatures(data.property_services_analysis, {
          featureProjection: 'EPSG:3857'
        });
        var featuresLength = features.length - 1;
        var area = new ol.style.Style({
          fill: new ol.style.Fill({
            color: [156, 39, 176, 0.1]
          })
        });
        features[0].setStyle(area);
        self.addFeatures(features);
        toastr.clear();
        toastr.info('Found ' + featuresLength + ' Points of Interest in 8 minute distance!');
      }).fail(function failed(jqXHR) {
        toastr.clear();
        if (jqXHR.status === 404) {
          toastr.error('Sorry, we cannot find any Points of Interest in 8 minute distance!');
        } else if (jqXHR.status === 503) {
          toastr.error('Service Unavailable');
        } else {
          toastr.error('Internal Server Error');
        }
      });
    },
    strategy: ol.loadingstrategy.all
  });
  PSA.setSource(PSASource);
  map.getView().setCenter(feature.coordinate);
  map.getView().setResolution(1.2);
  obj.feature = feature;

  dust.render('estateCards', obj, function renderEstateCards(err, out) {
    $('.estate-cards').html(out);
    $('.mdl-card__title').css('background-image', 'url(http://res.cloudinary.com/firvain/image/upload/w_432,c_scale/' + obj.feature.gid + '.jpg)');
    $('.estate-cards').addClass('estate-cards-active');
  // $("#infobox").addClass("visuallyhidden");
  });
  $('a[href="#openModal"]').click(function () {
    dust.render('modalInfo', obj, function renderModalInfo(err, out) {
      $('.modal-content').html(out);
      $('.big-image').css('background-image', 'url(http://res.cloudinary.com/firvain/image/upload/h_222,c_scale/' + obj.feature.gid + '.jpg)');
    });
  });
  $('a[href="#closeEstateCard"]').click(function () {
    $('.estate-cards').removeClass('estate-cards-active');
  });
}
$('#information').on('click', function (e) {
  PSA.setSource(null);
  if ($(this).prop('checked') === true) {
    map.on('click', handleInfo);
    $(this).parent().siblings().find('input').each(function () {$(this).prop('disabled', true);});
  } else {
    map.un('click', handleInfo);
    $(this).parent().siblings().find('input').each(function () {$(this).prop('disabled', false);});
  }
});

(function () {
  var marker = new ol.Feature();
  var iconStyle = new ol.style.Style({
    image: new ol.style.Icon(/** @type {olx.style.IconOptions} */
    ({
      anchor: [
        0.5, 1
      ],
      anchorXUnits: 'fraction',
      anchorYUnits: 'fraction',
      opacity: 1,
      scale: 1,
      src: '../images/map-icons/pins/24/pin1.png',
      snapToPixel: false
    })),
    zIndex: 100
  });
  marker.setStyle(iconStyle);
  var featuresOverlayStyle = new ol.style.Style({
    stroke: new ol.style.Stroke({
      color: '#408080',
      width: 5,
      lineDash: [4, 4]
    })
  });
  var featuresOverlay = new ol.layer.Vector({
    map: map,
    source: new ol.source.Vector(),
    style: featuresOverlayStyle,
    id: 'route',
    nameEl: 'Διαδρομή',
    NameEn: 'Route'
  });
  var routeCoords = [];
  function handleMarker(event) {
    event.preventDefault();
    var featureCount = featuresOverlay.getSource().getFeatures().length;
    var coordinates = event.coordinate;
    if (featureCount === 0) {
      marker.setGeometry(new ol.geom.Point(coordinates));
      marker.setId('first');
      featuresOverlay.getSource().addFeature(marker);
      routeCoords[0] = coordinates[0];
      routeCoords[1] = coordinates[1];
    } else if (featureCount === 1) {
      var clone = marker.clone();
      clone.setGeometry(new ol.geom.Point(coordinates));
      clone.setId('second');
      featuresOverlay.getSource().addFeature(clone);
      routeCoords[2] = coordinates[0];
      routeCoords[3] = coordinates[1];
      callRoute(routeCoords);
    } else {
      featuresOverlay.getSource().clear();
    }
  }
  geoJSONFormat = new ol.format.GeoJSON({ defaultDataProjection: 'EPSG:4326', geometryName: 'geometry' });
  function callRoute(routeCoords) {
    var first = ol.proj.transform([
      routeCoords[0], routeCoords[1]
    ], 'EPSG:3857', 'EPSG:4326');
    var second = ol.proj.transform([
      routeCoords[2], routeCoords[3]
    ], 'EPSG:3857', 'EPSG:4326');
    var x1 = first[0];
    var y1 = first[1];
    var x2 = second[0];
    var y2 = second[1];
    $.ajax({
      url: 'https://api.mapbox.com/v4/directions/mapbox.driving/' + x1 + ',' + y1 + ';' + x2 + ',' + y2 + '.json?alternatives=false&access_token=pk.eyJ1IjoiZmlydmFpbiIsImEiOiJlOWYyYTM0NThiNWM0YjJjODJjNDE4ODQzNzA2MGQyNiJ9.-NVDO27Hzt-w_nQosUPfLA',
      type: 'GET',
      dataType: 'json'
    }).done(function (data) {
      var route = {};
      route.type = 'Feature';
      route.geometry = data.routes[0].geometry;
      featuresOverlay.getSource().addFeatures(geoJSONFormat.readFeatures(route, {
        dataProjection: 'EPSG:4326',
        featureProjection: 'EPSG:3857'
      }));
      map.getView().fit(featuresOverlay.getSource().getExtent(), map.getSize());
    }).fail(function () {
      // console.log("error");
    }).always(function () {
      // console.log("complete");
    });
  }
  $('#marker').on('change', function (event) {
    event.preventDefault();
    /* Act on the event */
    if ($(this).prop('checked') === true) {
      map.on('singleclick', handleMarker);
    } else {
      map.un('singleclick', handleMarker);
      featuresOverlay.getSource().clear();
    }
  });
}());

(function () {
  $('#weather').click(function () {
    if ($(this).prop('checked') === true) {
      $(this).parent().siblings().find('input').each(function () {$(this).prop('disabled', true);});
      map.getOverlays().forEach(function (ovl) {
        if (ovl.get('name') === 'weather') {
          ($(ovl.getElement()).parent()).remove();
          $(ovl.getElement()).remove();
        }
      });
      var center = ol.proj.transform(map.getView().getCenter(), 'EPSG:3857', 'EPSG:4326');
      var lat = center[1];
      var lon = center[0];
      $.ajax({
        url: 'http://api.openweathermap.org/data/2.5/find?lat=' + lat + '&lon=' + lon + '&cnt=5&cluster=no&units=metric&type=accurate&APPID=f9cd9fa2c427c3b115e87e4862619c5c',
        type: 'GET',
        dataType: 'json'
      }).done(function (data) {
        function createWeatherOverlay(position, index) {
          var elem = document.createElement('div');
          elem.setAttribute('class', 'weather-popup  mdl-shadow--6dp');
          elem.setAttribute('id', index);
          elem.setAttribute('data-name', 'weather');
          return new ol.Overlay({ element: elem, position: position });
        }
        var objs = data.list;
        var overlay,
          coordinates;
        $.each(objs, function (index, val) {
          coordinates = ol.proj.transform([
            val.coord.lon, val.coord.lat
          ], 'EPSG:4326', 'EPSG:3857');
          overlay = createWeatherOverlay(coordinates, index);
          map.addOverlay(overlay);
          overlay.set('name', 'weather');
          weatherData = {
            'name': val.name,
            'temp': val.main.temp,
            'pressure': val.main.pressure,
            'humidity': val.main.humidity
          };
          dust.render('weatherPopup', weatherData, function (err, out) {
            $('#' + index).html(out);
          });
        });
      }).fail(function () {
        // toastr.error("Δεν βρέθηκαν πληροφορίες για τις καιρικές συνθήκες!");
      });
    } else if ($(this).prop('checked') === false) {
      $(this).parent().siblings().find('input').each(function () {$(this).prop('disabled', false);});
      map.getOverlays().forEach(function (ovl) {
        if (ovl.get('name') === 'weather') {
          ($(ovl.getElement()).parent()).remove();
          $(ovl.getElement()).remove();
        }
      });
    }
  });
}());

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hcC5qcyIsImZpbHRlcnMuanMiLCJnZW9sb2NhdGlvbi5qcyIsImluZm8uanMiLCJyb3V0aW5nLmpzIiwid2VhdGhlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDak1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoibWFwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciAkbG9hZGluZyA9ICQoJy5tZGwtc3Bpbm5lcicpO1xyXG52YXIgY2VudGVyID0gWzM2NzczODUsIDQxMjA5NDldO1xyXG52YXIgZXh0ZW50ID0gWzM2NTI3NzIsIDQxMTI4MDgsIDM3MDAwMDAsIDQxMzI3OTddO1xyXG52YXIgbGFuZyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nO1xyXG52YXIgc3R5bGVDYWNoZSA9IHt9O1xyXG52YXIgZ2VvSlNPTkZvcm1hdCA9IG5ldyBvbC5mb3JtYXQuR2VvSlNPTih7XHJcbiAgZGVmYXVsdERhdGFQcm9qZWN0aW9uOiAnRVBTRzo0MzI2J1xyXG59KTtcclxudG9hc3RyLm9wdGlvbnMgPSB7XHJcbiAgY2xvc2VCdXR0b246IGZhbHNlLFxyXG4gIGRlYnVnOiBmYWxzZSxcclxuICBuZXdlc3RPblRvcDogZmFsc2UsXHJcbiAgcHJvZ3Jlc3NCYXI6IGZhbHNlLFxyXG4gIHBvc2l0aW9uQ2xhc3M6ICd0b2FzdC10b3AtY2VudGVyJyxcclxuICBwcmV2ZW50RHVwbGljYXRlczogZmFsc2UsXHJcbiAgb25jbGljazogbnVsbCxcclxuICBzaG93RHVyYXRpb246ICczMDAnLFxyXG4gIGhpZGVEdXJhdGlvbjogJzEwMDAnLFxyXG4gIHRpbWVPdXQ6ICc1MDAwJyxcclxuICBleHRlbmRlZFRpbWVPdXQ6ICcxMDAwJyxcclxuICBzaG93RWFzaW5nOiAnc3dpbmcnLFxyXG4gIGhpZGVFYXNpbmc6ICdsaW5lYXInLFxyXG4gIHNob3dNZXRob2Q6ICdmYWRlSW4nLFxyXG4gIGhpZGVNZXRob2Q6ICdmYWRlT3V0J1xyXG59O1xyXG52YXIgYmluZyA9IG5ldyBvbC5sYXllci5UaWxlKHtcclxuICB2aXNpYmxlOiB0cnVlLFxyXG4gIHNvdXJjZTogbmV3IG9sLnNvdXJjZS5CaW5nTWFwcyh7XHJcbiAgICBrZXk6ICdBazJHcThWVWZJQ3NQcHVmN0xSQU5YbVh0MnNIV21TTFBob2htVkxGdEZJRXdZanNfNU1DeUFoQUZ3UlNWcExqJyxcclxuICAgIGltYWdlcnlTZXQ6ICdBZXJpYWwnXHJcbiAgfSksXHJcbiAgbWF4Wm9vbTogMTksXHJcbiAgY3Jvc3NPcmlnaW46ICdhbm9ueW1vdXMnLFxyXG4gIHByZWxvYWQ6IEluZmluaXR5LFxyXG4gIGlkOiAnYmluZydcclxufSk7XHJcbnZhciBtYXBib3ggPSBuZXcgb2wubGF5ZXIuVGlsZSh7XHJcbiAgc291cmNlOiBuZXcgb2wuc291cmNlLlhZWih7XHJcbiAgICBhdHRyaWJ1dGlvbnM6IFtuZXcgb2wuQXR0cmlidXRpb24oe1xyXG4gICAgICBodG1sOiAnPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm1hcGJveC5jb20vYWJvdXQvbWFwcy9cIiB0YXJnZXQ9XCJfYmxhbmtcIj4mY29weTsgTWFwYm94ICZjb3B5OyBPcGVuU3RyZWV0TWFwPC9hPidcclxuICAgIH0pXSxcclxuICAgIHVybDogJ2h0dHBzOi8vYXBpLm1hcGJveC5jb20vdjQvbWFwYm94LnN0cmVldHMve3p9L3t4fS97eX0ucG5nP2FjY2Vzc190b2tlbj1way5leUoxSWpvaVptbHlkbUZwYmlJc0ltRWlPaUpsT1dZeVlUTTBOVGhpTldNMFlqSmpPREpqTkRFNE9EUXpOekEyTUdReU5pSjkuLU5WRE8yN0h6dC13X25Rb3NVUGZMQSdcclxuICB9KSxcclxuICBpZDogJ21hcGJveCdcclxufSk7XHJcbmZ1bmN0aW9uIGdldEljb25UeXBlKGVzdGF0ZVR5cGUpIHtcclxuICB2YXIgaWNvblR5cGUgPSB7XHJcbiAgICBBcGFydG1lbnQ6IGZ1bmN0aW9uIGFwYXJ0bWVudEljb24oKSB7XHJcbiAgICAgIHJldHVybiAnYXBhcnRtZW50JztcclxuICAgIH0sXHJcbiAgICAnRGV0YWNoZWQgSG91c2UnOiBmdW5jdGlvbiBkZXRhY2hlZEhvdWNlSWNvbigpIHtcclxuICAgICAgcmV0dXJuICdkZXRhY2hlZCc7XHJcbiAgICB9LFxyXG4gICAgVmlsbGE6IGZ1bmN0aW9uIHZpbGxhSWNvbigpIHtcclxuICAgICAgcmV0dXJuICd2aWxsYSc7XHJcbiAgICB9LFxyXG4gICAgTWFpc29uZXR0ZTogZnVuY3Rpb24gbWFpc29uZXR0ZUljb24oKSB7XHJcbiAgICAgIHJldHVybiAndmlsbGEnO1xyXG4gICAgfVxyXG4gIH07XHJcbiAgcmV0dXJuIChpY29uVHlwZVtlc3RhdGVUeXBlXSkoKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0SWNvblBhdGgobGlzdGluZ1R5cGUpIHtcclxuICB2YXIgaWNvblBhdGggPSB7XHJcbiAgICB0cnVlOiBmdW5jdGlvbiBzYWxlSWNvbigpIHtcclxuICAgICAgcmV0dXJuICcuL2ltYWdlcy9waW5zL3NhbGUvJztcclxuICAgIH0sXHJcbiAgICBmYWxzZTogZnVuY3Rpb24gcmVudEljb24oKSB7XHJcbiAgICAgIHJldHVybiAnLi9pbWFnZXMvcGlucy9yZW50Lyc7XHJcbiAgICB9XHJcbiAgfTtcclxuICByZXR1cm4gKGljb25QYXRoW2xpc3RpbmdUeXBlXSkoKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlUHJvcGVydHlTdHlsZShmZWF0dXJlKSB7XHJcbiAgdmFyIHNyYztcclxuICBzcmMgPSBnZXRJY29uUGF0aChmZWF0dXJlLmdldCgnc2FsZScpKSArIGdldEljb25UeXBlKGZlYXR1cmUuZ2V0KCdlc3RhdGV0eXBlX2VuJykpICsgJy00OC5wbmcnO1xyXG4gIHJldHVybiBuZXcgb2wuc3R5bGUuU3R5bGUoe1xyXG4gICAgZ2VvbWV0cnk6IGZlYXR1cmUuZ2V0R2VvbWV0cnkoKSxcclxuICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuSWNvbigoe1xyXG4gICAgICBzcmM6IHNyYyxcclxuICAgICAgYW5jaG9yT3JpZ2luOiAnYm90dG9tLWxlZnQnLFxyXG4gICAgICBhbmNob3I6IFswLjUsIDBdLFxyXG4gICAgICBzY2FsZTogMVxyXG4gICAgfSkpXHJcbiAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHByb3BlcnR5U3R5bGVGdW5jdGlvbihmZWF0dXJlLCByZXNvbHV0aW9uKSB7XHJcbiAgdmFyIHNpemUgPSBmZWF0dXJlLmdldCgnZmVhdHVyZXMnKS5sZW5ndGg7XHJcbiAgdmFyIHN0eWxlO1xyXG4gIHZhciBvcmlnaW5hbEZlYXR1cmU7XHJcbiAgaWYgKHNpemUgPiAxKSB7XHJcbiAgICBzdHlsZSA9IFtuZXcgb2wuc3R5bGUuU3R5bGUoe1xyXG4gICAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkNpcmNsZSh7XHJcbiAgICAgICAgcmFkaXVzOiAyMCxcclxuICAgICAgICBzdHJva2U6IG5ldyBvbC5zdHlsZS5TdHJva2Uoe1xyXG4gICAgICAgICAgY29sb3I6IFsxNTYsIDM5LCAxNzYsIDFdLFxyXG4gICAgICAgICAgd2lkdGg6IDVcclxuICAgICAgICB9KSxcclxuICAgICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XHJcbiAgICAgICAgICBjb2xvcjogWzY4LCAxMzgsIDI1NSwgMC44XVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pLFxyXG4gICAgICB0ZXh0OiBuZXcgb2wuc3R5bGUuVGV4dCh7XHJcbiAgICAgICAgdGV4dDogc2l6ZS50b1N0cmluZygpLFxyXG4gICAgICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcclxuICAgICAgICAgIGNvbG9yOiAnI0ZGRkZGRidcclxuICAgICAgICB9KVxyXG4gICAgICB9KSxcclxuICAgICAgekluZGV4OiAxMDFcclxuICAgIH0pXTtcclxuICB9IGVsc2Uge1xyXG4gICAgb3JpZ2luYWxGZWF0dXJlID0gZmVhdHVyZS5nZXQoJ2ZlYXR1cmVzJylbMF07XHJcbiAgICBzdHlsZSA9IFtjcmVhdGVQcm9wZXJ0eVN0eWxlKG9yaWdpbmFsRmVhdHVyZSldO1xyXG4gIH1cclxuICByZXR1cm4gc3R5bGU7XHJcbn1cclxuXHJcbi8vIGZ1bmN0aW9uIHNlbGVjdFN0eWxlRnVuY3Rpb24oZmVhdHVyZSwgcmVzb2x1dGlvbikge1xyXG4vLyAgIHZhciBzdHlsZXMgPSBbbmV3IG9sLnN0eWxlLlN0eWxlKHt9KV07XHJcbi8vICAgdmFyIG9yaWdpbmFsRmVhdHVyZXMgPSBmZWF0dXJlLmdldCgnZmVhdHVyZXMnKTtcclxuLy8gICB2YXIgb3JpZ2luYUZlYXR1cmU7XHJcbi8vICAgZm9yICh2YXIgaSA9IG9yaWdpbmFsRmVhdHVyZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcclxuLy8gICAgIG9yaWdpbmFsRmVhdHVyZSA9IG9yaWdpbmFsRmVhdHVyZXNbaV07XHJcbi8vICAgICBzdHlsZXMucHVzaChjcmVhdGVQcm9wZXJ0eVN0eWxlKG9yaWdpbmFsRmVhdHVyZSkpO1xyXG4vLyAgIH1cclxuLy8gICByZXR1cm4gc3R5bGVzO1xyXG4vLyB9XHJcbnZhciBwcm9wZXJ0eVNvdXJjZSA9IG5ldyBvbC5zb3VyY2UuVmVjdG9yKHtcclxuICBmb3JtYXQ6IGdlb0pTT05Gb3JtYXQsXHJcbiAgbG9hZGVyOiBmdW5jdGlvbiBmZWF0cmVMb2FkZXIoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICB0aGlzLmNsZWFyKCk7XHJcbiAgICAkLmFqYXgoe1xyXG4gICAgICB1cmw6ICdodHRwOi8vMTI3LjAuMC4xOjMwMDAvZGIvbGlzdGVkJyxcclxuICAgICAgdHlwZTogJ0dFVCcsXHJcbiAgICAgIGRhdGFUeXBlOiAnanNvbidcclxuICAgIH0pXHJcbiAgICAgIC5kb25lKGZ1bmN0aW9uIHN1Y2NlZGVkKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgdmFyIGZlYXR1cmVzID0gZ2VvSlNPTkZvcm1hdC5yZWFkRmVhdHVyZXMocmVzcG9uc2UsIHtcclxuICAgICAgICAgIGZlYXR1cmVQcm9qZWN0aW9uOiAnRVBTRzozODU3J1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHNlbGYuYWRkRmVhdHVyZXMoZmVhdHVyZXMpO1xyXG4gICAgICB9KVxyXG4gICAgICAuZmFpbChmdW5jdGlvbiBmYWlsZWQoanFYSFIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XHJcbiAgICAgICAgdG9hc3RyLmNsZWFyKCk7XHJcbiAgICAgICAgaWYgKGpxWEhSLnN0YXR1cyA9PT0gNDA0KSB7XHJcbiAgICAgICAgICB0b2FzdHIuZXJyb3IoJ1NvcnJ5LCB3ZSBjYW5ub3QgZmluZCBhbnkgcHJvcGVydGllcyEnKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGpxWEhSLnN0YXR1cyA9PT0gNTAzKSB7XHJcbiAgICAgICAgICB0b2FzdHIuZXJyb3IoJ1NlcnZpY2UgVW5hdmFpbGFibGUnKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdG9hc3RyLmVycm9yKCdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gIH1cclxufSk7XHJcbnZhciBwcm9wZXJ0eUNsdXN0ZXJTb3VyY2UgPSBuZXcgb2wuc291cmNlLkNsdXN0ZXIoe1xyXG4gIGRpc3RhbmNlOiA0MCxcclxuICBzb3VyY2U6IHByb3BlcnR5U291cmNlLFxyXG4gIGF0dHJpYnV0aW9uczogW25ldyBvbC5BdHRyaWJ1dGlvbih7XHJcbiAgICBodG1sOiAnQWxsIG1hcHMgwqkgJyArICc8YSBocmVmPVwiaHR0cDovL3d3dy50ZXJyYWNvZ25pdGEuZ3IvXCI+VGVycmEgQ29nbml0YTwvYT4nXHJcbiAgfSldXHJcbn0pO1xyXG52YXIgcHJvcGVydHkgPSBuZXcgb2wubGF5ZXIuVmVjdG9yKHtcclxuICBzb3VyY2U6IHByb3BlcnR5Q2x1c3RlclNvdXJjZSxcclxuICBpZDogJ2VzdGF0ZXMnLFxyXG4gIHZpc2libGU6IHRydWUsXHJcbiAgc3R5bGU6IHByb3BlcnR5U3R5bGVGdW5jdGlvblxyXG59KTtcclxucHJvcGVydHkuc2V0WkluZGV4KDIpO1xyXG52YXIgUFNBU3R5bGVGdW5jdGlvbiA9IGZ1bmN0aW9uIChmZWF0dXJlLCByZXNvbHV0aW9uKSB7XHJcbiAgdmFyIHN5bWJvbCA9IGZlYXR1cmUuZ2V0KCdzdHlsZScpO1xyXG4gIHZhciB0ZXh0O1xyXG4gIGlmIChsYW5nID09PSAnZWwnKSB7XHJcbiAgICB0ZXh0ID0gZmVhdHVyZS5nZXQoJ25hbWVfZWwnKTtcclxuICB9IGVsc2Uge1xyXG4gICAgdGV4dCA9IGZlYXR1cmUuZ2V0KCduYW1lX2VuJyk7XHJcbiAgfVxyXG4gIGlmICghc3R5bGVDYWNoZVtzeW1ib2xdKSB7XHJcbiAgICBzdHlsZUNhY2hlID0gW25ldyBvbC5zdHlsZS5TdHlsZSh7XHJcbiAgICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuSWNvbigoe1xyXG4gICAgICAgIHNyYzogJy4uL2ltYWdlcy9tYWtpL3JlbmRlcnMvJyArIHN5bWJvbCArICctMjQucG5nJyxcclxuICAgICAgICBhbmNob3JPcmlnaW46ICdib3R0b20tbGVmdCcsXHJcbiAgICAgICAgYW5jaG9yOiBbMC41LCAwLjVdLFxyXG4gICAgICAgIHNjYWxlOiAxXHJcbiAgICAgIH0pKSxcclxuICAgICAgdGV4dDogbmV3IG9sLnN0eWxlLlRleHQoe1xyXG4gICAgICAgIHRleHQ6IHRleHQsXHJcbiAgICAgICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcclxuICAgICAgICAgIGNvbG9yOiBbMTU2LCAzOSwgMTc2LCAwLjhdLFxyXG4gICAgICAgICAgd2lkdGg6IDFcclxuICAgICAgICB9KSxcclxuICAgICAgICBvZmZzZXRZOiAxMlxyXG4gICAgICB9KVxyXG4gICAgfSldO1xyXG4gIH1cclxuICByZXR1cm4gc3R5bGVDYWNoZTtcclxufTtcclxudmFyIFBTQSA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xyXG4gIHN0eWxlOiBQU0FTdHlsZUZ1bmN0aW9uLFxyXG4gIG1heFJlc29sdXRpb246IDNcclxufSk7XHJcblBTQS5zZXRaSW5kZXgoMSk7XHJcblxyXG5mdW5jdGlvbiBmaWx0ZXJlZEVzYXRlU3R5bGUoZmVhdHVyZSwgcmVzb2x1dGlvbikge1xyXG4gIHZhciBzcmM7XHJcbiAgc3JjID0gZ2V0SWNvblBhdGgoZmVhdHVyZS5nZXQoJ3NhbGUnKSkgKyBnZXRJY29uVHlwZShmZWF0dXJlLmdldCgnZXN0YXRldHlwZV9lbicpKSArICctNjQucG5nJztcclxuICBzdHlsZUNhY2hlID0gW25ldyBvbC5zdHlsZS5TdHlsZSh7XHJcbiAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkljb24oKHtcclxuICAgICAgc3JjOiBzcmMsXHJcbiAgICAgIGFuY2hvck9yaWdpbjogJ2JvdHRvbS1sZWZ0JyxcclxuICAgICAgYW5jaG9yOiBbMC41LCAwXSxcclxuICAgICAgc2NhbGU6IDFcclxuICAgIH0pKVxyXG4gIH0pXTtcclxuICByZXR1cm4gc3R5bGVDYWNoZTtcclxufVxyXG52YXIgZmlsdGVyZWRFc3RhdGVzID0gbmV3IG9sLmxheWVyLlZlY3Rvcih7XHJcbiAgc291cmNlOiBuZXcgb2wuc291cmNlLlZlY3Rvcih7XHJcbiAgICBmb3JtYXQ6IGdlb0pTT05Gb3JtYXRcclxuICB9KSxcclxuICBpZDogJ2ZpbHRlcmVkRXN0YXRlcycsXHJcbiAgdmlzaWJsZTogdHJ1ZSxcclxuICBzdHlsZTogZmlsdGVyZWRFc2F0ZVN0eWxlXHJcbn0pO1xyXG5maWx0ZXJlZEVzdGF0ZXMuc2V0WkluZGV4KDIpO1xyXG52YXIgc2VsZWN0U291cmNlID0gbmV3IG9sLnNvdXJjZS5WZWN0b3Ioe30pO1xyXG52YXIgc2VsZWN0Qm94ID0gbmV3IG9sLmxheWVyLlZlY3Rvcih7XHJcbiAgc291cmNlOiBzZWxlY3RTb3VyY2UsXHJcbiAgc3R5bGU6IG5ldyBvbC5zdHlsZS5TdHlsZSh7XHJcbiAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XHJcbiAgICAgIGNvbG9yOiAncmdiYSgyMjcsIDcyLCAyNywgMC4yKSdcclxuICAgIH0pLFxyXG4gICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcclxuICAgICAgY29sb3I6ICcjRTM0ODFCJyxcclxuICAgICAgd2lkdGg6IDJcclxuICAgIH0pLFxyXG4gICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5DaXJjbGUoe1xyXG4gICAgICByYWRpdXM6IDcsXHJcbiAgICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcclxuICAgICAgICBjb2xvcjogJyNFMzQ4MUInXHJcbiAgICAgIH0pXHJcbiAgICB9KVxyXG4gIH0pXHJcbn0pO1xyXG5zZWxlY3RCb3guc2V0WkluZGV4KDMpO1xyXG52YXIgbWFwID0gbmV3IG9sLk1hcCh7XHJcbiAgdGFyZ2V0OiAnbWFwJyxcclxuICBsYXllcnM6IFttYXBib3gsIHByb3BlcnR5LCBQU0EsIGZpbHRlcmVkRXN0YXRlcywgc2VsZWN0Qm94XSxcclxuICAvLyBpbnRlcmFjdGlvbnM6IG9sLmludGVyYWN0aW9uLmRlZmF1bHRzKCkuZXh0ZW5kKFtuZXcgb2wuaW50ZXJhY3Rpb24uU2VsZWN0KHtcclxuICAvLyAgIGNvbmRpdGlvbjogZnVuY3Rpb24oZXZ0KSB7XHJcbiAgLy8gICAgIHJldHVybiBldnQudHlwZSA9PT0gJ3NpbmdsZWNsaWNrJyAmJiBvbC5ldmVudHMuY29uZGl0aW9uLnNoaWZ0S2V5T25seShldnQpO1xyXG4gIC8vICAgfSxcclxuICAvLyAgIHN0eWxlOiBzZWxlY3RTdHlsZUZ1bmN0aW9uXHJcbiAgLy8gfSldKSxcclxuICBsb2FkVGlsZXNXaGlsZUFuaW1hdGluZzogdHJ1ZSxcclxuICBsb2FkVGlsZXNXaGlsZUludGVyYWN0aW5nOiB0cnVlLFxyXG4gIHJlbmRlcmVyOiAnY2FudmFzJyxcclxuICBjb250cm9sczogb2wuY29udHJvbC5kZWZhdWx0cyh7XHJcbiAgICBhdHRyaWJ1dGlvbk9wdGlvbnM6IHtcclxuICAgICAgY29sbGFwc2libGU6IGZhbHNlLFxyXG4gICAgICBjb2xsYXBzZWQ6IGZhbHNlXHJcbiAgICB9XHJcbiAgfSlcclxuICAgIC5leHRlbmQoW1xyXG4gICAgICBuZXcgb2wuY29udHJvbC5TY2FsZUxpbmUoe1xyXG4gICAgICAgIHVuaXRzOiAnbWV0cmljJ1xyXG4gICAgICB9KSwgbmV3IG9sLmNvbnRyb2wuT3ZlcnZpZXdNYXAoe1xyXG4gICAgICAgIGNsYXNzTmFtZTogJ29sLW92ZXJ2aWV3bWFwIG9sLWN1c3RvbS1vdmVydmlld21hcCcsXHJcbiAgICAgICAgY29sbGFwc2libGU6IHRydWUsXHJcbiAgICAgICAgY29sbGFwc2VkOiB0cnVlLFxyXG4gICAgICAgIGxheWVyczogW2JpbmddXHJcbiAgICAgIH0pLFxyXG4gICAgICBuZXcgb2wuY29udHJvbC5ab29tVG9FeHRlbnQoe1xyXG4gICAgICAgIGV4dGVudDogZXh0ZW50XHJcbiAgICAgIH0pXHJcbiAgICBdKSxcclxuICB2aWV3OiBuZXcgb2wuVmlldyh7XHJcbiAgICBjZW50ZXI6IGNlbnRlcixcclxuICAgIGV4dGVudDogZXh0ZW50LFxyXG4gICAgcHJvamVjdGlvbjogJ0VQU0c6Mzg1NycsXHJcbiAgICB6b29tOiAxNCxcclxuICAgIG1heFpvb206IDE5LFxyXG4gICAgbWluWm9vbTogMTRcclxuICB9KVxyXG59KTtcclxuaWYgKGxhbmcgPT09ICdlbCcpIHtcclxuICBiaW5nLnNldCgnbmFtZScsICfOlM6/z4HPhc+Gzr/Pgc65zrrOriDOtc65zrrPjM69zrEnKTtcclxuICBtYXBib3guc2V0KCduYW1lJywgJ86nzqzPgc+EzrfPgicpO1xyXG4gIHByb3BlcnR5LnNldCgnbmFtZScsICfOkc66zq/Ovc63z4TOsScpO1xyXG59IGVsc2Uge1xyXG4gIGJpbmcuc2V0KCduYW1lJywgJ1NhdHRlbGl0ZSBJbWFnZScpO1xyXG4gIG1hcGJveC5zZXQoJ25hbWUnLCAnTWFwJyk7XHJcbiAgcHJvcGVydHkuc2V0KCduYW1lJywgJ1Byb3BlcnRpZXMnKTtcclxufVxyXG5qUXVlcnkoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgkKSB7XHJcbiAgJCgnLnNwaW5uZXInKS5hZGRDbGFzcygndmlzdWFsbHloaWRkZW4nKTtcclxuICAkKCcubWRsLXNwaW5uZXInKS5yZW1vdmVDbGFzcygnaXMtYWN0aXZlJyk7XHJcbiAgLy8gaGFuZGxlU2VsZWN0KCk7XHJcbn0pO1xyXG4kKGRvY3VtZW50KVxyXG4gIC5hamF4U3RhcnQoZnVuY3Rpb24gKCkge1xyXG4gICAgJGxvYWRpbmcuYWRkQ2xhc3MoJ2lzLWFjdGl2ZScpO1xyXG4gIH0pXHJcbiAgLmFqYXhTdG9wKGZ1bmN0aW9uICgpIHtcclxuICAgICRsb2FkaW5nLnJlbW92ZUNsYXNzKCdpcy1hY3RpdmUnKTtcclxuICB9KTtcclxuIiwid2luZG93LmFwcCB8fCAod2luZG93LmFwcCA9IHt9KTtcclxudmFyIGFwcCA9IHdpbmRvdy5hcHA7XHJcbmFwcC5GaWx0ZXJzID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICB0aGlzLmVzdGF0ZVR5cGUgPSBvcHRpb25zLmVzdGF0ZVR5cGU7XHJcbiAgdGhpcy5sZWFzZVR5cGUgPSBvcHRpb25zLmxlYXNlVHlwZSAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5sZWFzZVR5cGUgOiAnUmVudCc7XHJcbiAgdGhpcy5zdGFydFByaWNlID0gb3B0aW9ucy5zdGFydFByaWNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnN0YXJ0UHJpY2UgOiAwO1xyXG4gIHRoaXMuZW5kUHJpY2UgPSBvcHRpb25zLmVuZFByaWNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmVuZFByaWNlIDogMjE0NzQ4MzY0NztcclxuICB0aGlzLnBhcmtpbmcgPSBvcHRpb25zLnBhcmtpbmcgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucGFya2luZyA6IGZhbHNlO1xyXG4gIHRoaXMuZnVybmlzaGVkID0gb3B0aW9ucy5mdXJuaXNoZWQgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuZnVybmlzaGVkIDogZmFsc2U7XHJcbiAgdGhpcy5oZWF0aW5nID0gb3B0aW9ucy5oZWF0aW5nICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmhlYXRpbmcgOiBmYWxzZTtcclxuICB0aGlzLmNvb2xpbmcgPSBvcHRpb25zLmNvb2xpbmcgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuY29vbGluZyA6IGZhbHNlO1xyXG4gIHRoaXMudmlldyA9IG9wdGlvbnMudmlldyAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy52aWV3IDogZmFsc2U7XHJcbiAgY29uc29sZS5sb2codGhpcy5zdGFydFByaWNlKTtcclxufTtcclxuYXBwLkZpbHRlcnMucHJvdG90eXBlLmNyZWF0ZVZhbGlkYXRvciA9IGZ1bmN0aW9uICgpIHtcclxuICB2YXIgcCA9ICQoJ2Zvcm1bbmFtZT1maWx0ZXJzXScpLnBhcnNsZXkoKTtcclxuICByZXR1cm4gcDtcclxufTtcclxuYXBwLkZpbHRlcnMucHJvdG90eXBlLnNldERlZmF1bHRzID0gZnVuY3Rpb24gKCkge1xyXG4gIHZhciBlcHNnNDMyNkV4dGVudDtcclxuICBQU0Euc2V0U291cmNlKG51bGwpO1xyXG4gIGlmIChzZWxlY3RTb3VyY2UuZ2V0RmVhdHVyZXMoKS5sZW5ndGggPT09IDApIHtcclxuICAgIGVwc2c0MzI2RXh0ZW50ID0gb2wucHJvai50cmFuc2Zvcm1FeHRlbnQoZXh0ZW50LCAnRVBTRzozODU3JywgJ0VQU0c6NDMyNicpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBlcHNnNDMyNkV4dGVudCA9IG9sLnByb2oudHJhbnNmb3JtRXh0ZW50KHNlbGVjdFNvdXJjZS5nZXRGZWF0dXJlcygpWzBdXHJcbiAgICAgIC5nZXRHZW9tZXRyeSgpLmdldEV4dGVudCgpLCAnRVBTRzozODU3JywgJ0VQU0c6NDMyNicpO1xyXG4gIH1cclxuICB0aGlzLmV4dGVudCA9IGVwc2c0MzI2RXh0ZW50O1xyXG4gIHRoaXMucCA9IHRoaXMuY3JlYXRlVmFsaWRhdG9yKCk7XHJcbn07XHJcbmFwcC5GaWx0ZXJzLnByb3RvdHlwZS5hamF4Q2FsbCA9IGZ1bmN0aW9uICgpIHtcclxuICBpZiAodGhpcy5wLnZhbGlkYXRlKCkgPT09IHRydWUpIHtcclxuICAgICQuYWpheCh7XHJcbiAgICAgIHVybDogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9kYi9saXN0ZWQvZmlsdGVycz9iYm94W3gxXT0nICsgdGhpcy5leHRlbnRbMF0gKyAnJmJib3hbeTFdPScgKyB0aGlzLmV4dGVudFsxXSArICcmYmJveFt4Ml09JyArIHRoaXMuZXh0ZW50WzJdICsgJyZiYm94W3kyXT0nICsgdGhpcy5leHRlbnRbM10sXHJcbiAgICAgIHR5cGU6ICdHRVQnLFxyXG4gICAgICBkYXRhVHlwZTogJ2pzb24nLFxyXG4gICAgICBkYXRhOiB7XHJcbiAgICAgICAgZXN0YXRlVHlwZTogdGhpcy5lc3RhdGVUeXBlLFxyXG4gICAgICAgIGxlYXNlVHlwZTogdGhpcy5sZWFzZVR5cGUsXHJcbiAgICAgICAgZnVybmlzaGVkOiB0aGlzLmZ1cm5pc2hlZCxcclxuICAgICAgICBoZWF0aW5nOiB0aGlzLmhlYXRpbmcsXHJcbiAgICAgICAgcGFya2luZzogdGhpcy5wYXJraW5nLFxyXG4gICAgICAgIGNvb2xpbmc6IHRoaXMuY29vbGluZyxcclxuICAgICAgICB2aWV3OiB0aGlzLnZpZXcsXHJcbiAgICAgICAgc3RhcnRQcmljZTogdGhpcy5zdGFydFByaWNlLFxyXG4gICAgICAgIGVuZFByaWNlOiB0aGlzLmVuZFByaWNlXHJcbiAgICAgIH1cclxuICAgIH0pLmRvbmUoZnVuY3Rpb24gc3VjY2VkZWQoZGF0YSwgdGV4dFN0YXR1cywganFYSFIpIHtcclxuICAgICAgdmFyIGZlYXR1cmVzID0gZ2VvSlNPTkZvcm1hdC5yZWFkRmVhdHVyZXMoZGF0YSwge1xyXG4gICAgICAgIGZlYXR1cmVQcm9qZWN0aW9uOiAnRVBTRzozODU3J1xyXG4gICAgICB9KTtcclxuICAgICAgICB0b2FzdHIuY2xlYXIoKTtcclxuICAgICAgICBmaWx0ZXJlZEVzdGF0ZXMuZ2V0U291cmNlKCkuY2xlYXIoKTtcclxuICAgICAgICBmaWx0ZXJlZEVzdGF0ZXMuZ2V0U291cmNlKCkuYWRkRmVhdHVyZXMoZmVhdHVyZXMpO1xyXG4gICAgICAgIGZpbHRlcmVkRXN0YXRlcy5zZXRWaXNpYmxlKHRydWUpO1xyXG4gICAgICAgIHByb3BlcnR5LnNldFZpc2libGUoZmFsc2UpO1xyXG4gICAgICAgIHRvYXN0ci5pbmZvKCdGb3VuZCAnICsgZmVhdHVyZXMubGVuZ3RoICsgJyBwcm9wZXJ0aWVzJyk7XHJcbiAgICB9KVxyXG4gICAgLmZhaWwoZnVuY3Rpb24gZmFpbGVkKGpxWEhSKSB7XHJcbiAgICAgIC8vIHZhciBhID0galF1ZXJ5LnBhcnNlSlNPTihqcVhIUi5yZXNwb25zZVRleHQpOyAvLyByZXNwb25zZSBpcyBKc29uIHNvIHdlIG5lZWQgdG8gcGFyc2VcclxuICAgICAgdG9hc3RyLmNsZWFyKCk7XHJcbiAgICAgIGlmIChqcVhIUi5zdGF0dXMgPT09IDQwNCkge1xyXG4gICAgICAgIHRvYXN0ci5lcnJvcignTm8gcHJvcGVydGllcyBmb3VuZCB3aXQgdGhlc2UgZmlsdGVycycpO1xyXG4gICAgICB9IGVsc2UgaWYgKGpxWEhSLnN0YXR1cyA9PT0gNTAzKSB7XHJcbiAgICAgICAgdG9hc3RyLmVycm9yKCdTZXJ2aWNlIFVuYXZhaWxhYmxlJyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdG9hc3RyLmVycm9yKCdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InKTtcclxuICAgICAgfVxyXG4gICAgICBmaWx0ZXJlZEVzdGF0ZXMuc2V0VmlzaWJsZShmYWxzZSk7XHJcbiAgICAgIHByb3BlcnR5LnNldFZpc2libGUodHJ1ZSk7XHJcbiAgICB9KTtcclxuICB9XHJcbn07XHJcbiQoJyNpbnZva2VGaWx0ZXJzJykuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gIHZhciBmaWx0ZXJzO1xyXG4gIHZhciBvcHRpb25zID0ge307XHJcbiAgb3B0aW9ucy5lc3RhdGVUeXBlID0gJCgnI2VzdGF0ZVR5cGUnKS52YWwoKTtcclxuICBvcHRpb25zLmxlYXNlVHlwZSA9ICQoJ2lucHV0W25hbWU9b3B0aW9uc106Y2hlY2tlZCcpLnZhbCgpO1xyXG4gIG9wdGlvbnMuc3RhcnRQcmljZSA9ICQoJyNzdGFydFByaWNlJykudmFsKCk7XHJcbiAgb3B0aW9ucy5lbmRQcmljZSA9ICQoJyNlbmRQcmljZScpLnZhbCgpO1xyXG4gIG9wdGlvbnMucGFya2luZyA9ICQoJyNjaGVja2JveC0xJykucHJvcCgnY2hlY2tlZCcpO1xyXG4gIG9wdGlvbnMuZnVybmlzaGVkID0gJCgnI2NoZWNrYm94LTInKS5wcm9wKCdjaGVja2VkJyk7XHJcbiAgb3B0aW9ucy5oZWF0aW5nID0gJCgnI2NoZWNrYm94LTMnKS5wcm9wKCdjaGVja2VkJyk7XHJcbiAgb3B0aW9ucy5jb29saW5nID0gJCgnI2NoZWNrYm94LTQnKS5wcm9wKCdjaGVja2VkJyk7XHJcbiAgb3B0aW9ucy52aWV3ID0gJCgnI2NoZWNrYm94LTUnKS5wcm9wKCdjaGVja2VkJyk7XHJcbiAgY29uc29sZS5sb2cob3B0aW9ucyk7XHJcbiAgZmlsdGVycyA9IG5ldyBhcHAuRmlsdGVycyhvcHRpb25zKTtcclxuICBmaWx0ZXJzLnNldERlZmF1bHRzKCk7XHJcbiAgZmlsdGVycy5hamF4Q2FsbCgpO1xyXG59KTtcclxuJCgnI2NsZWFyRmlsdGVycycpLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICB2YXIgbGFuZyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nO1xyXG4gICQoJ2xhYmVsW2Zvcj1vcHRpb24tMV0nKS5hZGRDbGFzcygnaXMtY2hlY2tlZCcpO1xyXG4gICQoJyNvcHRpb24tMScpLnByb3AoJ2NoZWNrZWQnLCB0cnVlKTtcclxuICAkKCdsYWJlbFtmb3I9b3B0aW9uLTJdJykucmVtb3ZlQ2xhc3MoJ2lzLWNoZWNrZWQnKTtcclxuICAkKCcjb3B0aW9uLTInKS5wcm9wKCdjaGVja2VkJywgZmFsc2UpO1xyXG4gICQoJ2xhYmVsW2Zvcj1jaGVja2JveC0xXScpLnJlbW92ZUNsYXNzKCdpcy1jaGVja2VkJyk7XHJcbiAgJCgnbGFiZWxbZm9yPWNoZWNrYm94LTJdJykucmVtb3ZlQ2xhc3MoJ2lzLWNoZWNrZWQnKTtcclxuICAkKCdsYWJlbFtmb3I9Y2hlY2tib3gtM10nKS5yZW1vdmVDbGFzcygnaXMtY2hlY2tlZCcpO1xyXG4gICQoJ2xhYmVsW2Zvcj1jaGVja2JveC00XScpLnJlbW92ZUNsYXNzKCdpcy1jaGVja2VkJyk7XHJcbiAgJCgnbGFiZWxbZm9yPWNoZWNrYm94LTVdJykucmVtb3ZlQ2xhc3MoJ2lzLWNoZWNrZWQnKTtcclxuICAkKCdsYWJlbFtmb3I9Y2hlY2tib3gtNl0nKS5yZW1vdmVDbGFzcygnaXMtY2hlY2tlZCcpO1xyXG4gICQoJyNlc3RhdGVUeXBlJykuYXR0cignZGF0YS12YWwnLCAnQXBhcnRtZW50Jyk7XHJcbiAgJCgnI3ByaWNlU2VsZWN0JykuYXR0cignZGF0YS12YWwnLCAnMCcpO1xyXG4gIGlmIChsYW5nID09PSAnZW4nKSB7XHJcbiAgICAkKCcjcHJpY2VTZWxlY3QnKS52YWwoJ1RvIDMwMCcpO1xyXG4gICAgJCgnI2VzdGF0ZVR5cGUnKS52YWwoJ0FwYXJ0bWVudCcpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICAkKCcjcHJpY2VTZWxlY3QnKS52YWwoJ86Vz47PgiAzMDAnKTtcclxuICAgICQoJyNlc3RhdGVUeXBlJykudmFsKCfOlM65zrHOvM6tz4HOuc+DzrzOsScpO1xyXG4gIH1cclxuICAkKCcjc3RhcnRQcmljZScpLnZhbCgnMCcpLnBhcmVudCgpLmVxKDApLmFkZENsYXNzKCdpcy1kaXJ0eScpO1xyXG4gICQoJyNlbmRQcmljZScpLnZhbCgnMzAwJykucGFyZW50KCkuZXEoMCkuYWRkQ2xhc3MoJ2lzLWRpcnR5Jyk7XHJcbiAgJCgnI2VzdGF0ZS1maWx0ZXJzJykuYWRkQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7XHJcbiAgJCgnI3ByaWNlLXJhbmdlJykuYWRkQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7XHJcbiAgZmlsdGVyZWRFc3RhdGVzLmdldFNvdXJjZSgpLmNsZWFyKCk7XHJcbiAgcHJvcGVydHkuc2V0VmlzaWJsZSh0cnVlKTtcclxuICBQU0Euc2V0U291cmNlKG51bGwpO1xyXG4gIHNlbGVjdFNvdXJjZS5jbGVhcigpO1xyXG4gIG1hcC5yZW1vdmVJbnRlcmFjdGlvbihkcmF3KTtcclxufSk7XHJcbnZhciBkcmF3O1xyXG5mdW5jdGlvbiBhZGRJbnRlcmFjdGlvbigpIHtcclxuICBzZWxlY3RTb3VyY2UuY2xlYXIoKTtcclxuICBkcmF3ID0gbmV3IG9sLmludGVyYWN0aW9uLkRyYXcoe1xyXG4gICAgc291cmNlOiBzZWxlY3RTb3VyY2UsXHJcbiAgICB0eXBlOiAnTGluZVN0cmluZycsXHJcbiAgICBnZW9tZXRyeUZ1bmN0aW9uOiBnZW9tZXRyeUZ1bmN0aW9uLFxyXG4gICAgbWF4UG9pbnRzOiAyXHJcbiAgfSk7XHJcbiAgZHJhdy5vbignZHJhd3N0YXJ0JywgZnVuY3Rpb24gKCkge1xyXG4gICAgc2VsZWN0U291cmNlLmNsZWFyKCk7XHJcbiAgfSk7XHJcbiAgZHJhdy5vbignZHJhd2VuZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgIG1hcC5yZW1vdmVJbnRlcmFjdGlvbihkcmF3KTtcclxuICB9KTtcclxuICBtYXAuYWRkSW50ZXJhY3Rpb24oZHJhdyk7XHJcbn1cclxuZnVuY3Rpb24gZ2VvbWV0cnlGdW5jdGlvbihjb29yZGluYXRlcywgZ2VvbWV0cnkpIHtcclxuICBpZiAoIWdlb21ldHJ5KSB7XHJcbiAgICBnZW9tZXRyeSA9IG5ldyBvbC5nZW9tLlBvbHlnb24obnVsbCk7XHJcbiAgfVxyXG4gIHZhciBzdGFydCA9IGNvb3JkaW5hdGVzWzBdO1xyXG4gIHZhciBlbmQgPSBjb29yZGluYXRlc1sxXTtcclxuICBnZW9tZXRyeS5zZXRDb29yZGluYXRlcyhbXHJcbiAgICBbXHJcbiAgICAgIHN0YXJ0LFxyXG4gICAgICBbXHJcbiAgICAgICAgc3RhcnRbMF0sIGVuZFsxXVxyXG4gICAgICBdLFxyXG4gICAgICBlbmQsXHJcbiAgICAgIFtcclxuICAgICAgICBlbmRbMF0sIHN0YXJ0WzFdXHJcbiAgICAgIF0sXHJcbiAgICAgIHN0YXJ0XHJcbiAgICBdXHJcbiAgXSk7XHJcbiAgcmV0dXJuIGdlb21ldHJ5O1xyXG59XHJcbiQoJyNjaGVja2JveC02JykuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gIGlmICh0aGlzLmNoZWNrZWQpIHtcclxuICAgIGFkZEludGVyYWN0aW9uKCk7XHJcbiAgfSBlbHNlIHtcclxuICAgIG1hcC5yZW1vdmVJbnRlcmFjdGlvbihkcmF3KTtcclxuICAgIHNlbGVjdFNvdXJjZS5jbGVhcigpO1xyXG4gIH1cclxufSk7XHJcblxyXG5cclxuLy8gdmFyIGhhbmRsZUZpbHRlcnMgPSAoZnVuY3Rpb24gaGFuZGxlRmlsdGVycygpIHtcclxuLy8gICAndXNlIHN0cmljdCc7XHJcblxyXG4vLyAgIGZ1bmN0aW9uIHNlbGVjdFJhbmdlKCkge1xyXG4vLyAgICAgJCgnI3ByaWNlU2VsZWN0JykuY2hhbmdlKGZ1bmN0aW9uIChlKSB7XHJcbi8vICAgICAgIHZhciB2YWwgPSAkKHRoaXMpLmRhdGEoJ2RhdGEtdmFsJyk7XHJcbi8vICAgICAgIGFsZXJ0KGUpO1xyXG4vLyAgICAgICBpZiAodmFsID09PSAxMDAwMDApIHtcclxuLy8gICAgICAgICAkKCcjc3RhcnRQcmljZScpLnZhbCgnMCcpLnBhcmVudCgpLmVxKDApLmFkZENsYXNzKCdpcy1kaXJ0eScpO1xyXG4vLyAgICAgICAgICQoJyNlbmRQcmljZScpLnZhbCgnMTAwMDAwJykucGFyZW50KCkuZXEoMCkuYWRkQ2xhc3MoJ2lzLWRpcnR5Jyk7XHJcbi8vICAgICAgIH0gZWxzZSBpZiAodmFsID09PSAxNTAwMDApIHtcclxuLy8gICAgICAgICAkKCcjc3RhcnRQcmljZScpLnZhbCgnMTAwMDAwJykucGFyZW50KCkuZXEoMCkuYWRkQ2xhc3MoJ2lzLWRpcnR5Jyk7XHJcbi8vICAgICAgICAgJCgnI2VuZFByaWNlJykudmFsKCcxNTAwMDAnKS5wYXJlbnQoKS5lcSgwKS5hZGRDbGFzcygnaXMtZGlydHknKTtcclxuLy8gICAgICAgfSBlbHNlIGlmICh2YWwgPT09IDIwMDAwMCkge1xyXG4vLyAgICAgICAgICQoJyNzdGFydFByaWNlJykudmFsKCcxNTAwMDAnKS5wYXJlbnQoKS5lcSgwKS5hZGRDbGFzcygnaXMtZGlydHknKTtcclxuLy8gICAgICAgICAkKCcjZW5kUHJpY2UnKS52YWwoJzIwMDAwMCcpLnBhcmVudCgpLmVxKDApLmFkZENsYXNzKCdpcy1kaXJ0eScpO1xyXG4vLyAgICAgICB9IGVsc2UgaWYgKHZhbCA9PT0gMjUwMDAwKSB7XHJcbi8vICAgICAgICAgJCgnI3N0YXJ0UHJpY2UnKS52YWwoJzIwMDAwMCcpLnBhcmVudCgpLmVxKDApLmFkZENsYXNzKCdpcy1kaXJ0eScpO1xyXG4vLyAgICAgICAgICQoJyNlbmRQcmljZScpLnZhbCgnMjUwMDAwJykucGFyZW50KCkuZXEoMCkuYWRkQ2xhc3MoJ2lzLWRpcnR5Jyk7XHJcbi8vICAgICAgIH0gZWxzZSBpZiAodmFsID09PSAzMDAwMDApIHtcclxuLy8gICAgICAgICAkKCcjc3RhcnRQcmljZScpLnZhbCgnMjUwMDAwJykucGFyZW50KCkuZXEoMCkuYWRkQ2xhc3MoJ2lzLWRpcnR5Jyk7XHJcbi8vICAgICAgICAgJCgnI2VuZFByaWNlJykudmFsKCczMDAwMDAnKS5wYXJlbnQoKS5lcSgwKS5hZGRDbGFzcygnaXMtZGlydHknKTtcclxuLy8gICAgICAgfSBlbHNlIHtcclxuLy8gICAgICAgICAkKCcjc3RhcnRQcmljZScpLnZhbCgnMjUwMDAwJykucGFyZW50KCkuZXEoMCkuYWRkQ2xhc3MoJ2lzLWRpcnR5Jyk7XHJcbi8vICAgICAgICAgJCgnI2VuZFByaWNlJykudmFsKCczMDAwMDAnKS5wYXJlbnQoKS5lcSgwKS5hZGRDbGFzcygnaXMtZGlydHknKTtcclxuLy8gICAgICAgfVxyXG4vLyAgICAgfSk7XHJcbi8vICAgfVxyXG5cclxuLy8gICByZXR1cm4ge1xyXG4vLyAgICAgc2VsZWN0UmFuZ2U6IHNlbGVjdFJhbmdlXHJcbi8vICAgfTtcclxuLy8gfSgpKTtcclxuZnVuY3Rpb24gZ2V0VmFsdWVSYW5nZShsaXN0aW5nVHlwZSkge1xyXG4gIHZhciBzYWxlVHlwZSA9IHtcclxuICAgIFNhbGU6IGZ1bmN0aW9uIHNhbGUoKSB7XHJcbiAgICAgICQoJyNzdGFydFByaWNlJykudmFsKCcwJykucGFyZW50KCkuZXEoMCkuYWRkQ2xhc3MoJ2lzLWRpcnR5Jyk7XHJcbiAgICAgICQoJyNlbmRQcmljZScpLnZhbCgnMTAwMDAwJykucGFyZW50KCkuZXEoMCkuYWRkQ2xhc3MoJ2lzLWRpcnR5Jyk7XHJcbiAgICAgICQoJyNwcmljZVNlbGVjdCcpLmNoYW5nZShmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIHZhciB2YWwgPSAkKHRoaXMpLmF0dHIoJ2RhdGEtdmFsJyk7XHJcbiAgICAgICAgaWYgKHZhbCA9PT0gJzEwMDAwMCcpIHtcclxuICAgICAgICAgICQoJyNzdGFydFByaWNlJykudmFsKCcwJykucGFyZW50KCkuZXEoMCkuYWRkQ2xhc3MoJ2lzLWRpcnR5Jyk7XHJcbiAgICAgICAgICAkKCcjZW5kUHJpY2UnKS52YWwoJzEwMDAwMCcpLnBhcmVudCgpLmVxKDApLmFkZENsYXNzKCdpcy1kaXJ0eScpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodmFsID09PSAnMTUwMDAwJykge1xyXG4gICAgICAgICAgJCgnI3N0YXJ0UHJpY2UnKS52YWwoJzEwMDAwMCcpLnBhcmVudCgpLmVxKDApLmFkZENsYXNzKCdpcy1kaXJ0eScpO1xyXG4gICAgICAgICAgJCgnI2VuZFByaWNlJykudmFsKCcxNTAwMDAnKS5wYXJlbnQoKS5lcSgwKS5hZGRDbGFzcygnaXMtZGlydHknKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHZhbCA9PT0gJzIwMDAwMCcpIHtcclxuICAgICAgICAgICQoJyNzdGFydFByaWNlJykudmFsKCcxNTAwMDAnKS5wYXJlbnQoKS5lcSgwKS5hZGRDbGFzcygnaXMtZGlydHknKTtcclxuICAgICAgICAgICQoJyNlbmRQcmljZScpLnZhbCgnMjAwMDAwJykucGFyZW50KCkuZXEoMCkuYWRkQ2xhc3MoJ2lzLWRpcnR5Jyk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh2YWwgPT09ICcyNTAwMDAnKSB7XHJcbiAgICAgICAgICAkKCcjc3RhcnRQcmljZScpLnZhbCgnMjAwMDAwJykucGFyZW50KCkuZXEoMCkuYWRkQ2xhc3MoJ2lzLWRpcnR5Jyk7XHJcbiAgICAgICAgICAkKCcjZW5kUHJpY2UnKS52YWwoJzI1MDAwMCcpLnBhcmVudCgpLmVxKDApLmFkZENsYXNzKCdpcy1kaXJ0eScpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodmFsID09PSAnMzAwMDAwJykge1xyXG4gICAgICAgICAgJCgnI3N0YXJ0UHJpY2UnKS52YWwoJzI1MDAwMCcpLnBhcmVudCgpLmVxKDApLmFkZENsYXNzKCdpcy1kaXJ0eScpO1xyXG4gICAgICAgICAgJCgnI2VuZFByaWNlJykudmFsKCczMDAwMDAnKS5wYXJlbnQoKS5lcSgwKS5hZGRDbGFzcygnaXMtZGlydHknKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgJCgnI3N0YXJ0UHJpY2UnKS52YWwoJzMwMDAwMCcpLnBhcmVudCgpLmVxKDApLmFkZENsYXNzKCdpcy1kaXJ0eScpO1xyXG4gICAgICAgICAgJCgnI2VuZFByaWNlJykudmFsKCcnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIFJlbnQ6IGZ1bmN0aW9uIHJlbnQoKSB7XHJcbiAgICAgICQoJyNzdGFydFByaWNlJykudmFsKCcwJykucGFyZW50KCkuZXEoMCkuYWRkQ2xhc3MoJ2lzLWRpcnR5Jyk7XHJcbiAgICAgICQoJyNlbmRQcmljZScpLnZhbCgnMzAwJykucGFyZW50KCkuZXEoMCkuYWRkQ2xhc3MoJ2lzLWRpcnR5Jyk7XHJcbiAgICAgICQoJyNwcmljZVNlbGVjdCcpLmNoYW5nZShmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIHZhciB2YWwgPSAkKHRoaXMpLmF0dHIoJ2RhdGEtdmFsJyk7XHJcbiAgICAgICAgaWYgKHZhbCA9PT0gJzMwMCcpIHtcclxuICAgICAgICAgICQoJyNzdGFydFByaWNlJykudmFsKCcwJykucGFyZW50KCkuZXEoMCkuYWRkQ2xhc3MoJ2lzLWRpcnR5Jyk7XHJcbiAgICAgICAgICAkKCcjZW5kUHJpY2UnKS52YWwoJzMwMCcpLnBhcmVudCgpLmVxKDApLmFkZENsYXNzKCdpcy1kaXJ0eScpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodmFsID09PSAnNDUwJykge1xyXG4gICAgICAgICAgJCgnI3N0YXJ0UHJpY2UnKS52YWwoJzMwMCcpLnBhcmVudCgpLmVxKDApLmFkZENsYXNzKCdpcy1kaXJ0eScpO1xyXG4gICAgICAgICAgJCgnI2VuZFByaWNlJykudmFsKCc0NTAnKS5wYXJlbnQoKS5lcSgwKS5hZGRDbGFzcygnaXMtZGlydHknKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHZhbCA9PT0gJzYwMCcpIHtcclxuICAgICAgICAgICQoJyNzdGFydFByaWNlJykudmFsKCc0NTAnKS5wYXJlbnQoKS5lcSgwKS5hZGRDbGFzcygnaXMtZGlydHknKTtcclxuICAgICAgICAgICQoJyNlbmRQcmljZScpLnZhbCgnNjAwJykucGFyZW50KCkuZXEoMCkuYWRkQ2xhc3MoJ2lzLWRpcnR5Jyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICQoJyNzdGFydFByaWNlJykudmFsKCc2MDAnKS5wYXJlbnQoKS5lcSgwKS5hZGRDbGFzcygnaXMtZGlydHknKTtcclxuICAgICAgICAgICQoJyNlbmRQcmljZScpLnZhbCgnJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG4gIHJldHVybiAoc2FsZVR5cGVbbGlzdGluZ1R5cGVdKSgpO1xyXG59XHJcbiQoZnVuY3Rpb24gKCkge1xyXG4gIGdldFZhbHVlUmFuZ2UoJ1JlbnQnKTtcclxuICAkKCdpbnB1dFt0eXBlPXJhZGlvXVtuYW1lPW9wdGlvbnNdJykuY2hhbmdlKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBsYW5nID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lmxhbmc7XHJcbiAgICB2YXIgdmFsdWUgPSB0aGlzLnZhbHVlO1xyXG4gICAgdmFyIHR5cGUgPSB7XHJcbiAgICAgIHJhbmdlVHlwZTogdGhpcy52YWx1ZVxyXG4gICAgfTtcclxuICAgIGlmIChsYW5nID09PSAnZW4nKSB7XHJcbiAgICAgIHR5cGUucHJpY2VUaXRsZSA9ICdDaG9vc2UgRXN0YXRlIFByaWNlJztcclxuICAgICAgdHlwZS5wcmljZSA9ICdQcmljZSc7XHJcbiAgICAgIHR5cGUuZnJvbSA9ICdGcm9tJztcclxuICAgICAgdHlwZS50byA9ICdUbyc7XHJcbiAgICAgIHR5cGUuYW5kTW9yZSA9ICdhbmQgbW9yZSc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0eXBlLnByaWNlVGl0bGUgPSAnzpXPgM65zrvOrc6+z4TOtSDOpM65zrzOriDOkc66zrnOvc6uz4TOv8+FJztcclxuICAgICAgdHlwZS5wcmljZSA9ICfOpM65zrzOric7XHJcbiAgICAgIHR5cGUuZnJvbSA9ICfOkc+Az4wnO1xyXG4gICAgICB0eXBlLnRvID0gJ86Vz47Pgic7XHJcbiAgICAgIHR5cGUuYW5kTW9yZSA9ICfOus6xzrkgz4DOrM69z4knO1xyXG4gICAgfVxyXG4gICAgZHVzdC5yZW5kZXIoJ3ZhbHVlUmFuZ2UnLCB0eXBlLCBmdW5jdGlvbiAoZXJyb3IsIGh0bWwpIHtcclxuICAgICAgJCgnLnByaWNlU2VsZWN0JykuaHRtbChodG1sKTtcclxuICAgICAgLy8gY29tcG9uZW50SGFuZGxlci51cGdyYWRlQWxsUmVnaXN0ZXJlZCgpO1xyXG4gICAgICBnZXRtZGxTZWxlY3QuaW5pdCgnLmdldG1kbC1zZWxlY3QnKTtcclxuICAgICAgZ2V0VmFsdWVSYW5nZSh2YWx1ZSk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgKTtcclxuICAkKCcjYWR2YW5jZWQtZmlsdGVycycpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIGlmICgkKCcjZXN0YXRlLWZpbHRlcnMnKS5oYXNDbGFzcygndmlzdWFsbHloaWRkZW4nKSkge1xyXG4gICAgICAkKCcjZXN0YXRlLWZpbHRlcnMnKS5yZW1vdmVDbGFzcygndmlzdWFsbHloaWRkZW4nKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICQoJyNlc3RhdGUtZmlsdGVycycpLmFkZENsYXNzKCd2aXN1YWxseWhpZGRlbicpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gICQoJyN0b2dnbGUtcHJpY2UtcmFuZ2UnKS5vbignY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xyXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIGlmICgkKCcjcHJpY2UtcmFuZ2UnKS5oYXNDbGFzcygndmlzdWFsbHloaWRkZW4nKSkge1xyXG4gICAgICAkKCcjcHJpY2UtcmFuZ2UnKS5yZW1vdmVDbGFzcygndmlzdWFsbHloaWRkZW4nKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICQoJyNwcmljZS1yYW5nZScpLmFkZENsYXNzKCd2aXN1YWxseWhpZGRlbicpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59KTtcclxuZnVuY3Rpb24gcHJldmVudERvdEFuZFNwYWNlKGUpIHtcclxuICB2YXIga2V5ID0gZS5jaGFyQ29kZSA/IGUuY2hhckNvZGUgOiBlLmtleUNvZGU7XHJcbiAgdGhpcy5pbm5lckhUTUwgPSBrZXk7XHJcbiAgaWYgKGtleSA9PT0gNDYgfHwga2V5ID09PSAzMikge1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufVxyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gIHZhciBnZW9sb2NhdGlvbiA9IG5ldyBvbC5HZW9sb2NhdGlvbih7XHJcbiAgICAvLyB0YWtlIHRoZSBwcm9qZWN0aW9uIHRvIHVzZSBmcm9tIHRoZSBtYXAncyB2aWV3XHJcbiAgICBwcm9qZWN0aW9uOiBtYXAuZ2V0VmlldygpLmdldFByb2plY3Rpb24oKSxcclxuICAgIHRyYWNraW5nT3B0aW9uczoge1xyXG4gICAgICBtYXhpbXVtQWdlOiAxMDAwMCxcclxuICAgICAgZW5hYmxlSGlnaEFjY3VyYWN5OiB0cnVlLFxyXG4gICAgICB0aW1lb3V0OiA2MDAwMDBcclxuICAgIH1cclxuICB9KTtcclxuICB2YXIgYWNjdXJhY3lGZWF0dXJlID0gbmV3IG9sLkZlYXR1cmUoKTtcclxuICBnZW9sb2NhdGlvbi5vbignY2hhbmdlOmFjY3VyYWN5R2VvbWV0cnknLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBhY2N1cmFjeUZlYXR1cmUuc2V0R2VvbWV0cnkoZ2VvbG9jYXRpb24uZ2V0QWNjdXJhY3lHZW9tZXRyeSgpKTtcclxuICB9KTtcclxuICB2YXIgcG9zaXRpb25GZWF0dXJlID0gbmV3IG9sLkZlYXR1cmUoKTtcclxuICBwb3NpdGlvbkZlYXR1cmUuc2V0U3R5bGUobmV3IG9sLnN0eWxlLlN0eWxlKHtcclxuICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuQ2lyY2xlKHtcclxuICAgICAgcmFkaXVzOiA2LFxyXG4gICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7IGNvbG9yOiAnIzMzOTlDQycgfSksXHJcbiAgICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7IGNvbG9yOiAnI2ZmZicsIHdpZHRoOiAyIH0pXHJcbiAgICB9KVxyXG4gIH0pKTtcclxuICAvLyBsaXN0ZW4gdG8gY2hhbmdlcyBpbiBwb3NpdGlvblxyXG4gIGdlb2xvY2F0aW9uLm9uKCdjaGFuZ2U6cG9zaXRpb24nLCBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgY29vcmRpbmF0ZXMgPSBnZW9sb2NhdGlvbi5nZXRQb3NpdGlvbigpO1xyXG4gICAgcG9zaXRpb25GZWF0dXJlLnNldEdlb21ldHJ5KGNvb3JkaW5hdGVzXHJcbiAgICAgID8gbmV3IG9sLmdlb20uUG9pbnQoY29vcmRpbmF0ZXMpXHJcbiAgICAgIDogbnVsbCk7XHJcbiAgfSk7XHJcbiAgZmVhdHVyZXNPdmVybGF5U291cmNlID0gbmV3IG9sLnNvdXJjZS5WZWN0b3Ioe30pO1xyXG4gIHZhciBmZWF0dXJlc092ZXJsYXkgPSBuZXcgb2wubGF5ZXIuVmVjdG9yKHsgbWFwOiBtYXAsIHNvdXJjZTogZmVhdHVyZXNPdmVybGF5U291cmNlIH0pO1xyXG4gICQoJy5nZW9sb2NhdGlvbicpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgaWYgKCQodGhpcykucHJvcCgnY2hlY2tlZCcpID09PSB0cnVlKSB7XHJcbiAgICAgIGdlb2xvY2F0aW9uLnNldFRyYWNraW5nKHRydWUpO1xyXG4gICAgICBmZWF0dXJlc092ZXJsYXlTb3VyY2UuYWRkRmVhdHVyZXMoW3Bvc2l0aW9uRmVhdHVyZSwgYWNjdXJhY3lGZWF0dXJlXSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBnZW9sb2NhdGlvbi5zZXRUcmFja2luZyhmYWxzZSk7XHJcbiAgICAgIGZlYXR1cmVzT3ZlcmxheVNvdXJjZS5jbGVhcigpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59KCkpO1xyXG4iLCJmdW5jdGlvbiBoYW5kbGVJbmZvKGV2dCkge1xyXG4gIHZhciBjb29yZGluYXRlID0gZXZ0LmNvb3JkaW5hdGU7XHJcbiAgdmFyIG9iaiA9IHt9O1xyXG4gIHZhciB0aXRsZSA9IHt9O1xyXG4gIHZhciBvd25lciA9IHt9O1xyXG4gIHZhciBmZWF0dXJlcyA9IFtdO1xyXG4gIHZhciBjbGlja2VkRmVhdHVyZTtcclxuICB2YXIgZjtcclxuXHJcbiAgbWFwLnJlbW92ZUludGVyYWN0aW9uKGRyYXcpO1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIG9iai50aXRsZSA9IHRpdGxlO1xyXG4gIGlmIChsYW5nID09PSAnZWwnKSB7XHJcbiAgICB0aXRsZS5naWQgPSAnzprPic60zrnOus+Mz4IgzpnOtM65zr/Ous+EzrfPg86vzrHPgic7XHJcbiAgICB0aXRsZS50eXBlID0gJ86Vzq/OtM6/z4IgzpnOtM65zr/Ous+EzrfPg86vzrHPgic7XHJcbiAgICB0aXRsZS5saXN0aW5nX3R5cGUgPSAnzqTPjc+Azr/PgiDOkc6zzrPOtc67zq/Osc+CJztcclxuICAgIHRpdGxlLmFyZWEgPSAnzpXOvM6yzrHOtM+MJztcclxuICAgIHRpdGxlLmFkZHJlc3MgPSAnzpTOuc61z4XOuM+Fzr3Pg863JztcclxuICAgIHRpdGxlLmJlZHJvb21zID0gJ86lz4DOvc6/zrTPic68zqzPhM65zrEnO1xyXG4gICAgdGl0bGUucHJpY2UgPSAnzqTOuc68zq4nO1xyXG4gICAgdGl0bGUuaXNuZXcgPSAnzp3Otc+MzrTOvM63z4TOvyc7XHJcbiAgICB0aXRsZS5wYXJraW5nID0gJ86jz4TOrM64zrzOtc+DzrcnO1xyXG4gICAgdGl0bGUuZnVybmlzaGVkID0gJ86Vz4DOuc+AzrvPic68zq3Ovc6/JztcclxuICAgIHRpdGxlLnBldHMgPSAnzprOsc+Ezr/Ouc66zq/OtM65zrEnO1xyXG4gICAgdGl0bGUudmlldyA9ICfOmM6tzrEnO1xyXG4gICAgdGl0bGUuaGVhdGluZyA9ICfOmM6tz4HOvM6xzr3Pg863JztcclxuICAgIHRpdGxlLmNvb2xpbmcgPSAnzqjPjc6+zrcnO1xyXG4gICAgdGl0bGUuY29udGFjdEluZm8gPSAnzqPPhM6/zrnPh861zq/OsSDOlc+AzrnOus6/zrnOvc+Jzr3Or86xz4InO1xyXG4gICAgdGl0bGUubmFtZSA9ICfOjM69zr/OvM6xJztcclxuICAgIHRpdGxlLmxhc3RuYW1lID0gJ86Vz4DOr864zrXPhM6/JztcclxuICAgIHRpdGxlLnBob25lID0gJ86kzrfOu86tz4bPic69zr8nO1xyXG4gICAgdGl0bGUuZW1haWwgPSAnzpfOu861zrrPhM+Bzr/Ovc65zrrOriDOlM65zrXPjc64z4XOvc+DzrcnO1xyXG4gIH0gZWxzZSB7XHJcbiAgICB0aXRsZS5naWQgPSAnRXN0YXRlIENvZGUnO1xyXG4gICAgdGl0bGUudHlwZSA9ICdQcm9wZXJ0eSBUeXBlJztcclxuICAgIHRpdGxlLmxpc3RpbmdfdHlwZSA9ICdMaXN0aW5nIFR5cGUnO1xyXG4gICAgdGl0bGUuYXJlYSA9ICdTaXplJztcclxuICAgIHRpdGxlLmFkZHJlc3MgPSAnQWRkcmVzcyc7XHJcbiAgICB0aXRsZS5iZWRyb29tcyA9ICdCZWRyb29tcyc7XHJcbiAgICB0aXRsZS5wcmljZSA9ICdQcmljZSc7XHJcbiAgICB0aXRsZS5pc25ldyA9ICdOZXdseSBCdWlsZCc7XHJcbiAgICB0aXRsZS5wYXJraW5nID0gJ1BhcmtpbmcnO1xyXG4gICAgdGl0bGUuZnVybmlzaGVkID0gJ0Z1cm5pc2hlZCc7XHJcbiAgICB0aXRsZS5wZXRzID0gJ1BldHMgQWxsb3dlZCc7XHJcbiAgICB0aXRsZS52aWV3ID0gJ1ZpZXcnO1xyXG4gICAgdGl0bGUuaGVhdGluZyA9ICdIZWF0aW5nJztcclxuICAgIHRpdGxlLmNvb2xpbmcgPSAnQ29vbGluZyc7XHJcbiAgICB0aXRsZS5jb250YWN0SW5mbyA9ICdDb250YWN0IEluZm8nO1xyXG4gICAgdGl0bGUubmFtZSA9ICdOYW1lJztcclxuICAgIHRpdGxlLmxhc3RuYW1lID0gJ0xhc3QgTmFtZSc7XHJcbiAgICB0aXRsZS5waG9uZSA9ICdUZWxlcGhvbmUnO1xyXG4gICAgdGl0bGUuZW1haWwgPSAnRW1haWwnO1xyXG4gIH1cclxuICBjbGlja2VkRmVhdHVyZSA9IG1hcC5mb3JFYWNoRmVhdHVyZUF0UGl4ZWwoZXZ0LnBpeGVsLCBmdW5jdGlvbiAoZmVhdHVyZSwgbGF5ZXIpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGZlYXR1cmU6IGZlYXR1cmUsXHJcbiAgICAgIGxheWVyOiBsYXllclxyXG4gICAgfTtcclxuICB9LCB0aGlzLCBmdW5jdGlvbiAobGF5ZXIpIHtcclxuICAgIGlmIChsYXllci5nZXQoJ2lkJykgPT09ICdlc3RhdGVzJyB8fCBsYXllci5nZXQoJ2lkJykgPT09ICdmaWx0ZXJlZEVzdGF0ZXMnKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH0sIHRoaXMpO1xyXG4gIGlmIChjbGlja2VkRmVhdHVyZSkge1xyXG4gICAgaWYgKGNsaWNrZWRGZWF0dXJlLmxheWVyLmdldCgnaWQnKSA9PT0gJ2VzdGF0ZXMnICYmIGNsaWNrZWRGZWF0dXJlLmZlYXR1cmUuZ2V0KCdmZWF0dXJlcycpLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICBmID0gY2xpY2tlZEZlYXR1cmUuZmVhdHVyZS5nZXRQcm9wZXJ0aWVzKCkuZmVhdHVyZXNbMF07XHJcbiAgICAgIGNyZWF0ZVBTQWFuZENhcmQoZiwgb2JqKTtcclxuICAgIH0gZWxzZSBpZiAoY2xpY2tlZEZlYXR1cmUubGF5ZXIuZ2V0KCdpZCcpID09PSAnZmlsdGVyZWRFc3RhdGVzJykge1xyXG4gICAgICBmID0gY2xpY2tlZEZlYXR1cmUuZmVhdHVyZTtcclxuICAgICAgY3JlYXRlUFNBYW5kQ2FyZChmLCBvYmopO1xyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICBQU0Euc2V0U291cmNlKG51bGwpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlUFNBYW5kQ2FyZChmLCBvYmopIHtcclxuICB2YXIgZmVhdHVyZSA9IHt9O1xyXG4gIGZlYXR1cmUuZ2lkID0gZi5nZXQoJ2dpZCcpO1xyXG4gIGZlYXR1cmUuYXJlYSA9IGYuZ2V0KCdlc3RhdGVhcmVhJyk7XHJcbiAgaWYgKGxhbmcgPT09ICdlbCcpIHtcclxuICAgIGZlYXR1cmUudHlwZSA9IGYuZ2V0KCdlc3RhdGV0eXBlJyk7XHJcbiAgICBmZWF0dXJlLmFkZHJlc3MgPSBmLmdldCgnc3RyZWV0X2VsJykgKyAnICcgKyBmLmdldCgnc3RyZWV0X251bWJlcicpO1xyXG4gICAgZmVhdHVyZS5uYW1lID0gZi5nZXQoJ25hbWVfZWwnKTtcclxuICAgIGZlYXR1cmUubGFzdG5hbWUgPSBmLmdldCgnbGFzdG5hbWVfZWwnKTtcclxuICAgIGlmIChmLmdldCgnc2FsZScpID09PSB0cnVlKSB7XHJcbiAgICAgIGZlYXR1cmUubGlzdGluZ190eXBlID0gJ86gz47Ou863z4POtyc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBmZWF0dXJlLmxpc3RpbmdfdHlwZSA9ICfOlc69zr/Ouc66zq/Osc+DzrcnO1xyXG4gICAgfVxyXG4gICAgZmVhdHVyZS5idG5zID0ge1xyXG4gICAgICBpbmZvOiAnz4DOu863z4HOv8+Gzr/Pgc65zrXPgicsXHJcbiAgICAgIGNsb3NlOiAnzrrOu861zrnPg865zrzOvydcclxuICAgIH07XHJcbiAgfSBlbHNlIHtcclxuICAgIGZlYXR1cmUudHlwZSA9IGYuZ2V0KCdlc3RhdGV0eXBlX2VuJyk7XHJcbiAgICBmZWF0dXJlLmFkZHJlc3MgPSBmLmdldCgnc3RyZWV0X2VuJykgKyAnICcgKyBmLmdldCgnc3RyZWV0X251bWJlcicpO1xyXG4gICAgZmVhdHVyZS5uYW1lID0gZi5nZXQoJ25hbWVfZW4nKTtcclxuICAgIGZlYXR1cmUubGFzdG5hbWUgPSBmLmdldCgnbGFzdG5hbWVfZW4nKTtcclxuICAgIGlmIChmLmdldCgnc2FsZScpID09PSB0cnVlKSB7XHJcbiAgICAgIGZlYXR1cmUubGlzdGluZ190eXBlID0gJ1NhbGUnO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZmVhdHVyZS5saXN0aW5nX3R5cGUgPSAnUmVudCc7XHJcbiAgICB9XHJcbiAgICBmZWF0dXJlLmJ0bnMgPSB7XHJcbiAgICAgIGluZm86ICdpbmZvJyxcclxuICAgICAgY2xvc2U6ICdjbG9zZSdcclxuICAgIH07XHJcbiAgfVxyXG4gIGZlYXR1cmUuYmVkcm9vbXMgPSBmLmdldCgnYmVkcm9vbXMnKTtcclxuICBmZWF0dXJlLnByaWNlID0gZi5nZXQoJ3ByaWNlJyk7XHJcbiAgZmVhdHVyZS5pc25ldyA9IGYuZ2V0KCdpc25ldycpO1xyXG4gIGZlYXR1cmUucGFya2luZyA9IGYuZ2V0KCdwYXJraW5nJyk7XHJcbiAgZmVhdHVyZS5mdXJuaXNoZWQgPSBmLmdldCgnZnVybmlzaGVkJyk7XHJcbiAgZmVhdHVyZS5wZXRzID0gZi5nZXQoJ3BldHMnKTtcclxuICBmZWF0dXJlLnZpZXcgPSBmLmdldCgndmlldycpO1xyXG4gIGZlYXR1cmUuaGVhdGluZyA9IGYuZ2V0KCdoZWF0aW5nJyk7XHJcbiAgZmVhdHVyZS5jb29saW5nID0gZi5nZXQoJ2Nvb2xpbmcnKTtcclxuICBmZWF0dXJlLnBob25lID0gZi5nZXQoJ3Bob25lMScpO1xyXG4gIGZlYXR1cmUuZW1haWwgPSBmLmdldCgnZW1haWwnKTtcclxuICBmZWF0dXJlLmNvb3JkaW5hdGUgPSBmLmdldCgnZ2VvbWV0cnknKS5nZXRDb29yZGluYXRlcygpO1xyXG5cclxuICB2YXIgUFNBU291cmNlID0gbmV3IG9sLnNvdXJjZS5WZWN0b3Ioe1xyXG4gICAgYXR0cmlidXRpb25zOiBbbmV3IG9sLkF0dHJpYnV0aW9uKHtcclxuICAgICAgaHRtbDogJ1BPSSBieSAnICsgJzxhIGhyZWY9XCJodHRwOi8vd3d3LnRlcnJhY29nbml0YS5nci9cIj5UZXJyYSBDb2duaXRhPC9hPidcclxuICAgIH0pXSxcclxuICAgIGZvcm1hdDogZ2VvSlNPTkZvcm1hdCxcclxuICAgIGxvYWRlcjogZnVuY3Rpb24gKGV4dGVudCwgcmVzb2x1dGlvbiwgcHJvamVjdGlvbikge1xyXG4gICAgICB2YXIgdXJsID0gJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9kYi91c2VzLycgKyBmZWF0dXJlLmdpZDtcclxuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAkLmFqYXgoe1xyXG4gICAgICAgIHVybDogdXJsLFxyXG4gICAgICAgIHR5cGU6ICdHRVQnLFxyXG4gICAgICAgIGRhdGFUeXBlOiAnanNvbidcclxuICAgICAgfSkuZG9uZShmdW5jdGlvbiBzdWNjZWRlZChkYXRhLCB0ZXh0U3RhdHVzLCBqcVhIUikge1xyXG4gICAgICAgIHZhciBmZWF0dXJlcyA9IGdlb0pTT05Gb3JtYXQucmVhZEZlYXR1cmVzKGRhdGEucHJvcGVydHlfc2VydmljZXNfYW5hbHlzaXMsIHtcclxuICAgICAgICAgIGZlYXR1cmVQcm9qZWN0aW9uOiAnRVBTRzozODU3J1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHZhciBmZWF0dXJlc0xlbmd0aCA9IGZlYXR1cmVzLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgdmFyIGFyZWEgPSBuZXcgb2wuc3R5bGUuU3R5bGUoe1xyXG4gICAgICAgICAgZmlsbDogbmV3IG9sLnN0eWxlLkZpbGwoe1xyXG4gICAgICAgICAgICBjb2xvcjogWzE1NiwgMzksIDE3NiwgMC4xXVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9KTtcclxuICAgICAgICBmZWF0dXJlc1swXS5zZXRTdHlsZShhcmVhKTtcclxuICAgICAgICBzZWxmLmFkZEZlYXR1cmVzKGZlYXR1cmVzKTtcclxuICAgICAgICB0b2FzdHIuY2xlYXIoKTtcclxuICAgICAgICB0b2FzdHIuaW5mbygnRm91bmQgJyArIGZlYXR1cmVzTGVuZ3RoICsgJyBQb2ludHMgb2YgSW50ZXJlc3QgaW4gOCBtaW51dGUgZGlzdGFuY2UhJyk7XHJcbiAgICAgIH0pLmZhaWwoZnVuY3Rpb24gZmFpbGVkKGpxWEhSKSB7XHJcbiAgICAgICAgdG9hc3RyLmNsZWFyKCk7XHJcbiAgICAgICAgaWYgKGpxWEhSLnN0YXR1cyA9PT0gNDA0KSB7XHJcbiAgICAgICAgICB0b2FzdHIuZXJyb3IoJ1NvcnJ5LCB3ZSBjYW5ub3QgZmluZCBhbnkgUG9pbnRzIG9mIEludGVyZXN0IGluIDggbWludXRlIGRpc3RhbmNlIScpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoanFYSFIuc3RhdHVzID09PSA1MDMpIHtcclxuICAgICAgICAgIHRvYXN0ci5lcnJvcignU2VydmljZSBVbmF2YWlsYWJsZScpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0b2FzdHIuZXJyb3IoJ0ludGVybmFsIFNlcnZlciBFcnJvcicpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgc3RyYXRlZ3k6IG9sLmxvYWRpbmdzdHJhdGVneS5hbGxcclxuICB9KTtcclxuICBQU0Euc2V0U291cmNlKFBTQVNvdXJjZSk7XHJcbiAgbWFwLmdldFZpZXcoKS5zZXRDZW50ZXIoZmVhdHVyZS5jb29yZGluYXRlKTtcclxuICBtYXAuZ2V0VmlldygpLnNldFJlc29sdXRpb24oMS4yKTtcclxuICBvYmouZmVhdHVyZSA9IGZlYXR1cmU7XHJcblxyXG4gIGR1c3QucmVuZGVyKCdlc3RhdGVDYXJkcycsIG9iaiwgZnVuY3Rpb24gcmVuZGVyRXN0YXRlQ2FyZHMoZXJyLCBvdXQpIHtcclxuICAgICQoJy5lc3RhdGUtY2FyZHMnKS5odG1sKG91dCk7XHJcbiAgICAkKCcubWRsLWNhcmRfX3RpdGxlJykuY3NzKCdiYWNrZ3JvdW5kLWltYWdlJywgJ3VybChodHRwOi8vcmVzLmNsb3VkaW5hcnkuY29tL2ZpcnZhaW4vaW1hZ2UvdXBsb2FkL3dfNDMyLGNfc2NhbGUvJyArIG9iai5mZWF0dXJlLmdpZCArICcuanBnKScpO1xyXG4gICAgJCgnLmVzdGF0ZS1jYXJkcycpLmFkZENsYXNzKCdlc3RhdGUtY2FyZHMtYWN0aXZlJyk7XHJcbiAgLy8gJChcIiNpbmZvYm94XCIpLmFkZENsYXNzKFwidmlzdWFsbHloaWRkZW5cIik7XHJcbiAgfSk7XHJcbiAgJCgnYVtocmVmPVwiI29wZW5Nb2RhbFwiXScpLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgIGR1c3QucmVuZGVyKCdtb2RhbEluZm8nLCBvYmosIGZ1bmN0aW9uIHJlbmRlck1vZGFsSW5mbyhlcnIsIG91dCkge1xyXG4gICAgICAkKCcubW9kYWwtY29udGVudCcpLmh0bWwob3V0KTtcclxuICAgICAgJCgnLmJpZy1pbWFnZScpLmNzcygnYmFja2dyb3VuZC1pbWFnZScsICd1cmwoaHR0cDovL3Jlcy5jbG91ZGluYXJ5LmNvbS9maXJ2YWluL2ltYWdlL3VwbG9hZC9oXzIyMixjX3NjYWxlLycgKyBvYmouZmVhdHVyZS5naWQgKyAnLmpwZyknKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG4gICQoJ2FbaHJlZj1cIiNjbG9zZUVzdGF0ZUNhcmRcIl0nKS5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICAkKCcuZXN0YXRlLWNhcmRzJykucmVtb3ZlQ2xhc3MoJ2VzdGF0ZS1jYXJkcy1hY3RpdmUnKTtcclxuICB9KTtcclxufVxyXG4kKCcjaW5mb3JtYXRpb24nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gIFBTQS5zZXRTb3VyY2UobnVsbCk7XHJcbiAgaWYgKCQodGhpcykucHJvcCgnY2hlY2tlZCcpID09PSB0cnVlKSB7XHJcbiAgICBtYXAub24oJ2NsaWNrJywgaGFuZGxlSW5mbyk7XHJcbiAgICAkKHRoaXMpLnBhcmVudCgpLnNpYmxpbmdzKCkuZmluZCgnaW5wdXQnKS5lYWNoKGZ1bmN0aW9uICgpIHskKHRoaXMpLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7fSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIG1hcC51bignY2xpY2snLCBoYW5kbGVJbmZvKTtcclxuICAgICQodGhpcykucGFyZW50KCkuc2libGluZ3MoKS5maW5kKCdpbnB1dCcpLmVhY2goZnVuY3Rpb24gKCkgeyQodGhpcykucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSk7fSk7XHJcbiAgfVxyXG59KTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICB2YXIgbWFya2VyID0gbmV3IG9sLkZlYXR1cmUoKTtcclxuICB2YXIgaWNvblN0eWxlID0gbmV3IG9sLnN0eWxlLlN0eWxlKHtcclxuICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuSWNvbigvKiogQHR5cGUge29seC5zdHlsZS5JY29uT3B0aW9uc30gKi9cclxuICAgICh7XHJcbiAgICAgIGFuY2hvcjogW1xyXG4gICAgICAgIDAuNSwgMVxyXG4gICAgICBdLFxyXG4gICAgICBhbmNob3JYVW5pdHM6ICdmcmFjdGlvbicsXHJcbiAgICAgIGFuY2hvcllVbml0czogJ2ZyYWN0aW9uJyxcclxuICAgICAgb3BhY2l0eTogMSxcclxuICAgICAgc2NhbGU6IDEsXHJcbiAgICAgIHNyYzogJy4uL2ltYWdlcy9tYXAtaWNvbnMvcGlucy8yNC9waW4xLnBuZycsXHJcbiAgICAgIHNuYXBUb1BpeGVsOiBmYWxzZVxyXG4gICAgfSkpLFxyXG4gICAgekluZGV4OiAxMDBcclxuICB9KTtcclxuICBtYXJrZXIuc2V0U3R5bGUoaWNvblN0eWxlKTtcclxuICB2YXIgZmVhdHVyZXNPdmVybGF5U3R5bGUgPSBuZXcgb2wuc3R5bGUuU3R5bGUoe1xyXG4gICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcclxuICAgICAgY29sb3I6ICcjNDA4MDgwJyxcclxuICAgICAgd2lkdGg6IDUsXHJcbiAgICAgIGxpbmVEYXNoOiBbNCwgNF1cclxuICAgIH0pXHJcbiAgfSk7XHJcbiAgdmFyIGZlYXR1cmVzT3ZlcmxheSA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xyXG4gICAgbWFwOiBtYXAsXHJcbiAgICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuVmVjdG9yKCksXHJcbiAgICBzdHlsZTogZmVhdHVyZXNPdmVybGF5U3R5bGUsXHJcbiAgICBpZDogJ3JvdXRlJyxcclxuICAgIG5hbWVFbDogJ86UzrnOsc60z4HOv868zq4nLFxyXG4gICAgTmFtZUVuOiAnUm91dGUnXHJcbiAgfSk7XHJcbiAgdmFyIHJvdXRlQ29vcmRzID0gW107XHJcbiAgZnVuY3Rpb24gaGFuZGxlTWFya2VyKGV2ZW50KSB7XHJcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgdmFyIGZlYXR1cmVDb3VudCA9IGZlYXR1cmVzT3ZlcmxheS5nZXRTb3VyY2UoKS5nZXRGZWF0dXJlcygpLmxlbmd0aDtcclxuICAgIHZhciBjb29yZGluYXRlcyA9IGV2ZW50LmNvb3JkaW5hdGU7XHJcbiAgICBpZiAoZmVhdHVyZUNvdW50ID09PSAwKSB7XHJcbiAgICAgIG1hcmtlci5zZXRHZW9tZXRyeShuZXcgb2wuZ2VvbS5Qb2ludChjb29yZGluYXRlcykpO1xyXG4gICAgICBtYXJrZXIuc2V0SWQoJ2ZpcnN0Jyk7XHJcbiAgICAgIGZlYXR1cmVzT3ZlcmxheS5nZXRTb3VyY2UoKS5hZGRGZWF0dXJlKG1hcmtlcik7XHJcbiAgICAgIHJvdXRlQ29vcmRzWzBdID0gY29vcmRpbmF0ZXNbMF07XHJcbiAgICAgIHJvdXRlQ29vcmRzWzFdID0gY29vcmRpbmF0ZXNbMV07XHJcbiAgICB9IGVsc2UgaWYgKGZlYXR1cmVDb3VudCA9PT0gMSkge1xyXG4gICAgICB2YXIgY2xvbmUgPSBtYXJrZXIuY2xvbmUoKTtcclxuICAgICAgY2xvbmUuc2V0R2VvbWV0cnkobmV3IG9sLmdlb20uUG9pbnQoY29vcmRpbmF0ZXMpKTtcclxuICAgICAgY2xvbmUuc2V0SWQoJ3NlY29uZCcpO1xyXG4gICAgICBmZWF0dXJlc092ZXJsYXkuZ2V0U291cmNlKCkuYWRkRmVhdHVyZShjbG9uZSk7XHJcbiAgICAgIHJvdXRlQ29vcmRzWzJdID0gY29vcmRpbmF0ZXNbMF07XHJcbiAgICAgIHJvdXRlQ29vcmRzWzNdID0gY29vcmRpbmF0ZXNbMV07XHJcbiAgICAgIGNhbGxSb3V0ZShyb3V0ZUNvb3Jkcyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBmZWF0dXJlc092ZXJsYXkuZ2V0U291cmNlKCkuY2xlYXIoKTtcclxuICAgIH1cclxuICB9XHJcbiAgZ2VvSlNPTkZvcm1hdCA9IG5ldyBvbC5mb3JtYXQuR2VvSlNPTih7IGRlZmF1bHREYXRhUHJvamVjdGlvbjogJ0VQU0c6NDMyNicsIGdlb21ldHJ5TmFtZTogJ2dlb21ldHJ5JyB9KTtcclxuICBmdW5jdGlvbiBjYWxsUm91dGUocm91dGVDb29yZHMpIHtcclxuICAgIHZhciBmaXJzdCA9IG9sLnByb2oudHJhbnNmb3JtKFtcclxuICAgICAgcm91dGVDb29yZHNbMF0sIHJvdXRlQ29vcmRzWzFdXHJcbiAgICBdLCAnRVBTRzozODU3JywgJ0VQU0c6NDMyNicpO1xyXG4gICAgdmFyIHNlY29uZCA9IG9sLnByb2oudHJhbnNmb3JtKFtcclxuICAgICAgcm91dGVDb29yZHNbMl0sIHJvdXRlQ29vcmRzWzNdXHJcbiAgICBdLCAnRVBTRzozODU3JywgJ0VQU0c6NDMyNicpO1xyXG4gICAgdmFyIHgxID0gZmlyc3RbMF07XHJcbiAgICB2YXIgeTEgPSBmaXJzdFsxXTtcclxuICAgIHZhciB4MiA9IHNlY29uZFswXTtcclxuICAgIHZhciB5MiA9IHNlY29uZFsxXTtcclxuICAgICQuYWpheCh7XHJcbiAgICAgIHVybDogJ2h0dHBzOi8vYXBpLm1hcGJveC5jb20vdjQvZGlyZWN0aW9ucy9tYXBib3guZHJpdmluZy8nICsgeDEgKyAnLCcgKyB5MSArICc7JyArIHgyICsgJywnICsgeTIgKyAnLmpzb24/YWx0ZXJuYXRpdmVzPWZhbHNlJmFjY2Vzc190b2tlbj1way5leUoxSWpvaVptbHlkbUZwYmlJc0ltRWlPaUpsT1dZeVlUTTBOVGhpTldNMFlqSmpPREpqTkRFNE9EUXpOekEyTUdReU5pSjkuLU5WRE8yN0h6dC13X25Rb3NVUGZMQScsXHJcbiAgICAgIHR5cGU6ICdHRVQnLFxyXG4gICAgICBkYXRhVHlwZTogJ2pzb24nXHJcbiAgICB9KS5kb25lKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgIHZhciByb3V0ZSA9IHt9O1xyXG4gICAgICByb3V0ZS50eXBlID0gJ0ZlYXR1cmUnO1xyXG4gICAgICByb3V0ZS5nZW9tZXRyeSA9IGRhdGEucm91dGVzWzBdLmdlb21ldHJ5O1xyXG4gICAgICBmZWF0dXJlc092ZXJsYXkuZ2V0U291cmNlKCkuYWRkRmVhdHVyZXMoZ2VvSlNPTkZvcm1hdC5yZWFkRmVhdHVyZXMocm91dGUsIHtcclxuICAgICAgICBkYXRhUHJvamVjdGlvbjogJ0VQU0c6NDMyNicsXHJcbiAgICAgICAgZmVhdHVyZVByb2plY3Rpb246ICdFUFNHOjM4NTcnXHJcbiAgICAgIH0pKTtcclxuICAgICAgbWFwLmdldFZpZXcoKS5maXQoZmVhdHVyZXNPdmVybGF5LmdldFNvdXJjZSgpLmdldEV4dGVudCgpLCBtYXAuZ2V0U2l6ZSgpKTtcclxuICAgIH0pLmZhaWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAvLyBjb25zb2xlLmxvZyhcImVycm9yXCIpO1xyXG4gICAgfSkuYWx3YXlzKGZ1bmN0aW9uICgpIHtcclxuICAgICAgLy8gY29uc29sZS5sb2coXCJjb21wbGV0ZVwiKTtcclxuICAgIH0pO1xyXG4gIH1cclxuICAkKCcjbWFya2VyJykub24oJ2NoYW5nZScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIC8qIEFjdCBvbiB0aGUgZXZlbnQgKi9cclxuICAgIGlmICgkKHRoaXMpLnByb3AoJ2NoZWNrZWQnKSA9PT0gdHJ1ZSkge1xyXG4gICAgICBtYXAub24oJ3NpbmdsZWNsaWNrJywgaGFuZGxlTWFya2VyKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIG1hcC51bignc2luZ2xlY2xpY2snLCBoYW5kbGVNYXJrZXIpO1xyXG4gICAgICBmZWF0dXJlc092ZXJsYXkuZ2V0U291cmNlKCkuY2xlYXIoKTtcclxuICAgIH1cclxuICB9KTtcclxufSgpKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAkKCcjd2VhdGhlcicpLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgIGlmICgkKHRoaXMpLnByb3AoJ2NoZWNrZWQnKSA9PT0gdHJ1ZSkge1xyXG4gICAgICAkKHRoaXMpLnBhcmVudCgpLnNpYmxpbmdzKCkuZmluZCgnaW5wdXQnKS5lYWNoKGZ1bmN0aW9uICgpIHskKHRoaXMpLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7fSk7XHJcbiAgICAgIG1hcC5nZXRPdmVybGF5cygpLmZvckVhY2goZnVuY3Rpb24gKG92bCkge1xyXG4gICAgICAgIGlmIChvdmwuZ2V0KCduYW1lJykgPT09ICd3ZWF0aGVyJykge1xyXG4gICAgICAgICAgKCQob3ZsLmdldEVsZW1lbnQoKSkucGFyZW50KCkpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgJChvdmwuZ2V0RWxlbWVudCgpKS5yZW1vdmUoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICB2YXIgY2VudGVyID0gb2wucHJvai50cmFuc2Zvcm0obWFwLmdldFZpZXcoKS5nZXRDZW50ZXIoKSwgJ0VQU0c6Mzg1NycsICdFUFNHOjQzMjYnKTtcclxuICAgICAgdmFyIGxhdCA9IGNlbnRlclsxXTtcclxuICAgICAgdmFyIGxvbiA9IGNlbnRlclswXTtcclxuICAgICAgJC5hamF4KHtcclxuICAgICAgICB1cmw6ICdodHRwOi8vYXBpLm9wZW53ZWF0aGVybWFwLm9yZy9kYXRhLzIuNS9maW5kP2xhdD0nICsgbGF0ICsgJyZsb249JyArIGxvbiArICcmY250PTUmY2x1c3Rlcj1ubyZ1bml0cz1tZXRyaWMmdHlwZT1hY2N1cmF0ZSZBUFBJRD1mOWNkOWZhMmM0MjdjM2IxMTVlODdlNDg2MjYxOWM1YycsXHJcbiAgICAgICAgdHlwZTogJ0dFVCcsXHJcbiAgICAgICAgZGF0YVR5cGU6ICdqc29uJ1xyXG4gICAgICB9KS5kb25lKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlV2VhdGhlck92ZXJsYXkocG9zaXRpb24sIGluZGV4KSB7XHJcbiAgICAgICAgICB2YXIgZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgZWxlbS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3dlYXRoZXItcG9wdXAgIG1kbC1zaGFkb3ctLTZkcCcpO1xyXG4gICAgICAgICAgZWxlbS5zZXRBdHRyaWJ1dGUoJ2lkJywgaW5kZXgpO1xyXG4gICAgICAgICAgZWxlbS5zZXRBdHRyaWJ1dGUoJ2RhdGEtbmFtZScsICd3ZWF0aGVyJyk7XHJcbiAgICAgICAgICByZXR1cm4gbmV3IG9sLk92ZXJsYXkoeyBlbGVtZW50OiBlbGVtLCBwb3NpdGlvbjogcG9zaXRpb24gfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBvYmpzID0gZGF0YS5saXN0O1xyXG4gICAgICAgIHZhciBvdmVybGF5LFxyXG4gICAgICAgICAgY29vcmRpbmF0ZXM7XHJcbiAgICAgICAgJC5lYWNoKG9ianMsIGZ1bmN0aW9uIChpbmRleCwgdmFsKSB7XHJcbiAgICAgICAgICBjb29yZGluYXRlcyA9IG9sLnByb2oudHJhbnNmb3JtKFtcclxuICAgICAgICAgICAgdmFsLmNvb3JkLmxvbiwgdmFsLmNvb3JkLmxhdFxyXG4gICAgICAgICAgXSwgJ0VQU0c6NDMyNicsICdFUFNHOjM4NTcnKTtcclxuICAgICAgICAgIG92ZXJsYXkgPSBjcmVhdGVXZWF0aGVyT3ZlcmxheShjb29yZGluYXRlcywgaW5kZXgpO1xyXG4gICAgICAgICAgbWFwLmFkZE92ZXJsYXkob3ZlcmxheSk7XHJcbiAgICAgICAgICBvdmVybGF5LnNldCgnbmFtZScsICd3ZWF0aGVyJyk7XHJcbiAgICAgICAgICB3ZWF0aGVyRGF0YSA9IHtcclxuICAgICAgICAgICAgJ25hbWUnOiB2YWwubmFtZSxcclxuICAgICAgICAgICAgJ3RlbXAnOiB2YWwubWFpbi50ZW1wLFxyXG4gICAgICAgICAgICAncHJlc3N1cmUnOiB2YWwubWFpbi5wcmVzc3VyZSxcclxuICAgICAgICAgICAgJ2h1bWlkaXR5JzogdmFsLm1haW4uaHVtaWRpdHlcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBkdXN0LnJlbmRlcignd2VhdGhlclBvcHVwJywgd2VhdGhlckRhdGEsIGZ1bmN0aW9uIChlcnIsIG91dCkge1xyXG4gICAgICAgICAgICAkKCcjJyArIGluZGV4KS5odG1sKG91dCk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSkuZmFpbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgLy8gdG9hc3RyLmVycm9yKFwizpTOtc69IM6yz4HOrc64zrfOus6xzr0gz4DOu863z4HOv8+Gzr/Pgc6vzrXPgiDOs865zrEgz4TOuc+CIM66zrHOuc+BzrnOus6tz4Igz4PPhc69zrjOrs66zrXPgiFcIik7XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIGlmICgkKHRoaXMpLnByb3AoJ2NoZWNrZWQnKSA9PT0gZmFsc2UpIHtcclxuICAgICAgJCh0aGlzKS5wYXJlbnQoKS5zaWJsaW5ncygpLmZpbmQoJ2lucHV0JykuZWFjaChmdW5jdGlvbiAoKSB7JCh0aGlzKS5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTt9KTtcclxuICAgICAgbWFwLmdldE92ZXJsYXlzKCkuZm9yRWFjaChmdW5jdGlvbiAob3ZsKSB7XHJcbiAgICAgICAgaWYgKG92bC5nZXQoJ25hbWUnKSA9PT0gJ3dlYXRoZXInKSB7XHJcbiAgICAgICAgICAoJChvdmwuZ2V0RWxlbWVudCgpKS5wYXJlbnQoKSkucmVtb3ZlKCk7XHJcbiAgICAgICAgICAkKG92bC5nZXRFbGVtZW50KCkpLnJlbW92ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn0oKSk7XHJcbiJdfQ==
