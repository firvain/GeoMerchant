function PropertyStyle(){var e;return e="../images/map-icons/pins/48/pin1.png",new ol.style.Style({image:new ol.style.Icon({src:e,anchor:[.5,1],scale:.7})})}function clickInfo(e){e.preventDefault();var t={},o=map.forEachFeatureAtPixel(e.pixel,function(e,t){return{feature:e,layer:t}},this,function(e){return"property"===e.get("id")?!0:void 0},this);console.log(o),o?(t.feature={},o.feature.getKeys().forEach(function(e){t.feature[e]=o.feature.get(e)}),console.log(t),dust.render("adminEstateInfo.dust",t,function(e,t){console.log(t),$(".property-info").html(t),$(".property-info").removeClass("visuallyhidden")})):$(".property-info").addClass("visuallyhidden")}var center=[3677385,4120949],extent=[3590094,4102833,3855483,4261211],lang=document.documentElement.lang,geoJSONFormat=new ol.format.GeoJSON({defaultDataProjection:"EPSG:4326"}),bing=new ol.layer.Tile({visible:!0,source:new ol.source.BingMaps({key:"Ak2Gq8VUfICsPpuf7LRANXmXt2sHWmSLPhohmVLFtFIEwYjs_5MCyAhAFwRSVpLj",imagerySet:"Aerial"}),maxZoom:19,crossOrigin:"anonymous",preload:1/0,id:"bing"}),mapbox=new ol.layer.Tile({source:new ol.source.XYZ({attributions:[new ol.Attribution({html:'<a href="https://www.mapbox.com/about/maps/" target="_blank">&copy; Mapbox &copy; OpenStreetMap</a>'})],url:"https://api.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZmlydmFpbiIsImEiOiJlOWYyYTM0NThiNWM0YjJjODJjNDE4ODQzNzA2MGQyNiJ9.-NVDO27Hzt-w_nQosUPfLA"}),id:"mapbox"}),propertySource=new ol.source.Vector({format:geoJSONFormat,loader:function(e,t,o){var r="http://127.0.0.1:3000/db/admin",n=this;n.clear(),$.ajax({url:r,type:"POST",beforeSend:function(e){localStorage.getItem("userToken")&&e.setRequestHeader("Authorization","Bearer "+localStorage.getItem("userToken"))},dataType:"json",data:{id:id}}).done(function(e){var t=geoJSONFormat.readFeatures(e,{featureProjection:"EPSG:3857"});n.addFeatures(t)}).fail(function(){console.log("error")})},strategy:ol.loadingstrategy.all}),property=new ol.layer.Vector({source:propertySource,id:"property",visible:!0,style:PropertyStyle()});property.setZIndex(2);var map=new ol.Map({target:"adminMap",layers:[mapbox,property],loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0,renderer:"canvas",controls:ol.control.defaults({attributionOptions:{collapsible:!1,collapsed:!1}}).extend([new ol.control.ScaleLine({units:"metric"}),new ol.control.OverviewMap({className:"ol-overviewmap ol-custom-overviewmap",collapsible:!0,collapsed:!0,layers:[bing]}),new ol.control.ZoomToExtent({extent:extent})]),view:new ol.View({center:center,projection:"EPSG:3857",zoom:14,maxZoom:19,minZoom:10})});"el"===lang?(bing.set("name","Δορυφορική εικόνα"),mapbox.set("name","Χάρτης"),property.set("name","Ακίνητα")):(bing.set("name","Sattelite Image"),mapbox.set("name","Map"),property.set("name","Properties"));var features=new ol.Collection,drawnProperties=new ol.layer.Vector({source:new ol.source.Vector,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})}),id:"drawnProperties"});map.addLayer(drawnProperties);var draw=new ol.interaction.Draw({source:drawnProperties.getSource(),type:"Point",style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})});map.addInteraction(draw),draw.setActive(!1);var select=new ol.interaction.Select({layers:[property],features:features,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 0, 0, 0.2)"}),stroke:new ol.style.Stroke({color:"#FF00003",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#FF0000"})})})});map.addInteraction(select),select.setActive(!1);var translate=new ol.interaction.Translate({features:select.getFeatures()});map.on("click",clickInfo),$("#insertProperty").click(function(){$(".property-info").addClass("visuallyhidden"),toastr.options={positionClass:"toast-top-center",preventDuplicates:!0,timeOut:20},toastr.info("Add New Property"),map.un("click",clickInfo),select.setActive(!1),draw.setActive(!0),draw.on("drawend",function(e){e.preventDefault(),draw.setActive(!1);var t={};$(".modal-dialog").removeClass("visuallyhidden"),dust.render("estateInsert.dust",t,function(e,t){$(".modal-content").html(t),componentHandler.upgradeDom()})})}),$("#deleteProperty").click(function(e){e.preventDefault(),$(".property-info").addClass("visuallyhidden"),toastr.options={positionClass:"toast-top-center",preventDuplicates:!0,timeOut:20},toastr.info("Delete Property"),map.un("click",clickInfo),draw.setActive(!1),features.clear(),select.setActive(!0),select.on("select",function(e){if(1===e.target.getFeatures().getLength()){toastr.options.newestOnTop=!0,toastr.options.preventDuplicates=!0,toastr.options.extendedTimeOut=0,toastr.options.timeOut=0,toastr.options.closeButton=!0;var t=toastr.warning('<p>Are you sure?</p><div class="toastr-btns"><button id="yesDelete" class="mdl-button mdl-js-button ">Yes</button><button id="noDelete" class="mdl-button mdl-js-button">No</button></div>');t.find("#yesDelete").length&&t.on("click","#yesDelete",function(){alert("you clicked ok"),t.remove()}),t.find("#noDelete").length&&t.on("click","#noDelete",function(){alert("Surprise! you clicked me.")})}})}),$("#logout").click(function(){location.href="/map/logout"});var handleCoords=function(e){"use strict";function t(e){for(var t=map.getLayers(),o=t.getLength(),r=0;o>r;r++)if(e===t.item(r).get("id"))return t.item(r);return null}function o(e){l=t(e)}function r(){var t;return t=l.getSource().getFeatures()[0].getGeometry().getCoordinates(),n=e.proj.transform(t,"EPSG:3857","EPSG:4326")}var n,l;return{coords:r,setLayer:o}}(ol),handleForm=function(e){"use strict";function t(e){n=e}function o(){var t={};return e('form[name="'+n+'"').find(".mdl-textfield__input").each(function(o,r){t[e(this).attr("id")]=e(this).val()}),e('form[name="'+n+'"').find(".mdl-checkbox__input").each(function(o,r){t[e(this).attr("id")]=e(this).prop("checked")}),t}function r(){e('form[name="'+n+'"').find(".mdl-textfield__input").each(function(t,o){e(this).val(""),e(this).parent().eq(0).removeClass("is-dirty"),e(this).parent().eq(0).removeClass("is-invalid")}),e('form[name="'+n+'"').find(".mdl-checkbox__input").each(function(t,o){e(this).prop("checked",!1)}),e('form[name="'+n+'"').find(".mdl-checkbox").each(function(t,o){e(this).removeClass("is-checked")})}var n;return{set:t,get:o,clear:r}}(jQuery);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkbWluLmpzIiwiaGFuZGxlQ29vcmRzLmpzIiwiaGFuZGxlRm9ybS5qcyJdLCJuYW1lcyI6WyJQcm9wZXJ0eVN0eWxlIiwic3JjIiwib2wiLCJzdHlsZSIsIlN0eWxlIiwiaW1hZ2UiLCJJY29uIiwiYW5jaG9yIiwic2NhbGUiLCJjbGlja0luZm8iLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsIm9iaiIsImNsaWNrZWRGZWF0dXJlIiwibWFwIiwiZm9yRWFjaEZlYXR1cmVBdFBpeGVsIiwicGl4ZWwiLCJmZWF0dXJlIiwibGF5ZXIiLCJ0aGlzIiwiZ2V0IiwiY29uc29sZSIsImxvZyIsImdldEtleXMiLCJmb3JFYWNoIiwia2V5IiwiZHVzdCIsInJlbmRlciIsImVyciIsIm91dCIsIiQiLCJodG1sIiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsImNlbnRlciIsImV4dGVudCIsImxhbmciLCJkb2N1bWVudCIsImRvY3VtZW50RWxlbWVudCIsImdlb0pTT05Gb3JtYXQiLCJmb3JtYXQiLCJHZW9KU09OIiwiZGVmYXVsdERhdGFQcm9qZWN0aW9uIiwiYmluZyIsIlRpbGUiLCJ2aXNpYmxlIiwic291cmNlIiwiQmluZ01hcHMiLCJpbWFnZXJ5U2V0IiwibWF4Wm9vbSIsImNyb3NzT3JpZ2luIiwicHJlbG9hZCIsIkluZmluaXR5IiwiaWQiLCJtYXBib3giLCJYWVoiLCJhdHRyaWJ1dGlvbnMiLCJBdHRyaWJ1dGlvbiIsInVybCIsInByb3BlcnR5U291cmNlIiwiVmVjdG9yIiwibG9hZGVyIiwicmVzb2x1dGlvbiIsInByb2plY3Rpb24iLCJzZWxmIiwiY2xlYXIiLCJhamF4IiwidHlwZSIsImJlZm9yZVNlbmQiLCJ4aHIiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwic2V0UmVxdWVzdEhlYWRlciIsImRhdGFUeXBlIiwiZGF0YSIsImRvbmUiLCJyZXNwb25zZSIsImZlYXR1cmVzIiwicmVhZEZlYXR1cmVzIiwiZmVhdHVyZVByb2plY3Rpb24iLCJhZGRGZWF0dXJlcyIsImZhaWwiLCJzdHJhdGVneSIsImxvYWRpbmdzdHJhdGVneSIsImFsbCIsInByb3BlcnR5Iiwic2V0WkluZGV4IiwiTWFwIiwidGFyZ2V0IiwibGF5ZXJzIiwibG9hZFRpbGVzV2hpbGVBbmltYXRpbmciLCJsb2FkVGlsZXNXaGlsZUludGVyYWN0aW5nIiwicmVuZGVyZXIiLCJjb250cm9scyIsImNvbnRyb2wiLCJkZWZhdWx0cyIsImF0dHJpYnV0aW9uT3B0aW9ucyIsImNvbGxhcHNpYmxlIiwiY29sbGFwc2VkIiwiZXh0ZW5kIiwiU2NhbGVMaW5lIiwidW5pdHMiLCJPdmVydmlld01hcCIsImNsYXNzTmFtZSIsIlpvb21Ub0V4dGVudCIsInZpZXciLCJWaWV3Iiwiem9vbSIsIm1pblpvb20iLCJzZXQiLCJDb2xsZWN0aW9uIiwiZHJhd25Qcm9wZXJ0aWVzIiwiZmlsbCIsIkZpbGwiLCJjb2xvciIsInN0cm9rZSIsIlN0cm9rZSIsIndpZHRoIiwiQ2lyY2xlIiwicmFkaXVzIiwiYWRkTGF5ZXIiLCJkcmF3IiwiaW50ZXJhY3Rpb24iLCJEcmF3IiwiZ2V0U291cmNlIiwiYWRkSW50ZXJhY3Rpb24iLCJzZXRBY3RpdmUiLCJzZWxlY3QiLCJTZWxlY3QiLCJ0cmFuc2xhdGUiLCJUcmFuc2xhdGUiLCJnZXRGZWF0dXJlcyIsIm9uIiwiY2xpY2siLCJ0b2FzdHIiLCJvcHRpb25zIiwicG9zaXRpb25DbGFzcyIsInByZXZlbnREdXBsaWNhdGVzIiwidGltZU91dCIsImluZm8iLCJ1biIsImNvbXBvbmVudEhhbmRsZXIiLCJ1cGdyYWRlRG9tIiwiZXZlbnQiLCJlIiwiZ2V0TGVuZ3RoIiwibmV3ZXN0T25Ub3AiLCJleHRlbmRlZFRpbWVPdXQiLCJjbG9zZUJ1dHRvbiIsIiR0b2FzdCIsIndhcm5pbmciLCJmaW5kIiwibGVuZ3RoIiwiYWxlcnQiLCJyZW1vdmUiLCJsb2NhdGlvbiIsImhyZWYiLCJoYW5kbGVDb29yZHMiLCJmaW5kQnlJZCIsImdldExheWVycyIsImkiLCJpdGVtIiwic2V0TGF5ZXIiLCJsIiwiZ2V0Q29vcmRzIiwiY29vcmRFUFNHMzg1NyIsImdldEdlb21ldHJ5IiwiZ2V0Q29vcmRpbmF0ZXMiLCJjb29yZHMiLCJwcm9qIiwidHJhbnNmb3JtIiwiaGFuZGxlRm9ybSIsInNldE5hbWUiLCJuYW1lIiwiZm9ybU5hbWUiLCJnZXRBdHRyaWJ1dGVzIiwiZWFjaCIsImluZGV4IiwiZWxlbWVudCIsImF0dHIiLCJ2YWwiLCJwcm9wIiwicmVzZXRGb3JtIiwicGFyZW50IiwiZXEiLCJqUXVlcnkiXSwibWFwcGluZ3MiOiJBQStCQSxRQUFBQSxpQkFDQSxHQUFBQyxFQUVBLE9BREFBLEdBQUEsdUNBQ0EsR0FBQUMsSUFBQUMsTUFBQUMsT0FDQUMsTUFBQSxHQUFBSCxJQUFBQyxNQUFBRyxNQUNBTCxJQUFBQSxFQUNBTSxRQUNBLEdBQUEsR0FFQUMsTUFBQSxPQStKQSxRQUFBQyxXQUFBQyxHQUNBQSxFQUFBQyxnQkFDQSxJQUFBQyxNQUNBQyxFQUFBQyxJQUFBQyxzQkFBQUwsRUFBQU0sTUFBQSxTQUFBQyxFQUFBQyxHQUNBLE9BQ0FELFFBQUFBLEVBQ0FDLE1BQUFBLElBRUFDLEtBQUEsU0FBQUQsR0FDQSxNQUFBLGFBQUFBLEVBQUFFLElBQUEsT0FDQSxFQURBLFFBR0FELEtBQ0FFLFNBQUFDLElBQUFULEdBQ0FBLEdBQ0FELEVBQUFLLFdBQ0FKLEVBQUFJLFFBQUFNLFVBQUFDLFFBQUEsU0FBQUMsR0FDQWIsRUFBQUssUUFBQVEsR0FBQVosRUFBQUksUUFBQUcsSUFBQUssS0FFQUosUUFBQUMsSUFBQVYsR0FDQWMsS0FBQUMsT0FBQSx1QkFBQWYsRUFBQSxTQUFBZ0IsRUFBQUMsR0FDQVIsUUFBQUMsSUFBQU8sR0FDQUMsRUFBQSxrQkFBQUMsS0FBQUYsR0FDQUMsRUFBQSxrQkFBQUUsWUFBQSxxQkFHQUYsRUFBQSxrQkFBQUcsU0FBQSxrQkFqT0EsR0FBQUMsU0FDQSxRQUFBLFNBRUFDLFFBQ0EsUUFBQSxRQUFBLFFBQUEsU0FFQUMsS0FBQUMsU0FBQUMsZ0JBQUFGLEtBQ0FHLGNBQUEs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SixJQUFBMkosRUFDQTlHLE1BQUFxSCxJQUVBRyIsImZpbGUiOiJhZG1pbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgY2VudGVyID0gW1xuICAgIDM2NzczODUsIDQxMjA5NDlcbiAgXSxcbiAgZXh0ZW50ID0gW1xuICAgIDM1OTAwOTQsIDQxMDI4MzMsIDM4NTU0ODMsIDQyNjEyMTFcbiAgXSxcbiAgbGFuZyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nLFxuICBnZW9KU09ORm9ybWF0ID0gbmV3IG9sLmZvcm1hdC5HZW9KU09OKHtcbiAgICBkZWZhdWx0RGF0YVByb2plY3Rpb246ICdFUFNHOjQzMjYnXG4gIH0pO1xudmFyIGJpbmcgPSBuZXcgb2wubGF5ZXIuVGlsZSh7XG4gIHZpc2libGU6IHRydWUsXG4gIHNvdXJjZTogbmV3IG9sLnNvdXJjZS5CaW5nTWFwcyh7XG4gICAga2V5OiAnQWsyR3E4VlVmSUNzUHB1ZjdMUkFOWG1YdDJzSFdtU0xQaG9obVZMRnRGSUV3WWpzXzVNQ3lBaEFGd1JTVnBMaicsXG4gICAgaW1hZ2VyeVNldDogJ0FlcmlhbCdcbiAgfSksXG4gIG1heFpvb206IDE5LFxuICBjcm9zc09yaWdpbjogJ2Fub255bW91cycsXG4gIHByZWxvYWQ6IEluZmluaXR5LFxuICBpZDogJ2JpbmcnXG59KTtcbnZhciBtYXBib3ggPSBuZXcgb2wubGF5ZXIuVGlsZSh7XG4gIHNvdXJjZTogbmV3IG9sLnNvdXJjZS5YWVooe1xuICAgIGF0dHJpYnV0aW9uczogW25ldyBvbC5BdHRyaWJ1dGlvbih7XG4gICAgICBodG1sOiAnPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm1hcGJveC5jb20vYWJvdXQvbWFwcy9cIiB0YXJnZXQ9XCJfYmxhbmtcIj4mY29weTsgTWFwYm94ICZjb3B5OyBPcGVuU3RyZWV0TWFwPC9hPidcbiAgICB9KV0sXG4gICAgdXJsOiAnaHR0cHM6Ly9hcGkubWFwYm94LmNvbS92NC9tYXBib3guc3RyZWV0cy97en0ve3h9L3t5fS5wbmc/YWNjZXNzX3Rva2VuPXBrLmV5SjFJam9pWm1seWRtRnBiaUlzSW1FaU9pSmxPV1l5WVRNME5UaGlOV00wWWpKak9ESmpOREU0T0RRek56QTJNR1F5TmlKOS4tTlZETzI3SHp0LXdfblFvc1VQZkxBJ1xuICB9KSxcbiAgaWQ6ICdtYXBib3gnXG59KTtcblxuZnVuY3Rpb24gUHJvcGVydHlTdHlsZSgpIHtcbiAgdmFyIHNyYztcbiAgc3JjID0gJy4uL2ltYWdlcy9tYXAtaWNvbnMvcGlucy80OC9waW4xLnBuZyc7XG4gIHJldHVybiBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuSWNvbigoe1xuICAgICAgc3JjOiBzcmMsXG4gICAgICBhbmNob3I6IFtcbiAgICAgICAgMC41LCAxXG4gICAgICBdLFxuICAgICAgc2NhbGU6IDAuN1xuICAgIH0pKVxuICB9KTtcbn1cbnZhciBwcm9wZXJ0eVNvdXJjZSA9IG5ldyBvbC5zb3VyY2UuVmVjdG9yKHtcbiAgZm9ybWF0OiBnZW9KU09ORm9ybWF0LFxuICBsb2FkZXI6IGZ1bmN0aW9uIChleHRlbnQsIHJlc29sdXRpb24sIHByb2plY3Rpb24pIHtcbiAgICB2YXIgdXJsID0gJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9kYi9hZG1pbic7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHNlbGYuY2xlYXIoKTtcbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOiB1cmwsXG4gICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAnYmVmb3JlU2VuZCc6IGZ1bmN0aW9uICh4aHIpIHtcbiAgICAgICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKSkge1xuICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdBdXRob3JpemF0aW9uJywgJ0JlYXJlciAnICsgbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGlkOiBpZFxuICAgICAgfVxuICAgIH0pLmRvbmUoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICB2YXIgZmVhdHVyZXMgPSBnZW9KU09ORm9ybWF0LnJlYWRGZWF0dXJlcyhyZXNwb25zZSwge1xuICAgICAgICBmZWF0dXJlUHJvamVjdGlvbjogJ0VQU0c6Mzg1NydcbiAgICAgIH0pO1xuICAgICAgc2VsZi5hZGRGZWF0dXJlcyhmZWF0dXJlcyk7XG4gICAgfSkuZmFpbChmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zb2xlLmxvZygnZXJyb3InKTtcbiAgICB9KTtcbiAgfSxcbiAgc3RyYXRlZ3k6IG9sLmxvYWRpbmdzdHJhdGVneS5hbGxcbn0pO1xudmFyIHByb3BlcnR5ID0gbmV3IG9sLmxheWVyLlZlY3Rvcih7XG4gIHNvdXJjZTogcHJvcGVydHlTb3VyY2UsXG4gIGlkOiAncHJvcGVydHknLFxuICB2aXNpYmxlOiB0cnVlLFxuICBzdHlsZTogUHJvcGVydHlTdHlsZSgpXG59KTtcbnByb3BlcnR5LnNldFpJbmRleCgyKTtcbnZhciBtYXAgPSBuZXcgb2wuTWFwKHtcbiAgdGFyZ2V0OiAnYWRtaW5NYXAnLFxuICBsYXllcnM6IFtcbiAgICBtYXBib3gsIHByb3BlcnR5XG4gIF0sXG4gIGxvYWRUaWxlc1doaWxlQW5pbWF0aW5nOiB0cnVlLFxuICBsb2FkVGlsZXNXaGlsZUludGVyYWN0aW5nOiB0cnVlLFxuICByZW5kZXJlcjogJ2NhbnZhcycsXG4gIGNvbnRyb2xzOiBvbC5jb250cm9sLmRlZmF1bHRzKHtcbiAgICBhdHRyaWJ1dGlvbk9wdGlvbnM6IHtcbiAgICAgIGNvbGxhcHNpYmxlOiBmYWxzZSxcbiAgICAgIGNvbGxhcHNlZDogZmFsc2VcbiAgICB9XG4gIH0pLmV4dGVuZChbXG4gICAgbmV3IG9sLmNvbnRyb2wuU2NhbGVMaW5lKHtcbiAgICAgIHVuaXRzOiAnbWV0cmljJ1xuICAgIH0pLFxuICAgIG5ldyBvbC5jb250cm9sLk92ZXJ2aWV3TWFwKHtcbiAgICAgIGNsYXNzTmFtZTogJ29sLW92ZXJ2aWV3bWFwIG9sLWN1c3RvbS1vdmVydmlld21hcCcsXG4gICAgICBjb2xsYXBzaWJsZTogdHJ1ZSxcbiAgICAgIGNvbGxhcHNlZDogdHJ1ZSxcbiAgICAgIGxheWVyczogW2JpbmddXG4gICAgfSksXG4gICAgbmV3IG9sLmNvbnRyb2wuWm9vbVRvRXh0ZW50KHtcbiAgICAgIGV4dGVudDogZXh0ZW50XG4gICAgfSlcbiAgXSksXG4gIHZpZXc6IG5ldyBvbC5WaWV3KHtcbiAgICBjZW50ZXI6IGNlbnRlcixcbiAgICAvLyBleHRlbnQ6IGV4dGVudCxcbiAgICBwcm9qZWN0aW9uOiAnRVBTRzozODU3JyxcbiAgICB6b29tOiAxNCxcbiAgICBtYXhab29tOiAxOSxcbiAgICBtaW5ab29tOiAxMFxuICB9KVxufSk7XG5pZiAobGFuZyA9PT0gJ2VsJykge1xuICBiaW5nLnNldCgnbmFtZScsICfOlM6/z4HPhc+Gzr/Pgc65zrrOriDOtc65zrrPjM69zrEnKTtcbiAgbWFwYm94LnNldCgnbmFtZScsICfOp86sz4HPhM63z4InKTtcbiAgcHJvcGVydHkuc2V0KCduYW1lJywgJ86RzrrOr869zrfPhM6xJyk7XG59IGVsc2Uge1xuICBiaW5nLnNldCgnbmFtZScsICdTYXR0ZWxpdGUgSW1hZ2UnKTtcbiAgbWFwYm94LnNldCgnbmFtZScsICdNYXAnKTtcbiAgcHJvcGVydHkuc2V0KCduYW1lJywgJ1Byb3BlcnRpZXMnKTtcbn1cbi8vPT09PT09IGludGVyYWN0aW9ucyA9PT09PT1cbnZhciBmZWF0dXJlcyA9IG5ldyBvbC5Db2xsZWN0aW9uKCk7XG52YXIgZHJhd25Qcm9wZXJ0aWVzID0gbmV3IG9sLmxheWVyLlZlY3Rvcih7XG4gIHNvdXJjZTogbmV3IG9sLnNvdXJjZS5WZWN0b3IoKSxcbiAgc3R5bGU6IG5ldyBvbC5zdHlsZS5TdHlsZSh7XG4gICAgZmlsbDogbmV3IG9sLnN0eWxlLkZpbGwoe1xuICAgICAgY29sb3I6ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMiknXG4gICAgfSksXG4gICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcbiAgICAgIGNvbG9yOiAnI2ZmY2MzMycsXG4gICAgICB3aWR0aDogMlxuICAgIH0pLFxuICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuQ2lyY2xlKHtcbiAgICAgIHJhZGl1czogNyxcbiAgICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgICAgY29sb3I6ICcjZmZjYzMzJ1xuICAgICAgfSlcbiAgICB9KVxuICB9KSxcbiAgaWQ6ICdkcmF3blByb3BlcnRpZXMnXG59KTtcbm1hcC5hZGRMYXllcihkcmF3blByb3BlcnRpZXMpO1xuLy9kcmF3XG52YXIgZHJhdyA9IG5ldyBvbC5pbnRlcmFjdGlvbi5EcmF3KHtcbiAgLy8gZmVhdHVyZXM6IGZlYXR1cmVzLFxuICBzb3VyY2U6IGRyYXduUHJvcGVydGllcy5nZXRTb3VyY2UoKSxcbiAgdHlwZTogJ1BvaW50JyxcbiAgc3R5bGU6IG5ldyBvbC5zdHlsZS5TdHlsZSh7XG4gICAgZmlsbDogbmV3IG9sLnN0eWxlLkZpbGwoe1xuICAgICAgY29sb3I6ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMiknXG4gICAgfSksXG4gICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcbiAgICAgIGNvbG9yOiAnI2ZmY2MzMycsXG4gICAgICB3aWR0aDogMlxuICAgIH0pLFxuICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuQ2lyY2xlKHtcbiAgICAgIHJhZGl1czogNyxcbiAgICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgICAgY29sb3I6ICcjZmZjYzMzJ1xuICAgICAgfSlcbiAgICB9KVxuICB9KVxufSk7XG5tYXAuYWRkSW50ZXJhY3Rpb24oZHJhdyk7XG5kcmF3LnNldEFjdGl2ZShmYWxzZSk7XG4vL3NlbGVjdFxudmFyIHNlbGVjdCA9IG5ldyBvbC5pbnRlcmFjdGlvbi5TZWxlY3Qoe1xuICBsYXllcnM6IFtwcm9wZXJ0eV0sXG4gIGZlYXR1cmVzOiBmZWF0dXJlcyxcbiAgc3R5bGU6IG5ldyBvbC5zdHlsZS5TdHlsZSh7XG4gICAgZmlsbDogbmV3IG9sLnN0eWxlLkZpbGwoe1xuICAgICAgY29sb3I6ICdyZ2JhKDI1NSwgMCwgMCwgMC4yKSdcbiAgICB9KSxcbiAgICBzdHJva2U6IG5ldyBvbC5zdHlsZS5TdHJva2Uoe1xuICAgICAgY29sb3I6ICcjRkYwMDAwMycsXG4gICAgICB3aWR0aDogMlxuICAgIH0pLFxuICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuQ2lyY2xlKHtcbiAgICAgIHJhZGl1czogNyxcbiAgICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgICAgY29sb3I6ICcjRkYwMDAwJ1xuICAgICAgfSlcbiAgICB9KVxuICB9KVxufSk7XG5tYXAuYWRkSW50ZXJhY3Rpb24oc2VsZWN0KTtcbnNlbGVjdC5zZXRBY3RpdmUoZmFsc2UpO1xuLy90cmFuc2xhdGUobW92ZSlcbnZhciB0cmFuc2xhdGUgPSBuZXcgb2wuaW50ZXJhY3Rpb24uVHJhbnNsYXRlKHtcbiAgZmVhdHVyZXM6IHNlbGVjdC5nZXRGZWF0dXJlcygpXG59KTtcbi8vPT09PT09IGluZm8gPT09PT09XG5tYXAub24oJ2NsaWNrJywgY2xpY2tJbmZvKTtcblxuZnVuY3Rpb24gY2xpY2tJbmZvKGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgdmFyIG9iaiA9IHt9O1xuICB2YXIgY2xpY2tlZEZlYXR1cmUgPSBtYXAuZm9yRWFjaEZlYXR1cmVBdFBpeGVsKGV2dC5waXhlbCwgZnVuY3Rpb24gKGZlYXR1cmUsIGxheWVyKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGZlYXR1cmU6IGZlYXR1cmUsXG4gICAgICBsYXllcjogbGF5ZXJcbiAgICB9O1xuICB9LCB0aGlzLCBmdW5jdGlvbiAobGF5ZXIpIHtcbiAgICBpZiAobGF5ZXIuZ2V0KCdpZCcpID09PSAncHJvcGVydHknKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH0sIHRoaXMpO1xuICBjb25zb2xlLmxvZyhjbGlja2VkRmVhdHVyZSk7XG4gIGlmIChjbGlja2VkRmVhdHVyZSkge1xuICAgIG9iai5mZWF0dXJlID0ge307XG4gICAgY2xpY2tlZEZlYXR1cmUuZmVhdHVyZS5nZXRLZXlzKCkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICBvYmouZmVhdHVyZVtrZXldID0gY2xpY2tlZEZlYXR1cmUuZmVhdHVyZS5nZXQoa2V5KTtcbiAgICB9KTtcbiAgICBjb25zb2xlLmxvZyhvYmopO1xuICAgIGR1c3QucmVuZGVyKCdhZG1pbkVzdGF0ZUluZm8uZHVzdCcsIG9iaiwgZnVuY3Rpb24gKGVyciwgb3V0KSB7XG4gICAgICBjb25zb2xlLmxvZyhvdXQpO1xuICAgICAgJCgnLnByb3BlcnR5LWluZm8nKS5odG1sKG91dCk7XG4gICAgICAkKCcucHJvcGVydHktaW5mbycpLnJlbW92ZUNsYXNzKCd2aXN1YWxseWhpZGRlbicpO1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgICQoJy5wcm9wZXJ0eS1pbmZvJykuYWRkQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7XG4gIH1cbn1cbi8vPT09PT09IGluc2VydCA9PT09PT1cbiQoJyNpbnNlcnRQcm9wZXJ0eScpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgJCgnLnByb3BlcnR5LWluZm8nKS5hZGRDbGFzcygndmlzdWFsbHloaWRkZW4nKTtcbiAgdG9hc3RyLm9wdGlvbnMgPSB7XG4gICAgJ3Bvc2l0aW9uQ2xhc3MnOiAndG9hc3QtdG9wLWNlbnRlcicsXG4gICAgJ3ByZXZlbnREdXBsaWNhdGVzJzogdHJ1ZSxcbiAgICAndGltZU91dCc6IDIwXG4gIH07XG4gIHRvYXN0ci5pbmZvKCdBZGQgTmV3IFByb3BlcnR5Jyk7XG4gIG1hcC51bignY2xpY2snLCBjbGlja0luZm8pO1xuICBzZWxlY3Quc2V0QWN0aXZlKGZhbHNlKTtcbiAgZHJhdy5zZXRBY3RpdmUodHJ1ZSk7XG4gIGRyYXcub24oJ2RyYXdlbmQnLCBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgZHJhdy5zZXRBY3RpdmUoZmFsc2UpO1xuICAgIHZhciBvYmogPSB7fTtcbiAgICAkKCcubW9kYWwtZGlhbG9nJykucmVtb3ZlQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7XG4gICAgZHVzdC5yZW5kZXIoJ2VzdGF0ZUluc2VydC5kdXN0Jywgb2JqLCBmdW5jdGlvbiAoZXJyLCBvdXQpIHtcbiAgICAgICQoJy5tb2RhbC1jb250ZW50JykuaHRtbChvdXQpO1xuICAgICAgY29tcG9uZW50SGFuZGxlci51cGdyYWRlRG9tKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4vLz09PT09PSBkZWxldGUgPT09PT09XG4kKCcjZGVsZXRlUHJvcGVydHknKS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgJCgnLnByb3BlcnR5LWluZm8nKS5hZGRDbGFzcygndmlzdWFsbHloaWRkZW4nKTtcbiAgdG9hc3RyLm9wdGlvbnMgPSB7XG4gICAgJ3Bvc2l0aW9uQ2xhc3MnOiAndG9hc3QtdG9wLWNlbnRlcicsXG4gICAgJ3ByZXZlbnREdXBsaWNhdGVzJzogdHJ1ZSxcbiAgICAndGltZU91dCc6IDIwXG4gIH07XG4gIHRvYXN0ci5pbmZvKCdEZWxldGUgUHJvcGVydHknKTtcbiAgbWFwLnVuKCdjbGljaycsIGNsaWNrSW5mbyk7XG4gIGRyYXcuc2V0QWN0aXZlKGZhbHNlKTtcbiAgZmVhdHVyZXMuY2xlYXIoKTtcbiAgc2VsZWN0LnNldEFjdGl2ZSh0cnVlKTtcbiAgc2VsZWN0Lm9uKCdzZWxlY3QnLCBmdW5jdGlvbiAoZSkge1xuICAgIGlmIChlLnRhcmdldC5nZXRGZWF0dXJlcygpLmdldExlbmd0aCgpID09PSAxKSB7XG4gICAgICB0b2FzdHIub3B0aW9ucy5uZXdlc3RPblRvcCA9IHRydWU7XG4gICAgICB0b2FzdHIub3B0aW9ucy5wcmV2ZW50RHVwbGljYXRlcyA9IHRydWU7XG4gICAgICB0b2FzdHIub3B0aW9ucy5leHRlbmRlZFRpbWVPdXQgPSAwO1xuICAgICAgdG9hc3RyLm9wdGlvbnMudGltZU91dCA9IDA7XG4gICAgICB0b2FzdHIub3B0aW9ucy5jbG9zZUJ1dHRvbiA9IHRydWU7XG4gICAgICB2YXIgJHRvYXN0ID0gdG9hc3RyLndhcm5pbmcoJzxwPkFyZSB5b3Ugc3VyZT88L3A+PGRpdiBjbGFzcz1cInRvYXN0ci1idG5zXCI+PGJ1dHRvbiBpZD1cInllc0RlbGV0ZVwiIGNsYXNzPVwibWRsLWJ1dHRvbiBtZGwtanMtYnV0dG9uIFwiPlllczwvYnV0dG9uPjxidXR0b24gaWQ9XCJub0RlbGV0ZVwiIGNsYXNzPVwibWRsLWJ1dHRvbiBtZGwtanMtYnV0dG9uXCI+Tm88L2J1dHRvbj48L2Rpdj4nKTtcbiAgICAgIGlmICgkdG9hc3QuZmluZCgnI3llc0RlbGV0ZScpLmxlbmd0aCkge1xuICAgICAgICAkdG9hc3Qub24oJ2NsaWNrJywgJyN5ZXNEZWxldGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgYWxlcnQoJ3lvdSBjbGlja2VkIG9rJyk7XG4gICAgICAgICAgJHRvYXN0LnJlbW92ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmICgkdG9hc3QuZmluZCgnI25vRGVsZXRlJykubGVuZ3RoKSB7XG4gICAgICAgICR0b2FzdC5vbignY2xpY2snLCAnI25vRGVsZXRlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGFsZXJ0KCdTdXJwcmlzZSEgeW91IGNsaWNrZWQgbWUuJyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59KTtcbiQoJyNsb2dvdXQnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gIGxvY2F0aW9uLmhyZWYgPSAnL21hcC9sb2dvdXQnO1xufSk7XG4iLCJ2YXIgaGFuZGxlQ29vcmRzID0gKGZ1bmN0aW9uIChvbCkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBjb29yZHM7XG4gIHZhciBsO1xuXG4gIGZ1bmN0aW9uIGZpbmRCeUlkKGlkKSB7XG4gICAgdmFyIGxheWVycyA9IG1hcC5nZXRMYXllcnMoKTtcbiAgICB2YXIgbGVuZ3RoID0gbGF5ZXJzLmdldExlbmd0aCgpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChpZCA9PT0gbGF5ZXJzLml0ZW0oaSkuZ2V0KCdpZCcpKSB7XG4gICAgICAgIHJldHVybiBsYXllcnMuaXRlbShpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiBmaW5kQnlOYW1lKG5hbWUpIHtcbiAgICB2YXIgbGF5ZXJzID0gbWFwLmdldExheWVycygpO1xuICAgIHZhciBsZW5ndGggPSBsYXllcnMuZ2V0TGVuZ3RoKCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgaWYgKG5hbWUgPT09IGxheWVycy5pdGVtKGkpLmdldCgnbmFtZUVuJykgfHwgbmFtZSA9PT0gbGF5ZXJzLml0ZW0oaSkuZ2V0KCduYW1lRWwnKSkge1xuICAgICAgICByZXR1cm4gbGF5ZXJzLml0ZW0oaSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0TGF5ZXIoaWQpIHtcbiAgICBsID0gZmluZEJ5SWQoaWQpO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0Q29vcmRzKCkge1xuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIHZhciBjb29yZEVQU0czODU3O1xyXG4gICAgY29vcmRFUFNHMzg1NyA9IGwuZ2V0U291cmNlKCkuZ2V0RmVhdHVyZXMoKVswXS5nZXRHZW9tZXRyeSgpLmdldENvb3JkaW5hdGVzKCk7XHJcbiAgICBjb29yZHMgPSBvbC5wcm9qLnRyYW5zZm9ybShjb29yZEVQU0czODU3LCAnRVBTRzozODU3JywgJ0VQU0c6NDMyNicpO1xyXG4gICAgcmV0dXJuIGNvb3JkcztcbiAgfVxuICByZXR1cm4ge1xuICAgIGNvb3JkczogZ2V0Q29vcmRzLFxuICAgIHNldExheWVyOiBzZXRMYXllclxuICB9O1xufShvbCkpO1xuIiwidmFyIGhhbmRsZUZvcm0gPSAoZnVuY3Rpb24gKCQpIHtcclxuICAndXNlIHN0cmljdCc7XHJcbiAgdmFyIGZvcm1OYW1lO1xyXG4gIC8vIGZvcm0gPSAkKCdmb3JtW25hbWU9XCInICsgdGhpcy5uYW1lICsgJ1wiXScpO1xyXG4gIGZ1bmN0aW9uIHNldE5hbWUobmFtZSkge1xyXG4gICAgZm9ybU5hbWUgPSBuYW1lO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZ2V0QXR0cmlidXRlcygpIHtcclxuICAgIHZhciBvYmogPSB7fTtcclxuICAgICQoJ2Zvcm1bbmFtZT1cIicgKyBmb3JtTmFtZSArICdcIicpLmZpbmQoJy5tZGwtdGV4dGZpZWxkX19pbnB1dCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbGVtZW50KSB7XHJcbiAgICAgIG9ialskKHRoaXMpLmF0dHIoJ2lkJyldID0gJCh0aGlzKS52YWwoKTtcclxuICAgIH0pO1xyXG4gICAgJCgnZm9ybVtuYW1lPVwiJyArIGZvcm1OYW1lICsgJ1wiJykuZmluZCgnLm1kbC1jaGVja2JveF9faW5wdXQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWxlbWVudCkge1xyXG4gICAgICBvYmpbJCh0aGlzKS5hdHRyKCdpZCcpXSA9ICQodGhpcykucHJvcCgnY2hlY2tlZCcpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gb2JqO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcmVzZXRGb3JtKCkge1xyXG4gICAgJCgnZm9ybVtuYW1lPVwiJyArIGZvcm1OYW1lICsgJ1wiJykuZmluZCgnLm1kbC10ZXh0ZmllbGRfX2lucHV0JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHtcclxuICAgICAgJCh0aGlzKS52YWwoJycpO1xyXG4gICAgICAkKHRoaXMpLnBhcmVudCgpLmVxKDApLnJlbW92ZUNsYXNzKCdpcy1kaXJ0eScpO1xyXG4gICAgICAkKHRoaXMpLnBhcmVudCgpLmVxKDApLnJlbW92ZUNsYXNzKCdpcy1pbnZhbGlkJyk7XHJcbiAgICB9KTtcclxuICAgICQoJ2Zvcm1bbmFtZT1cIicgKyBmb3JtTmFtZSArICdcIicpLmZpbmQoJy5tZGwtY2hlY2tib3hfX2lucHV0JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHtcclxuICAgICAgJCh0aGlzKS5wcm9wKCdjaGVja2VkJywgZmFsc2UpO1xyXG4gICAgfSk7XHJcbiAgICAkKCdmb3JtW25hbWU9XCInICsgZm9ybU5hbWUgKyAnXCInKS5maW5kKCcubWRsLWNoZWNrYm94JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHtcclxuICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnaXMtY2hlY2tlZCcpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIHJldHVybiB7XHJcbiAgICBzZXQ6IHNldE5hbWUsXHJcbiAgICBnZXQ6IGdldEF0dHJpYnV0ZXMsXHJcbiAgICBjbGVhcjogcmVzZXRGb3JtXHJcbiAgfTtcclxufShqUXVlcnkpKTtcclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
