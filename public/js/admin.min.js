function PropertyStyle(){var e;return e="../images/map-icons/pins/48/pin1.png",new ol.style.Style({image:new ol.style.Icon({src:e,anchor:[.5,1],scale:.7})})}function clickInfo(e){e.preventDefault();var t={},o=map.forEachFeatureAtPixel(e.pixel,function(e,t){return{feature:e,layer:t}},this,function(e){return"property"===e.get("id")?!0:void 0},this);console.log(o),o?(t.feature={},o.feature.getKeys().forEach(function(e){t.feature[e]=o.feature.get(e)}),console.log(t),dust.render("adminEstateInfo.dust",t,function(e,t){console.log(t),$(".property-info").html(t),$(".property-info").removeClass("visuallyhidden")})):$(".property-info").addClass("visuallyhidden")}var center=[3677385,4120949],extent=[3590094,4102833,3855483,4261211],lang=document.documentElement.lang,geoJSONFormat=new ol.format.GeoJSON({defaultDataProjection:"EPSG:4326"}),bing=new ol.layer.Tile({visible:!0,source:new ol.source.BingMaps({key:"Ak2Gq8VUfICsPpuf7LRANXmXt2sHWmSLPhohmVLFtFIEwYjs_5MCyAhAFwRSVpLj",imagerySet:"Aerial"}),maxZoom:19,crossOrigin:"anonymous",preload:1/0,id:"bing"}),mapbox=new ol.layer.Tile({source:new ol.source.XYZ({attributions:[new ol.Attribution({html:'<a href="https://www.mapbox.com/about/maps/" target="_blank">&copy; Mapbox &copy; OpenStreetMap</a>'})],url:"https://api.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZmlydmFpbiIsImEiOiJlOWYyYTM0NThiNWM0YjJjODJjNDE4ODQzNzA2MGQyNiJ9.-NVDO27Hzt-w_nQosUPfLA"}),id:"mapbox"}),propertySource=new ol.source.Vector({format:geoJSONFormat,loader:function(e,t,o){var l="http://127.0.0.1:3000/db/admin",r=this;r.clear(),$.ajax({url:l,type:"POST",beforeSend:function(e){localStorage.getItem("userToken")&&e.setRequestHeader("Authorization","Bearer "+localStorage.getItem("userToken"))},dataType:"json",data:{id:id}}).done(function(e){var t=geoJSONFormat.readFeatures(e,{featureProjection:"EPSG:3857"});r.addFeatures(t)}).fail(function(){console.log("error")})},strategy:ol.loadingstrategy.all}),property=new ol.layer.Vector({source:propertySource,id:"property",visible:!0,style:PropertyStyle()});property.setZIndex(2);var map=new ol.Map({target:"adminMap",layers:[mapbox,property],loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0,renderer:"canvas",controls:ol.control.defaults({attributionOptions:{collapsible:!1,collapsed:!1}}).extend([new ol.control.ScaleLine({units:"metric"}),new ol.control.OverviewMap({className:"ol-overviewmap ol-custom-overviewmap",collapsible:!0,collapsed:!0,layers:[bing]}),new ol.control.ZoomToExtent({extent:extent})]),view:new ol.View({center:center,projection:"EPSG:3857",zoom:14,maxZoom:19,minZoom:10})});"el"===lang?(bing.set("name","Δορυφορική εικόνα"),mapbox.set("name","Χάρτης"),property.set("name","Ακίνητα")):(bing.set("name","Sattelite Image"),mapbox.set("name","Map"),property.set("name","Properties"));var features=new ol.Collection,drawnProperties=new ol.layer.Vector({source:new ol.source.Vector,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})}),id:"drawnProperties"});map.addLayer(drawnProperties);var draw=new ol.interaction.Draw({source:drawnProperties.getSource(),type:"Point",style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})});map.addInteraction(draw),draw.setActive(!1);var select=new ol.interaction.Select({layers:[property],features:features,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 0, 0, 0.2)"}),stroke:new ol.style.Stroke({color:"#FF00003",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#FF0000"})})})});map.addInteraction(select),select.setActive(!1);var translate=new ol.interaction.Translate({features:select.getFeatures()});map.on("click",clickInfo),$("#insertProperty").click(function(){$(".property-info").addClass("visuallyhidden"),toastr.options={positionClass:"toast-top-center",preventDuplicates:!0,timeOut:20},toastr.info("Add New Property"),map.un("click",clickInfo),select.setActive(!1),draw.setActive(!0),draw.on("drawend",function(e){e.preventDefault(),draw.setActive(!1);var t={};$(".modal-dialog").removeClass("visuallyhidden"),dust.render("estateInsert.dust",t,function(e,t){$(".modal-content").html(t),componentHandler.upgradeDom()})})}),$("#deleteProperty").click(function(e){e.preventDefault(),$(".property-info").addClass("visuallyhidden"),toastr.options={positionClass:"toast-top-center",preventDuplicates:!0,timeOut:20},toastr.info("Delete Property"),map.un("click",clickInfo),draw.setActive(!1),features.clear(),select.setActive(!0),select.on("select",function(e){if(1===e.target.getFeatures().getLength()){toastr.options.newestOnTop=!0,toastr.options.preventDuplicates=!0,toastr.options.extendedTimeOut=0,toastr.options.timeOut=0,toastr.options.closeButton=!0;var t=toastr.warning('<p>Are you sure?</p><div class="toastr-btns"><button id="yesDelete" class="mdl-button mdl-js-button ">Yes</button><button id="noDelete" class="mdl-button mdl-js-button">No</button></div>');t.find("#yesDelete").length&&t.on("click","#yesDelete",function(){alert("you clicked ok"),t.remove()}),t.find("#noDelete").length&&t.on("click","#noDelete",function(){alert("Surprise! you clicked me.")})}})}),$("#logout").click(function(){location.href="/map/logout"});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkbWluLmpzIl0sIm5hbWVzIjpbIlByb3BlcnR5U3R5bGUiLCJzcmMiLCJvbCIsInN0eWxlIiwiU3R5bGUiLCJpbWFnZSIsIkljb24iLCJhbmNob3IiLCJzY2FsZSIsImNsaWNrSW5mbyIsImV2dCIsInByZXZlbnREZWZhdWx0Iiwib2JqIiwiY2xpY2tlZEZlYXR1cmUiLCJtYXAiLCJmb3JFYWNoRmVhdHVyZUF0UGl4ZWwiLCJwaXhlbCIsImZlYXR1cmUiLCJsYXllciIsInRoaXMiLCJnZXQiLCJjb25zb2xlIiwibG9nIiwiZ2V0S2V5cyIsImZvckVhY2giLCJrZXkiLCJkdXN0IiwicmVuZGVyIiwiZXJyIiwib3V0IiwiJCIsImh0bWwiLCJyZW1vdmVDbGFzcyIsImFkZENsYXNzIiwiY2VudGVyIiwiZXh0ZW50IiwibGFuZyIsImRvY3VtZW50IiwiZG9jdW1lbnRFbGVtZW50IiwiZ2VvSlNPTkZvcm1hdCIsImZvcm1hdCIsIkdlb0pTT04iLCJkZWZhdWx0RGF0YVByb2plY3Rpb24iLCJiaW5nIiwiVGlsZSIsInZpc2libGUiLCJzb3VyY2UiLCJCaW5nTWFwcyIsImltYWdlcnlTZXQiLCJtYXhab29tIiwiY3Jvc3NPcmlnaW4iLCJwcmVsb2FkIiwiSW5maW5pdHkiLCJpZCIsIm1hcGJveCIsIlhZWiIsImF0dHJpYnV0aW9ucyIsIkF0dHJpYnV0aW9uIiwidXJsIiwicHJvcGVydHlTb3VyY2UiLCJWZWN0b3IiLCJsb2FkZXIiLCJyZXNvbHV0aW9uIiwicHJvamVjdGlvbiIsInNlbGYiLCJjbGVhciIsImFqYXgiLCJ0eXBlIiwiYmVmb3JlU2VuZCIsInhociIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzZXRSZXF1ZXN0SGVhZGVyIiwiZGF0YVR5cGUiLCJkYXRhIiwiZG9uZSIsInJlc3BvbnNlIiwiZmVhdHVyZXMiLCJyZWFkRmVhdHVyZXMiLCJmZWF0dXJlUHJvamVjdGlvbiIsImFkZEZlYXR1cmVzIiwiZmFpbCIsInN0cmF0ZWd5IiwibG9hZGluZ3N0cmF0ZWd5IiwiYWxsIiwicHJvcGVydHkiLCJzZXRaSW5kZXgiLCJNYXAiLCJ0YXJnZXQiLCJsYXllcnMiLCJsb2FkVGlsZXNXaGlsZUFuaW1hdGluZyIsImxvYWRUaWxlc1doaWxlSW50ZXJhY3RpbmciLCJyZW5kZXJlciIsImNvbnRyb2xzIiwiY29udHJvbCIsImRlZmF1bHRzIiwiYXR0cmlidXRpb25PcHRpb25zIiwiY29sbGFwc2libGUiLCJjb2xsYXBzZWQiLCJleHRlbmQiLCJTY2FsZUxpbmUiLCJ1bml0cyIsIk92ZXJ2aWV3TWFwIiwiY2xhc3NOYW1lIiwiWm9vbVRvRXh0ZW50IiwidmlldyIsIlZpZXciLCJ6b29tIiwibWluWm9vbSIsInNldCIsIkNvbGxlY3Rpb24iLCJkcmF3blByb3BlcnRpZXMiLCJmaWxsIiwiRmlsbCIsImNvbG9yIiwic3Ryb2tlIiwiU3Ryb2tlIiwid2lkdGgiLCJDaXJjbGUiLCJyYWRpdXMiLCJhZGRMYXllciIsImRyYXciLCJpbnRlcmFjdGlvbiIsIkRyYXciLCJnZXRTb3VyY2UiLCJhZGRJbnRlcmFjdGlvbiIsInNldEFjdGl2ZSIsInNlbGVjdCIsIlNlbGVjdCIsInRyYW5zbGF0ZSIsIlRyYW5zbGF0ZSIsImdldEZlYXR1cmVzIiwib24iLCJjbGljayIsInRvYXN0ciIsIm9wdGlvbnMiLCJwb3NpdGlvbkNsYXNzIiwicHJldmVudER1cGxpY2F0ZXMiLCJ0aW1lT3V0IiwiaW5mbyIsInVuIiwiY29tcG9uZW50SGFuZGxlciIsInVwZ3JhZGVEb20iLCJldmVudCIsImUiLCJnZXRMZW5ndGgiLCJuZXdlc3RPblRvcCIsImV4dGVuZGVkVGltZU91dCIsImNsb3NlQnV0dG9uIiwiJHRvYXN0Iiwid2FybmluZyIsImZpbmQiLCJsZW5ndGgiLCJhbGVydCIsInJlbW92ZSIsImxvY2F0aW9uIiwiaHJlZiJdLCJtYXBwaW5ncyI6IkFBK0JBLFFBQUFBLGlCQUNBLEdBQUFDLEVBRUEsT0FEQUEsR0FBQSx1Q0FDQSxHQUFBQyxJQUFBQyxNQUFBQyxPQUNBQyxNQUFBLEdBQUFI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QUEyQyxjQUFBYyxZQUFBLENBQ0FYLE9BQUFDLFFBQUFXLGFBQUEsRUFDQVosT0FBQUMsUUFBQUUsbUJBQUEsRUFDQUgsT0FBQUMsUUFBQVksZ0JBQUEsRUFDQWIsT0FBQUMsUUFBQUcsUUFBQSxFQUNBSixPQUFBQyxRQUFBYSxhQUFBLENBQ0EsSUFBQUMsR0FBQWYsT0FBQWdCLFFBQUEsNkxBQ0FELEdBQUFFLEtBQUEsY0FBQUMsUUFDQUgsRUFBQWpCLEdBQUEsUUFBQSxhQUFBLFdBQ0FxQixNQUFBLGtCQUNBSixFQUFBSyxXQUdBTCxFQUFBRSxLQUFBLGFBQUFDLFFBQ0FILEVBQUFqQixHQUFBLFFBQUEsWUFBQSxXQUNBcUIsTUFBQSxvQ0FNQTNILEVBQUEsV0FBQXVHLE1BQUEsV0FDQXNCLFNBQUFDLEtBQUEiLCJmaWxlIjoiYWRtaW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGNlbnRlciA9IFtcbiAgICAzNjc3Mzg1LCA0MTIwOTQ5XG4gIF0sXG4gIGV4dGVudCA9IFtcbiAgICAzNTkwMDk0LCA0MTAyODMzLCAzODU1NDgzLCA0MjYxMjExXG4gIF0sXG4gIGxhbmcgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZyxcbiAgZ2VvSlNPTkZvcm1hdCA9IG5ldyBvbC5mb3JtYXQuR2VvSlNPTih7XG4gICAgZGVmYXVsdERhdGFQcm9qZWN0aW9uOiAnRVBTRzo0MzI2J1xuICB9KTtcbnZhciBiaW5nID0gbmV3IG9sLmxheWVyLlRpbGUoe1xuICB2aXNpYmxlOiB0cnVlLFxuICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuQmluZ01hcHMoe1xuICAgIGtleTogJ0FrMkdxOFZVZklDc1BwdWY3TFJBTlhtWHQyc0hXbVNMUGhvaG1WTEZ0RklFd1lqc181TUN5QWhBRndSU1ZwTGonLFxuICAgIGltYWdlcnlTZXQ6ICdBZXJpYWwnXG4gIH0pLFxuICBtYXhab29tOiAxOSxcbiAgY3Jvc3NPcmlnaW46ICdhbm9ueW1vdXMnLFxuICBwcmVsb2FkOiBJbmZpbml0eSxcbiAgaWQ6ICdiaW5nJ1xufSk7XG52YXIgbWFwYm94ID0gbmV3IG9sLmxheWVyLlRpbGUoe1xuICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuWFlaKHtcbiAgICBhdHRyaWJ1dGlvbnM6IFtuZXcgb2wuQXR0cmlidXRpb24oe1xuICAgICAgaHRtbDogJzxhIGhyZWY9XCJodHRwczovL3d3dy5tYXBib3guY29tL2Fib3V0L21hcHMvXCIgdGFyZ2V0PVwiX2JsYW5rXCI+JmNvcHk7IE1hcGJveCAmY29weTsgT3BlblN0cmVldE1hcDwvYT4nXG4gICAgfSldLFxuICAgIHVybDogJ2h0dHBzOi8vYXBpLm1hcGJveC5jb20vdjQvbWFwYm94LnN0cmVldHMve3p9L3t4fS97eX0ucG5nP2FjY2Vzc190b2tlbj1way5leUoxSWpvaVptbHlkbUZwYmlJc0ltRWlPaUpsT1dZeVlUTTBOVGhpTldNMFlqSmpPREpqTkRFNE9EUXpOekEyTUdReU5pSjkuLU5WRE8yN0h6dC13X25Rb3NVUGZMQSdcbiAgfSksXG4gIGlkOiAnbWFwYm94J1xufSk7XG5cbmZ1bmN0aW9uIFByb3BlcnR5U3R5bGUoKSB7XG4gIHZhciBzcmM7XG4gIHNyYyA9ICcuLi9pbWFnZXMvbWFwLWljb25zL3BpbnMvNDgvcGluMS5wbmcnO1xuICByZXR1cm4gbmV3IG9sLnN0eWxlLlN0eWxlKHtcbiAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkljb24oKHtcbiAgICAgIHNyYzogc3JjLFxuICAgICAgYW5jaG9yOiBbXG4gICAgICAgIDAuNSwgMVxuICAgICAgXSxcbiAgICAgIHNjYWxlOiAwLjdcbiAgICB9KSlcbiAgfSk7XG59XG52YXIgcHJvcGVydHlTb3VyY2UgPSBuZXcgb2wuc291cmNlLlZlY3Rvcih7XG4gIGZvcm1hdDogZ2VvSlNPTkZvcm1hdCxcbiAgbG9hZGVyOiBmdW5jdGlvbiAoZXh0ZW50LCByZXNvbHV0aW9uLCBwcm9qZWN0aW9uKSB7XG4gICAgdmFyIHVybCA9ICdodHRwOi8vMTI3LjAuMC4xOjMwMDAvZGIvYWRtaW4nO1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBzZWxmLmNsZWFyKCk7XG4gICAgJC5hamF4KHtcbiAgICAgIHVybDogdXJsLFxuICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgJ2JlZm9yZVNlbmQnOiBmdW5jdGlvbiAoeGhyKSB7XG4gICAgICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJykpIHtcbiAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQXV0aG9yaXphdGlvbicsICdCZWFyZXIgJyArIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgZGF0YToge1xuICAgICAgICBpZDogaWRcbiAgICAgIH1cbiAgICB9KS5kb25lKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgdmFyIGZlYXR1cmVzID0gZ2VvSlNPTkZvcm1hdC5yZWFkRmVhdHVyZXMocmVzcG9uc2UsIHtcbiAgICAgICAgZmVhdHVyZVByb2plY3Rpb246ICdFUFNHOjM4NTcnXG4gICAgICB9KTtcbiAgICAgIHNlbGYuYWRkRmVhdHVyZXMoZmVhdHVyZXMpO1xuICAgIH0pLmZhaWwoZnVuY3Rpb24gKCkge1xuICAgICAgY29uc29sZS5sb2coJ2Vycm9yJyk7XG4gICAgfSk7XG4gIH0sXG4gIHN0cmF0ZWd5OiBvbC5sb2FkaW5nc3RyYXRlZ3kuYWxsXG59KTtcbnZhciBwcm9wZXJ0eSA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xuICBzb3VyY2U6IHByb3BlcnR5U291cmNlLFxuICBpZDogJ3Byb3BlcnR5JyxcbiAgdmlzaWJsZTogdHJ1ZSxcbiAgc3R5bGU6IFByb3BlcnR5U3R5bGUoKVxufSk7XG5wcm9wZXJ0eS5zZXRaSW5kZXgoMik7XG52YXIgbWFwID0gbmV3IG9sLk1hcCh7XG4gIHRhcmdldDogJ2FkbWluTWFwJyxcbiAgbGF5ZXJzOiBbXG4gICAgbWFwYm94LCBwcm9wZXJ0eVxuICBdLFxuICBsb2FkVGlsZXNXaGlsZUFuaW1hdGluZzogdHJ1ZSxcbiAgbG9hZFRpbGVzV2hpbGVJbnRlcmFjdGluZzogdHJ1ZSxcbiAgcmVuZGVyZXI6ICdjYW52YXMnLFxuICBjb250cm9sczogb2wuY29udHJvbC5kZWZhdWx0cyh7XG4gICAgYXR0cmlidXRpb25PcHRpb25zOiB7XG4gICAgICBjb2xsYXBzaWJsZTogZmFsc2UsXG4gICAgICBjb2xsYXBzZWQ6IGZhbHNlXG4gICAgfVxuICB9KS5leHRlbmQoW1xuICAgIG5ldyBvbC5jb250cm9sLlNjYWxlTGluZSh7XG4gICAgICB1bml0czogJ21ldHJpYydcbiAgICB9KSxcbiAgICBuZXcgb2wuY29udHJvbC5PdmVydmlld01hcCh7XG4gICAgICBjbGFzc05hbWU6ICdvbC1vdmVydmlld21hcCBvbC1jdXN0b20tb3ZlcnZpZXdtYXAnLFxuICAgICAgY29sbGFwc2libGU6IHRydWUsXG4gICAgICBjb2xsYXBzZWQ6IHRydWUsXG4gICAgICBsYXllcnM6IFtiaW5nXVxuICAgIH0pLFxuICAgIG5ldyBvbC5jb250cm9sLlpvb21Ub0V4dGVudCh7XG4gICAgICBleHRlbnQ6IGV4dGVudFxuICAgIH0pXG4gIF0pLFxuICB2aWV3OiBuZXcgb2wuVmlldyh7XG4gICAgY2VudGVyOiBjZW50ZXIsXG4gICAgLy8gZXh0ZW50OiBleHRlbnQsXG4gICAgcHJvamVjdGlvbjogJ0VQU0c6Mzg1NycsXG4gICAgem9vbTogMTQsXG4gICAgbWF4Wm9vbTogMTksXG4gICAgbWluWm9vbTogMTBcbiAgfSlcbn0pO1xuaWYgKGxhbmcgPT09ICdlbCcpIHtcbiAgYmluZy5zZXQoJ25hbWUnLCAnzpTOv8+Bz4XPhs6/z4HOuc66zq4gzrXOuc66z4zOvc6xJyk7XG4gIG1hcGJveC5zZXQoJ25hbWUnLCAnzqfOrM+Bz4TOt8+CJyk7XG4gIHByb3BlcnR5LnNldCgnbmFtZScsICfOkc66zq/Ovc63z4TOsScpO1xufSBlbHNlIHtcbiAgYmluZy5zZXQoJ25hbWUnLCAnU2F0dGVsaXRlIEltYWdlJyk7XG4gIG1hcGJveC5zZXQoJ25hbWUnLCAnTWFwJyk7XG4gIHByb3BlcnR5LnNldCgnbmFtZScsICdQcm9wZXJ0aWVzJyk7XG59XG4vLz09PT09PSBpbnRlcmFjdGlvbnMgPT09PT09XG52YXIgZmVhdHVyZXMgPSBuZXcgb2wuQ29sbGVjdGlvbigpO1xudmFyIGRyYXduUHJvcGVydGllcyA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xuICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuVmVjdG9yKCksXG4gIHN0eWxlOiBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgIGNvbG9yOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpJ1xuICAgIH0pLFxuICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XG4gICAgICBjb2xvcjogJyNmZmNjMzMnLFxuICAgICAgd2lkdGg6IDJcbiAgICB9KSxcbiAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkNpcmNsZSh7XG4gICAgICByYWRpdXM6IDcsXG4gICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XG4gICAgICAgIGNvbG9yOiAnI2ZmY2MzMydcbiAgICAgIH0pXG4gICAgfSlcbiAgfSksXG4gIGlkOiAnZHJhd25Qcm9wZXJ0aWVzJ1xufSk7XG5tYXAuYWRkTGF5ZXIoZHJhd25Qcm9wZXJ0aWVzKTtcbi8vZHJhd1xudmFyIGRyYXcgPSBuZXcgb2wuaW50ZXJhY3Rpb24uRHJhdyh7XG4gIC8vIGZlYXR1cmVzOiBmZWF0dXJlcyxcbiAgc291cmNlOiBkcmF3blByb3BlcnRpZXMuZ2V0U291cmNlKCksXG4gIHR5cGU6ICdQb2ludCcsXG4gIHN0eWxlOiBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgIGNvbG9yOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpJ1xuICAgIH0pLFxuICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XG4gICAgICBjb2xvcjogJyNmZmNjMzMnLFxuICAgICAgd2lkdGg6IDJcbiAgICB9KSxcbiAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkNpcmNsZSh7XG4gICAgICByYWRpdXM6IDcsXG4gICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XG4gICAgICAgIGNvbG9yOiAnI2ZmY2MzMydcbiAgICAgIH0pXG4gICAgfSlcbiAgfSlcbn0pO1xubWFwLmFkZEludGVyYWN0aW9uKGRyYXcpO1xuZHJhdy5zZXRBY3RpdmUoZmFsc2UpO1xuLy9zZWxlY3RcbnZhciBzZWxlY3QgPSBuZXcgb2wuaW50ZXJhY3Rpb24uU2VsZWN0KHtcbiAgbGF5ZXJzOiBbcHJvcGVydHldLFxuICBmZWF0dXJlczogZmVhdHVyZXMsXG4gIHN0eWxlOiBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgIGNvbG9yOiAncmdiYSgyNTUsIDAsIDAsIDAuMiknXG4gICAgfSksXG4gICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcbiAgICAgIGNvbG9yOiAnI0ZGMDAwMDMnLFxuICAgICAgd2lkdGg6IDJcbiAgICB9KSxcbiAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkNpcmNsZSh7XG4gICAgICByYWRpdXM6IDcsXG4gICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XG4gICAgICAgIGNvbG9yOiAnI0ZGMDAwMCdcbiAgICAgIH0pXG4gICAgfSlcbiAgfSlcbn0pO1xubWFwLmFkZEludGVyYWN0aW9uKHNlbGVjdCk7XG5zZWxlY3Quc2V0QWN0aXZlKGZhbHNlKTtcbi8vdHJhbnNsYXRlKG1vdmUpXG52YXIgdHJhbnNsYXRlID0gbmV3IG9sLmludGVyYWN0aW9uLlRyYW5zbGF0ZSh7XG4gIGZlYXR1cmVzOiBzZWxlY3QuZ2V0RmVhdHVyZXMoKVxufSk7XG4vLz09PT09PSBpbmZvID09PT09PVxubWFwLm9uKCdjbGljaycsIGNsaWNrSW5mbyk7XG5cbmZ1bmN0aW9uIGNsaWNrSW5mbyhldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIHZhciBvYmogPSB7fTtcbiAgdmFyIGNsaWNrZWRGZWF0dXJlID0gbWFwLmZvckVhY2hGZWF0dXJlQXRQaXhlbChldnQucGl4ZWwsIGZ1bmN0aW9uIChmZWF0dXJlLCBsYXllcikge1xuICAgIHJldHVybiB7XG4gICAgICBmZWF0dXJlOiBmZWF0dXJlLFxuICAgICAgbGF5ZXI6IGxheWVyXG4gICAgfTtcbiAgfSwgdGhpcywgZnVuY3Rpb24gKGxheWVyKSB7XG4gICAgaWYgKGxheWVyLmdldCgnaWQnKSA9PT0gJ3Byb3BlcnR5Jykge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9LCB0aGlzKTtcbiAgY29uc29sZS5sb2coY2xpY2tlZEZlYXR1cmUpO1xuICBpZiAoY2xpY2tlZEZlYXR1cmUpIHtcbiAgICBvYmouZmVhdHVyZSA9IHt9O1xuICAgIGNsaWNrZWRGZWF0dXJlLmZlYXR1cmUuZ2V0S2V5cygpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgb2JqLmZlYXR1cmVba2V5XSA9IGNsaWNrZWRGZWF0dXJlLmZlYXR1cmUuZ2V0KGtleSk7XG4gICAgfSk7XG4gICAgY29uc29sZS5sb2cob2JqKTtcbiAgICBkdXN0LnJlbmRlcignYWRtaW5Fc3RhdGVJbmZvLmR1c3QnLCBvYmosIGZ1bmN0aW9uIChlcnIsIG91dCkge1xuICAgICAgY29uc29sZS5sb2cob3V0KTtcbiAgICAgICQoJy5wcm9wZXJ0eS1pbmZvJykuaHRtbChvdXQpO1xuICAgICAgJCgnLnByb3BlcnR5LWluZm8nKS5yZW1vdmVDbGFzcygndmlzdWFsbHloaWRkZW4nKTtcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICAkKCcucHJvcGVydHktaW5mbycpLmFkZENsYXNzKCd2aXN1YWxseWhpZGRlbicpO1xuICB9XG59XG4vLz09PT09PSBpbnNlcnQgPT09PT09XG4kKCcjaW5zZXJ0UHJvcGVydHknKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICQoJy5wcm9wZXJ0eS1pbmZvJykuYWRkQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7XG4gIHRvYXN0ci5vcHRpb25zID0ge1xuICAgICdwb3NpdGlvbkNsYXNzJzogJ3RvYXN0LXRvcC1jZW50ZXInLFxuICAgICdwcmV2ZW50RHVwbGljYXRlcyc6IHRydWUsXG4gICAgJ3RpbWVPdXQnOiAyMFxuICB9O1xuICB0b2FzdHIuaW5mbygnQWRkIE5ldyBQcm9wZXJ0eScpO1xuICBtYXAudW4oJ2NsaWNrJywgY2xpY2tJbmZvKTtcbiAgc2VsZWN0LnNldEFjdGl2ZShmYWxzZSk7XG4gIGRyYXcuc2V0QWN0aXZlKHRydWUpO1xuICBkcmF3Lm9uKCdkcmF3ZW5kJywgZnVuY3Rpb24gKGV2dCkge1xuICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGRyYXcuc2V0QWN0aXZlKGZhbHNlKTtcbiAgICB2YXIgb2JqPXt9O1xuICAgICQoJy5tb2RhbC1kaWFsb2cnKS5yZW1vdmVDbGFzcygndmlzdWFsbHloaWRkZW4nKTtcbiAgICBkdXN0LnJlbmRlcignZXN0YXRlSW5zZXJ0LmR1c3QnLCBvYmosIGZ1bmN0aW9uKGVyciwgb3V0KSB7XG4gICAgICAkKCcubW9kYWwtY29udGVudCcpLmh0bWwob3V0KTtcbiAgICAgIGNvbXBvbmVudEhhbmRsZXIudXBncmFkZURvbSgpO1xuICAgIH0pO1xuICB9KTtcblxufSk7XG4vLz09PT09PSBkZWxldGUgPT09PT09XG4kKCcjZGVsZXRlUHJvcGVydHknKS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgJCgnLnByb3BlcnR5LWluZm8nKS5hZGRDbGFzcygndmlzdWFsbHloaWRkZW4nKTtcbiAgdG9hc3RyLm9wdGlvbnMgPSB7XG4gICAgJ3Bvc2l0aW9uQ2xhc3MnOiAndG9hc3QtdG9wLWNlbnRlcicsXG4gICAgJ3ByZXZlbnREdXBsaWNhdGVzJzogdHJ1ZSxcbiAgICAndGltZU91dCc6IDIwXG4gIH07XG4gIHRvYXN0ci5pbmZvKCdEZWxldGUgUHJvcGVydHknKTtcbiAgbWFwLnVuKCdjbGljaycsIGNsaWNrSW5mbyk7XG4gIGRyYXcuc2V0QWN0aXZlKGZhbHNlKTtcbiAgZmVhdHVyZXMuY2xlYXIoKTtcbiAgc2VsZWN0LnNldEFjdGl2ZSh0cnVlKTtcbiAgc2VsZWN0Lm9uKCdzZWxlY3QnLCBmdW5jdGlvbiAoZSkge1xuICAgIGlmIChlLnRhcmdldC5nZXRGZWF0dXJlcygpLmdldExlbmd0aCgpID09PSAxKSB7XG4gICAgICB0b2FzdHIub3B0aW9ucy5uZXdlc3RPblRvcCA9IHRydWU7XG4gICAgICB0b2FzdHIub3B0aW9ucy5wcmV2ZW50RHVwbGljYXRlcyA9IHRydWU7XG4gICAgICB0b2FzdHIub3B0aW9ucy5leHRlbmRlZFRpbWVPdXQgPSAwO1xuICAgICAgdG9hc3RyLm9wdGlvbnMudGltZU91dCA9IDA7XG4gICAgICB0b2FzdHIub3B0aW9ucy5jbG9zZUJ1dHRvbiA9IHRydWU7XG4gICAgICB2YXIgJHRvYXN0ID0gdG9hc3RyLndhcm5pbmcoJzxwPkFyZSB5b3Ugc3VyZT88L3A+PGRpdiBjbGFzcz1cInRvYXN0ci1idG5zXCI+PGJ1dHRvbiBpZD1cInllc0RlbGV0ZVwiIGNsYXNzPVwibWRsLWJ1dHRvbiBtZGwtanMtYnV0dG9uIFwiPlllczwvYnV0dG9uPjxidXR0b24gaWQ9XCJub0RlbGV0ZVwiIGNsYXNzPVwibWRsLWJ1dHRvbiBtZGwtanMtYnV0dG9uXCI+Tm88L2J1dHRvbj48L2Rpdj4nKTtcbiAgICAgIGlmICgkdG9hc3QuZmluZCgnI3llc0RlbGV0ZScpLmxlbmd0aCkge1xuICAgICAgICAkdG9hc3Qub24oJ2NsaWNrJywgJyN5ZXNEZWxldGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgYWxlcnQoJ3lvdSBjbGlja2VkIG9rJyk7XG4gICAgICAgICAgJHRvYXN0LnJlbW92ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmICgkdG9hc3QuZmluZCgnI25vRGVsZXRlJykubGVuZ3RoKSB7XG4gICAgICAgICR0b2FzdC5vbignY2xpY2snLCAnI25vRGVsZXRlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGFsZXJ0KCdTdXJwcmlzZSEgeW91IGNsaWNrZWQgbWUuJyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59KTtcbiQoJyNsb2dvdXQnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gIGxvY2F0aW9uLmhyZWYgPSAnL21hcC9sb2dvdXQnO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
