function PropertyStyle(){var e;return e="../images/map-icons/pins/48/pin1.png",new ol.style.Style({image:new ol.style.Icon({src:e,anchor:[.5,1],scale:.7})})}function clickInfo(e){e.preventDefault();var t={},o=map.forEachFeatureAtPixel(e.pixel,function(e,t){return{feature:e,layer:t}},this,function(e){return"property"===e.get("id")?!0:void 0},this);o?(t.feature={},o.feature.getKeys().forEach(function(e){t.feature[e]=o.feature.get(e)}),dust.render("adminPropertyInfo",t,function(e,t){$(".property-info").html(t),$(".property-info").removeClass("visuallyhidden")})):($(".property-info").addClass("visuallyhidden"),toastr.options={positionClass:"toast-bottom-full-width",preventDuplicates:!0,timeOut:60},toastr.error("Cant Find Any Property There..."))}var center=[3677385,4120949],extent=[3590094,4102833,3855483,4261211],lang=document.documentElement.lang,geoJSONFormat=new ol.format.GeoJSON({defaultDataProjection:"EPSG:4326"}),bing=new ol.layer.Tile({visible:!0,source:new ol.source.BingMaps({key:"Ak2Gq8VUfICsPpuf7LRANXmXt2sHWmSLPhohmVLFtFIEwYjs_5MCyAhAFwRSVpLj",imagerySet:"Aerial"}),maxZoom:19,crossOrigin:"anonymous",preload:1/0,id:"bing"}),mapbox=new ol.layer.Tile({source:new ol.source.XYZ({attributions:[new ol.Attribution({html:'<a href="https://www.mapbox.com/about/maps/" target="_blank">&copy; Mapbox &copy; OpenStreetMap</a>'})],url:"https://api.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZmlydmFpbiIsImEiOiJlOWYyYTM0NThiNWM0YjJjODJjNDE4ODQzNzA2MGQyNiJ9.-NVDO27Hzt-w_nQosUPfLA"}),id:"mapbox"}),propertySource=new ol.source.Vector({format:geoJSONFormat,loader:function(e,t,o){var r="http://127.0.0.1:3000/db/admin",n=this;n.clear(),$.ajax({url:r,type:"POST",beforeSend:function(e){localStorage.getItem("userToken")&&e.setRequestHeader("Authorization","Bearer "+localStorage.getItem("userToken"))},dataType:"json",data:{id:id}}).done(function(e){var t=geoJSONFormat.readFeatures(e,{featureProjection:"EPSG:3857"});n.addFeatures(t)}).fail(function(){console.log("error")})},strategy:ol.loadingstrategy.all}),property=new ol.layer.Vector({source:propertySource,id:"property",visible:!0,style:PropertyStyle()});property.setZIndex(2);var map=new ol.Map({target:"adminMap",layers:[mapbox,property],loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0,renderer:"canvas",controls:ol.control.defaults({attributionOptions:{collapsible:!1,collapsed:!1}}).extend([new ol.control.ScaleLine({units:"metric"}),new ol.control.OverviewMap({className:"ol-overviewmap ol-custom-overviewmap",collapsible:!0,collapsed:!0,layers:[bing]}),new ol.control.ZoomToExtent({extent:extent})]),view:new ol.View({center:center,projection:"EPSG:3857",zoom:14,maxZoom:19,minZoom:10})});"el"===lang?(bing.set("name","Δορυφορική εικόνα"),mapbox.set("name","Χάρτης"),property.set("name","Ακίνητα")):(bing.set("name","Sattelite Image"),mapbox.set("name","Map"),property.set("name","Properties"));var features=new ol.Collection,drawnProperties=new ol.layer.Vector({source:new ol.source.Vector,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})}),id:"drawnProperties"});map.addLayer(drawnProperties);var draw=new ol.interaction.Draw({source:drawnProperties.getSource(),type:"Point",style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})});map.addInteraction(draw),draw.setActive(!1);var select=new ol.interaction.Select({layers:[property],features:features,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 0, 0, 0.2)"}),stroke:new ol.style.Stroke({color:"#FF00003",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#FF0000"})})})});map.addInteraction(select),select.setActive(!1);var translate=new ol.interaction.Translate({features:select.getFeatures()});map.addInteraction(translate),translate.setActive(!1),map.on("click",clickInfo),$("#insertProperty").click(function(){$(".property-info").addClass("visuallyhidden"),toastr.options={positionClass:"toast-top-center",preventDuplicates:!0,timeOut:60},map.un("click",clickInfo),select.setActive(!1),draw.setActive(!0),draw.on("drawend",function(e){e.preventDefault(),draw.setActive(!1);var t={};$(".modal-dialog").removeClass("visuallyhidden"),dust.render("propertyInsert",t,function(e,t){$(".modal-content").html(t),componentHandler.upgradeDom(),handleForm.set({name:"insertProperty",submitBtnId:"insert"}),$("#cancelInsert").on("click",function(e){e.preventDefault(),handleForm.clear(),drawnProperties.getSource().clear(),$(".modal-dialog").addClass("visuallyhidden"),map.on("click",clickInfo)}),$("#insert").on("click",function(e){e.preventDefault();var t,o;t=handleForm.get(),console.log(t),null!==t&&(handleCoords.setLayer("drawnProperties"),o=handleCoords.coords(),t.x=o[0],t.y=o[1],t.adminId=id,$.ajax({url:"http://127.0.0.1:3000/db/insert",type:"POST",data:t}).done(function(e,t,o){toastr.options={positionClass:"toast-bottom-full-width",preventDuplicates:!0,timeOut:60},201===o.status?toastr.success("Property Recorded In Database"):toastr.error("Oops Something Went Wrong!!!")}).fail(function(e,t,o){toastr.error("Oops Something Went Wrong!!!")}).always(function(){e.preventDefault(),drawnProperties.getSource().clear(),propertySource.clear(),handleForm.clear(),$(".modal-dialog").addClass("visuallyhidden"),map.on("click",clickInfo)}))})})})}),$("#deleteProperty").click(function(e){e.preventDefault(),$(".property-info").addClass("visuallyhidden"),toastr.options={positionClass:"toast-top-center",preventDuplicates:!0,timeOut:20},toastr.info("Delete Property"),map.un("click",clickInfo),draw.setActive(!1),features.clear(),select.setActive(!0),select.on("select",function(e){if(1===e.target.getFeatures().getLength()){toastr.options.newestOnTop=!0,toastr.options.preventDuplicates=!0,toastr.options.extendedTimeOut=0,toastr.options.timeOut=0,toastr.options.closeButton=!0;var t=toastr.warning('<p>Are you sure?</p><div class="toastr-btns"><button id="yesDelete" class="mdl-button mdl-js-button ">Yes</button><button id="noDelete" class="mdl-button mdl-js-button">No</button></div>');t.on("click","#yesDelete",function(){var e;console.log(select.getFeatures()),e=select.getFeatures().item(0).get("gid"),$.ajax({url:"http://127.0.0.1:3000/db/delete",type:"POST",dataType:"text",data:{gid:e}}).done(function(e,t,o){toastr.options={positionClass:"toast-bottom-full-width",preventDuplicates:!0,timeOut:60},toastr.success("Property Deleted From Database")}).fail(function(e,t,o){toastr.options={positionClass:"toast-bottom-full-width",preventDuplicates:!0,timeOut:60},toastr.success("Oops Something Went Wrong!!!")}).always(function(){propertySource.clear(),select.getFeatures().clear(),select.setActive(!1),map.on("click",clickInfo)}),t.remove()}),t.on("click","#noDelete",function(){t.remove(),select.getFeatures().clear(),select.setActive(!1)})}})}),$("#logout").click(function(){location.href="/map/logout"}),$("#updateProperty").on("click",function(e){e.preventDefault(),map.un("click",clickInfo),draw.setActive(!1),select.setActive(!0),translate.setActive(!0);var t;$(".property-info").addClass("visuallyhidden");var o;select.on("select",function(e){1===select.getFeatures().getLength()&&(t=select.getFeatures().item(0).get("gid"),$.ajax({url:"http://127.0.0.1:3000/db/fetch",type:"POST",dataType:"json",data:{gid:t}}).done(function(e){o=_.head(e.features).properties}).fail(function(){toastr.error("Oops Something Went Wrong!!!")}).always(function(){console.log("complete")}))}),translate.on("translateend",function(e){var r=ol.proj.transform(e.coordinate,"EPSG:3857","EPSG:4326");console.log(r),$(".modal-dialog").removeClass("visuallyhidden"),dust.render("propertyUpdate",o,function(e,o){$(".modal-content").html(o),componentHandler.upgradeDom(),handleForm.set({name:"updateProperty",submitBtnId:"update"}),$("#update").on("click",function(e){e.preventDefault();var o=handleForm.get();_.isNil(o)||(o.x=r[0],o.y=r[1],o.gid=t,$.ajax({url:"http://127.0.0.1:3000/db/update",type:"POST",data:o}).done(function(e,t,o){toastr.options={positionClass:"toast-bottom-full-width",preventDuplicates:!0,timeOut:60},200===o.status?toastr.success("Property Updated In Database"):toastr.error("Oops Something Went Wrong!!!")}).fail(function(){toastr.error("Oops Something Went Wrong!!!")}).always(function(){propertySource.clear(),select.getFeatures().clear(),select.setActive(!1),translate.setActive(!1),map.on("click",clickInfo),$(".modal-dialog").addClass("visuallyhidden")}))}),$("#cancelUpdate").on("click",function(e){e.preventDefault(),handleForm.clear(),propertySource.clear(),select.getFeatures().clear(),select.setActive(!1),translate.setActive(!1),map.on("click",clickInfo),$(".modal-dialog").addClass("visuallyhidden"),map.on("click",clickInfo)})})})});var handleCoords=function(e){"use strict";function t(e){for(var t=map.getLayers(),o=t.getLength(),r=0;o>r;r++)if(e===t.item(r).get("id"))return t.item(r);return null}function o(e){a=t(e)}function r(){var t;return t=a.getSource().getFeatures()[0].getGeometry().getCoordinates(),n=e.proj.transform(t,"EPSG:3857","EPSG:4326")}var n,a;return{coords:r,setLayer:o}}(ol),handleForm=function(e,t){"use strict";function o(e){i=e.name,c=e.submitBtnId}function r(){return d=e('form[name="'+i+'"').parsley(),!0}function n(){d.destroy()}function a(){return d.validate()}function l(){var t={};return r(),a()===!0?(e('form[name="'+i+'"').find(".mdl-textfield__input").each(function(o,r){t[e(this).attr("id")]=e(this).val()}),e('form[name="'+i+'"').find(".mdl-checkbox__input").each(function(o,r){t[e(this).attr("id")]=e(this).prop("checked")}),t):null}function s(){1==r()&&n(),e('form[name="'+i+'"').find(".mdl-textfield__input").each(function(t,o){e(this).val(""),e(this).parent().eq(0).removeClass("is-dirty"),e(this).parent().eq(0).removeClass("is-invalid")}),e('form[name="'+i+'"').find(".mdl-checkbox__input").each(function(t,o){e(this).prop("checked",!1)}),e('form[name="'+i+'"').find(".mdl-checkbox").each(function(t,o){e(this).removeClass("is-checked")})}var i,c,d;return{set:o,get:l,clear:s}}(jQuery,parsley);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkbWluLmpzIiwiaGFuZGxlQ29vcmRzLmpzIiwiaGFuZGxlRm9ybS5qcyJdLCJuYW1lcyI6WyJQcm9wZXJ0eVN0eWxlIiwic3JjIiwib2wiLCJzdHlsZSIsIlN0eWxlIiwiaW1hZ2UiLCJJY29uIiwiYW5jaG9yIiwic2NhbGUiLCJjbGlja0luZm8iLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsIm9iaiIsImNsaWNrZWRGZWF0dXJlIiwibWFwIiwiZm9yRWFjaEZlYXR1cmVBdFBpeGVsIiwicGl4ZWwiLCJmZWF0dXJlIiwibGF5ZXIiLCJ0aGlzIiwiZ2V0IiwiZ2V0S2V5cyIsImZvckVhY2giLCJrZXkiLCJkdXN0IiwicmVuZGVyIiwiZXJyIiwib3V0IiwiJCIsImh0bWwiLCJyZW1vdmVDbGFzcyIsImFkZENsYXNzIiwidG9hc3RyIiwib3B0aW9ucyIsInBvc2l0aW9uQ2xhc3MiLCJwcmV2ZW50RHVwbGljYXRlcyIsInRpbWVPdXQiLCJlcnJvciIsImNlbnRlciIsImV4dGVudCIsImxhbmciLCJkb2N1bWVudCIsImRvY3VtZW50RWxlbWVudCIsImdlb0pTT05Gb3JtYXQiLCJmb3JtYXQiLCJHZW9KU09OIiwiZGVmYXVsdERhdGFQcm9qZWN0aW9uIiwiYmluZyIsIlRpbGUiLCJ2aXNpYmxlIiwic291cmNlIiwiQmluZ01hcHMiLCJpbWFnZXJ5U2V0IiwibWF4Wm9vbSIsImNyb3NzT3JpZ2luIiwicHJlbG9hZCIsIkluZmluaXR5IiwiaWQiLCJtYXBib3giLCJYWVoiLCJhdHRyaWJ1dGlvbnMiLCJBdHRyaWJ1dGlvbiIsInVybCIsInByb3BlcnR5U291cmNlIiwiVmVjdG9yIiwibG9hZGVyIiwicmVzb2x1dGlvbiIsInByb2plY3Rpb24iLCJzZWxmIiwiY2xlYXIiLCJhamF4IiwidHlwZSIsImJlZm9yZVNlbmQiLCJ4aHIiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwic2V0UmVxdWVzdEhlYWRlciIsImRhdGFUeXBlIiwiZGF0YSIsImRvbmUiLCJyZXNwb25zZSIsImZlYXR1cmVzIiwicmVhZEZlYXR1cmVzIiwiZmVhdHVyZVByb2plY3Rpb24iLCJhZGRGZWF0dXJlcyIsImZhaWwiLCJjb25zb2xlIiwibG9nIiwic3RyYXRlZ3kiLCJsb2FkaW5nc3RyYXRlZ3kiLCJhbGwiLCJwcm9wZXJ0eSIsInNldFpJbmRleCIsIk1hcCIsInRhcmdldCIsImxheWVycyIsImxvYWRUaWxlc1doaWxlQW5pbWF0aW5nIiwibG9hZFRpbGVzV2hpbGVJbnRlcmFjdGluZyIsInJlbmRlcmVyIiwiY29udHJvbHMiLCJjb250cm9sIiwiZGVmYXVsdHMiLCJhdHRyaWJ1dGlvbk9wdGlvbnMiLCJjb2xsYXBzaWJsZSIsImNvbGxhcHNlZCIsImV4dGVuZCIsIlNjYWxlTGluZSIsInVuaXRzIiwiT3ZlcnZpZXdNYXAiLCJjbGFzc05hbWUiLCJab29tVG9FeHRlbnQiLCJ2aWV3IiwiVmlldyIsInpvb20iLCJtaW5ab29tIiwic2V0IiwiQ29sbGVjdGlvbiIsImRyYXduUHJvcGVydGllcyIsImZpbGwiLCJGaWxsIiwiY29sb3IiLCJzdHJva2UiLCJTdHJva2UiLCJ3aWR0aCIsIkNpcmNsZSIsInJhZGl1cyIsImFkZExheWVyIiwiZHJhdyIsImludGVyYWN0aW9uIiwiRHJhdyIsImdldFNvdXJjZSIsImFkZEludGVyYWN0aW9uIiwic2V0QWN0aXZlIiwic2VsZWN0IiwiU2VsZWN0IiwidHJhbnNsYXRlIiwiVHJhbnNsYXRlIiwiZ2V0RmVhdHVyZXMiLCJvbiIsImNsaWNrIiwidW4iLCJjb21wb25lbnRIYW5kbGVyIiwidXBncmFkZURvbSIsImhhbmRsZUZvcm0iLCJuYW1lIiwic3VibWl0QnRuSWQiLCJldmVudCIsImMiLCJoYW5kbGVDb29yZHMiLCJzZXRMYXllciIsImNvb3JkcyIsIngiLCJ5IiwiYWRtaW5JZCIsInRleHRTdGF0dXMiLCJqcVhIUiIsInN0YXR1cyIsInN1Y2Nlc3MiLCJlcnJvclRocm93biIsImFsd2F5cyIsImluZm8iLCJlIiwiZ2V0TGVuZ3RoIiwibmV3ZXN0T25Ub3AiLCJleHRlbmRlZFRpbWVPdXQiLCJjbG9zZUJ1dHRvbiIsIiR0b2FzdCIsIndhcm5pbmciLCJnaWQiLCJpdGVtIiwicmVtb3ZlIiwibG9jYXRpb24iLCJocmVmIiwiXyIsImhlYWQiLCJwcm9wZXJ0aWVzIiwicHJvaiIsInRyYW5zZm9ybSIsImNvb3JkaW5hdGUiLCJpc05pbCIsImZpbmRCeUlkIiwiZ2V0TGF5ZXJzIiwibGVuZ3RoIiwiaSIsImwiLCJnZXRDb29yZHMiLCJjb29yZEVQU0czODU3IiwiZ2V0R2VvbWV0cnkiLCJnZXRDb29yZGluYXRlcyIsInBhcnNsZXkiLCJzZXRPcHRpb25zIiwiZm9ybU5hbWUiLCJjcmVhdGVWYWxpZGF0b3IiLCJwIiwiZGVzdHJveVZhbGlkYXRvciIsImRlc3Ryb3kiLCJ2YWxpZGF0ZUZvcm0iLCJ2YWxpZGF0ZSIsImdldEF0dHJpYnV0ZXMiLCJmaW5kIiwiZWFjaCIsImluZGV4IiwiZWxlbWVudCIsImF0dHIiLCJ2YWwiLCJwcm9wIiwicmVzZXRGb3JtIiwicGFyZW50IiwiZXEiLCJqUXVlcnkiXSwibWFwcGluZ3MiOiJBQTRCQSxRQUFBQSxpQkFDQSxHQUFBQyxFQUVBLE9BREFBLEdBQUEsdUNBQ0EsR0FBQUMsSUFBQUMsTUFBQUMsT0FDQUMsTUFBQSxHQUFBSCxJQUFBQyxNQUFBRyxNQUNBTCxJQUFBQSxFQUNBTSxRQUNBLEdBQUEsR0FFQUMsTUFBQSxPQWdLQSxRQUFBQyxXQUFBQyxHQUNBQSxFQUFBQyxnQkFDQSxJQUFBQyxNQUNBQyxFQUFBQyxJQUFBQyxzQkFBQUwsRUFBQU0sTUFBQSxTQUFBQyxFQUFBQyxHQUNBLE9BQ0FELFFBQUFBLEVBQ0FDLE1BQUFBLElBRUFDLEtBQUEsU0FBQUQsR0FDQSxNQUFBLGFBQUFBLEVBQUFFLElBQUEsT0FDQSxFQURBLFFBR0FELEtBQ0FOLElBQ0FELEVBQUFLLFdBQ0FKLEVBQUFJLFFBQUFJLFVBQUFDLFFBQUEsU0FBQUMsR0FDQVgsRUFBQUssUUFBQU0sR0FBQVYsRUFBQUksUUFBQUcsSUFBQUcsS0FFQUMsS0FBQUMs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QVEsS0FBQSx5QkFBQUMsS0FBQSxTQUFBQyxFQUFBQyxHQUNBOUssRUFBQVQsTUFBQXlMLElBQUEsSUFDQWhMLEVBQUFULE1BQUE0TCxTQUFBQyxHQUFBLEdBQUFsTCxZQUFBLFlBQ0FGLEVBQUFULE1BQUE0TCxTQUFBQyxHQUFBLEdBQUFsTCxZQUFBLGdCQUVBRixFQUFBLGNBQUFtSyxFQUFBLEtBQUFRLEtBQUEsd0JBQUFDLEtBQUEsU0FBQUMsRUFBQUMsR0FDQTlLLEVBQUFULE1BQUEwTCxLQUFBLFdBQUEsS0FFQWpMLEVBQUEsY0FBQW1LLEVBQUEsS0FBQVEsS0FBQSxpQkFBQUMsS0FBQSxTQUFBQyxFQUFBQyxHQUNBOUssRUFBQVQsTUFBQVcsWUFBQSxnQkF4REEsR0FBQWlLLEdBQUE5QyxFQUFBZ0QsQ0EyREEsUUFDQTlFLElBQUEyRSxFQUNBMUssSUFBQWtMLEVBQ0FqSSxNQUFBeUksSUFPQUcsT0FBQXBCIiwiZmlsZSI6ImFkbWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBjZW50ZXIgPSBbMzY3NzM4NSwgNDEyMDk0OV0sXG4gIGV4dGVudCA9IFszNTkwMDk0LCA0MTAyODMzLCAzODU1NDgzLCA0MjYxMjExXSxcbiAgbGFuZyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nLFxuICBnZW9KU09ORm9ybWF0ID0gbmV3IG9sLmZvcm1hdC5HZW9KU09OKHtcbiAgICBkZWZhdWx0RGF0YVByb2plY3Rpb246ICdFUFNHOjQzMjYnXG4gIH0pO1xudmFyIGJpbmcgPSBuZXcgb2wubGF5ZXIuVGlsZSh7XG4gIHZpc2libGU6IHRydWUsXG4gIHNvdXJjZTogbmV3IG9sLnNvdXJjZS5CaW5nTWFwcyh7XG4gICAga2V5OiAnQWsyR3E4VlVmSUNzUHB1ZjdMUkFOWG1YdDJzSFdtU0xQaG9obVZMRnRGSUV3WWpzXzVNQ3lBaEFGd1JTVnBMaicsXG4gICAgaW1hZ2VyeVNldDogJ0FlcmlhbCdcbiAgfSksXG4gIG1heFpvb206IDE5LFxuICBjcm9zc09yaWdpbjogJ2Fub255bW91cycsXG4gIHByZWxvYWQ6IEluZmluaXR5LFxuICBpZDogJ2JpbmcnXG59KTtcblxudmFyIG1hcGJveCA9IG5ldyBvbC5sYXllci5UaWxlKHtcbiAgc291cmNlOiBuZXcgb2wuc291cmNlLlhZWih7XG4gICAgYXR0cmlidXRpb25zOiBbbmV3IG9sLkF0dHJpYnV0aW9uKHtcbiAgICAgIGh0bWw6ICc8YSBocmVmPVwiaHR0cHM6Ly93d3cubWFwYm94LmNvbS9hYm91dC9tYXBzL1wiIHRhcmdldD1cIl9ibGFua1wiPiZjb3B5OyBNYXBib3ggJmNvcHk7IE9wZW5TdHJlZXRNYXA8L2E+J1xuICAgIH0pXSxcbiAgICB1cmw6ICdodHRwczovL2FwaS5tYXBib3guY29tL3Y0L21hcGJveC5zdHJlZXRzL3t6fS97eH0ve3l9LnBuZz9hY2Nlc3NfdG9rZW49cGsuZXlKMUlqb2labWx5ZG1GcGJpSXNJbUVpT2lKbE9XWXlZVE0wTlRoaU5XTTBZakpqT0RKak5ERTRPRFF6TnpBMk1HUXlOaUo5Li1OVkRPMjdIenQtd19uUW9zVVBmTEEnXG4gIH0pLFxuICBpZDogJ21hcGJveCdcbn0pO1xuXG5mdW5jdGlvbiBQcm9wZXJ0eVN0eWxlKCkge1xuICB2YXIgc3JjO1xuICBzcmMgPSAnLi4vaW1hZ2VzL21hcC1pY29ucy9waW5zLzQ4L3BpbjEucG5nJztcbiAgcmV0dXJuIG5ldyBvbC5zdHlsZS5TdHlsZSh7XG4gICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5JY29uKCh7XG4gICAgICBzcmM6IHNyYyxcbiAgICAgIGFuY2hvcjogW1xuICAgICAgICAwLjUsIDFcbiAgICAgIF0sXG4gICAgICBzY2FsZTogMC43XG4gICAgfSkpXG4gIH0pO1xufVxudmFyIHByb3BlcnR5U291cmNlID0gbmV3IG9sLnNvdXJjZS5WZWN0b3Ioe1xuICBmb3JtYXQ6IGdlb0pTT05Gb3JtYXQsXG4gIGxvYWRlcjogZnVuY3Rpb24oZXh0ZW50LCByZXNvbHV0aW9uLCBwcm9qZWN0aW9uKSB7XG4gICAgdmFyIHVybCA9ICdodHRwOi8vMTI3LjAuMC4xOjMwMDAvZGIvYWRtaW4nO1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBzZWxmLmNsZWFyKCk7XG4gICAgJC5hamF4KHtcbiAgICAgIHVybDogdXJsLFxuICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgJ2JlZm9yZVNlbmQnOiBmdW5jdGlvbih4aHIpIHtcbiAgICAgICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKSkge1xuICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdBdXRob3JpemF0aW9uJywgJ0JlYXJlciAnICsgbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGlkOiBpZFxuICAgICAgfVxuICAgIH0pLmRvbmUoZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgIHZhciBmZWF0dXJlcyA9IGdlb0pTT05Gb3JtYXQucmVhZEZlYXR1cmVzKHJlc3BvbnNlLCB7XG4gICAgICAgIGZlYXR1cmVQcm9qZWN0aW9uOiAnRVBTRzozODU3J1xuICAgICAgfSk7XG4gICAgICBzZWxmLmFkZEZlYXR1cmVzKGZlYXR1cmVzKTtcbiAgICB9KS5mYWlsKGZ1bmN0aW9uKCkge1xuICAgICAgY29uc29sZS5sb2coJ2Vycm9yJyk7XG4gICAgfSk7XG4gIH0sXG4gIHN0cmF0ZWd5OiBvbC5sb2FkaW5nc3RyYXRlZ3kuYWxsXG59KTtcbnZhciBwcm9wZXJ0eSA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xuICBzb3VyY2U6IHByb3BlcnR5U291cmNlLFxuICBpZDogJ3Byb3BlcnR5JyxcbiAgdmlzaWJsZTogdHJ1ZSxcbiAgc3R5bGU6IFByb3BlcnR5U3R5bGUoKVxufSk7XG5wcm9wZXJ0eS5zZXRaSW5kZXgoMik7XG52YXIgbWFwID0gbmV3IG9sLk1hcCh7XG4gIHRhcmdldDogJ2FkbWluTWFwJyxcbiAgbGF5ZXJzOiBbXG4gICAgbWFwYm94LCBwcm9wZXJ0eVxuICBdLFxuICBsb2FkVGlsZXNXaGlsZUFuaW1hdGluZzogdHJ1ZSxcbiAgbG9hZFRpbGVzV2hpbGVJbnRlcmFjdGluZzogdHJ1ZSxcbiAgcmVuZGVyZXI6ICdjYW52YXMnLFxuICBjb250cm9sczogb2wuY29udHJvbC5kZWZhdWx0cyh7XG4gICAgYXR0cmlidXRpb25PcHRpb25zOiB7XG4gICAgICBjb2xsYXBzaWJsZTogZmFsc2UsXG4gICAgICBjb2xsYXBzZWQ6IGZhbHNlXG4gICAgfVxuICB9KS5leHRlbmQoW1xuICAgIG5ldyBvbC5jb250cm9sLlNjYWxlTGluZSh7XG4gICAgICB1bml0czogJ21ldHJpYydcbiAgICB9KSxcbiAgICBuZXcgb2wuY29udHJvbC5PdmVydmlld01hcCh7XG4gICAgICBjbGFzc05hbWU6ICdvbC1vdmVydmlld21hcCBvbC1jdXN0b20tb3ZlcnZpZXdtYXAnLFxuICAgICAgY29sbGFwc2libGU6IHRydWUsXG4gICAgICBjb2xsYXBzZWQ6IHRydWUsXG4gICAgICBsYXllcnM6IFtiaW5nXVxuICAgIH0pLFxuICAgIG5ldyBvbC5jb250cm9sLlpvb21Ub0V4dGVudCh7XG4gICAgICBleHRlbnQ6IGV4dGVudFxuICAgIH0pXG4gIF0pLFxuICB2aWV3OiBuZXcgb2wuVmlldyh7XG4gICAgY2VudGVyOiBjZW50ZXIsXG4gICAgLy8gZXh0ZW50OiBleHRlbnQsXG4gICAgcHJvamVjdGlvbjogJ0VQU0c6Mzg1NycsXG4gICAgem9vbTogMTQsXG4gICAgbWF4Wm9vbTogMTksXG4gICAgbWluWm9vbTogMTBcbiAgfSlcbn0pO1xuaWYgKGxhbmcgPT09ICdlbCcpIHtcbiAgYmluZy5zZXQoJ25hbWUnLCAnzpTOv8+Bz4XPhs6/z4HOuc66zq4gzrXOuc66z4zOvc6xJyk7XG4gIG1hcGJveC5zZXQoJ25hbWUnLCAnzqfOrM+Bz4TOt8+CJyk7XG4gIHByb3BlcnR5LnNldCgnbmFtZScsICfOkc66zq/Ovc63z4TOsScpO1xufSBlbHNlIHtcbiAgYmluZy5zZXQoJ25hbWUnLCAnU2F0dGVsaXRlIEltYWdlJyk7XG4gIG1hcGJveC5zZXQoJ25hbWUnLCAnTWFwJyk7XG4gIHByb3BlcnR5LnNldCgnbmFtZScsICdQcm9wZXJ0aWVzJyk7XG59XG4vLz09PT09PSBpbnRlcmFjdGlvbnMgPT09PT09XG52YXIgZmVhdHVyZXMgPSBuZXcgb2wuQ29sbGVjdGlvbigpO1xudmFyIGRyYXduUHJvcGVydGllcyA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xuICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuVmVjdG9yKCksXG4gIHN0eWxlOiBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgIGNvbG9yOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpJ1xuICAgIH0pLFxuICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XG4gICAgICBjb2xvcjogJyNmZmNjMzMnLFxuICAgICAgd2lkdGg6IDJcbiAgICB9KSxcbiAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkNpcmNsZSh7XG4gICAgICByYWRpdXM6IDcsXG4gICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XG4gICAgICAgIGNvbG9yOiAnI2ZmY2MzMydcbiAgICAgIH0pXG4gICAgfSlcbiAgfSksXG4gIGlkOiAnZHJhd25Qcm9wZXJ0aWVzJ1xufSk7XG5tYXAuYWRkTGF5ZXIoZHJhd25Qcm9wZXJ0aWVzKTtcbi8vZHJhd1xudmFyIGRyYXcgPSBuZXcgb2wuaW50ZXJhY3Rpb24uRHJhdyh7XG4gIC8vIGZlYXR1cmVzOiBmZWF0dXJlcyxcbiAgc291cmNlOiBkcmF3blByb3BlcnRpZXMuZ2V0U291cmNlKCksXG4gIHR5cGU6ICdQb2ludCcsXG4gIHN0eWxlOiBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgIGNvbG9yOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpJ1xuICAgIH0pLFxuICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XG4gICAgICBjb2xvcjogJyNmZmNjMzMnLFxuICAgICAgd2lkdGg6IDJcbiAgICB9KSxcbiAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkNpcmNsZSh7XG4gICAgICByYWRpdXM6IDcsXG4gICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XG4gICAgICAgIGNvbG9yOiAnI2ZmY2MzMydcbiAgICAgIH0pXG4gICAgfSlcbiAgfSlcbn0pO1xubWFwLmFkZEludGVyYWN0aW9uKGRyYXcpO1xuZHJhdy5zZXRBY3RpdmUoZmFsc2UpO1xuLy9zZWxlY3RcbnZhciBzZWxlY3QgPSBuZXcgb2wuaW50ZXJhY3Rpb24uU2VsZWN0KHtcbiAgbGF5ZXJzOiBbcHJvcGVydHldLFxuICBmZWF0dXJlczogZmVhdHVyZXMsXG4gIHN0eWxlOiBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgIGNvbG9yOiAncmdiYSgyNTUsIDAsIDAsIDAuMiknXG4gICAgfSksXG4gICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcbiAgICAgIGNvbG9yOiAnI0ZGMDAwMDMnLFxuICAgICAgd2lkdGg6IDJcbiAgICB9KSxcbiAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkNpcmNsZSh7XG4gICAgICByYWRpdXM6IDcsXG4gICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XG4gICAgICAgIGNvbG9yOiAnI0ZGMDAwMCdcbiAgICAgIH0pXG4gICAgfSlcbiAgfSlcbn0pO1xubWFwLmFkZEludGVyYWN0aW9uKHNlbGVjdCk7XG5zZWxlY3Quc2V0QWN0aXZlKGZhbHNlKTtcbnZhciB0cmFuc2xhdGUgPSBuZXcgb2wuaW50ZXJhY3Rpb24uVHJhbnNsYXRlKHtcbiAgZmVhdHVyZXM6IHNlbGVjdC5nZXRGZWF0dXJlcygpXG59KTtcbm1hcC5hZGRJbnRlcmFjdGlvbih0cmFuc2xhdGUpO1xudHJhbnNsYXRlLnNldEFjdGl2ZShmYWxzZSk7XG4vLz09PT09PSBpbmZvID09PT09PVxubWFwLm9uKCdjbGljaycsIGNsaWNrSW5mbyk7XG5cbmZ1bmN0aW9uIGNsaWNrSW5mbyhldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIHZhciBvYmogPSB7fTtcbiAgdmFyIGNsaWNrZWRGZWF0dXJlID0gbWFwLmZvckVhY2hGZWF0dXJlQXRQaXhlbChldnQucGl4ZWwsIGZ1bmN0aW9uKGZlYXR1cmUsIGxheWVyKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGZlYXR1cmU6IGZlYXR1cmUsXG4gICAgICBsYXllcjogbGF5ZXJcbiAgICB9O1xuICB9LCB0aGlzLCBmdW5jdGlvbihsYXllcikge1xuICAgIGlmIChsYXllci5nZXQoJ2lkJykgPT09ICdwcm9wZXJ0eScpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfSwgdGhpcyk7XG4gIGlmIChjbGlja2VkRmVhdHVyZSkge1xuICAgIG9iai5mZWF0dXJlID0ge307XG4gICAgY2xpY2tlZEZlYXR1cmUuZmVhdHVyZS5nZXRLZXlzKCkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICAgIG9iai5mZWF0dXJlW2tleV0gPSBjbGlja2VkRmVhdHVyZS5mZWF0dXJlLmdldChrZXkpO1xuICAgIH0pO1xuICAgIGR1c3QucmVuZGVyKCdhZG1pblByb3BlcnR5SW5mbycsIG9iaiwgZnVuY3Rpb24oZXJyLCBvdXQpIHtcbiAgICAgICQoJy5wcm9wZXJ0eS1pbmZvJykuaHRtbChvdXQpO1xuICAgICAgJCgnLnByb3BlcnR5LWluZm8nKS5yZW1vdmVDbGFzcygndmlzdWFsbHloaWRkZW4nKTtcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICAkKCcucHJvcGVydHktaW5mbycpLmFkZENsYXNzKCd2aXN1YWxseWhpZGRlbicpO1xuICAgIHRvYXN0ci5vcHRpb25zID0ge1xuICAgICAgJ3Bvc2l0aW9uQ2xhc3MnOiAndG9hc3QtYm90dG9tLWZ1bGwtd2lkdGgnLFxuICAgICAgJ3ByZXZlbnREdXBsaWNhdGVzJzogdHJ1ZSxcbiAgICAgICd0aW1lT3V0JzogNjBcbiAgICB9O1xuICAgIHRvYXN0ci5lcnJvcignQ2FudCBGaW5kIEFueSBQcm9wZXJ0eSBUaGVyZS4uLicpO1xuICB9XG59XG4vLz09PT09PSBpbnNlcnQgPT09PT09XG4kKCcjaW5zZXJ0UHJvcGVydHknKS5jbGljayhmdW5jdGlvbigpIHtcbiAgJCgnLnByb3BlcnR5LWluZm8nKS5hZGRDbGFzcygndmlzdWFsbHloaWRkZW4nKTtcbiAgdG9hc3RyLm9wdGlvbnMgPSB7XG4gICAgJ3Bvc2l0aW9uQ2xhc3MnOiAndG9hc3QtdG9wLWNlbnRlcicsXG4gICAgJ3ByZXZlbnREdXBsaWNhdGVzJzogdHJ1ZSxcbiAgICAndGltZU91dCc6IDYwXG4gIH07XG4gIC8vIHRvYXN0ci5pbmZvKFwiQWRkIE5ldyBQcm9wZXJ0eVwiKTtcbiAgbWFwLnVuKCdjbGljaycsIGNsaWNrSW5mbyk7XG4gIHNlbGVjdC5zZXRBY3RpdmUoZmFsc2UpO1xuICBkcmF3LnNldEFjdGl2ZSh0cnVlKTtcbiAgZHJhdy5vbignZHJhd2VuZCcsIGZ1bmN0aW9uKGV2dCkge1xuICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGRyYXcuc2V0QWN0aXZlKGZhbHNlKTtcbiAgICB2YXIgb2JqID0ge307XG4gICAgJCgnLm1vZGFsLWRpYWxvZycpLnJlbW92ZUNsYXNzKCd2aXN1YWxseWhpZGRlbicpO1xuICAgIGR1c3QucmVuZGVyKCdwcm9wZXJ0eUluc2VydCcsIG9iaiwgZnVuY3Rpb24oZXJyLCBvdXQpIHtcbiAgICAgICQoJy5tb2RhbC1jb250ZW50JykuaHRtbChvdXQpO1xuICAgICAgY29tcG9uZW50SGFuZGxlci51cGdyYWRlRG9tKCk7XG4gICAgICBoYW5kbGVGb3JtLnNldCh7XG4gICAgICAgIG5hbWU6ICdpbnNlcnRQcm9wZXJ0eScsXG4gICAgICAgIHN1Ym1pdEJ0bklkOiAnaW5zZXJ0J1xuICAgICAgfSk7XG4gICAgICAkKCcjY2FuY2VsSW5zZXJ0Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaGFuZGxlRm9ybS5jbGVhcigpO1xuICAgICAgICBkcmF3blByb3BlcnRpZXMuZ2V0U291cmNlKCkuY2xlYXIoKTtcblxuICAgICAgICAkKCcubW9kYWwtZGlhbG9nJykuYWRkQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7XG4gICAgICAgIG1hcC5vbignY2xpY2snLCBjbGlja0luZm8pO1xuICAgICAgfSk7XG4gICAgICAkKCcjaW5zZXJ0Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdmFyIGRhdGEsIGM7XG4gICAgICAgIGRhdGEgPSBoYW5kbGVGb3JtLmdldCgpO1xuICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgaWYgKGRhdGEgIT09IG51bGwpIHtcbiAgICAgICAgICBoYW5kbGVDb29yZHMuc2V0TGF5ZXIoJ2RyYXduUHJvcGVydGllcycpO1xuICAgICAgICAgIGMgPSBoYW5kbGVDb29yZHMuY29vcmRzKCk7XG4gICAgICAgICAgZGF0YS54ID0gY1swXTtcbiAgICAgICAgICBkYXRhLnkgPSBjWzFdO1xuICAgICAgICAgIGRhdGEuYWRtaW5JZCA9IGlkO1xuICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6ICdodHRwOi8vMTI3LjAuMC4xOjMwMDAvZGIvaW5zZXJ0JyxcbiAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIGpxWEhSKSB7XG4gICAgICAgICAgICB0b2FzdHIub3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgJ3Bvc2l0aW9uQ2xhc3MnOiAndG9hc3QtYm90dG9tLWZ1bGwtd2lkdGgnLFxuICAgICAgICAgICAgICAncHJldmVudER1cGxpY2F0ZXMnOiB0cnVlLFxuICAgICAgICAgICAgICAndGltZU91dCc6IDYwXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKGpxWEhSLnN0YXR1cyA9PT0gMjAxKSB7XG4gICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCdQcm9wZXJ0eSBSZWNvcmRlZCBJbiBEYXRhYmFzZScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCdPb3BzIFNvbWV0aGluZyBXZW50IFdyb25nISEhJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcbiAgICAgICAgICAgIHRvYXN0ci5lcnJvcignT29wcyBTb21ldGhpbmcgV2VudCBXcm9uZyEhIScpO1xuICAgICAgICAgIH0pLmFsd2F5cyhmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBkcmF3blByb3BlcnRpZXMuZ2V0U291cmNlKCkuY2xlYXIoKTtcbiAgICAgICAgICAgIHByb3BlcnR5U291cmNlLmNsZWFyKCk7XG4gICAgICAgICAgICBoYW5kbGVGb3JtLmNsZWFyKCk7XG4gICAgICAgICAgICAkKCcubW9kYWwtZGlhbG9nJykuYWRkQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7XG4gICAgICAgICAgICBtYXAub24oJ2NsaWNrJywgY2xpY2tJbmZvKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4vLz09PT09PSBkZWxldGUgPT09PT09XG4kKCcjZGVsZXRlUHJvcGVydHknKS5jbGljayhmdW5jdGlvbihldmVudCkge1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAkKCcucHJvcGVydHktaW5mbycpLmFkZENsYXNzKCd2aXN1YWxseWhpZGRlbicpO1xuICB0b2FzdHIub3B0aW9ucyA9IHtcbiAgICAncG9zaXRpb25DbGFzcyc6ICd0b2FzdC10b3AtY2VudGVyJyxcbiAgICAncHJldmVudER1cGxpY2F0ZXMnOiB0cnVlLFxuICAgICd0aW1lT3V0JzogMjBcbiAgfTtcbiAgdG9hc3RyLmluZm8oJ0RlbGV0ZSBQcm9wZXJ0eScpO1xuICBtYXAudW4oJ2NsaWNrJywgY2xpY2tJbmZvKTtcbiAgZHJhdy5zZXRBY3RpdmUoZmFsc2UpO1xuICBmZWF0dXJlcy5jbGVhcigpO1xuICBzZWxlY3Quc2V0QWN0aXZlKHRydWUpO1xuICBzZWxlY3Qub24oJ3NlbGVjdCcsIGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuZ2V0RmVhdHVyZXMoKS5nZXRMZW5ndGgoKSA9PT0gMSkge1xuICAgICAgdG9hc3RyLm9wdGlvbnMubmV3ZXN0T25Ub3AgPSB0cnVlO1xuICAgICAgdG9hc3RyLm9wdGlvbnMucHJldmVudER1cGxpY2F0ZXMgPSB0cnVlO1xuICAgICAgdG9hc3RyLm9wdGlvbnMuZXh0ZW5kZWRUaW1lT3V0ID0gMDtcbiAgICAgIHRvYXN0ci5vcHRpb25zLnRpbWVPdXQgPSAwO1xuICAgICAgdG9hc3RyLm9wdGlvbnMuY2xvc2VCdXR0b24gPSB0cnVlO1xuICAgICAgdmFyICR0b2FzdCA9IHRvYXN0ci53YXJuaW5nKCc8cD5BcmUgeW91IHN1cmU/PC9wPjxkaXYgY2xhc3M9XCJ0b2FzdHItYnRuc1wiPjxidXR0b24gaWQ9XCJ5ZXNEZWxldGVcIiBjbGFzcz1cIm1kbC1idXR0b24gbWRsLWpzLWJ1dHRvbiBcIj5ZZXM8L2J1dHRvbj48YnV0dG9uIGlkPVwibm9EZWxldGVcIiBjbGFzcz1cIm1kbC1idXR0b24gbWRsLWpzLWJ1dHRvblwiPk5vPC9idXR0b24+PC9kaXY+Jyk7XG4gICAgICAkdG9hc3Qub24oJ2NsaWNrJywgJyN5ZXNEZWxldGUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGdpZDtcbiAgICAgICAgY29uc29sZS5sb2coc2VsZWN0LmdldEZlYXR1cmVzKCkpO1xuICAgICAgICBnaWQgPSBzZWxlY3QuZ2V0RmVhdHVyZXMoKS5pdGVtKDApLmdldCgnZ2lkJyk7XG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgdXJsOiAnaHR0cDovLzEyNy4wLjAuMTozMDAwL2RiL2RlbGV0ZScsXG4gICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgIGRhdGFUeXBlOiAndGV4dCcsXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgZ2lkOiBnaWRcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgICAgLmRvbmUoZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywganFYSFIpIHtcblxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coanFYSFIuc3RhdHVzKTtcbiAgICAgICAgICAgIHRvYXN0ci5vcHRpb25zID0ge1xuICAgICAgICAgICAgICAncG9zaXRpb25DbGFzcyc6ICd0b2FzdC1ib3R0b20tZnVsbC13aWR0aCcsXG4gICAgICAgICAgICAgICdwcmV2ZW50RHVwbGljYXRlcyc6IHRydWUsXG4gICAgICAgICAgICAgICd0aW1lT3V0JzogNjBcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygnUHJvcGVydHkgRGVsZXRlZCBGcm9tIERhdGFiYXNlJyk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZmFpbChmdW5jdGlvbihqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcbiAgICAgICAgICAgIHRvYXN0ci5vcHRpb25zID0ge1xuICAgICAgICAgICAgICAncG9zaXRpb25DbGFzcyc6ICd0b2FzdC1ib3R0b20tZnVsbC13aWR0aCcsXG4gICAgICAgICAgICAgICdwcmV2ZW50RHVwbGljYXRlcyc6IHRydWUsXG4gICAgICAgICAgICAgICd0aW1lT3V0JzogNjBcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygnT29wcyBTb21ldGhpbmcgV2VudCBXcm9uZyEhIScpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmFsd2F5cyhmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHByb3BlcnR5U291cmNlLmNsZWFyKCk7XG4gICAgICAgICAgICBzZWxlY3QuZ2V0RmVhdHVyZXMoKS5jbGVhcigpO1xuICAgICAgICAgICAgc2VsZWN0LnNldEFjdGl2ZShmYWxzZSk7XG4gICAgICAgICAgICBtYXAub24oJ2NsaWNrJywgY2xpY2tJbmZvKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAkdG9hc3QucmVtb3ZlKCk7XG4gICAgICB9KTtcbiAgICAgICR0b2FzdC5vbignY2xpY2snLCAnI25vRGVsZXRlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICR0b2FzdC5yZW1vdmUoKTtcbiAgICAgICAgc2VsZWN0LmdldEZlYXR1cmVzKCkuY2xlYXIoKTtcbiAgICAgICAgc2VsZWN0LnNldEFjdGl2ZShmYWxzZSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xufSk7XG4kKCcjbG9nb3V0JykuY2xpY2soZnVuY3Rpb24oKSB7XG4gIGxvY2F0aW9uLmhyZWYgPSAnL21hcC9sb2dvdXQnO1xufSk7XG4vLz09PT09PSB1cGRhdGUgPT09PT09XG5cbiQoJyN1cGRhdGVQcm9wZXJ0eScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIG1hcC51bignY2xpY2snLCBjbGlja0luZm8pO1xuICBkcmF3LnNldEFjdGl2ZShmYWxzZSk7XG4gIHNlbGVjdC5zZXRBY3RpdmUodHJ1ZSk7XG4gIHRyYW5zbGF0ZS5zZXRBY3RpdmUodHJ1ZSk7XG4gIHZhciBnaWQ7XG4gICQoJy5wcm9wZXJ0eS1pbmZvJykuYWRkQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7XG4gIHZhciBvYmo7XG4gIHNlbGVjdC5vbignc2VsZWN0JywgZnVuY3Rpb24oZSkge1xuICAgIGlmIChzZWxlY3QuZ2V0RmVhdHVyZXMoKS5nZXRMZW5ndGgoKSA9PT0gMSkge1xuICAgICAgZ2lkID0gc2VsZWN0LmdldEZlYXR1cmVzKCkuaXRlbSgwKS5nZXQoJ2dpZCcpO1xuICAgICAgJC5hamF4KHtcbiAgICAgICAgdXJsOiAnaHR0cDovLzEyNy4wLjAuMTozMDAwL2RiL2ZldGNoJyxcbiAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgZ2lkOiBnaWRcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgICAgLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgIG9iaiA9IF8uaGVhZChkYXRhLmZlYXR1cmVzKS5wcm9wZXJ0aWVzO1xuXG5cbiAgICAgICAgfSlcbiAgICAgICAgLmZhaWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdG9hc3RyLmVycm9yKCdPb3BzIFNvbWV0aGluZyBXZW50IFdyb25nISEhJyk7XG4gICAgICAgIH0pXG4gICAgICAgIC5hbHdheXMoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ2NvbXBsZXRlJyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG4gIH0pO1xuICB0cmFuc2xhdGUub24oJ3RyYW5zbGF0ZWVuZCcsIGZ1bmN0aW9uKGUpIHtcbiAgICB2YXIgY29vcmRzID0gb2wucHJvai50cmFuc2Zvcm0oZS5jb29yZGluYXRlLCAnRVBTRzozODU3JywgJ0VQU0c6NDMyNicpO1xuICAgIGNvbnNvbGUubG9nKGNvb3Jkcyk7XG4gICAgJCgnLm1vZGFsLWRpYWxvZycpLnJlbW92ZUNsYXNzKCd2aXN1YWxseWhpZGRlbicpO1xuICAgIGR1c3QucmVuZGVyKCdwcm9wZXJ0eVVwZGF0ZScsIG9iaiwgZnVuY3Rpb24oZXJyLCBvdXQpIHtcblxuICAgICAgJCgnLm1vZGFsLWNvbnRlbnQnKS5odG1sKG91dCk7XG4gICAgICBjb21wb25lbnRIYW5kbGVyLnVwZ3JhZGVEb20oKTtcbiAgICAgIGhhbmRsZUZvcm0uc2V0KHtcbiAgICAgICAgbmFtZTogJ3VwZGF0ZVByb3BlcnR5JyxcbiAgICAgICAgc3VibWl0QnRuSWQ6ICd1cGRhdGUnXG4gICAgICB9KTtcbiAgICAgICQoJyN1cGRhdGUnKS5vbignY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB2YXIgZGF0YSA9IGhhbmRsZUZvcm0uZ2V0KCk7XG4gICAgICAgIGlmICghXy5pc05pbChkYXRhKSkge1xuICAgICAgICAgIGRhdGEueCA9IGNvb3Jkc1swXTtcbiAgICAgICAgICBkYXRhLnkgPSBjb29yZHNbMV07XG4gICAgICAgICAgZGF0YS5naWQgPSBnaWQ7XG5cbiAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgdXJsOiAnaHR0cDovLzEyNy4wLjAuMTozMDAwL2RiL3VwZGF0ZScsXG4gICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgICAgfSlcbiAgICAgICAgICAgIC5kb25lKGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIGpxWEhSKSB7XG4gICAgICAgICAgICAgIHRvYXN0ci5vcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICdwb3NpdGlvbkNsYXNzJzogJ3RvYXN0LWJvdHRvbS1mdWxsLXdpZHRoJyxcbiAgICAgICAgICAgICAgICAncHJldmVudER1cGxpY2F0ZXMnOiB0cnVlLFxuICAgICAgICAgICAgICAgICd0aW1lT3V0JzogNjBcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgaWYgKGpxWEhSLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoJ1Byb3BlcnR5IFVwZGF0ZWQgSW4gRGF0YWJhc2UnKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoJ09vcHMgU29tZXRoaW5nIFdlbnQgV3JvbmchISEnKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5mYWlsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoJ09vcHMgU29tZXRoaW5nIFdlbnQgV3JvbmchISEnKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYWx3YXlzKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBwcm9wZXJ0eVNvdXJjZS5jbGVhcigpO1xuICAgICAgICAgICAgICBzZWxlY3QuZ2V0RmVhdHVyZXMoKS5jbGVhcigpO1xuICAgICAgICAgICAgICBzZWxlY3Quc2V0QWN0aXZlKGZhbHNlKTtcbiAgICAgICAgICAgICAgdHJhbnNsYXRlLnNldEFjdGl2ZShmYWxzZSk7XG4gICAgICAgICAgICAgIG1hcC5vbignY2xpY2snLCBjbGlja0luZm8pO1xuICAgICAgICAgICAgICAkKCcubW9kYWwtZGlhbG9nJykuYWRkQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICAkKCcjY2FuY2VsVXBkYXRlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaGFuZGxlRm9ybS5jbGVhcigpO1xuICAgICAgICBwcm9wZXJ0eVNvdXJjZS5jbGVhcigpO1xuICAgICAgICBzZWxlY3QuZ2V0RmVhdHVyZXMoKS5jbGVhcigpO1xuICAgICAgICBzZWxlY3Quc2V0QWN0aXZlKGZhbHNlKTtcbiAgICAgICAgdHJhbnNsYXRlLnNldEFjdGl2ZShmYWxzZSk7XG4gICAgICAgIG1hcC5vbignY2xpY2snLCBjbGlja0luZm8pO1xuICAgICAgICAkKCcubW9kYWwtZGlhbG9nJykuYWRkQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7XG4gICAgICAgIG1hcC5vbignY2xpY2snLCBjbGlja0luZm8pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iLCJ2YXIgaGFuZGxlQ29vcmRzID0gKGZ1bmN0aW9uKG9sKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIGNvb3JkcztcbiAgdmFyIGw7XG5cbiAgZnVuY3Rpb24gZmluZEJ5SWQoaWQpIHtcbiAgICB2YXIgbGF5ZXJzID0gbWFwLmdldExheWVycygpO1xuICAgIHZhciBsZW5ndGggPSBsYXllcnMuZ2V0TGVuZ3RoKCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGlkID09PSBsYXllcnMuaXRlbShpKS5nZXQoJ2lkJykpIHtcbiAgICAgICAgcmV0dXJuIGxheWVycy5pdGVtKGkpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbmRCeU5hbWUobmFtZSkge1xuICAgIHZhciBsYXllcnMgPSBtYXAuZ2V0TGF5ZXJzKCk7XG4gICAgdmFyIGxlbmd0aCA9IGxheWVycy5nZXRMZW5ndGgoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAobmFtZSA9PT0gbGF5ZXJzLml0ZW0oaSkuZ2V0KCduYW1lRW4nKSB8fCBuYW1lID09PSBsYXllcnMuaXRlbShpKS5nZXQoJ25hbWVFbCcpKSB7XG4gICAgICAgIHJldHVybiBsYXllcnMuaXRlbShpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiBzZXRMYXllcihpZCkge1xuICAgIGwgPSBmaW5kQnlJZChpZCk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRDb29yZHMoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgdmFyIGNvb3JkRVBTRzM4NTc7XHJcbiAgICBjb29yZEVQU0czODU3ID0gbC5nZXRTb3VyY2UoKS5nZXRGZWF0dXJlcygpWzBdLmdldEdlb21ldHJ5KCkuZ2V0Q29vcmRpbmF0ZXMoKTtcclxuICAgIGNvb3JkcyA9IG9sLnByb2oudHJhbnNmb3JtKGNvb3JkRVBTRzM4NTcsICdFUFNHOjM4NTcnLCAnRVBTRzo0MzI2Jyk7XHJcbiAgICByZXR1cm4gY29vcmRzO1xuICB9XG4gIHJldHVybiB7XG4gICAgY29vcmRzOiBnZXRDb29yZHMsXG4gICAgc2V0TGF5ZXI6IHNldExheWVyXG4gIH07XG59KG9sKSk7XG4iLCJ2YXIgaGFuZGxlRm9ybSA9IChmdW5jdGlvbigkLCBwYXJzbGV5KSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG4gIHZhciBmb3JtTmFtZSwgc3VibWl0QnRuSWQsIHA7XHJcblxyXG4gIGZ1bmN0aW9uIHNldE9wdGlvbnMob3B0aW9ucykge1xyXG4gICAgZm9ybU5hbWUgPSBvcHRpb25zLm5hbWU7XHJcbiAgICBzdWJtaXRCdG5JZCA9IG9wdGlvbnMuc3VibWl0QnRuSWQ7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBkaXNhYmxlU3VibWl0QnRuKCkge1xyXG4gICAgJCgnIycgKyBzdWJtaXRCdG5JZCArICcnKS5wcm9wKCdkaXNhYmxlZCcsIHRydWUpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gY3JlYXRlVmFsaWRhdG9yKCkge1xyXG4gICAgcCA9ICQoJ2Zvcm1bbmFtZT1cIicgKyBmb3JtTmFtZSArICdcIicpLnBhcnNsZXkoKTtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZGVzdHJveVZhbGlkYXRvcigpIHtcclxuICAgIHAuZGVzdHJveSgpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gdmFsaWRhdGVGb3JtKCkge1xyXG4gICAgcmV0dXJuIHAudmFsaWRhdGUoKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIG9uVmFsaWRhdGVGb3JtU3VjY2VzcygpIHtcclxuICAgIHAub24oJ2Zvcm06c3VjY2VzcycsIGZ1bmN0aW9uKCkge30pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZ2V0QXR0cmlidXRlcygpIHtcclxuICAgIHZhciBvYmogPSB7fTtcclxuICAgIGNyZWF0ZVZhbGlkYXRvcigpO1xyXG4gICAgaWYgKHZhbGlkYXRlRm9ybSgpID09PSB0cnVlKSB7XHJcbiAgICAgICQoJ2Zvcm1bbmFtZT1cIicgKyBmb3JtTmFtZSArICdcIicpLmZpbmQoJy5tZGwtdGV4dGZpZWxkX19pbnB1dCcpLmVhY2goZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHtcclxuICAgICAgICBvYmpbJCh0aGlzKS5hdHRyKCdpZCcpXSA9ICQodGhpcykudmFsKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICAkKCdmb3JtW25hbWU9XCInICsgZm9ybU5hbWUgKyAnXCInKS5maW5kKCcubWRsLWNoZWNrYm94X19pbnB1dCcpLmVhY2goZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHtcclxuICAgICAgICBvYmpbJCh0aGlzKS5hdHRyKCdpZCcpXSA9ICQodGhpcykucHJvcCgnY2hlY2tlZCcpO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIG9iajtcclxuICAgIH1cclxuICAgIGVsc2UgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiByZXNldEZvcm0oKSB7XHJcbiAgICBpZiAoY3JlYXRlVmFsaWRhdG9yKCkgPT0gdHJ1ZSkge1xyXG4gICAgICBkZXN0cm95VmFsaWRhdG9yKCk7XHJcbiAgICB9XHJcbiAgICAkKCdmb3JtW25hbWU9XCInICsgZm9ybU5hbWUgKyAnXCInKS5maW5kKCcubWRsLXRleHRmaWVsZF9faW5wdXQnKS5lYWNoKGZ1bmN0aW9uKGluZGV4LCBlbGVtZW50KSB7XHJcbiAgICAgICQodGhpcykudmFsKCcnKTtcclxuICAgICAgJCh0aGlzKS5wYXJlbnQoKS5lcSgwKS5yZW1vdmVDbGFzcygnaXMtZGlydHknKTtcclxuICAgICAgJCh0aGlzKS5wYXJlbnQoKS5lcSgwKS5yZW1vdmVDbGFzcygnaXMtaW52YWxpZCcpO1xyXG4gICAgfSk7XHJcbiAgICAkKCdmb3JtW25hbWU9XCInICsgZm9ybU5hbWUgKyAnXCInKS5maW5kKCcubWRsLWNoZWNrYm94X19pbnB1dCcpLmVhY2goZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHtcclxuICAgICAgJCh0aGlzKS5wcm9wKCdjaGVja2VkJywgZmFsc2UpO1xyXG4gICAgfSk7XHJcbiAgICAkKCdmb3JtW25hbWU9XCInICsgZm9ybU5hbWUgKyAnXCInKS5maW5kKCcubWRsLWNoZWNrYm94JykuZWFjaChmdW5jdGlvbihpbmRleCwgZWxlbWVudCkge1xyXG4gICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdpcy1jaGVja2VkJyk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgcmV0dXJuIHtcclxuICAgIHNldDogc2V0T3B0aW9ucyxcclxuICAgIGdldDogZ2V0QXR0cmlidXRlcyxcclxuICAgIGNsZWFyOiByZXNldEZvcm1cclxuICAvLyBjcmVhdGVWYWxpZGF0b3I6IGNyZWF0ZVZhbGlkYXRvcixcclxuICAvLyBkZXN0cm95VmFsaWRhdG9yOiBkZXN0cm95VmFsaWRhdG9yLFxyXG4gIC8vIHZhbGlkYXRlRm9ybTogdmFsaWRhdGVGb3JtLFxyXG4gIC8vIG9uVmFsaWRhdGVGb3JtU3VjY2Vzczogb25WYWxpZGF0ZUZvcm1TdWNjZXNzLFxyXG4gIC8vIGRpc2FibGVTdWJtaXRCdG46IGRpc2FibGVTdWJtaXRCdG5cclxuICB9O1xyXG59KGpRdWVyeSwgcGFyc2xleSkpO1xyXG5cclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
