function PropertyStyle(){var e;return e="../images/map-icons/pins/48/pin1.png",new ol.style.Style({image:new ol.style.Icon({src:e,anchor:[.5,1],scale:.7})})}function clickInfo(e){e.preventDefault();var t={},o=map.forEachFeatureAtPixel(e.pixel,function(e,t){return{feature:e,layer:t}},this,function(e){return"property"===e.get("id")?!0:void 0},this);console.log(o),o?(t.feature={},o.feature.getKeys().forEach(function(e){t.feature[e]=o.feature.get(e)}),console.log(t),dust.render("adminEstateInfo.dust",t,function(e,t){console.log(t),$(".property-info").html(t),$(".property-info").removeClass("visuallyhidden")})):$(".property-info").addClass("visuallyhidden")}var center=[3677385,4120949],extent=[3590094,4102833,3855483,4261211],lang=document.documentElement.lang,geoJSONFormat=new ol.format.GeoJSON({defaultDataProjection:"EPSG:4326"}),bing=new ol.layer.Tile({visible:!0,source:new ol.source.BingMaps({key:"Ak2Gq8VUfICsPpuf7LRANXmXt2sHWmSLPhohmVLFtFIEwYjs_5MCyAhAFwRSVpLj",imagerySet:"Aerial"}),maxZoom:19,crossOrigin:"anonymous",preload:1/0,id:"bing"}),mapbox=new ol.layer.Tile({source:new ol.source.XYZ({attributions:[new ol.Attribution({html:'<a href="https://www.mapbox.com/about/maps/" target="_blank">&copy; Mapbox &copy; OpenStreetMap</a>'})],url:"https://api.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZmlydmFpbiIsImEiOiJlOWYyYTM0NThiNWM0YjJjODJjNDE4ODQzNzA2MGQyNiJ9.-NVDO27Hzt-w_nQosUPfLA"}),id:"mapbox"}),propertySource=new ol.source.Vector({format:geoJSONFormat,loader:function(e,t,o){var r="http://127.0.0.1:3000/db/admin",n=this;n.clear(),$.ajax({url:r,type:"POST",beforeSend:function(e){localStorage.getItem("userToken")&&e.setRequestHeader("Authorization","Bearer "+localStorage.getItem("userToken"))},dataType:"json",data:{id:id}}).done(function(e){var t=geoJSONFormat.readFeatures(e,{featureProjection:"EPSG:3857"});n.addFeatures(t)}).fail(function(){console.log("error")})},strategy:ol.loadingstrategy.all}),property=new ol.layer.Vector({source:propertySource,id:"property",visible:!0,style:PropertyStyle()});property.setZIndex(2);var map=new ol.Map({target:"adminMap",layers:[mapbox,property],loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0,renderer:"canvas",controls:ol.control.defaults({attributionOptions:{collapsible:!1,collapsed:!1}}).extend([new ol.control.ScaleLine({units:"metric"}),new ol.control.OverviewMap({className:"ol-overviewmap ol-custom-overviewmap",collapsible:!0,collapsed:!0,layers:[bing]}),new ol.control.ZoomToExtent({extent:extent})]),view:new ol.View({center:center,projection:"EPSG:3857",zoom:14,maxZoom:19,minZoom:10})});"el"===lang?(bing.set("name","Δορυφορική εικόνα"),mapbox.set("name","Χάρτης"),property.set("name","Ακίνητα")):(bing.set("name","Sattelite Image"),mapbox.set("name","Map"),property.set("name","Properties"));var features=new ol.Collection,drawnProperties=new ol.layer.Vector({source:new ol.source.Vector,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})}),id:"drawnProperties"});map.addLayer(drawnProperties);var draw=new ol.interaction.Draw({source:drawnProperties.getSource(),type:"Point",style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})});map.addInteraction(draw),draw.setActive(!1);var select=new ol.interaction.Select({layers:[property],features:features,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 0, 0, 0.2)"}),stroke:new ol.style.Stroke({color:"#FF00003",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#FF0000"})})})});map.addInteraction(select),select.setActive(!1);var translate=new ol.interaction.Translate({features:select.getFeatures()});map.on("click",clickInfo),$("#insertProperty").click(function(){$(".property-info").addClass("visuallyhidden"),toastr.options={positionClass:"toast-top-center",preventDuplicates:!0,timeOut:20},toastr.info("Add New Property"),map.un("click",clickInfo),select.setActive(!1),draw.setActive(!0),draw.on("drawend",function(e){e.preventDefault(),draw.setActive(!1);var t={};$(".modal-dialog").removeClass("visuallyhidden"),dust.render("estateInsert.dust",t,function(e,t){$(".modal-content").html(t),componentHandler.upgradeDom(),$("#cancelInsert").on("click",function(e){e.preventDefault(),handleForm.clear(),$(".modal-dialog").addClass("visuallyhidden")}),$("#insert").on("click",function(e){e.preventDefault();var t,o;handleForm.set("insertProperty"),t=handleForm.get(),handleCoords.setLayer("drawnProperties"),o=handleCoords.coords(),t.x=o[0],t.y=o[1],t.adminId=id,$.ajax({url:"http://127.0.0.1:3000/db/insert",type:"POST",data:t}).done(function(e,t,o){toastr.options={positionClass:"toast-bottom-full-width",preventDuplicates:!0,timeOut:30},201===o.status?toastr.success("Estate Recorded In Database"):toastr.error("Ops Something went wrong!!!")}).fail(function(e,t,o){console.log("error")}).always(function(){e.preventDefault(),console.log("complete"),drawnProperties.getSource().clear(),propertySource.clear(),handleForm.clear(),$(".modal-dialog").addClass("visuallyhidden")})})})})}),$("#deleteProperty").click(function(e){e.preventDefault(),$(".property-info").addClass("visuallyhidden"),toastr.options={positionClass:"toast-top-center",preventDuplicates:!0,timeOut:20},toastr.info("Delete Property"),map.un("click",clickInfo),draw.setActive(!1),features.clear(),select.setActive(!0),select.on("select",function(e){if(1===e.target.getFeatures().getLength()){toastr.options.newestOnTop=!0,toastr.options.preventDuplicates=!0,toastr.options.extendedTimeOut=0,toastr.options.timeOut=0,toastr.options.closeButton=!0;var t=toastr.warning('<p>Are you sure?</p><div class="toastr-btns"><button id="yesDelete" class="mdl-button mdl-js-button ">Yes</button><button id="noDelete" class="mdl-button mdl-js-button">No</button></div>');t.find("#yesDelete").length&&t.on("click","#yesDelete",function(){alert("you clicked ok"),t.remove()}),t.find("#noDelete").length&&t.on("click","#noDelete",function(){alert("Surprise! you clicked me.")})}})}),$("#logout").click(function(){location.href="/map/logout"});var handleCoords=function(e){"use strict";function t(e){for(var t=map.getLayers(),o=t.getLength(),r=0;o>r;r++)if(e===t.item(r).get("id"))return t.item(r);return null}function o(e){l=t(e)}function r(){var t;return t=l.getSource().getFeatures()[0].getGeometry().getCoordinates(),n=e.proj.transform(t,"EPSG:3857","EPSG:4326")}var n,l;return{coords:r,setLayer:o}}(ol),handleForm=function(e){"use strict";function t(e){n=e}function o(){var t={};return e('form[name="'+n+'"').find(".mdl-textfield__input").each(function(o,r){t[e(this).attr("id")]=e(this).val()}),e('form[name="'+n+'"').find(".mdl-checkbox__input").each(function(o,r){t[e(this).attr("id")]=e(this).prop("checked")}),t}function r(){e('form[name="'+n+'"').find(".mdl-textfield__input").each(function(t,o){e(this).val(""),e(this).parent().eq(0).removeClass("is-dirty"),e(this).parent().eq(0).removeClass("is-invalid")}),e('form[name="'+n+'"').find(".mdl-checkbox__input").each(function(t,o){e(this).prop("checked",!1)}),e('form[name="'+n+'"').find(".mdl-checkbox").each(function(t,o){e(this).removeClass("is-checked")})}var n;return{set:t,get:o,clear:r}}(jQuery);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkbWluLmpzIiwiaGFuZGxlQ29vcmRzLmpzIiwiaGFuZGxlRm9ybS5qcyJdLCJuYW1lcyI6WyJQcm9wZXJ0eVN0eWxlIiwic3JjIiwib2wiLCJzdHlsZSIsIlN0eWxlIiwiaW1hZ2UiLCJJY29uIiwiYW5jaG9yIiwic2NhbGUiLCJjbGlja0luZm8iLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsIm9iaiIsImNsaWNrZWRGZWF0dXJlIiwibWFwIiwiZm9yRWFjaEZlYXR1cmVBdFBpeGVsIiwicGl4ZWwiLCJmZWF0dXJlIiwibGF5ZXIiLCJ0aGlzIiwiZ2V0IiwiY29uc29sZSIsImxvZyIsImdldEtleXMiLCJmb3JFYWNoIiwia2V5IiwiZHVzdCIsInJlbmRlciIsImVyciIsIm91dCIsIiQiLCJodG1sIiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsImNlbnRlciIsImV4dGVudCIsImxhbmciLCJkb2N1bWVudCIsImRvY3VtZW50RWxlbWVudCIsImdlb0pTT05Gb3JtYXQiLCJmb3JtYXQiLCJHZW9KU09OIiwiZGVmYXVsdERhdGFQcm9qZWN0aW9uIiwiYmluZyIsIlRpbGUiLCJ2aXNpYmxlIiwic291cmNlIiwiQmluZ01hcHMiLCJpbWFnZXJ5U2V0IiwibWF4Wm9vbSIsImNyb3NzT3JpZ2luIiwicHJlbG9hZCIsIkluZmluaXR5IiwiaWQiLCJtYXBib3giLCJYWVoiLCJhdHRyaWJ1dGlvbnMiLCJBdHRyaWJ1dGlvbiIsInVybCIsInByb3BlcnR5U291cmNlIiwiVmVjdG9yIiwibG9hZGVyIiwicmVzb2x1dGlvbiIsInByb2plY3Rpb24iLCJzZWxmIiwiY2xlYXIiLCJhamF4IiwidHlwZSIsImJlZm9yZVNlbmQiLCJ4aHIiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwic2V0UmVxdWVzdEhlYWRlciIsImRhdGFUeXBlIiwiZGF0YSIsImRvbmUiLCJyZXNwb25zZSIsImZlYXR1cmVzIiwicmVhZEZlYXR1cmVzIiwiZmVhdHVyZVByb2plY3Rpb24iLCJhZGRGZWF0dXJlcyIsImZhaWwiLCJzdHJhdGVneSIsImxvYWRpbmdzdHJhdGVneSIsImFsbCIsInByb3BlcnR5Iiwic2V0WkluZGV4IiwiTWFwIiwidGFyZ2V0IiwibGF5ZXJzIiwibG9hZFRpbGVzV2hpbGVBbmltYXRpbmciLCJsb2FkVGlsZXNXaGlsZUludGVyYWN0aW5nIiwicmVuZGVyZXIiLCJjb250cm9scyIsImNvbnRyb2wiLCJkZWZhdWx0cyIsImF0dHJpYnV0aW9uT3B0aW9ucyIsImNvbGxhcHNpYmxlIiwiY29sbGFwc2VkIiwiZXh0ZW5kIiwiU2NhbGVMaW5lIiwidW5pdHMiLCJPdmVydmlld01hcCIsImNsYXNzTmFtZSIsIlpvb21Ub0V4dGVudCIsInZpZXciLCJWaWV3Iiwiem9vbSIsIm1pblpvb20iLCJzZXQiLCJDb2xsZWN0aW9uIiwiZHJhd25Qcm9wZXJ0aWVzIiwiZmlsbCIsIkZpbGwiLCJjb2xvciIsInN0cm9rZSIsIlN0cm9rZSIsIndpZHRoIiwiQ2lyY2xlIiwicmFkaXVzIiwiYWRkTGF5ZXIiLCJkcmF3IiwiaW50ZXJhY3Rpb24iLCJEcmF3IiwiZ2V0U291cmNlIiwiYWRkSW50ZXJhY3Rpb24iLCJzZXRBY3RpdmUiLCJzZWxlY3QiLCJTZWxlY3QiLCJ0cmFuc2xhdGUiLCJUcmFuc2xhdGUiLCJnZXRGZWF0dXJlcyIsIm9uIiwiY2xpY2siLCJ0b2FzdHIiLCJvcHRpb25zIiwicG9zaXRpb25DbGFzcyIsInByZXZlbnREdXBsaWNhdGVzIiwidGltZU91dCIsImluZm8iLCJ1biIsImNvbXBvbmVudEhhbmRsZXIiLCJ1cGdyYWRlRG9tIiwiZXZlbnQiLCJoYW5kbGVGb3JtIiwiYyIsImhhbmRsZUNvb3JkcyIsInNldExheWVyIiwiY29vcmRzIiwieCIsInkiLCJhZG1pbklkIiwidGV4dFN0YXR1cyIsImpxWEhSIiwic3RhdHVzIiwic3VjY2VzcyIsImVycm9yIiwiZXJyb3JUaHJvd24iLCJhbHdheXMiLCJlIiwiZ2V0TGVuZ3RoIiwibmV3ZXN0T25Ub3AiLCJleHRlbmRlZFRpbWVPdXQiLCJjbG9zZUJ1dHRvbiIsIiR0b2FzdCIsIndhcm5pbmciLCJmaW5kIiwibGVuZ3RoIiwiYWxlcnQiLCJyZW1vdmUiLCJsb2NhdGlvbiIsImhyZWYiLCJmaW5kQnlJZCIsImdldExheWVycyIsImkiLCJpdGVtIiwibCIsImdldENvb3JkcyIsImNvb3JkRVBTRzM4NTciLCJnZXRHZW9tZXRyeSIsImdldENvb3JkaW5hdGVzIiwicHJvaiIsInRyYW5zZm9ybSIsInNldE5hbWUiLCJuYW1lIiwiZm9ybU5hbWUiLCJnZXRBdHRyaWJ1dGVzIiwiZWFjaCIsImluZGV4IiwiZWxlbWVudCIsImF0dHIiLCJ2YWwiLCJwcm9wIiwicmVzZXRGb3JtIiwicGFyZW50IiwiZXEiLCJqUXVlcnkiXSwibWFwcGluZ3MiOiJBQStCQSxRQUFBQSxpQkFDQSxHQUFBQyxFQUVBLE9BREFBLEdBQUEsdUNBQ0EsR0FBQUMsSUFBQUMsTUFBQUMsT0FDQUMsTUFBQSxHQUFBSCxJQUFBQyxNQUFBRyxNQUNBTCxJQUFBQSxFQUNBTSxRQUNBLEdBQUEsR0FFQUMsTUFBQSxPQStKQSxRQUFBQyxXQUFBQyxHQUNBQSxFQUFBQyxnQkFDQSxJQUFBQyxNQUNBQyxFQUFBQyxJQUFBQyxzQkFBQUwsRUFBQU0sTUFBQSxTQUFBQyxFQUFBQyxHQUNBLE9BQ0FELFFBQUFBLEVBQ0FDLE1BQUFBLElBRUFDLEtBQUEsU0FBQUQsR0FDQSxNQUFBLGFBQUFBLEVBQUFFLElBQUEsT0FDQSxFQURBLFFBR0FELEtBQ0FFLFNBQUFDLElBQUFULEdBQ0FBLEdBQ0FELEVBQUFLLFdBQ0FKLEVBQUFJLFFBQUFNLFVBQUFDLFFBQUEsU0FBQUMsR0FDQWIsRUFBQUssUUFBQVEsR0FBQVosRUFBQUksUUFBQUcsSUFBQUssS0FFQUosUUFBQUMsSUFBQVYsR0FDQWMsS0FBQUMsT0FBQSx1QkFBQWYsRUFBQSxTQUFBZ0IsRUFBQUMsR0FDQVIsUUFBQUMsSUFBQU8sR0FDQUMsRUFBQSxrQkFBQUMsS0FBQUYsR0FDQUMsRUFBQSxrQkFBQUUsWUFBQSxxQkFHQUYsRUFBQSxrQkFB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LENBbUNBLFFBQ0E1QixPQUFBNkIsRUFDQTlCLFNBQUFBLElBRUFqSixJQzFDQThJLFdBQUEsU0FBQWxILEdBQ0EsWUFHQSxTQUFBeUosR0FBQUMsR0FDQUMsRUFBQUQsRUFHQSxRQUFBRSxLQUNBLEdBQUE5SyxLQU9BLE9BTkFrQixHQUFBLGNBQUEySixFQUFBLEtBQUFuQixLQUFBLHlCQUFBcUIsS0FBQSxTQUFBQyxFQUFBQyxHQUNBakwsRUFBQWtCLEVBQUFYLE1BQUEySyxLQUFBLE9BQUFoSyxFQUFBWCxNQUFBNEssUUFFQWpLLEVBQUEsY0FBQTJKLEVBQUEsS0FBQW5CLEtBQUEsd0JBQUFxQixLQUFBLFNBQUFDLEVBQUFDLEdBQ0FqTCxFQUFBa0IsRUFBQVgsTUFBQTJLLEtBQUEsT0FBQWhLLEVBQUFYLE1BQUE2SyxLQUFBLGFBRUFwTCxFQUdBLFFBQUFxTCxLQUNBbkssRUFBQSxjQUFBMkosRUFBQSxLQUFBbkIsS0FBQSx5QkFBQXFCLEtBQUEsU0FBQUMsRUFBQUMsR0FDQS9KLEVBQUFYLE1BQUE0SyxJQUFBLElBQ0FqSyxFQUFBWCxNQUFBK0ssU0FBQUMsR0FBQSxHQUFBbkssWUFBQSxZQUNBRixFQUFBWCxNQUFBK0ssU0FBQUMsR0FBQSxHQUFBbkssWUFBQSxnQkFFQUYsRUFBQSxjQUFBMkosRUFBQSxLQUFBbkIsS0FBQSx3QkFBQXFCLEtBQUEsU0FBQUMsRUFBQUMsR0FDQS9KLEVBQUFYLE1BQUE2SyxLQUFBLFdBQUEsS0FFQWxLLEVBQUEsY0FBQTJKLEVBQUEsS0FBQW5CLEtBQUEsaUJBQUFxQixLQUFBLFNBQUFDLEVBQUFDLEdBQ0EvSixFQUFBWCxNQUFBYSxZQUFBLGdCQTNCQSxHQUFBeUosRUE4QkEsUUFDQTVFLElBQUEwRSxFQUNBbkssSUFBQXNLLEVBQ0F6SCxNQUFBZ0ksSUFFQUciLCJmaWxlIjoiYWRtaW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGNlbnRlciA9IFtcbiAgICAzNjc3Mzg1LCA0MTIwOTQ5XG4gIF0sXG4gIGV4dGVudCA9IFtcbiAgICAzNTkwMDk0LCA0MTAyODMzLCAzODU1NDgzLCA0MjYxMjExXG4gIF0sXG4gIGxhbmcgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZyxcbiAgZ2VvSlNPTkZvcm1hdCA9IG5ldyBvbC5mb3JtYXQuR2VvSlNPTih7XG4gICAgZGVmYXVsdERhdGFQcm9qZWN0aW9uOiAnRVBTRzo0MzI2J1xuICB9KTtcbnZhciBiaW5nID0gbmV3IG9sLmxheWVyLlRpbGUoe1xuICB2aXNpYmxlOiB0cnVlLFxuICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuQmluZ01hcHMoe1xuICAgIGtleTogJ0FrMkdxOFZVZklDc1BwdWY3TFJBTlhtWHQyc0hXbVNMUGhvaG1WTEZ0RklFd1lqc181TUN5QWhBRndSU1ZwTGonLFxuICAgIGltYWdlcnlTZXQ6ICdBZXJpYWwnXG4gIH0pLFxuICBtYXhab29tOiAxOSxcbiAgY3Jvc3NPcmlnaW46ICdhbm9ueW1vdXMnLFxuICBwcmVsb2FkOiBJbmZpbml0eSxcbiAgaWQ6ICdiaW5nJ1xufSk7XG52YXIgbWFwYm94ID0gbmV3IG9sLmxheWVyLlRpbGUoe1xuICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuWFlaKHtcbiAgICBhdHRyaWJ1dGlvbnM6IFtuZXcgb2wuQXR0cmlidXRpb24oe1xuICAgICAgaHRtbDogJzxhIGhyZWY9XCJodHRwczovL3d3dy5tYXBib3guY29tL2Fib3V0L21hcHMvXCIgdGFyZ2V0PVwiX2JsYW5rXCI+JmNvcHk7IE1hcGJveCAmY29weTsgT3BlblN0cmVldE1hcDwvYT4nXG4gICAgfSldLFxuICAgIHVybDogJ2h0dHBzOi8vYXBpLm1hcGJveC5jb20vdjQvbWFwYm94LnN0cmVldHMve3p9L3t4fS97eX0ucG5nP2FjY2Vzc190b2tlbj1way5leUoxSWpvaVptbHlkbUZwYmlJc0ltRWlPaUpsT1dZeVlUTTBOVGhpTldNMFlqSmpPREpqTkRFNE9EUXpOekEyTUdReU5pSjkuLU5WRE8yN0h6dC13X25Rb3NVUGZMQSdcbiAgfSksXG4gIGlkOiAnbWFwYm94J1xufSk7XG5cbmZ1bmN0aW9uIFByb3BlcnR5U3R5bGUoKSB7XG4gIHZhciBzcmM7XG4gIHNyYyA9ICcuLi9pbWFnZXMvbWFwLWljb25zL3BpbnMvNDgvcGluMS5wbmcnO1xuICByZXR1cm4gbmV3IG9sLnN0eWxlLlN0eWxlKHtcbiAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkljb24oKHtcbiAgICAgIHNyYzogc3JjLFxuICAgICAgYW5jaG9yOiBbXG4gICAgICAgIDAuNSwgMVxuICAgICAgXSxcbiAgICAgIHNjYWxlOiAwLjdcbiAgICB9KSlcbiAgfSk7XG59XG52YXIgcHJvcGVydHlTb3VyY2UgPSBuZXcgb2wuc291cmNlLlZlY3Rvcih7XG4gIGZvcm1hdDogZ2VvSlNPTkZvcm1hdCxcbiAgbG9hZGVyOiBmdW5jdGlvbiAoZXh0ZW50LCByZXNvbHV0aW9uLCBwcm9qZWN0aW9uKSB7XG4gICAgdmFyIHVybCA9ICdodHRwOi8vMTI3LjAuMC4xOjMwMDAvZGIvYWRtaW4nO1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBzZWxmLmNsZWFyKCk7XG4gICAgJC5hamF4KHtcbiAgICAgIHVybDogdXJsLFxuICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgJ2JlZm9yZVNlbmQnOiBmdW5jdGlvbiAoeGhyKSB7XG4gICAgICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJykpIHtcbiAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQXV0aG9yaXphdGlvbicsICdCZWFyZXIgJyArIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgZGF0YToge1xuICAgICAgICBpZDogaWRcbiAgICAgIH1cbiAgICB9KS5kb25lKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgdmFyIGZlYXR1cmVzID0gZ2VvSlNPTkZvcm1hdC5yZWFkRmVhdHVyZXMocmVzcG9uc2UsIHtcbiAgICAgICAgZmVhdHVyZVByb2plY3Rpb246ICdFUFNHOjM4NTcnXG4gICAgICB9KTtcbiAgICAgIHNlbGYuYWRkRmVhdHVyZXMoZmVhdHVyZXMpO1xuICAgIH0pLmZhaWwoZnVuY3Rpb24gKCkge1xuICAgICAgY29uc29sZS5sb2coJ2Vycm9yJyk7XG4gICAgfSk7XG4gIH0sXG4gIHN0cmF0ZWd5OiBvbC5sb2FkaW5nc3RyYXRlZ3kuYWxsXG59KTtcbnZhciBwcm9wZXJ0eSA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xuICBzb3VyY2U6IHByb3BlcnR5U291cmNlLFxuICBpZDogJ3Byb3BlcnR5JyxcbiAgdmlzaWJsZTogdHJ1ZSxcbiAgc3R5bGU6IFByb3BlcnR5U3R5bGUoKVxufSk7XG5wcm9wZXJ0eS5zZXRaSW5kZXgoMik7XG52YXIgbWFwID0gbmV3IG9sLk1hcCh7XG4gIHRhcmdldDogJ2FkbWluTWFwJyxcbiAgbGF5ZXJzOiBbXG4gICAgbWFwYm94LCBwcm9wZXJ0eVxuICBdLFxuICBsb2FkVGlsZXNXaGlsZUFuaW1hdGluZzogdHJ1ZSxcbiAgbG9hZFRpbGVzV2hpbGVJbnRlcmFjdGluZzogdHJ1ZSxcbiAgcmVuZGVyZXI6ICdjYW52YXMnLFxuICBjb250cm9sczogb2wuY29udHJvbC5kZWZhdWx0cyh7XG4gICAgYXR0cmlidXRpb25PcHRpb25zOiB7XG4gICAgICBjb2xsYXBzaWJsZTogZmFsc2UsXG4gICAgICBjb2xsYXBzZWQ6IGZhbHNlXG4gICAgfVxuICB9KS5leHRlbmQoW1xuICAgIG5ldyBvbC5jb250cm9sLlNjYWxlTGluZSh7XG4gICAgICB1bml0czogJ21ldHJpYydcbiAgICB9KSxcbiAgICBuZXcgb2wuY29udHJvbC5PdmVydmlld01hcCh7XG4gICAgICBjbGFzc05hbWU6ICdvbC1vdmVydmlld21hcCBvbC1jdXN0b20tb3ZlcnZpZXdtYXAnLFxuICAgICAgY29sbGFwc2libGU6IHRydWUsXG4gICAgICBjb2xsYXBzZWQ6IHRydWUsXG4gICAgICBsYXllcnM6IFtiaW5nXVxuICAgIH0pLFxuICAgIG5ldyBvbC5jb250cm9sLlpvb21Ub0V4dGVudCh7XG4gICAgICBleHRlbnQ6IGV4dGVudFxuICAgIH0pXG4gIF0pLFxuICB2aWV3OiBuZXcgb2wuVmlldyh7XG4gICAgY2VudGVyOiBjZW50ZXIsXG4gICAgLy8gZXh0ZW50OiBleHRlbnQsXG4gICAgcHJvamVjdGlvbjogJ0VQU0c6Mzg1NycsXG4gICAgem9vbTogMTQsXG4gICAgbWF4Wm9vbTogMTksXG4gICAgbWluWm9vbTogMTBcbiAgfSlcbn0pO1xuaWYgKGxhbmcgPT09ICdlbCcpIHtcbiAgYmluZy5zZXQoJ25hbWUnLCAnzpTOv8+Bz4XPhs6/z4HOuc66zq4gzrXOuc66z4zOvc6xJyk7XG4gIG1hcGJveC5zZXQoJ25hbWUnLCAnzqfOrM+Bz4TOt8+CJyk7XG4gIHByb3BlcnR5LnNldCgnbmFtZScsICfOkc66zq/Ovc63z4TOsScpO1xufSBlbHNlIHtcbiAgYmluZy5zZXQoJ25hbWUnLCAnU2F0dGVsaXRlIEltYWdlJyk7XG4gIG1hcGJveC5zZXQoJ25hbWUnLCAnTWFwJyk7XG4gIHByb3BlcnR5LnNldCgnbmFtZScsICdQcm9wZXJ0aWVzJyk7XG59XG4vLz09PT09PSBpbnRlcmFjdGlvbnMgPT09PT09XG52YXIgZmVhdHVyZXMgPSBuZXcgb2wuQ29sbGVjdGlvbigpO1xudmFyIGRyYXduUHJvcGVydGllcyA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xuICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuVmVjdG9yKCksXG4gIHN0eWxlOiBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgIGNvbG9yOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpJ1xuICAgIH0pLFxuICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XG4gICAgICBjb2xvcjogJyNmZmNjMzMnLFxuICAgICAgd2lkdGg6IDJcbiAgICB9KSxcbiAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkNpcmNsZSh7XG4gICAgICByYWRpdXM6IDcsXG4gICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XG4gICAgICAgIGNvbG9yOiAnI2ZmY2MzMydcbiAgICAgIH0pXG4gICAgfSlcbiAgfSksXG4gIGlkOiAnZHJhd25Qcm9wZXJ0aWVzJ1xufSk7XG5tYXAuYWRkTGF5ZXIoZHJhd25Qcm9wZXJ0aWVzKTtcbi8vZHJhd1xudmFyIGRyYXcgPSBuZXcgb2wuaW50ZXJhY3Rpb24uRHJhdyh7XG4gIC8vIGZlYXR1cmVzOiBmZWF0dXJlcyxcbiAgc291cmNlOiBkcmF3blByb3BlcnRpZXMuZ2V0U291cmNlKCksXG4gIHR5cGU6ICdQb2ludCcsXG4gIHN0eWxlOiBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgIGNvbG9yOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpJ1xuICAgIH0pLFxuICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XG4gICAgICBjb2xvcjogJyNmZmNjMzMnLFxuICAgICAgd2lkdGg6IDJcbiAgICB9KSxcbiAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkNpcmNsZSh7XG4gICAgICByYWRpdXM6IDcsXG4gICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XG4gICAgICAgIGNvbG9yOiAnI2ZmY2MzMydcbiAgICAgIH0pXG4gICAgfSlcbiAgfSlcbn0pO1xubWFwLmFkZEludGVyYWN0aW9uKGRyYXcpO1xuZHJhdy5zZXRBY3RpdmUoZmFsc2UpO1xuLy9zZWxlY3RcbnZhciBzZWxlY3QgPSBuZXcgb2wuaW50ZXJhY3Rpb24uU2VsZWN0KHtcbiAgbGF5ZXJzOiBbcHJvcGVydHldLFxuICBmZWF0dXJlczogZmVhdHVyZXMsXG4gIHN0eWxlOiBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgIGNvbG9yOiAncmdiYSgyNTUsIDAsIDAsIDAuMiknXG4gICAgfSksXG4gICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcbiAgICAgIGNvbG9yOiAnI0ZGMDAwMDMnLFxuICAgICAgd2lkdGg6IDJcbiAgICB9KSxcbiAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkNpcmNsZSh7XG4gICAgICByYWRpdXM6IDcsXG4gICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XG4gICAgICAgIGNvbG9yOiAnI0ZGMDAwMCdcbiAgICAgIH0pXG4gICAgfSlcbiAgfSlcbn0pO1xubWFwLmFkZEludGVyYWN0aW9uKHNlbGVjdCk7XG5zZWxlY3Quc2V0QWN0aXZlKGZhbHNlKTtcbi8vdHJhbnNsYXRlKG1vdmUpXG52YXIgdHJhbnNsYXRlID0gbmV3IG9sLmludGVyYWN0aW9uLlRyYW5zbGF0ZSh7XG4gIGZlYXR1cmVzOiBzZWxlY3QuZ2V0RmVhdHVyZXMoKVxufSk7XG4vLz09PT09PSBpbmZvID09PT09PVxubWFwLm9uKCdjbGljaycsIGNsaWNrSW5mbyk7XG5cbmZ1bmN0aW9uIGNsaWNrSW5mbyhldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIHZhciBvYmogPSB7fTtcbiAgdmFyIGNsaWNrZWRGZWF0dXJlID0gbWFwLmZvckVhY2hGZWF0dXJlQXRQaXhlbChldnQucGl4ZWwsIGZ1bmN0aW9uIChmZWF0dXJlLCBsYXllcikge1xuICAgIHJldHVybiB7XG4gICAgICBmZWF0dXJlOiBmZWF0dXJlLFxuICAgICAgbGF5ZXI6IGxheWVyXG4gICAgfTtcbiAgfSwgdGhpcywgZnVuY3Rpb24gKGxheWVyKSB7XG4gICAgaWYgKGxheWVyLmdldCgnaWQnKSA9PT0gJ3Byb3BlcnR5Jykge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9LCB0aGlzKTtcbiAgY29uc29sZS5sb2coY2xpY2tlZEZlYXR1cmUpO1xuICBpZiAoY2xpY2tlZEZlYXR1cmUpIHtcbiAgICBvYmouZmVhdHVyZSA9IHt9O1xuICAgIGNsaWNrZWRGZWF0dXJlLmZlYXR1cmUuZ2V0S2V5cygpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgb2JqLmZlYXR1cmVba2V5XSA9IGNsaWNrZWRGZWF0dXJlLmZlYXR1cmUuZ2V0KGtleSk7XG4gICAgfSk7XG4gICAgY29uc29sZS5sb2cob2JqKTtcbiAgICBkdXN0LnJlbmRlcignYWRtaW5Fc3RhdGVJbmZvLmR1c3QnLCBvYmosIGZ1bmN0aW9uIChlcnIsIG91dCkge1xuICAgICAgY29uc29sZS5sb2cob3V0KTtcbiAgICAgICQoJy5wcm9wZXJ0eS1pbmZvJykuaHRtbChvdXQpO1xuICAgICAgJCgnLnByb3BlcnR5LWluZm8nKS5yZW1vdmVDbGFzcygndmlzdWFsbHloaWRkZW4nKTtcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICAkKCcucHJvcGVydHktaW5mbycpLmFkZENsYXNzKCd2aXN1YWxseWhpZGRlbicpO1xuICB9XG59XG4vLz09PT09PSBpbnNlcnQgPT09PT09XG4kKCcjaW5zZXJ0UHJvcGVydHknKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICQoJy5wcm9wZXJ0eS1pbmZvJykuYWRkQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7XG4gIHRvYXN0ci5vcHRpb25zID0ge1xuICAgICdwb3NpdGlvbkNsYXNzJzogJ3RvYXN0LXRvcC1jZW50ZXInLFxuICAgICdwcmV2ZW50RHVwbGljYXRlcyc6IHRydWUsXG4gICAgJ3RpbWVPdXQnOiAyMFxuICB9O1xuICB0b2FzdHIuaW5mbygnQWRkIE5ldyBQcm9wZXJ0eScpO1xuICBtYXAudW4oJ2NsaWNrJywgY2xpY2tJbmZvKTtcbiAgc2VsZWN0LnNldEFjdGl2ZShmYWxzZSk7XG4gIGRyYXcuc2V0QWN0aXZlKHRydWUpO1xuICBkcmF3Lm9uKCdkcmF3ZW5kJywgZnVuY3Rpb24gKGV2dCkge1xuICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGRyYXcuc2V0QWN0aXZlKGZhbHNlKTtcbiAgICB2YXIgb2JqID0ge307XG4gICAgJCgnLm1vZGFsLWRpYWxvZycpLnJlbW92ZUNsYXNzKCd2aXN1YWxseWhpZGRlbicpO1xuICAgIGR1c3QucmVuZGVyKCdlc3RhdGVJbnNlcnQuZHVzdCcsIG9iaiwgZnVuY3Rpb24gKGVyciwgb3V0KSB7XG4gICAgICAkKCcubW9kYWwtY29udGVudCcpLmh0bWwob3V0KTtcbiAgICAgIGNvbXBvbmVudEhhbmRsZXIudXBncmFkZURvbSgpO1xuICAgICAgJChcIiNjYW5jZWxJbnNlcnRcIikub24oJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGhhbmRsZUZvcm0uY2xlYXIoKTtcbiAgICAgICAgJCgnLm1vZGFsLWRpYWxvZycpLmFkZENsYXNzKCd2aXN1YWxseWhpZGRlbicpO1xuICAgICAgfSk7XG4gICAgICAkKFwiI2luc2VydFwiKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdmFyIGRhdGEsIGM7XG4gICAgICAgIGhhbmRsZUZvcm0uc2V0KCdpbnNlcnRQcm9wZXJ0eScpO1xuICAgICAgICBkYXRhID0gaGFuZGxlRm9ybS5nZXQoKTtcbiAgICAgICAgaGFuZGxlQ29vcmRzLnNldExheWVyKCdkcmF3blByb3BlcnRpZXMnKTtcbiAgICAgICAgYyA9IGhhbmRsZUNvb3Jkcy5jb29yZHMoKTtcbiAgICAgICAgZGF0YS54ID0gY1swXTtcbiAgICAgICAgZGF0YS55ID0gY1sxXTtcbiAgICAgICAgZGF0YS5hZG1pbklkID0gaWQ7XG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgdXJsOiAnaHR0cDovLzEyNy4wLjAuMTozMDAwL2RiL2luc2VydCcsXG4gICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAoZGF0YSwgdGV4dFN0YXR1cywganFYSFIpIHtcbiAgICAgICAgICB0b2FzdHIub3B0aW9ucyA9IHtcbiAgICAgICAgICAgICdwb3NpdGlvbkNsYXNzJzogJ3RvYXN0LWJvdHRvbS1mdWxsLXdpZHRoJyxcbiAgICAgICAgICAgICdwcmV2ZW50RHVwbGljYXRlcyc6IHRydWUsXG4gICAgICAgICAgICAndGltZU91dCc6IDMwXG4gICAgICAgICAgfTtcbiAgICAgICAgICBpZiAoanFYSFIuc3RhdHVzID09PSAyMDEpIHtcbiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCdFc3RhdGUgUmVjb3JkZWQgSW4gRGF0YWJhc2UnKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdG9hc3RyLmVycm9yKCdPcHMgU29tZXRoaW5nIHdlbnQgd3JvbmchISEnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pLmZhaWwoZnVuY3Rpb24gKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3JcIik7XG4gICAgICAgIH0pLmFsd2F5cyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcImNvbXBsZXRlXCIpO1xuICAgICAgICAgIGRyYXduUHJvcGVydGllcy5nZXRTb3VyY2UoKS5jbGVhcigpO1xuICAgICAgICAgIHByb3BlcnR5U291cmNlLmNsZWFyKCk7XG4gICAgICAgICAgaGFuZGxlRm9ybS5jbGVhcigpO1xuICAgICAgICAgICQoJy5tb2RhbC1kaWFsb2cnKS5hZGRDbGFzcygndmlzdWFsbHloaWRkZW4nKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbi8vPT09PT09IGRlbGV0ZSA9PT09PT1cbiQoJyNkZWxldGVQcm9wZXJ0eScpLmNsaWNrKGZ1bmN0aW9uIChldmVudCkge1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAkKCcucHJvcGVydHktaW5mbycpLmFkZENsYXNzKCd2aXN1YWxseWhpZGRlbicpO1xuICB0b2FzdHIub3B0aW9ucyA9IHtcbiAgICAncG9zaXRpb25DbGFzcyc6ICd0b2FzdC10b3AtY2VudGVyJyxcbiAgICAncHJldmVudER1cGxpY2F0ZXMnOiB0cnVlLFxuICAgICd0aW1lT3V0JzogMjBcbiAgfTtcbiAgdG9hc3RyLmluZm8oJ0RlbGV0ZSBQcm9wZXJ0eScpO1xuICBtYXAudW4oJ2NsaWNrJywgY2xpY2tJbmZvKTtcbiAgZHJhdy5zZXRBY3RpdmUoZmFsc2UpO1xuICBmZWF0dXJlcy5jbGVhcigpO1xuICBzZWxlY3Quc2V0QWN0aXZlKHRydWUpO1xuICBzZWxlY3Qub24oJ3NlbGVjdCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmdldEZlYXR1cmVzKCkuZ2V0TGVuZ3RoKCkgPT09IDEpIHtcbiAgICAgIHRvYXN0ci5vcHRpb25zLm5ld2VzdE9uVG9wID0gdHJ1ZTtcbiAgICAgIHRvYXN0ci5vcHRpb25zLnByZXZlbnREdXBsaWNhdGVzID0gdHJ1ZTtcbiAgICAgIHRvYXN0ci5vcHRpb25zLmV4dGVuZGVkVGltZU91dCA9IDA7XG4gICAgICB0b2FzdHIub3B0aW9ucy50aW1lT3V0ID0gMDtcbiAgICAgIHRvYXN0ci5vcHRpb25zLmNsb3NlQnV0dG9uID0gdHJ1ZTtcbiAgICAgIHZhciAkdG9hc3QgPSB0b2FzdHIud2FybmluZygnPHA+QXJlIHlvdSBzdXJlPzwvcD48ZGl2IGNsYXNzPVwidG9hc3RyLWJ0bnNcIj48YnV0dG9uIGlkPVwieWVzRGVsZXRlXCIgY2xhc3M9XCJtZGwtYnV0dG9uIG1kbC1qcy1idXR0b24gXCI+WWVzPC9idXR0b24+PGJ1dHRvbiBpZD1cIm5vRGVsZXRlXCIgY2xhc3M9XCJtZGwtYnV0dG9uIG1kbC1qcy1idXR0b25cIj5ObzwvYnV0dG9uPjwvZGl2PicpO1xuICAgICAgaWYgKCR0b2FzdC5maW5kKCcjeWVzRGVsZXRlJykubGVuZ3RoKSB7XG4gICAgICAgICR0b2FzdC5vbignY2xpY2snLCAnI3llc0RlbGV0ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBhbGVydCgneW91IGNsaWNrZWQgb2snKTtcbiAgICAgICAgICAkdG9hc3QucmVtb3ZlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKCR0b2FzdC5maW5kKCcjbm9EZWxldGUnKS5sZW5ndGgpIHtcbiAgICAgICAgJHRvYXN0Lm9uKCdjbGljaycsICcjbm9EZWxldGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgYWxlcnQoJ1N1cnByaXNlISB5b3UgY2xpY2tlZCBtZS4nKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn0pO1xuJCgnI2xvZ291dCcpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgbG9jYXRpb24uaHJlZiA9ICcvbWFwL2xvZ291dCc7XG59KTtcbiIsInZhciBoYW5kbGVDb29yZHMgPSAoZnVuY3Rpb24gKG9sKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIGNvb3JkcztcbiAgdmFyIGw7XG5cbiAgZnVuY3Rpb24gZmluZEJ5SWQoaWQpIHtcbiAgICB2YXIgbGF5ZXJzID0gbWFwLmdldExheWVycygpO1xuICAgIHZhciBsZW5ndGggPSBsYXllcnMuZ2V0TGVuZ3RoKCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGlkID09PSBsYXllcnMuaXRlbShpKS5nZXQoJ2lkJykpIHtcbiAgICAgICAgcmV0dXJuIGxheWVycy5pdGVtKGkpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbmRCeU5hbWUobmFtZSkge1xuICAgIHZhciBsYXllcnMgPSBtYXAuZ2V0TGF5ZXJzKCk7XG4gICAgdmFyIGxlbmd0aCA9IGxheWVycy5nZXRMZW5ndGgoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAobmFtZSA9PT0gbGF5ZXJzLml0ZW0oaSkuZ2V0KCduYW1lRW4nKSB8fCBuYW1lID09PSBsYXllcnMuaXRlbShpKS5nZXQoJ25hbWVFbCcpKSB7XG4gICAgICAgIHJldHVybiBsYXllcnMuaXRlbShpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiBzZXRMYXllcihpZCkge1xuICAgIGwgPSBmaW5kQnlJZChpZCk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRDb29yZHMoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgdmFyIGNvb3JkRVBTRzM4NTc7XHJcbiAgICBjb29yZEVQU0czODU3ID0gbC5nZXRTb3VyY2UoKS5nZXRGZWF0dXJlcygpWzBdLmdldEdlb21ldHJ5KCkuZ2V0Q29vcmRpbmF0ZXMoKTtcclxuICAgIGNvb3JkcyA9IG9sLnByb2oudHJhbnNmb3JtKGNvb3JkRVBTRzM4NTcsICdFUFNHOjM4NTcnLCAnRVBTRzo0MzI2Jyk7XHJcbiAgICByZXR1cm4gY29vcmRzO1xuICB9XG4gIHJldHVybiB7XG4gICAgY29vcmRzOiBnZXRDb29yZHMsXG4gICAgc2V0TGF5ZXI6IHNldExheWVyXG4gIH07XG59KG9sKSk7XG4iLCJ2YXIgaGFuZGxlRm9ybSA9IChmdW5jdGlvbiAoJCkge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuICB2YXIgZm9ybU5hbWU7XHJcbiAgLy8gZm9ybSA9ICQoJ2Zvcm1bbmFtZT1cIicgKyB0aGlzLm5hbWUgKyAnXCJdJyk7XHJcbiAgZnVuY3Rpb24gc2V0TmFtZShuYW1lKSB7XHJcbiAgICBmb3JtTmFtZSA9IG5hbWU7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBnZXRBdHRyaWJ1dGVzKCkge1xyXG4gICAgdmFyIG9iaiA9IHt9O1xyXG4gICAgJCgnZm9ybVtuYW1lPVwiJyArIGZvcm1OYW1lICsgJ1wiJykuZmluZCgnLm1kbC10ZXh0ZmllbGRfX2lucHV0JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHtcclxuICAgICAgb2JqWyQodGhpcykuYXR0cignaWQnKV0gPSAkKHRoaXMpLnZhbCgpO1xyXG4gICAgfSk7XHJcbiAgICAkKCdmb3JtW25hbWU9XCInICsgZm9ybU5hbWUgKyAnXCInKS5maW5kKCcubWRsLWNoZWNrYm94X19pbnB1dCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbGVtZW50KSB7XHJcbiAgICAgIG9ialskKHRoaXMpLmF0dHIoJ2lkJyldID0gJCh0aGlzKS5wcm9wKCdjaGVja2VkJyk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBvYmo7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiByZXNldEZvcm0oKSB7XHJcbiAgICAkKCdmb3JtW25hbWU9XCInICsgZm9ybU5hbWUgKyAnXCInKS5maW5kKCcubWRsLXRleHRmaWVsZF9faW5wdXQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWxlbWVudCkge1xyXG4gICAgICAkKHRoaXMpLnZhbCgnJyk7XHJcbiAgICAgICQodGhpcykucGFyZW50KCkuZXEoMCkucmVtb3ZlQ2xhc3MoJ2lzLWRpcnR5Jyk7XHJcbiAgICAgICQodGhpcykucGFyZW50KCkuZXEoMCkucmVtb3ZlQ2xhc3MoJ2lzLWludmFsaWQnKTtcclxuICAgIH0pO1xyXG4gICAgJCgnZm9ybVtuYW1lPVwiJyArIGZvcm1OYW1lICsgJ1wiJykuZmluZCgnLm1kbC1jaGVja2JveF9faW5wdXQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWxlbWVudCkge1xyXG4gICAgICAkKHRoaXMpLnByb3AoJ2NoZWNrZWQnLCBmYWxzZSk7XHJcbiAgICB9KTtcclxuICAgICQoJ2Zvcm1bbmFtZT1cIicgKyBmb3JtTmFtZSArICdcIicpLmZpbmQoJy5tZGwtY2hlY2tib3gnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWxlbWVudCkge1xyXG4gICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdpcy1jaGVja2VkJyk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgcmV0dXJuIHtcclxuICAgIHNldDogc2V0TmFtZSxcclxuICAgIGdldDogZ2V0QXR0cmlidXRlcyxcclxuICAgIGNsZWFyOiByZXNldEZvcm1cclxuICB9O1xyXG59KGpRdWVyeSkpO1xyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
