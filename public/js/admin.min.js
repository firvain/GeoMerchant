function PropertyStyle(){var e;return e="../images/map-icons/pins/48/pin1.png",new ol.style.Style({image:new ol.style.Icon({src:e,anchor:[.5,1],scale:.7})})}function clickInfo(e){e.preventDefault();var t={},o=map.forEachFeatureAtPixel(e.pixel,function(e,t){return{feature:e,layer:t}},this,function(e){return"property"===e.get("id")?!0:void 0},this);console.log(o),o?(t.feature={},o.feature.getKeys().forEach(function(e){t.feature[e]=o.feature.get(e)}),console.log(t),dust.render("adminEstateInfo.dust",t,function(e,t){console.log(t),$(".property-info").html(t),$(".property-info").removeClass("visuallyhidden")})):$(".property-info").addClass("visuallyhidden")}var center=[3677385,4120949],extent=[3590094,4102833,3855483,4261211],lang=document.documentElement.lang,geoJSONFormat=new ol.format.GeoJSON({defaultDataProjection:"EPSG:4326"}),bing=new ol.layer.Tile({visible:!0,source:new ol.source.BingMaps({key:"Ak2Gq8VUfICsPpuf7LRANXmXt2sHWmSLPhohmVLFtFIEwYjs_5MCyAhAFwRSVpLj",imagerySet:"Aerial"}),maxZoom:19,crossOrigin:"anonymous",preload:1/0,id:"bing"}),mapbox=new ol.layer.Tile({source:new ol.source.XYZ({attributions:[new ol.Attribution({html:'<a href="https://www.mapbox.com/about/maps/" target="_blank">&copy; Mapbox &copy; OpenStreetMap</a>'})],url:"https://api.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZmlydmFpbiIsImEiOiJlOWYyYTM0NThiNWM0YjJjODJjNDE4ODQzNzA2MGQyNiJ9.-NVDO27Hzt-w_nQosUPfLA"}),id:"mapbox"}),propertySource=new ol.source.Vector({format:geoJSONFormat,loader:function(e,t,o){var n="http://127.0.0.1:3000/db/admin",r=this;r.clear(),$.ajax({url:n,type:"POST",beforeSend:function(e){localStorage.getItem("userToken")&&e.setRequestHeader("Authorization","Bearer "+localStorage.getItem("userToken"))},dataType:"json",data:{id:id}}).done(function(e){var t=geoJSONFormat.readFeatures(e,{featureProjection:"EPSG:3857"});r.addFeatures(t)}).fail(function(){console.log("error")})},strategy:ol.loadingstrategy.all}),property=new ol.layer.Vector({source:propertySource,id:"property",visible:!0,style:PropertyStyle()});property.setZIndex(2);var map=new ol.Map({target:"adminMap",layers:[mapbox,property],loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0,renderer:"canvas",controls:ol.control.defaults({attributionOptions:{collapsible:!1,collapsed:!1}}).extend([new ol.control.ScaleLine({units:"metric"}),new ol.control.OverviewMap({className:"ol-overviewmap ol-custom-overviewmap",collapsible:!0,collapsed:!0,layers:[bing]}),new ol.control.ZoomToExtent({extent:extent})]),view:new ol.View({center:center,projection:"EPSG:3857",zoom:14,maxZoom:19,minZoom:10})});"el"===lang?(bing.set("name","Δορυφορική εικόνα"),mapbox.set("name","Χάρτης"),property.set("name","Ακίνητα")):(bing.set("name","Sattelite Image"),mapbox.set("name","Map"),property.set("name","Properties"));var features=new ol.Collection,drawnProperties=new ol.layer.Vector({source:new ol.source.Vector,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})}),id:"drawnProperties"});map.addLayer(drawnProperties);var draw=new ol.interaction.Draw({source:drawnProperties.getSource(),type:"Point",style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})});map.addInteraction(draw),draw.setActive(!1);var select=new ol.interaction.Select({layers:[property],features:features,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 0, 0, 0.2)"}),stroke:new ol.style.Stroke({color:"#FF00003",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#FF0000"})})})});map.addInteraction(select),select.setActive(!1);var translate=new ol.interaction.Translate({features:select.getFeatures()});map.on("click",clickInfo),$("#insertProperty").click(function(){$(".property-info").addClass("visuallyhidden"),toastr.options={positionClass:"toast-top-center",preventDuplicates:!0,timeOut:20},toastr.info("Add New Property"),map.un("click",clickInfo),select.setActive(!1),draw.setActive(!0),draw.on("drawend",function(e){e.preventDefault(),draw.setActive(!1);var t={};$(".modal-dialog").removeClass("visuallyhidden"),dust.render("estateInsert.dust",t,function(e,t){$(".modal-content").html(t),componentHandler.upgradeDom()})})}),$("#deleteProperty").click(function(e){e.preventDefault(),$(".property-info").addClass("visuallyhidden"),toastr.options={positionClass:"toast-top-center",preventDuplicates:!0,timeOut:20},toastr.info("Delete Property"),map.un("click",clickInfo),draw.setActive(!1),features.clear(),select.setActive(!0),select.on("select",function(e){if(1===e.target.getFeatures().getLength()){toastr.options.newestOnTop=!0,toastr.options.preventDuplicates=!0,toastr.options.extendedTimeOut=0,toastr.options.timeOut=0,toastr.options.closeButton=!0;var t=toastr.warning('<p>Are you sure?</p><div class="toastr-btns"><button id="yesDelete" class="mdl-button mdl-js-button ">Yes</button><button id="noDelete" class="mdl-button mdl-js-button">No</button></div>');t.find("#yesDelete").length&&t.on("click","#yesDelete",function(){alert("you clicked ok"),t.remove()}),t.find("#noDelete").length&&t.on("click","#noDelete",function(){alert("Surprise! you clicked me.")})}})}),$("#logout").click(function(){location.href="/map/logout"});var handleForm=function(e){"use strict";function t(e){r=e}function o(){var t={};return e('form[name="'+r+'"').find(".mdl-textfield__input").each(function(o,n){t[e(this).attr("id")]=e(this).val()}),e('form[name="'+r+'"').find(".mdl-checkbox__input").each(function(o,n){t[e(this).attr("id")]=e(this).prop("checked")}),t}function n(){e('form[name="'+r+'"').find(".mdl-textfield__input").each(function(t,o){e(this).val(""),e(this).parent().eq(0).removeClass("is-dirty"),e(this).parent().eq(0).removeClass("is-invalid")}),e('form[name="'+r+'"').find(".mdl-checkbox__input").each(function(t,o){e(this).prop("checked",!1)}),e('form[name="'+r+'"').find(".mdl-checkbox").each(function(t,o){e(this).removeClass("is-checked")})}var r;return{set:t,get:o,clear:n}}(jQuery);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkbWluLmpzIiwiaGFuZGxlRm9ybS5qcyJdLCJuYW1lcyI6WyJQcm9wZXJ0eVN0eWxlIiwic3JjIiwib2wiLCJzdHlsZSIsIlN0eWxlIiwiaW1hZ2UiLCJJY29uIiwiYW5jaG9yIiwic2NhbGUiLCJjbGlja0luZm8iLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsIm9iaiIsImNsaWNrZWRGZWF0dXJlIiwibWFwIiwiZm9yRWFjaEZlYXR1cmVBdFBpeGVsIiwicGl4ZWwiLCJmZWF0dXJlIiwibGF5ZXIiLCJ0aGlzIiwiZ2V0IiwiY29uc29sZSIsImxvZyIsImdldEtleXMiLCJmb3JFYWNoIiwia2V5IiwiZHVzdCIsInJlbmRlciIsImVyciIsIm91dCIsIiQiLCJodG1sIiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsImNlbnRlciIsImV4dGVudCIsImxhbmciLCJkb2N1bWVudCIsImRvY3VtZW50RWxlbWVudCIsImdlb0pTT05Gb3JtYXQiLCJmb3JtYXQiLCJHZW9KU09OIiwiZGVmYXVsdERhdGFQcm9qZWN0aW9uIiwiYmluZyIsIlRpbGUiLCJ2aXNpYmxlIiwic291cmNlIiwiQmluZ01hcHMiLCJpbWFnZXJ5U2V0IiwibWF4Wm9vbSIsImNyb3NzT3JpZ2luIiwicHJlbG9hZCIsIkluZmluaXR5IiwiaWQiLCJtYXBib3giLCJYWVoiLCJhdHRyaWJ1dGlvbnMiLCJBdHRyaWJ1dGlvbiIsInVybCIsInByb3BlcnR5U291cmNlIiwiVmVjdG9yIiwibG9hZGVyIiwicmVzb2x1dGlvbiIsInByb2plY3Rpb24iLCJzZWxmIiwiY2xlYXIiLCJhamF4IiwidHlwZSIsImJlZm9yZVNlbmQiLCJ4aHIiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwic2V0UmVxdWVzdEhlYWRlciIsImRhdGFUeXBlIiwiZGF0YSIsImRvbmUiLCJyZXNwb25zZSIsImZlYXR1cmVzIiwicmVhZEZlYXR1cmVzIiwiZmVhdHVyZVByb2plY3Rpb24iLCJhZGRGZWF0dXJlcyIsImZhaWwiLCJzdHJhdGVneSIsImxvYWRpbmdzdHJhdGVneSIsImFsbCIsInByb3BlcnR5Iiwic2V0WkluZGV4IiwiTWFwIiwidGFyZ2V0IiwibGF5ZXJzIiwibG9hZFRpbGVzV2hpbGVBbmltYXRpbmciLCJsb2FkVGlsZXNXaGlsZUludGVyYWN0aW5nIiwicmVuZGVyZXIiLCJjb250cm9scyIsImNvbnRyb2wiLCJkZWZhdWx0cyIsImF0dHJpYnV0aW9uT3B0aW9ucyIsImNvbGxhcHNpYmxlIiwiY29sbGFwc2VkIiwiZXh0ZW5kIiwiU2NhbGVMaW5lIiwidW5pdHMiLCJPdmVydmlld01hcCIsImNsYXNzTmFtZSIsIlpvb21Ub0V4dGVudCIsInZpZXciLCJWaWV3Iiwiem9vbSIsIm1pblpvb20iLCJzZXQiLCJDb2xsZWN0aW9uIiwiZHJhd25Qcm9wZXJ0aWVzIiwiZmlsbCIsIkZpbGwiLCJjb2xvciIsInN0cm9rZSIsIlN0cm9rZSIsIndpZHRoIiwiQ2lyY2xlIiwicmFkaXVzIiwiYWRkTGF5ZXIiLCJkcmF3IiwiaW50ZXJhY3Rpb24iLCJEcmF3IiwiZ2V0U291cmNlIiwiYWRkSW50ZXJhY3Rpb24iLCJzZXRBY3RpdmUiLCJzZWxlY3QiLCJTZWxlY3QiLCJ0cmFuc2xhdGUiLCJUcmFuc2xhdGUiLCJnZXRGZWF0dXJlcyIsIm9uIiwiY2xpY2siLCJ0b2FzdHIiLCJvcHRpb25zIiwicG9zaXRpb25DbGFzcyIsInByZXZlbnREdXBsaWNhdGVzIiwidGltZU91dCIsImluZm8iLCJ1biIsImNvbXBvbmVudEhhbmRsZXIiLCJ1cGdyYWRlRG9tIiwiZXZlbnQiLCJlIiwiZ2V0TGVuZ3RoIiwibmV3ZXN0T25Ub3AiLCJleHRlbmRlZFRpbWVPdXQiLCJjbG9zZUJ1dHRvbiIsIiR0b2FzdCIsIndhcm5pbmciLCJmaW5kIiwibGVuZ3RoIiwiYWxlcnQiLCJyZW1vdmUiLCJsb2NhdGlvbiIsImhyZWYiLCJoYW5kbGVGb3JtIiwic2V0TmFtZSIsIm5hbWUiLCJmb3JtTmFtZSIsImdldEF0dHJpYnV0ZXMiLCJlYWNoIiwiaW5kZXgiLCJlbGVt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QVgsTUFBQW1KLElBQUEsSUFDQXhJLEVBQUFYLE1BQUFzSixTQUFBQyxHQUFBLEdBQUExSSxZQUFBLFlBQ0FGLEVBQUFYLE1BQUFzSixTQUFBQyxHQUFBLEdBQUExSSxZQUFBLGdCQUVBRixFQUFBLGNBQUFrSSxFQUFBLEtBQUFULEtBQUEsd0JBQUFXLEtBQUEsU0FBQUMsRUFBQUMsR0FDQXRJLEVBQUFYLE1BQUFvSixLQUFBLFdBQUEsS0FFQXpJLEVBQUEsY0FBQWtJLEVBQUEsS0FBQVQsS0FBQSxpQkFBQVcsS0FBQSxTQUFBQyxFQUFBQyxHQUNBdEksRUFBQVgsTUFBQWEsWUFBQSxnQkEzQkEsR0FBQWdJLEVBOEJBLFFBQ0FuRCxJQUFBaUQsRUFDQTFJLElBQUE2SSxFQUNBaEcsTUFBQXVHLElBRUFHIiwiZmlsZSI6ImFkbWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBjZW50ZXIgPSBbXG4gICAgMzY3NzM4NSwgNDEyMDk0OVxuICBdLFxuICBleHRlbnQgPSBbXG4gICAgMzU5MDA5NCwgNDEwMjgzMywgMzg1NTQ4MywgNDI2MTIxMVxuICBdLFxuICBsYW5nID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmxhbmcsXG4gIGdlb0pTT05Gb3JtYXQgPSBuZXcgb2wuZm9ybWF0Lkdlb0pTT04oe1xuICAgIGRlZmF1bHREYXRhUHJvamVjdGlvbjogJ0VQU0c6NDMyNidcbiAgfSk7XG52YXIgYmluZyA9IG5ldyBvbC5sYXllci5UaWxlKHtcbiAgdmlzaWJsZTogdHJ1ZSxcbiAgc291cmNlOiBuZXcgb2wuc291cmNlLkJpbmdNYXBzKHtcbiAgICBrZXk6ICdBazJHcThWVWZJQ3NQcHVmN0xSQU5YbVh0MnNIV21TTFBob2htVkxGdEZJRXdZanNfNU1DeUFoQUZ3UlNWcExqJyxcbiAgICBpbWFnZXJ5U2V0OiAnQWVyaWFsJ1xuICB9KSxcbiAgbWF4Wm9vbTogMTksXG4gIGNyb3NzT3JpZ2luOiAnYW5vbnltb3VzJyxcbiAgcHJlbG9hZDogSW5maW5pdHksXG4gIGlkOiAnYmluZydcbn0pO1xudmFyIG1hcGJveCA9IG5ldyBvbC5sYXllci5UaWxlKHtcbiAgc291cmNlOiBuZXcgb2wuc291cmNlLlhZWih7XG4gICAgYXR0cmlidXRpb25zOiBbbmV3IG9sLkF0dHJpYnV0aW9uKHtcbiAgICAgIGh0bWw6ICc8YSBocmVmPVwiaHR0cHM6Ly93d3cubWFwYm94LmNvbS9hYm91dC9tYXBzL1wiIHRhcmdldD1cIl9ibGFua1wiPiZjb3B5OyBNYXBib3ggJmNvcHk7IE9wZW5TdHJlZXRNYXA8L2E+J1xuICAgIH0pXSxcbiAgICB1cmw6ICdodHRwczovL2FwaS5tYXBib3guY29tL3Y0L21hcGJveC5zdHJlZXRzL3t6fS97eH0ve3l9LnBuZz9hY2Nlc3NfdG9rZW49cGsuZXlKMUlqb2labWx5ZG1GcGJpSXNJbUVpT2lKbE9XWXlZVE0wTlRoaU5XTTBZakpqT0RKak5ERTRPRFF6TnpBMk1HUXlOaUo5Li1OVkRPMjdIenQtd19uUW9zVVBmTEEnXG4gIH0pLFxuICBpZDogJ21hcGJveCdcbn0pO1xuXG5mdW5jdGlvbiBQcm9wZXJ0eVN0eWxlKCkge1xuICB2YXIgc3JjO1xuICBzcmMgPSAnLi4vaW1hZ2VzL21hcC1pY29ucy9waW5zLzQ4L3BpbjEucG5nJztcbiAgcmV0dXJuIG5ldyBvbC5zdHlsZS5TdHlsZSh7XG4gICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5JY29uKCh7XG4gICAgICBzcmM6IHNyYyxcbiAgICAgIGFuY2hvcjogW1xuICAgICAgICAwLjUsIDFcbiAgICAgIF0sXG4gICAgICBzY2FsZTogMC43XG4gICAgfSkpXG4gIH0pO1xufVxudmFyIHByb3BlcnR5U291cmNlID0gbmV3IG9sLnNvdXJjZS5WZWN0b3Ioe1xuICBmb3JtYXQ6IGdlb0pTT05Gb3JtYXQsXG4gIGxvYWRlcjogZnVuY3Rpb24gKGV4dGVudCwgcmVzb2x1dGlvbiwgcHJvamVjdGlvbikge1xuICAgIHZhciB1cmwgPSAnaHR0cDovLzEyNy4wLjAuMTozMDAwL2RiL2FkbWluJztcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgc2VsZi5jbGVhcigpO1xuICAgICQuYWpheCh7XG4gICAgICB1cmw6IHVybCxcbiAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICdiZWZvcmVTZW5kJzogZnVuY3Rpb24gKHhocikge1xuICAgICAgICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpKSB7XG4gICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0F1dGhvcml6YXRpb24nLCAnQmVhcmVyICcgKyBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJykpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgaWQ6IGlkXG4gICAgICB9XG4gICAgfSkuZG9uZShmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIHZhciBmZWF0dXJlcyA9IGdlb0pTT05Gb3JtYXQucmVhZEZlYXR1cmVzKHJlc3BvbnNlLCB7XG4gICAgICAgIGZlYXR1cmVQcm9qZWN0aW9uOiAnRVBTRzozODU3J1xuICAgICAgfSk7XG4gICAgICBzZWxmLmFkZEZlYXR1cmVzKGZlYXR1cmVzKTtcbiAgICB9KS5mYWlsKGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicpO1xuICAgIH0pO1xuICB9LFxuICBzdHJhdGVneTogb2wubG9hZGluZ3N0cmF0ZWd5LmFsbFxufSk7XG52YXIgcHJvcGVydHkgPSBuZXcgb2wubGF5ZXIuVmVjdG9yKHtcbiAgc291cmNlOiBwcm9wZXJ0eVNvdXJjZSxcbiAgaWQ6ICdwcm9wZXJ0eScsXG4gIHZpc2libGU6IHRydWUsXG4gIHN0eWxlOiBQcm9wZXJ0eVN0eWxlKClcbn0pO1xucHJvcGVydHkuc2V0WkluZGV4KDIpO1xudmFyIG1hcCA9IG5ldyBvbC5NYXAoe1xuICB0YXJnZXQ6ICdhZG1pbk1hcCcsXG4gIGxheWVyczogW1xuICAgIG1hcGJveCwgcHJvcGVydHlcbiAgXSxcbiAgbG9hZFRpbGVzV2hpbGVBbmltYXRpbmc6IHRydWUsXG4gIGxvYWRUaWxlc1doaWxlSW50ZXJhY3Rpbmc6IHRydWUsXG4gIHJlbmRlcmVyOiAnY2FudmFzJyxcbiAgY29udHJvbHM6IG9sLmNvbnRyb2wuZGVmYXVsdHMoe1xuICAgIGF0dHJpYnV0aW9uT3B0aW9uczoge1xuICAgICAgY29sbGFwc2libGU6IGZhbHNlLFxuICAgICAgY29sbGFwc2VkOiBmYWxzZVxuICAgIH1cbiAgfSkuZXh0ZW5kKFtcbiAgICBuZXcgb2wuY29udHJvbC5TY2FsZUxpbmUoe1xuICAgICAgdW5pdHM6ICdtZXRyaWMnXG4gICAgfSksXG4gICAgbmV3IG9sLmNvbnRyb2wuT3ZlcnZpZXdNYXAoe1xuICAgICAgY2xhc3NOYW1lOiAnb2wtb3ZlcnZpZXdtYXAgb2wtY3VzdG9tLW92ZXJ2aWV3bWFwJyxcbiAgICAgIGNvbGxhcHNpYmxlOiB0cnVlLFxuICAgICAgY29sbGFwc2VkOiB0cnVlLFxuICAgICAgbGF5ZXJzOiBbYmluZ11cbiAgICB9KSxcbiAgICBuZXcgb2wuY29udHJvbC5ab29tVG9FeHRlbnQoe1xuICAgICAgZXh0ZW50OiBleHRlbnRcbiAgICB9KVxuICBdKSxcbiAgdmlldzogbmV3IG9sLlZpZXcoe1xuICAgIGNlbnRlcjogY2VudGVyLFxuICAgIC8vIGV4dGVudDogZXh0ZW50LFxuICAgIHByb2plY3Rpb246ICdFUFNHOjM4NTcnLFxuICAgIHpvb206IDE0LFxuICAgIG1heFpvb206IDE5LFxuICAgIG1pblpvb206IDEwXG4gIH0pXG59KTtcbmlmIChsYW5nID09PSAnZWwnKSB7XG4gIGJpbmcuc2V0KCduYW1lJywgJ86Uzr/Pgc+Fz4bOv8+BzrnOus6uIM61zrnOus+Mzr3OsScpO1xuICBtYXBib3guc2V0KCduYW1lJywgJ86nzqzPgc+EzrfPgicpO1xuICBwcm9wZXJ0eS5zZXQoJ25hbWUnLCAnzpHOus6vzr3Ot8+EzrEnKTtcbn0gZWxzZSB7XG4gIGJpbmcuc2V0KCduYW1lJywgJ1NhdHRlbGl0ZSBJbWFnZScpO1xuICBtYXBib3guc2V0KCduYW1lJywgJ01hcCcpO1xuICBwcm9wZXJ0eS5zZXQoJ25hbWUnLCAnUHJvcGVydGllcycpO1xufVxuLy89PT09PT0gaW50ZXJhY3Rpb25zID09PT09PVxudmFyIGZlYXR1cmVzID0gbmV3IG9sLkNvbGxlY3Rpb24oKTtcbnZhciBkcmF3blByb3BlcnRpZXMgPSBuZXcgb2wubGF5ZXIuVmVjdG9yKHtcbiAgc291cmNlOiBuZXcgb2wuc291cmNlLlZlY3RvcigpLFxuICBzdHlsZTogbmV3IG9sLnN0eWxlLlN0eWxlKHtcbiAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XG4gICAgICBjb2xvcjogJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC4yKSdcbiAgICB9KSxcbiAgICBzdHJva2U6IG5ldyBvbC5zdHlsZS5TdHJva2Uoe1xuICAgICAgY29sb3I6ICcjZmZjYzMzJyxcbiAgICAgIHdpZHRoOiAyXG4gICAgfSksXG4gICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5DaXJjbGUoe1xuICAgICAgcmFkaXVzOiA3LFxuICAgICAgZmlsbDogbmV3IG9sLnN0eWxlLkZpbGwoe1xuICAgICAgICBjb2xvcjogJyNmZmNjMzMnXG4gICAgICB9KVxuICAgIH0pXG4gIH0pLFxuICBpZDogJ2RyYXduUHJvcGVydGllcydcbn0pO1xubWFwLmFkZExheWVyKGRyYXduUHJvcGVydGllcyk7XG4vL2RyYXdcbnZhciBkcmF3ID0gbmV3IG9sLmludGVyYWN0aW9uLkRyYXcoe1xuICAvLyBmZWF0dXJlczogZmVhdHVyZXMsXG4gIHNvdXJjZTogZHJhd25Qcm9wZXJ0aWVzLmdldFNvdXJjZSgpLFxuICB0eXBlOiAnUG9pbnQnLFxuICBzdHlsZTogbmV3IG9sLnN0eWxlLlN0eWxlKHtcbiAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XG4gICAgICBjb2xvcjogJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC4yKSdcbiAgICB9KSxcbiAgICBzdHJva2U6IG5ldyBvbC5zdHlsZS5TdHJva2Uoe1xuICAgICAgY29sb3I6ICcjZmZjYzMzJyxcbiAgICAgIHdpZHRoOiAyXG4gICAgfSksXG4gICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5DaXJjbGUoe1xuICAgICAgcmFkaXVzOiA3LFxuICAgICAgZmlsbDogbmV3IG9sLnN0eWxlLkZpbGwoe1xuICAgICAgICBjb2xvcjogJyNmZmNjMzMnXG4gICAgICB9KVxuICAgIH0pXG4gIH0pXG59KTtcbm1hcC5hZGRJbnRlcmFjdGlvbihkcmF3KTtcbmRyYXcuc2V0QWN0aXZlKGZhbHNlKTtcbi8vc2VsZWN0XG52YXIgc2VsZWN0ID0gbmV3IG9sLmludGVyYWN0aW9uLlNlbGVjdCh7XG4gIGxheWVyczogW3Byb3BlcnR5XSxcbiAgZmVhdHVyZXM6IGZlYXR1cmVzLFxuICBzdHlsZTogbmV3IG9sLnN0eWxlLlN0eWxlKHtcbiAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XG4gICAgICBjb2xvcjogJ3JnYmEoMjU1LCAwLCAwLCAwLjIpJ1xuICAgIH0pLFxuICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XG4gICAgICBjb2xvcjogJyNGRjAwMDAzJyxcbiAgICAgIHdpZHRoOiAyXG4gICAgfSksXG4gICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5DaXJjbGUoe1xuICAgICAgcmFkaXVzOiA3LFxuICAgICAgZmlsbDogbmV3IG9sLnN0eWxlLkZpbGwoe1xuICAgICAgICBjb2xvcjogJyNGRjAwMDAnXG4gICAgICB9KVxuICAgIH0pXG4gIH0pXG59KTtcbm1hcC5hZGRJbnRlcmFjdGlvbihzZWxlY3QpO1xuc2VsZWN0LnNldEFjdGl2ZShmYWxzZSk7XG4vL3RyYW5zbGF0ZShtb3ZlKVxudmFyIHRyYW5zbGF0ZSA9IG5ldyBvbC5pbnRlcmFjdGlvbi5UcmFuc2xhdGUoe1xuICBmZWF0dXJlczogc2VsZWN0LmdldEZlYXR1cmVzKClcbn0pO1xuLy89PT09PT0gaW5mbyA9PT09PT1cbm1hcC5vbignY2xpY2snLCBjbGlja0luZm8pO1xuXG5mdW5jdGlvbiBjbGlja0luZm8oZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICB2YXIgb2JqID0ge307XG4gIHZhciBjbGlja2VkRmVhdHVyZSA9IG1hcC5mb3JFYWNoRmVhdHVyZUF0UGl4ZWwoZXZ0LnBpeGVsLCBmdW5jdGlvbiAoZmVhdHVyZSwgbGF5ZXIpIHtcbiAgICByZXR1cm4ge1xuICAgICAgZmVhdHVyZTogZmVhdHVyZSxcbiAgICAgIGxheWVyOiBsYXllclxuICAgIH07XG4gIH0sIHRoaXMsIGZ1bmN0aW9uIChsYXllcikge1xuICAgIGlmIChsYXllci5nZXQoJ2lkJykgPT09ICdwcm9wZXJ0eScpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfSwgdGhpcyk7XG4gIGNvbnNvbGUubG9nKGNsaWNrZWRGZWF0dXJlKTtcbiAgaWYgKGNsaWNrZWRGZWF0dXJlKSB7XG4gICAgb2JqLmZlYXR1cmUgPSB7fTtcbiAgICBjbGlja2VkRmVhdHVyZS5mZWF0dXJlLmdldEtleXMoKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgIG9iai5mZWF0dXJlW2tleV0gPSBjbGlja2VkRmVhdHVyZS5mZWF0dXJlLmdldChrZXkpO1xuICAgIH0pO1xuICAgIGNvbnNvbGUubG9nKG9iaik7XG4gICAgZHVzdC5yZW5kZXIoJ2FkbWluRXN0YXRlSW5mby5kdXN0Jywgb2JqLCBmdW5jdGlvbiAoZXJyLCBvdXQpIHtcbiAgICAgIGNvbnNvbGUubG9nKG91dCk7XG4gICAgICAkKCcucHJvcGVydHktaW5mbycpLmh0bWwob3V0KTtcbiAgICAgICQoJy5wcm9wZXJ0eS1pbmZvJykucmVtb3ZlQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgJCgnLnByb3BlcnR5LWluZm8nKS5hZGRDbGFzcygndmlzdWFsbHloaWRkZW4nKTtcbiAgfVxufVxuLy89PT09PT0gaW5zZXJ0ID09PT09PVxuJCgnI2luc2VydFByb3BlcnR5JykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAkKCcucHJvcGVydHktaW5mbycpLmFkZENsYXNzKCd2aXN1YWxseWhpZGRlbicpO1xuICB0b2FzdHIub3B0aW9ucyA9IHtcbiAgICAncG9zaXRpb25DbGFzcyc6ICd0b2FzdC10b3AtY2VudGVyJyxcbiAgICAncHJldmVudER1cGxpY2F0ZXMnOiB0cnVlLFxuICAgICd0aW1lT3V0JzogMjBcbiAgfTtcbiAgdG9hc3RyLmluZm8oJ0FkZCBOZXcgUHJvcGVydHknKTtcbiAgbWFwLnVuKCdjbGljaycsIGNsaWNrSW5mbyk7XG4gIHNlbGVjdC5zZXRBY3RpdmUoZmFsc2UpO1xuICBkcmF3LnNldEFjdGl2ZSh0cnVlKTtcbiAgZHJhdy5vbignZHJhd2VuZCcsIGZ1bmN0aW9uIChldnQpIHtcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICBkcmF3LnNldEFjdGl2ZShmYWxzZSk7XG4gICAgdmFyIG9iaiA9IHt9O1xuICAgICQoJy5tb2RhbC1kaWFsb2cnKS5yZW1vdmVDbGFzcygndmlzdWFsbHloaWRkZW4nKTtcbiAgICBkdXN0LnJlbmRlcignZXN0YXRlSW5zZXJ0LmR1c3QnLCBvYmosIGZ1bmN0aW9uIChlcnIsIG91dCkge1xuICAgICAgJCgnLm1vZGFsLWNvbnRlbnQnKS5odG1sKG91dCk7XG4gICAgICBjb21wb25lbnRIYW5kbGVyLnVwZ3JhZGVEb20oKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbi8vPT09PT09IGRlbGV0ZSA9PT09PT1cbiQoJyNkZWxldGVQcm9wZXJ0eScpLmNsaWNrKGZ1bmN0aW9uIChldmVudCkge1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAkKCcucHJvcGVydHktaW5mbycpLmFkZENsYXNzKCd2aXN1YWxseWhpZGRlbicpO1xuICB0b2FzdHIub3B0aW9ucyA9IHtcbiAgICAncG9zaXRpb25DbGFzcyc6ICd0b2FzdC10b3AtY2VudGVyJyxcbiAgICAncHJldmVudER1cGxpY2F0ZXMnOiB0cnVlLFxuICAgICd0aW1lT3V0JzogMjBcbiAgfTtcbiAgdG9hc3RyLmluZm8oJ0RlbGV0ZSBQcm9wZXJ0eScpO1xuICBtYXAudW4oJ2NsaWNrJywgY2xpY2tJbmZvKTtcbiAgZHJhdy5zZXRBY3RpdmUoZmFsc2UpO1xuICBmZWF0dXJlcy5jbGVhcigpO1xuICBzZWxlY3Quc2V0QWN0aXZlKHRydWUpO1xuICBzZWxlY3Qub24oJ3NlbGVjdCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmdldEZlYXR1cmVzKCkuZ2V0TGVuZ3RoKCkgPT09IDEpIHtcbiAgICAgIHRvYXN0ci5vcHRpb25zLm5ld2VzdE9uVG9wID0gdHJ1ZTtcbiAgICAgIHRvYXN0ci5vcHRpb25zLnByZXZlbnREdXBsaWNhdGVzID0gdHJ1ZTtcbiAgICAgIHRvYXN0ci5vcHRpb25zLmV4dGVuZGVkVGltZU91dCA9IDA7XG4gICAgICB0b2FzdHIub3B0aW9ucy50aW1lT3V0ID0gMDtcbiAgICAgIHRvYXN0ci5vcHRpb25zLmNsb3NlQnV0dG9uID0gdHJ1ZTtcbiAgICAgIHZhciAkdG9hc3QgPSB0b2FzdHIud2FybmluZygnPHA+QXJlIHlvdSBzdXJlPzwvcD48ZGl2IGNsYXNzPVwidG9hc3RyLWJ0bnNcIj48YnV0dG9uIGlkPVwieWVzRGVsZXRlXCIgY2xhc3M9XCJtZGwtYnV0dG9uIG1kbC1qcy1idXR0b24gXCI+WWVzPC9idXR0b24+PGJ1dHRvbiBpZD1cIm5vRGVsZXRlXCIgY2xhc3M9XCJtZGwtYnV0dG9uIG1kbC1qcy1idXR0b25cIj5ObzwvYnV0dG9uPjwvZGl2PicpO1xuICAgICAgaWYgKCR0b2FzdC5maW5kKCcjeWVzRGVsZXRlJykubGVuZ3RoKSB7XG4gICAgICAgICR0b2FzdC5vbignY2xpY2snLCAnI3llc0RlbGV0ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBhbGVydCgneW91IGNsaWNrZWQgb2snKTtcbiAgICAgICAgICAkdG9hc3QucmVtb3ZlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKCR0b2FzdC5maW5kKCcjbm9EZWxldGUnKS5sZW5ndGgpIHtcbiAgICAgICAgJHRvYXN0Lm9uKCdjbGljaycsICcjbm9EZWxldGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgYWxlcnQoJ1N1cnByaXNlISB5b3UgY2xpY2tlZCBtZS4nKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn0pO1xuJCgnI2xvZ291dCcpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgbG9jYXRpb24uaHJlZiA9ICcvbWFwL2xvZ291dCc7XG59KTtcbiIsInZhciBoYW5kbGVGb3JtID0gKGZ1bmN0aW9uICgkKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIGZvcm1OYW1lO1xuICAvLyBmb3JtID0gJCgnZm9ybVtuYW1lPVwiJyArIHRoaXMubmFtZSArICdcIl0nKTtcbiAgZnVuY3Rpb24gc2V0TmFtZShuYW1lKSB7XG4gICAgZm9ybU5hbWUgPSBuYW1lO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0QXR0cmlidXRlcygpIHtcbiAgICB2YXIgb2JqID0ge307XG4gICAgJCgnZm9ybVtuYW1lPVwiJyArIGZvcm1OYW1lICsgJ1wiJykuZmluZCgnLm1kbC10ZXh0ZmllbGRfX2lucHV0JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgIG9ialskKHRoaXMpLmF0dHIoJ2lkJyldID0gJCh0aGlzKS52YWwoKTtcbiAgICB9KTtcbiAgICAkKCdmb3JtW25hbWU9XCInICsgZm9ybU5hbWUgKyAnXCInKS5maW5kKCcubWRsLWNoZWNrYm94X19pbnB1dCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbGVtZW50KSB7XG4gICAgICBvYmpbJCh0aGlzKS5hdHRyKCdpZCcpXSA9ICQodGhpcykucHJvcCgnY2hlY2tlZCcpO1xuICAgIH0pO1xuICAgIHJldHVybiBvYmo7XG4gIH1cblxuICBmdW5jdGlvbiByZXNldEZvcm0oKSB7XG4gICAgJCgnZm9ybVtuYW1lPVwiJyArIGZvcm1OYW1lICsgJ1wiJykuZmluZCgnLm1kbC10ZXh0ZmllbGRfX2lucHV0JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICQodGhpcykudmFsKCcnKTtcbiAgICAgICQodGhpcykucGFyZW50KCkuZXEoMCkucmVtb3ZlQ2xhc3MoJ2lzLWRpcnR5Jyk7XG4gICAgICAkKHRoaXMpLnBhcmVudCgpLmVxKDApLnJlbW92ZUNsYXNzKCdpcy1pbnZhbGlkJyk7XG4gICAgfSk7XG4gICAgJCgnZm9ybVtuYW1lPVwiJyArIGZvcm1OYW1lICsgJ1wiJykuZmluZCgnLm1kbC1jaGVja2JveF9faW5wdXQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWxlbWVudCkge1xuICAgICAgJCh0aGlzKS5wcm9wKCdjaGVja2VkJywgZmFsc2UpO1xuICAgIH0pO1xuICAgICQoJ2Zvcm1bbmFtZT1cIicgKyBmb3JtTmFtZSArICdcIicpLmZpbmQoJy5tZGwtY2hlY2tib3gnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWxlbWVudCkge1xuICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnaXMtY2hlY2tlZCcpO1xuICAgIH0pO1xuICB9XG4gIHJldHVybiB7XG4gICAgc2V0OiBzZXROYW1lLFxuICAgIGdldDogZ2V0QXR0cmlidXRlcyxcbiAgICBjbGVhcjogcmVzZXRGb3JtXG4gIH07XG59KGpRdWVyeSkpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
