function PropertyStyle(){var e;return e="../images/map-icons/pins/48/pin1.png",new ol.style.Style({image:new ol.style.Icon({src:e,anchor:[.5,1],scale:.7})})}function clickInfo(e){e.preventDefault();var t={},o=map.forEachFeatureAtPixel(e.pixel,function(e,t){return{feature:e,layer:t}},this,function(e){return"property"===e.get("id")?!0:void 0},this);console.log(o),o?(t.feature={},o.feature.getKeys().forEach(function(e){t.feature[e]=o.feature.get(e)}),console.log(t),dust.render("adminEstateInfo.dust",t,function(e,t){console.log(t),$(".property-info").html(t),$(".property-info").removeClass("visuallyhidden")})):$(".property-info").addClass("visuallyhidden")}var center=[3677385,4120949],extent=[3590094,4102833,3855483,4261211],lang=document.documentElement.lang,styleCache={},geoJSONFormat=new ol.format.GeoJSON({defaultDataProjection:"EPSG:4326"}),bing=new ol.layer.Tile({visible:!0,source:new ol.source.BingMaps({key:"Ak2Gq8VUfICsPpuf7LRANXmXt2sHWmSLPhohmVLFtFIEwYjs_5MCyAhAFwRSVpLj",imagerySet:"Aerial"}),maxZoom:19,crossOrigin:"anonymous",preload:1/0,id:"bing"}),mapbox=new ol.layer.Tile({source:new ol.source.XYZ({attributions:[new ol.Attribution({html:'<a href="https://www.mapbox.com/about/maps/" target="_blank">&copy; Mapbox &copy; OpenStreetMap</a>'})],url:"https://api.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZmlydmFpbiIsImEiOiJlOWYyYTM0NThiNWM0YjJjODJjNDE4ODQzNzA2MGQyNiJ9.-NVDO27Hzt-w_nQosUPfLA"}),id:"mapbox"}),propertySource=new ol.source.Vector({format:geoJSONFormat,loader:function(e,t,o){var l="http://localhost:3000/db/admin",r=this;this.clear(),$.ajax({url:l,type:"POST",beforeSend:function(e){localStorage.getItem("userToken")&&e.setRequestHeader("Authorization","Bearer "+localStorage.getItem("userToken"))},dataType:"json",data:{id:id}}).done(function(e){var t=geoJSONFormat.readFeatures(e,{featureProjection:"EPSG:3857"});r.addFeatures(t)}).fail(function(){console.log("error")})},strategy:ol.loadingstrategy.all}),property=new ol.layer.Vector({source:propertySource,id:"property",visible:!0,style:PropertyStyle()});property.setZIndex(2);var map=new ol.Map({target:"adminMap",layers:[mapbox,property],loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0,renderer:"canvas",controls:ol.control.defaults({attributionOptions:{collapsible:!1,collapsed:!1}}).extend([new ol.control.ScaleLine({units:"metric"}),new ol.control.OverviewMap({className:"ol-overviewmap ol-custom-overviewmap",collapsible:!0,collapsed:!0,layers:[bing]}),new ol.control.ZoomToExtent({extent:extent})]),view:new ol.View({center:center,projection:"EPSG:3857",zoom:14,maxZoom:19,minZoom:10})});"el"===lang?(bing.set("name","Δορυφορική εικόνα"),mapbox.set("name","Χάρτης"),property.set("name","Ακίνητα")):(bing.set("name","Sattelite Image"),mapbox.set("name","Map"),property.set("name","Properties"));var features=new ol.Collection,drawnProperties=new ol.layer.Vector({source:new ol.source.Vector,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})}),id:"drawnProperties"});map.addLayer(drawnProperties);var draw=new ol.interaction.Draw({source:drawnProperties.getSource(),type:"Point",style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})});map.addInteraction(draw),draw.setActive(!1);var select=new ol.interaction.Select({layers:[property],features:features,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 0, 0, 0.2)"}),stroke:new ol.style.Stroke({color:"#FF00003",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#FF0000"})})})});map.addInteraction(select),select.setActive(!1);var translate=new ol.interaction.Translate({features:select.getFeatures()});map.on("click",clickInfo),$("#insertProperty").click(function(){$(".property-info").addClass("visuallyhidden"),toastr.options={positionClass:"toast-top-center"},toastr.info("Add New Property"),map.un("click",clickInfo),select.setActive(!1),draw.setActive(!0),draw.on("drawend",function(e){draw.setActive(!1)})}),$("#deleteProperty").click(function(e){$(".property-info").addClass("visuallyhidden"),toastr.options={positionClass:"toast-top-center"},toastr.info("Delete Property"),map.un("click",clickInfo),draw.setActive(!1),features.clear(),select.setActive(!0),select.on("select",function(e){if(1===e.target.getFeatures().getLength()){toastr.options.newestOnTop=!0,toastr.options.preventDuplicates=!0,toastr.options.extendedTimeOut=0,toastr.options.timeOut=0,toastr.options.closeButton=!0;var t=toastr.warning('<p>Are you sure?</p><div class="toastr-btns"><button id="yesDelete" class="mdl-button mdl-js-button ">Yes</button><button id="noDelete" class="mdl-button mdl-js-button">No</button></div>');t.find("#yesDelete").length&&t.on("click","#yesDelete",function(){alert("you clicked ok"),t.remove()}),t.find("#noDelete").length&&t.on("click","#noDelete",function(){alert("Surprise! you clicked me.")})}})}),$("#logout").click(function(){location.href="/map/logout"});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkbWluLmpzIl0sIm5hbWVzIjpbIlByb3BlcnR5U3R5bGUiLCJzcmMiLCJvbCIsInN0eWxlIiwiU3R5bGUiLCJpbWFnZSIsIkljb24iLCJhbmNob3IiLCJzY2FsZSIsImNsaWNrSW5mbyIsImV2dCIsInByZXZlbnREZWZhdWx0Iiwib2JqIiwiY2xpY2tlZEZlYXR1cmUiLCJtYXAiLCJmb3JFYWNoRmVhdHVyZUF0UGl4ZWwiLCJwaXhlbCIsImZlYXR1cmUiLCJsYXllciIsInRoaXMiLCJnZXQiLCJjb25zb2xlIiwibG9nIiwiZ2V0S2V5cyIsImZvckVhY2giLCJrZXkiLCJkdXN0IiwicmVuZGVyIiwiZXJyIiwib3V0IiwiJCIsImh0bWwiLCJyZW1vdmVDbGFzcyIsImFkZENsYXNzIiwiY2VudGVyIiwiZXh0ZW50IiwibGFuZyIsImRvY3VtZW50IiwiZG9jdW1lbnRFbGVtZW50Iiwic3R5bGVDYWNoZSIsImdlb0pTT05Gb3JtYXQiLCJmb3JtYXQiLCJHZW9KU09OIiwiZGVmYXVsdERhdGFQcm9qZWN0aW9uIiwiYmluZyIsIlRpbGUiLCJ2aXNpYmxlIiwic291cmNlIiwiQmluZ01hcHMiLCJpbWFnZXJ5U2V0IiwibWF4Wm9vbSIsImNyb3NzT3JpZ2luIiwicHJlbG9hZCIsIkluZmluaXR5IiwiaWQiLCJtYXBib3giLCJYWVoiLCJhdHRyaWJ1dGlvbnMiLCJBdHRyaWJ1dGlvbiIsInVybCIsInByb3BlcnR5U291cmNlIiwiVmVjdG9yIiwibG9hZGVyIiwicmVzb2x1dGlvbiIsInByb2plY3Rpb24iLCJzZWxmIiwiY2xlYXIiLCJhamF4IiwidHlwZSIsImJlZm9yZVNlbmQiLCJ4aHIiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwic2V0UmVxdWVzdEhlYWRlciIsImRhdGFUeXBlIiwiZGF0YSIsImRvbmUiLCJyZXNwb25zZSIsImZlYXR1cmVzIiwicmVhZEZlYXR1cmVzIiwiZmVhdHVyZVByb2plY3Rpb24iLCJhZGRGZWF0dXJlcyIsImZhaWwiLCJzdHJhdGVneSIsImxvYWRpbmdzdHJhdGVneSIsImFsbCIsInByb3BlcnR5Iiwic2V0WkluZGV4IiwiTWFwIiwidGFyZ2V0IiwibGF5ZXJzIiwibG9hZFRpbGVzV2hpbGVBbmltYXRpbmciLCJsb2FkVGlsZXNXaGlsZUludGVyYWN0aW5nIiwicmVuZGVyZXIiLCJjb250cm9scyIsImNvbnRyb2wiLCJkZWZhdWx0cyIsImF0dHJpYnV0aW9uT3B0aW9ucyIsImNvbGxhcHNpYmxlIiwiY29sbGFwc2VkIiwiZXh0ZW5kIiwiU2NhbGVMaW5lIiwidW5pdHMiLCJPdmVydmlld01hcCIsImNsYXNzTmFtZSIsIlpvb21Ub0V4dGVudCIsInZpZXciLCJWaWV3Iiwiem9vbSIsIm1pblpvb20iLCJzZXQiLCJDb2xsZWN0aW9uIiwiZHJhd25Qcm9wZXJ0aWVzIiwiZmlsbCIsIkZpbGwiLCJjb2xvciIsInN0cm9rZSIsIlN0cm9rZSIsIndpZHRoIiwiQ2lyY2xlIiwicmFkaXVzIiwiYWRkTGF5ZXIiLCJkcmF3IiwiaW50ZXJhY3Rpb24iLCJEcmF3IiwiZ2V0U291cmNlIiwiYWRkSW50ZXJhY3Rpb24iLCJzZXRBY3RpdmUiLCJzZWxlY3QiLCJTZWxlY3QiLCJ0cmFuc2xhdGUiLCJUcmFuc2xhdGUiLCJnZXRGZWF0dXJlcyIsIm9uIiwiY2xpY2siLCJ0b2FzdHIiLCJvcHRpb25zIiwicG9zaXRpb25DbGFzcyIsImluZm8iLCJ1biIsImV2ZW50IiwiZSIsImdldExlbmd0aCIsIm5ld2VzdE9uVG9wIiwicHJldmVudER1cGxpY2F0ZXMiLCJleHRlbmRlZFRpbWVPdXQiLCJ0aW1lT3V0IiwiY2xvc2VCdXR0b24iLCIkdG9hc3QiLCJ3YXJuaW5nIiwiZmluZCIsImxlbmd0aCIsImFsZXJ0IiwicmVtb3ZlIiwibG9jYXRpb24iLCJocmVmIl0sIm1hcHBpbmdzIjoiQUF3QkEsUUFBQUEsaUJBQ0EsR0FBQUMsRUFFQSxPQURBQSxHQUFBLHVDQUNBLEdBQUFDLElBQUFDLE1BQUFDLE9BQ0FDLE1BQUEsR0FBQUgsSUFBQUMsTUFBQUcsTUFDQUws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QSxhQUFBLFdBQ0FtQixNQUFBLGtCQUNBSixFQUFBSyxXQUdBTCxFQUFBRSxLQUFBLGFBQUFDLFFBQ0FILEVBQUFmLEdBQUEsUUFBQSxZQUFBLFdBQ0FtQixNQUFBLG9DQU1BMUgsRUFBQSxXQUFBd0csTUFBQSxXQUNBb0IsU0FBQUMsS0FBQSIsImZpbGUiOiJhZG1pbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgY2VudGVyID0gW1xuICAgIDM2NzczODUsIDQxMjA5NDlcbiAgXSxcbiAgZXh0ZW50ID0gW1xuICAgIDM1OTAwOTQsIDQxMDI4MzMsIDM4NTU0ODMsIDQyNjEyMTFcbiAgXSxcbiAgbGFuZyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nLFxuICBzdHlsZUNhY2hlID0ge30sXG4gIGdlb0pTT05Gb3JtYXQgPSBuZXcgb2wuZm9ybWF0Lkdlb0pTT04oe2RlZmF1bHREYXRhUHJvamVjdGlvbjogJ0VQU0c6NDMyNid9KTtcbnZhciBiaW5nID0gbmV3IG9sLmxheWVyLlRpbGUoe1xuICB2aXNpYmxlOiB0cnVlLFxuICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuQmluZ01hcHMoe2tleTogJ0FrMkdxOFZVZklDc1BwdWY3TFJBTlhtWHQyc0hXbVNMUGhvaG1WTEZ0RklFd1lqc181TUN5QWhBRndSU1ZwTGonLCBpbWFnZXJ5U2V0OiAnQWVyaWFsJ30pLFxuICBtYXhab29tOiAxOSxcbiAgY3Jvc3NPcmlnaW46ICdhbm9ueW1vdXMnLFxuICBwcmVsb2FkOiBJbmZpbml0eSxcbiAgaWQ6ICdiaW5nJ1xufSk7XG52YXIgbWFwYm94ID0gbmV3IG9sLmxheWVyLlRpbGUoe1xuICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuWFlaKHtcbiAgICBhdHRyaWJ1dGlvbnM6IFtuZXcgb2wuQXR0cmlidXRpb24oe2h0bWw6ICc8YSBocmVmPVxcXCJodHRwczovL3d3dy5tYXBib3guY29tL2Fib3V0L21hcHMvXFxcIiB0YXJnZXQ9XFxcIl9ibGFua1xcXCI+JmNvcHk7IE1hcGJveCAmY29weTsgT3BlblN0cmVldE1hcDwvYT4nfSldLFxuICAgIHVybDogJ2h0dHBzOi8vYXBpLm1hcGJveC5jb20vdjQvbWFwYm94LnN0cmVldHMve3p9L3t4fS97eX0ucG5nP2FjY2Vzc190b2tlbj1way5leUoxSWpvaVptbHlkbUZwYmlJc0ltRWlPaUpsT1dZeVlUTTBOVGhpTldNMFlqSmpPREpqTkRFNE9EUXpOekEyTUdReU5pSjkuLU5WRE8yN0h6dC13X25Rb3NVUGZMQSdcbiAgfSksXG4gIGlkOiAnbWFwYm94J1xufSk7XG5mdW5jdGlvbiBQcm9wZXJ0eVN0eWxlKCkge1xuICB2YXIgc3JjO1xuICBzcmMgPSAnLi4vaW1hZ2VzL21hcC1pY29ucy9waW5zLzQ4L3BpbjEucG5nJztcbiAgcmV0dXJuIG5ldyBvbC5zdHlsZS5TdHlsZSh7XG4gICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5JY29uKCh7XG4gICAgICBzcmM6IHNyYyxcbiAgICAgIGFuY2hvcjogW1xuICAgICAgICAwLjUsIDFcbiAgICAgIF0sXG4gICAgICBzY2FsZTogMC43XG4gICAgfSkpXG4gIH0pO1xufVxudmFyIHByb3BlcnR5U291cmNlID0gbmV3IG9sLnNvdXJjZS5WZWN0b3Ioe1xuICBmb3JtYXQ6IGdlb0pTT05Gb3JtYXQsXG4gIGxvYWRlcjogZnVuY3Rpb24oZXh0ZW50LCByZXNvbHV0aW9uLCBwcm9qZWN0aW9uKSB7XG4gICAgdmFyIHVybCA9ICdodHRwOi8vbG9jYWxob3N0OjMwMDAvZGIvYWRtaW4nO1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB0aGlzLmNsZWFyKCk7XG4gICAgJC5hamF4KHtcbiAgICAgIHVybDogdXJsLFxuICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgJ2JlZm9yZVNlbmQnOiBmdW5jdGlvbih4aHIpIHtcbiAgICAgICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKSkge1xuICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdBdXRob3JpemF0aW9uJywgJ0JlYXJlciAnICsgbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGlkOiBpZFxuICAgICAgfVxuICAgIH0pLmRvbmUoZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgIHZhciBmZWF0dXJlcyA9IGdlb0pTT05Gb3JtYXQucmVhZEZlYXR1cmVzKHJlc3BvbnNlLCB7ZmVhdHVyZVByb2plY3Rpb246ICdFUFNHOjM4NTcnfSk7XG4gICAgICBzZWxmLmFkZEZlYXR1cmVzKGZlYXR1cmVzKTtcbiAgICB9KS5mYWlsKGZ1bmN0aW9uKCkge1xuICAgICAgY29uc29sZS5sb2coJ2Vycm9yJyk7XG4gICAgfSk7XG4gIH0sXG4gIHN0cmF0ZWd5OiBvbC5sb2FkaW5nc3RyYXRlZ3kuYWxsXG59KTtcbnZhciBwcm9wZXJ0eSA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe3NvdXJjZTogcHJvcGVydHlTb3VyY2UsIGlkOiAncHJvcGVydHknLCB2aXNpYmxlOiB0cnVlLCBzdHlsZTogUHJvcGVydHlTdHlsZSgpfSk7XG5wcm9wZXJ0eS5zZXRaSW5kZXgoMik7XG52YXIgbWFwID0gbmV3IG9sLk1hcCh7XG4gIHRhcmdldDogJ2FkbWluTWFwJyxcbiAgbGF5ZXJzOiBbXG4gICAgbWFwYm94LCBwcm9wZXJ0eVxuICBdLFxuICBsb2FkVGlsZXNXaGlsZUFuaW1hdGluZzogdHJ1ZSxcbiAgbG9hZFRpbGVzV2hpbGVJbnRlcmFjdGluZzogdHJ1ZSxcbiAgcmVuZGVyZXI6ICdjYW52YXMnLFxuICBjb250cm9sczogb2wuY29udHJvbC5kZWZhdWx0cyh7XG4gICAgYXR0cmlidXRpb25PcHRpb25zOiB7XG4gICAgICBjb2xsYXBzaWJsZTogZmFsc2UsXG4gICAgICBjb2xsYXBzZWQ6IGZhbHNlXG4gICAgfVxuICB9KS5leHRlbmQoW1xuICAgIG5ldyBvbC5jb250cm9sLlNjYWxlTGluZSh7dW5pdHM6ICdtZXRyaWMnfSksXG4gICAgbmV3IG9sLmNvbnRyb2wuT3ZlcnZpZXdNYXAoe2NsYXNzTmFtZTogJ29sLW92ZXJ2aWV3bWFwIG9sLWN1c3RvbS1vdmVydmlld21hcCcsIGNvbGxhcHNpYmxlOiB0cnVlLCBjb2xsYXBzZWQ6IHRydWUsIGxheWVyczogW2JpbmddfSksXG4gICAgbmV3IG9sLmNvbnRyb2wuWm9vbVRvRXh0ZW50KHtleHRlbnQ6IGV4dGVudH0pXG4gIF0pLFxuICB2aWV3OiBuZXcgb2wuVmlldyh7XG4gICAgY2VudGVyOiBjZW50ZXIsXG4gICAgLy8gZXh0ZW50OiBleHRlbnQsXG4gICAgcHJvamVjdGlvbjogJ0VQU0c6Mzg1NycsXG4gICAgem9vbTogMTQsXG4gICAgbWF4Wm9vbTogMTksXG4gICAgbWluWm9vbTogMTBcbiAgfSlcbn0pO1xuaWYgKGxhbmcgPT09ICdlbCcpIHtcbiAgYmluZy5zZXQoJ25hbWUnLCAnzpTOv8+Bz4XPhs6/z4HOuc66zq4gzrXOuc66z4zOvc6xJyk7XG4gIG1hcGJveC5zZXQoJ25hbWUnLCAnzqfOrM+Bz4TOt8+CJyk7XG4gIHByb3BlcnR5LnNldCgnbmFtZScsICfOkc66zq/Ovc63z4TOsScpO1xufSBlbHNlIHtcbiAgYmluZy5zZXQoJ25hbWUnLCAnU2F0dGVsaXRlIEltYWdlJyk7XG4gIG1hcGJveC5zZXQoJ25hbWUnLCAnTWFwJyk7XG4gIHByb3BlcnR5LnNldCgnbmFtZScsICdQcm9wZXJ0aWVzJyk7XG59XG4vLz09PT09PSBpbnRlcmFjdGlvbnMgPT09PT09XG52YXIgZmVhdHVyZXMgPSBuZXcgb2wuQ29sbGVjdGlvbigpO1xudmFyIGRyYXduUHJvcGVydGllcyA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xuICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuVmVjdG9yKCksXG4gIHN0eWxlOiBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtjb2xvcjogJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC4yKSd9KSxcbiAgICBzdHJva2U6IG5ldyBvbC5zdHlsZS5TdHJva2Uoe2NvbG9yOiAnI2ZmY2MzMycsIHdpZHRoOiAyfSksXG4gICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5DaXJjbGUoe1xuICAgICAgcmFkaXVzOiA3LFxuICAgICAgZmlsbDogbmV3IG9sLnN0eWxlLkZpbGwoe2NvbG9yOiAnI2ZmY2MzMyd9KVxuICAgIH0pXG4gIH0pLFxuICBpZDogJ2RyYXduUHJvcGVydGllcydcbn0pO1xubWFwLmFkZExheWVyKGRyYXduUHJvcGVydGllcyk7XG4vL2RyYXdcbnZhciBkcmF3ID0gbmV3IG9sLmludGVyYWN0aW9uLkRyYXcoe1xuICAvLyBmZWF0dXJlczogZmVhdHVyZXMsXG4gIHNvdXJjZTogZHJhd25Qcm9wZXJ0aWVzLmdldFNvdXJjZSgpLFxuICB0eXBlOiAnUG9pbnQnLFxuICBzdHlsZTogbmV3IG9sLnN0eWxlLlN0eWxlKHtcbiAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7Y29sb3I6ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMiknfSksXG4gICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtjb2xvcjogJyNmZmNjMzMnLCB3aWR0aDogMn0pLFxuICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuQ2lyY2xlKHtcbiAgICAgIHJhZGl1czogNyxcbiAgICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtjb2xvcjogJyNmZmNjMzMnfSlcbiAgICB9KVxuICB9KVxufSk7XG5tYXAuYWRkSW50ZXJhY3Rpb24oZHJhdyk7XG5kcmF3LnNldEFjdGl2ZShmYWxzZSk7XG4vL3NlbGVjdFxudmFyIHNlbGVjdCA9IG5ldyBvbC5pbnRlcmFjdGlvbi5TZWxlY3Qoe1xuICBsYXllcnM6IFtwcm9wZXJ0eV0sXG4gIGZlYXR1cmVzOiBmZWF0dXJlcyxcbiAgc3R5bGU6IG5ldyBvbC5zdHlsZS5TdHlsZSh7XG4gICAgZmlsbDogbmV3IG9sLnN0eWxlLkZpbGwoe2NvbG9yOiAncmdiYSgyNTUsIDAsIDAsIDAuMiknfSksXG4gICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtjb2xvcjogJyNGRjAwMDAzJywgd2lkdGg6IDJ9KSxcbiAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkNpcmNsZSh7XG4gICAgICByYWRpdXM6IDcsXG4gICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7Y29sb3I6ICcjRkYwMDAwJ30pXG4gICAgfSlcbiAgfSlcbn0pO1xubWFwLmFkZEludGVyYWN0aW9uKHNlbGVjdCk7XG5zZWxlY3Quc2V0QWN0aXZlKGZhbHNlKTtcbi8vdHJhbnNsYXRlKG1vdmUpXG52YXIgdHJhbnNsYXRlID0gbmV3IG9sLmludGVyYWN0aW9uLlRyYW5zbGF0ZSh7ZmVhdHVyZXM6IHNlbGVjdC5nZXRGZWF0dXJlcygpfSk7XG4vLz09PT09PSBpbmZvID09PT09PVxubWFwLm9uKCdjbGljaycsIGNsaWNrSW5mbyk7XG5mdW5jdGlvbiBjbGlja0luZm8oZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICB2YXIgb2JqID0ge307XG4gIHZhciBjbGlja2VkRmVhdHVyZSA9IG1hcC5mb3JFYWNoRmVhdHVyZUF0UGl4ZWwoZXZ0LnBpeGVsLCBmdW5jdGlvbihmZWF0dXJlLCBsYXllcikge1xuICAgIHJldHVybiB7ZmVhdHVyZTogZmVhdHVyZSwgbGF5ZXI6IGxheWVyfTtcbiAgfSwgdGhpcywgZnVuY3Rpb24obGF5ZXIpIHtcbiAgICBpZiAobGF5ZXIuZ2V0KCdpZCcpID09PSAncHJvcGVydHknKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH0sIHRoaXMpO1xuICBjb25zb2xlLmxvZyhjbGlja2VkRmVhdHVyZSk7XG4gIGlmIChjbGlja2VkRmVhdHVyZSkge1xuICAgIG9iai5mZWF0dXJlID0ge307XG4gICAgY2xpY2tlZEZlYXR1cmUuZmVhdHVyZS5nZXRLZXlzKCkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICAgIG9iai5mZWF0dXJlW2tleV0gPSBjbGlja2VkRmVhdHVyZS5mZWF0dXJlLmdldChrZXkpO1xuICAgIH0pO1xuICAgIGNvbnNvbGUubG9nKG9iaik7XG4gICAgZHVzdC5yZW5kZXIoJ2FkbWluRXN0YXRlSW5mby5kdXN0Jywgb2JqLCBmdW5jdGlvbihlcnIsIG91dCkge1xuICAgICAgY29uc29sZS5sb2cob3V0KTtcbiAgICAgICQoJy5wcm9wZXJ0eS1pbmZvJykuaHRtbChvdXQpO1xuICAgICAgJCgnLnByb3BlcnR5LWluZm8nKS5yZW1vdmVDbGFzcygndmlzdWFsbHloaWRkZW4nKTtcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICAkKCcucHJvcGVydHktaW5mbycpLmFkZENsYXNzKCd2aXN1YWxseWhpZGRlbicpO1xuICB9XG59XG4vLz09PT09PSBpbnNlcnQgPT09PT09XG4kKCcjaW5zZXJ0UHJvcGVydHknKS5jbGljayhmdW5jdGlvbigpIHtcbiAgJCgnLnByb3BlcnR5LWluZm8nKS5hZGRDbGFzcygndmlzdWFsbHloaWRkZW4nKTtcbiAgdG9hc3RyLm9wdGlvbnMgPSB7XG4gICAgXCJwb3NpdGlvbkNsYXNzXCI6IFwidG9hc3QtdG9wLWNlbnRlclwiXG4gIH07XG4gIHRvYXN0ci5pbmZvKCdBZGQgTmV3IFByb3BlcnR5Jyk7XG4gIG1hcC51bignY2xpY2snLCBjbGlja0luZm8pO1xuICBzZWxlY3Quc2V0QWN0aXZlKGZhbHNlKTtcbiAgZHJhdy5zZXRBY3RpdmUodHJ1ZSk7XG4gIGRyYXcub24oJ2RyYXdlbmQnLCBmdW5jdGlvbihldnQpIHtcbiAgICBkcmF3LnNldEFjdGl2ZShmYWxzZSk7XG4gIH0pO1xufSk7XG4vLz09PT09PSBkZWxldGUgPT09PT09XG4kKCcjZGVsZXRlUHJvcGVydHknKS5jbGljayhmdW5jdGlvbihldmVudCkge1xuICAkKCcucHJvcGVydHktaW5mbycpLmFkZENsYXNzKCd2aXN1YWxseWhpZGRlbicpO1xuICB0b2FzdHIub3B0aW9ucyA9IHtcbiAgICBcInBvc2l0aW9uQ2xhc3NcIjogXCJ0b2FzdC10b3AtY2VudGVyXCJcbiAgfTtcbiAgdG9hc3RyLmluZm8oJ0RlbGV0ZSBQcm9wZXJ0eScpO1xuICBtYXAudW4oJ2NsaWNrJywgY2xpY2tJbmZvKTtcbiAgZHJhdy5zZXRBY3RpdmUoZmFsc2UpO1xuICBmZWF0dXJlcy5jbGVhcigpO1xuICBzZWxlY3Quc2V0QWN0aXZlKHRydWUpO1xuICBzZWxlY3Qub24oJ3NlbGVjdCcsIGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuZ2V0RmVhdHVyZXMoKS5nZXRMZW5ndGgoKSA9PT0gMSkge1xuICAgICAgdG9hc3RyLm9wdGlvbnMubmV3ZXN0T25Ub3AgPSB0cnVlO1xuICAgICAgdG9hc3RyLm9wdGlvbnMucHJldmVudER1cGxpY2F0ZXMgPSB0cnVlO1xuICAgICAgdG9hc3RyLm9wdGlvbnMuZXh0ZW5kZWRUaW1lT3V0ID0gMDtcbiAgICAgIHRvYXN0ci5vcHRpb25zLnRpbWVPdXQgPSAwO1xuICAgICAgdG9hc3RyLm9wdGlvbnMuY2xvc2VCdXR0b24gPSB0cnVlO1xuICAgICAgdmFyICR0b2FzdCA9IHRvYXN0ci53YXJuaW5nKCc8cD5BcmUgeW91IHN1cmU/PC9wPjxkaXYgY2xhc3M9XCJ0b2FzdHItYnRuc1wiPjxidXR0b24gaWQ9XCJ5ZXNEZWxldGVcIiBjbGFzcz1cIm1kbC1idXR0b24gbWRsLWpzLWJ1dHRvbiBcIj5ZZXM8L2J1dHRvbj48YnV0dG9uIGlkPVwibm9EZWxldGVcIiBjbGFzcz1cIm1kbC1idXR0b24gbWRsLWpzLWJ1dHRvblwiPk5vPC9idXR0b24+PC9kaXY+Jyk7XG4gICAgICBpZiAoJHRvYXN0LmZpbmQoJyN5ZXNEZWxldGUnKS5sZW5ndGgpIHtcbiAgICAgICAgJHRvYXN0Lm9uKCdjbGljaycsICcjeWVzRGVsZXRlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgYWxlcnQoJ3lvdSBjbGlja2VkIG9rJyk7XG4gICAgICAgICAgJHRvYXN0LnJlbW92ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmICgkdG9hc3QuZmluZCgnI25vRGVsZXRlJykubGVuZ3RoKSB7XG4gICAgICAgICR0b2FzdC5vbignY2xpY2snLCAnI25vRGVsZXRlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgYWxlcnQoJ1N1cnByaXNlISB5b3UgY2xpY2tlZCBtZS4nKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn0pO1xuJCgnI2xvZ291dCcpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICBsb2NhdGlvbi5ocmVmID0gJy9tYXAvbG9nb3V0Jztcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
