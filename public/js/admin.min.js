(function () {

  if ( typeof window.CustomEvent === "function" ) return false;

  function CustomEvent ( event, params ) {
    params = params || { bubbles: false, cancelable: false, detail: undefined };
    var evt = document.createEvent( 'CustomEvent' );
    evt.initCustomEvent( event, params.bubbles, params.cancelable, params.detail );
    return evt;
   }

  CustomEvent.prototype = window.Event.prototype;

  window.CustomEvent = CustomEvent;
})();

  (function () {
    if (!Element.prototype.scrollIntoViewIfNeeded) {
      Element.prototype.scrollIntoViewIfNeeded = function (centerIfNeeded) {
        centerIfNeeded = arguments.length === 0 ? true : !!centerIfNeeded;

        var parent = this.parentNode,
        parentComputedStyle = window.getComputedStyle(parent, null),
        parentBorderTopWidth = parseInt(parentComputedStyle.getPropertyValue('border-top-width')),
        parentBorderLeftWidth = parseInt(parentComputedStyle.getPropertyValue('border-left-width')),
        overTop = this.offsetTop - parent.offsetTop < parent.scrollTop,
        overBottom = (this.offsetTop - parent.offsetTop + this.clientHeight - parentBorderTopWidth) > (parent.scrollTop + parent.clientHeight),
        overLeft = this.offsetLeft - parent.offsetLeft < parent.scrollLeft,
        overRight = (this.offsetLeft - parent.offsetLeft + this.clientWidth - parentBorderLeftWidth) > (parent.scrollLeft + parent.clientWidth),
        alignWithTop = overTop && !overBottom;

        if ((overTop || overBottom) && centerIfNeeded) {
          parent.scrollTop = this.offsetTop - parent.offsetTop - parent.clientHeight / 2 - parentBorderTopWidth + this.clientHeight / 2;
        }

        if ((overLeft || overRight) && centerIfNeeded) {
          parent.scrollLeft = this.offsetLeft - parent.offsetLeft - parent.clientWidth / 2 - parentBorderLeftWidth + this.clientWidth / 2;
        }

        if ((overTop || overBottom || overLeft || overRight) && !centerIfNeeded) {
          this.scrollIntoView(alignWithTop);
        }
      };
    }
  })();

window.App || (window.App = {});
window.App.config = {
  promises: {
    dustBluebird: Promise.promisifyAll(dust),
    cloudinaryBird: Promise.promisifyAll($.cloudinary)
  },
  commons: {
    map: {},
    trans: {}
  },
  cache: {
    activeEstate: {},
    activeEstateListing: {}
  },
  modules: {
    map: {},
    info: {},
    edit: {}
  }
};
window.App.utils = {};
// var trans;
// var cloudinaryBird = Promise.promisifyAll($.cloudinary);
// var activeEstate;
// var activeEstateListing;
$.cloudinary.config({ cloud_name: 'firvain', api_key: '375138932689591' });

App.utils = {
  findById: function findById(map, id) {
    var layers = map.getLayers();
    var length = layers.getLength();
    for (var i = 0; i < length; i++) {
      if (id === layers.item(i).get('id')) {
        return layers.item(i);
      }
    }
    return null;
  },
  findByName: function findByName(map, name) {
    var layers = map.getLayers();
    var length = layers.getLength();
    for (var i = 0; i < length; i++) {
      if (name === layers.item(i).get('name')) {
        return layers.item(i);
      }
    }
    return null;
  },
  preventDotAndSpace: function preventDotAndSpace(e) {
    var key = e.charCode ? e.charCode : e.keyCode;
    this.innerHTML = key;
    if (key === 46 || key === 32) {
      return false;
    }
    return true;
  },
  geometryFunction: function geometryFunction(coordinates, geometry) {
    var geom = geometry;
    var start;
    var end;
    if (!geom) {
      geom = new ol.geom.Polygon(null);
    }
    start = coordinates[0];
    end = coordinates[1];
    geom.setCoordinates([
      [start, [start[0], end[1]], end, [end[0], start[1]], start]
      ]);
    return geom;
  },
  hasClass: function hasClass(el, className) {
    if (el.classList) {
      return el.classList.contains(className);
    }
    return new RegExp('(^| )' + className + '( |$)', 'gi').test(el.className);
  },
  removeClass: function removeClass(el, className) {
    var element = el;
    if (element.classList) {
      element.classList.remove(className);
    } else {
      element.className = element.className.replace(new RegExp('(^|\\b)' + className.split(' ').join('|') + '(\\b|$)', 'gi'), ' ');
    }
  },
  addClass: function removeClass(el, className) {
    var element = el;
    if (element.classList) {
      element.classList.add(className);
    } else {
      element.className += ' ' + className;
    }
  },
  requestFullScreen: function requestFullScreen(element) {
    // Supports most browsers and their versions.
    var requestMethod = element.requestFullScreen || element.webkitRequestFullScreen || element.mozRequestFullScreen || element.msRequestFullScreen;
    var wscript;
    if (requestMethod) { // Native full screen.
      requestMethod.call(element);
    } else if (typeof window.ActiveXObject !== 'undefined') { // Older IE.
      wscript = new ActiveXObject('WScript.Shell');
      if (wscript !== null) {
        wscript.SendKeys('{F11}');
      }
    }
  },
  exitFullsreen: function exitFullsreen(element) {
    var requestMethod = element.exitFullScreen || element.webkitExitFullscreen || element.mozCancelFullScreen || element.msExitFullscreen;
    var wscript;
    if (requestMethod) { // Native full screen.
      requestMethod.call(element);
    } else if (typeof window.ActiveXObject !== 'undefined') { // Older IE.
      wscript = new ActiveXObject('WScript.Shell');
      if (wscript !== null) {
        wscript.SendKeys('{Esc}');
      }
    }
  }
  // zoomToGid: function zoomToGid(map, gid) {
  //   var coordinates = utils.findById(map, 'filteredEstates').getSource().getFeatureById(gid)
  //   .getGeometry()
  //   .getCoordinates();
  //   map.getView().setCenter(coordinates);
  // }
};

App.config.modules.map = (function (window, document, undefined, Promise, ol, App) {
  'use strict';
  var center = [3677385, 4120949];
  var extent = [3652772, 4112808, 3700000, 4132797];
  var geoJSONFormat = new ol.format.GeoJSON({
    defaultDataProjection: 'EPSG:4326'
  });

  var mapStyles = {
    iconType: function getIconType(estateType) {
      var iconType = {
        Apartment: function getApartmentIcon() {
          return 'apartment';
        },
        Store: function getStoreIcon() {
          return 'store';
        },
        'Detached House': function getDetachedHouseIcon() {
          return 'detached';
        },
        Maisonette: function getMaisonetteIcon() {
          return 'maisonette';
        },
        Villa: function getVillaIon() {
          return 'villa';
        }
      };
      return (iconType[estateType])();
    },
    estates: function estates(feature) {
      var src = './images/pins/none/' +
      mapStyles.iconType(feature.get('estatetype_en')) + '-48.png';
      return new ol.style.Style({
        geometry: feature.getGeometry(),
        image: new ol.style.Icon(({
          src: src,
          anchorOrigin: 'bottom-left',
          anchor: [0.5, 0],
          scale: 1
        }))
      });
    }
  };

  var mapSources = {
    bing: function bing() {
      return new ol.source.BingMaps({
        key: 'Ak2Gq8VUfICsPpuf7LRANXmXt2sHWmSLPhohmVLFtFIEwYjs_5MCyAhAFwRSVpLj',
        imagerySet: 'AerialWithLabels'
      });
    },
    mapBox: function mapBox() {
      return new ol.source.XYZ({
        attributions: [new ol.Attribution({
          html: '<a href="https://www.mapbox.com/about/maps/" target="_blank">&copy; Mapbox &copy; OpenStreetMap</a>'
        })],
        url: 'https://api.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZmlydmFpbiIsImEiOiJlOWYyYTM0NThiNWM0YjJjODJjNDE4ODQzNzA2MGQyNiJ9.-NVDO27Hzt-w_nQosUPfLA'
      });
    },
    estates: function estates() {
      return new ol.source.Vector({
        format: geoJSONFormat,
        loader: function propertyLoader() {
          var url = 'http://127.0.0.1:3000/api/property/all/' + id;
          var self = this;
          Promise.resolve(
            $.ajax({
              url: url,
              type: 'GET',
              dataType: 'json'
            })
          )
          .then(function resolve(data) {
            var features = geoJSONFormat.readFeatures(data, {
              featureProjection: 'EPSG:3857'
            });
            self.addFeatures(features);
          })
          .catch(function error(e) {
            console.log(e);
            if (e.status === 404) {
              toastr.error('Sorry, we cannot find any properties!');
            } else if (e.status === 503) {
              toastr.error('Service Unavailable!');
            } else {
              toastr.error('Internal Server Error! Please reload page or try again later');
            }
          });
        }
      });
    }
  };

  var mapLayers = {
    bing: function bing(trans) {
      return new ol.layer.Tile({
        visible: true,
        source: mapSources.bing(),
        maxZoom: 19,
        crossOrigin: 'anonymous',
        preload: Infinity,
        id: 'bing',
        name: trans.layers.bing
      });
    },
    mapBox: function mapBox(trans) {
      return new ol.layer.Tile({
        source: mapSources.mapBox(),
        id: 'mapbox',
        name: trans.layers.mapBox
      });
    },
    estates: function estates(trans){
      return new ol.layer.Vector({
        source: mapSources.estates(),
        id: 'estates',
        visible: true,
        style: mapStyles.estates
      });
    }
  };
  var initialize = function initialize() {
    var trans = App.config.commons.trans;
    var layers = Object.keys(mapLayers).map(function addMapLayers(key) {
      if (key !== 'bing') { return mapLayers[key](trans); }
      return null;
    });
    return new ol.Map({
      target: 'map',
      layers: _.compact(layers),
      loadTilesWhileAnimating: true,
      loadTilesWhileInteracting: true,
      renderer: 'canvas',
      controls: ol.control.defaults({
        attributionOptions: {
          collapsible: false,
          collapsed: false
        }
      })
       .extend([
         new ol.control.ScaleLine({
           units: 'metric'
         }), new ol.control.OverviewMap({
           className: 'ol-overviewmap ol-custom-overviewmap',
           collapsible: true,
           collapsed: true,
           layers: [mapLayers.bing(trans)]
         }),
         new ol.control.ZoomToExtent({
           extent: extent
         })
       ]),
      view: new ol.View({
        center: center,
        extent: extent,
        projection: 'EPSG:3857',
        zoom: 14,
        maxZoom: 19,
        minZoom: 14
      })
    });
  };
  return {
    initialize: initialize
  };
}(window, document, undefined, Promise, ol, App));

App.config.modules.info = (function info(window, document, Promise, $, App) {
  'use strict';
  var geoJSONFormat = new ol.format.GeoJSON({
    defaultDataProjection: 'EPSG:4326'
  });
  var lang = document.documentElement.lang;
  var editButton = document.querySelector('#edit');
  var infoBoxContent = document.querySelector('#infobox-content');
  var dustBluebird = App.config.promises.dustBluebird;
  var utils = App.utils;
  function dustEstateInfo(data) {
    dustBluebird.renderAsync('edit', data)
    .then(function resolveDust(result) {
      utils.removeClass(infoBoxContent, 'visuallyhidden');
      infoBoxContent.innerHTML = result;
      getmdlSelect.init('.getmdl-select');
    })
    .catch(function error(e) {
      console.log(e);
    });
  }
  function selectFeature(evt) {
    var map = evt.map;
    var coordinates;
    var estate;
    var gid;
    var renderData = App.config.commons.trans;
    // var coordinate = evt.coordinate;
    var clickedFeature = map.forEachFeatureAtPixel(evt.pixel, function findFeature(feature, layer) {
      return {
        feature: feature,
        layer: layer
      };
    }, this, function clickedFeatureLayerFilter(layer) {
      if (layer.get('id') === 'estates') {
        return true;
      }
      return false;
    }, this);
    if (clickedFeature) {
      estate = clickedFeature.feature;
      coordinates = estate.getGeometry().getCoordinates();
      map.getView().setCenter(coordinates);
      map.getView().setZoom(16);
      gid = estate.getProperties().gid;
      utils.removeClass(editButton, 'mdl-button--accent');
      utils.removeClass(editButton, 'mdl-button--raised');
      var p1 = Promise.resolve(
        $.ajax({
          url: 'http://127.0.0.1:3000/api/property',
          type: 'GET',
          data: {
            gid: gid
          }
        })
      );
      p1.then(function resolve(data) {
        var feature = data.features[0];
        App.config.cache.activeEstate = feature.properties;
        return feature;
      })
      .then(function resolve(feature) {
        if (lang === 'el') {
          renderData.values = {
            gid: feature.properties.gid,
            estateType: feature.properties.estatetype,
            address: feature.properties.street_el,
            addressNumber: feature.properties.street_number,
            pscode: feature.properties.ps_code,
            estateArea: feature.properties.estatearea,
            bedrooms: feature.properties.bedrooms,
            floor: feature.properties.floor,
            year: feature.properties.year,
            plotArea: feature.properties.plotarea,
            parcelNumber: feature.properties.parcel_num,
            parking: feature.properties.parking,
            furnished: feature.properties.furnished,
            isnew: feature.properties.isnew,
            heating: feature.properties.heating,
            cooling: feature.properties.cooling,
            view: feature.properties.view,
            title: feature.properties.title
          };
        } else {
          renderData.values = {
            gid: feature.properties.gid,
            estateType: feature.properties.estatetype_en,
            address: feature.properties.street_en,
            addressNumber: feature.properties.street_number,
            pscode: feature.properties.ps_code,
            estateArea: feature.properties.estatearea,
            bedrooms: feature.properties.bedrooms,
            floor: feature.properties.floor,
            year: feature.properties.year,
            plotArea: feature.properties.plotarea,
            parcelNumber: feature.properties.parcel_num,
            parking: feature.properties.parking,
            furnished: feature.properties.furnished,
            isnew: feature.properties.isnew,
            heating: feature.properties.heating,
            cooling: feature.properties.cooling,
            view: feature.properties.view,
            title: feature.properties.title
          };
        }
      });
      p1.catch(function error(e) {
        console.log(e);
      });
      var p2 = Promise.resolve(
        $.ajax({
          url: 'http://127.0.0.1:3000/api/listing',
          type: 'GET',
          data: {
            gid: gid
          }
        })
      )
      .then(function resolve(data) {
        App.config.cache.activeEstateListing = data;
        renderData.listing.values = data;
        renderData.listing.exists = true;
      })
      .catch(function error(e) {
        console.log(e);

        if (e.status === 404) {
          renderData.listing.values = {};
          renderData.listing.exists = false;
        }
      });
      Promise.each([p1, p2], function e() {
      })
      .then(function resolve() {
        dustEstateInfo(renderData);
        editButton.removeAttribute('disabled');
        utils.addClass(editButton, 'mdl-button--accent');
      })
      .catch(function error(e) {
        console.log(e);
      });
    } else {
      infoBoxContent.innerHTML = '';
      utils.addClass(infoBoxContent, 'visuallyhidden');
      editButton.setAttribute('disabled', true);
      utils.removeClass(editButton, 'mdl-button--accent');
      utils.removeClass(editButton, 'mdl-button--raised');
    }
  }

  function init() {
    var map = App.config.commons.map;
    map.on('click', selectFeature);
  }
  function disable() {
    var map = App.config.commons.map;
    map.un('click', selectFeature);
  }
  return {
    init: init,
    disable: disable
  };
}(window, document, Promise, jQuery, App));

App.config.modules.edit = (function edit(window, document, Promise, $, dPick, moment) {
  'use strict';
  var editButton = document.querySelector('#edit');
  var infoBoxContent = document.querySelector('#infobox-content');
  var lang = document.documentElement.lang;
  var map = App.config.commons.map;
  var info = App.config.modules.info;
  var utils = App.utils;
  function datePicker() {
    var format = (lang === 'el') ? 'DD-MM-YYYY' : 'MM-DD-YYYY';
    var dateStartPicker;
    var dateEndPicker;
    var dateStart = document.getElementById('listing-date--start__toggle');
    var dateEnd = document.getElementById('listing-date--end__toggle');
    var dateStartInput = document.getElementById('listing-date--start');
    var dateEndInput = document.getElementById('listing-date--end');
    var observeDatePicker = new MutationObserver(function observeDatePicker(mutations) {
      var attributeValue;
      mutations.forEach(function foerEachMutation(mutation) {
        if (mutation.attributeName === 'class') {
          attributeValue = $(mutation.target).prop(mutation.attributeName);
          if (attributeValue.indexOf('mddtp-picker--inactive') > -1) {
            info.init();
          } else {
            info.disable();
          }
        }
      });
    });

    if (dateStartInput !== null) {
      dateStartPicker = new dPick.default({
        type: 'date',
        init: moment(dateStartInput.value, format),
        future: moment().add(5, 'years'),
        trigger: dateStartInput,
        orientation: 'PORTRAIT'
      });
      observeDatePicker.observe(document.getElementById('mddtp-picker__date'), {
        attributes: true
      });
      dateStartInput.addEventListener('onOk', function displayPickedate() {
        this.value = dateStartPicker.time.format(format).toString();
      });
      dateStart.addEventListener('click', function showDatePicker(e) {
        dateStartPicker.toggle();
      });
    }
    if (dateEndInput !== null) {
      dateEndInput.addEventListener('onOk', function displayPickedate() {
        this.value = dateEndPicker.time.format(format).toString();
      });
      dateEndPicker = new dPick.default({
        type: 'date',
        init: moment(dateEndInput.value, format),
        future: moment().add(5, 'years'),
        trigger: dateEndInput,
        orientation: 'PORTRAIT'
      });
      observeDatePicker.observe(document.getElementById('mddtp-picker__date'), {
        attributes: true
      });
      dateEnd.addEventListener('click', function showDatePicker(e) {
        dateEndPicker.toggle();
      });
    }
  }
  function enableEdit() {
    var inputs = infoBoxContent.querySelectorAll('input');
    var labels = infoBoxContent.querySelectorAll('label');
    var buttons = infoBoxContent.querySelectorAll('button');
    var editCloseButton = document.querySelector('.close');
    [].forEach.call(inputs, function removeDisabledInputs(el) {
      if (!utils.hasClass(el, 'not-edditable')) {
        el.removeAttribute('disabled');
      }
    });
    [].forEach.call(labels, function removeDisabledLabels(el) {
      utils.removeClass(el, 'is-disabled');
    });
    [].forEach.call(buttons, function removeDisabledLabels(el) {
      el.removeAttribute('disabled');
    });
    utils.addClass(editButton, 'mdl-button--raised');
    utils.removeClass(document.querySelector('#edit-actions'), 'visuallyhidden');
    editCloseButton.addEventListener('click', function cancelEdit() {
      infoBoxContent.innerHTML = '';
      utils.addClass(infoBoxContent, 'visuallyhidden');
      editButton.setAttribute('disabled', true);
      utils.removeClass(editButton, 'mdl-button--accent');
      utils.removeClass(editButton, 'mdl-button--raised');
    });
    datePicker();
  }

  function init() {
    editButton.addEventListener('click', function addClickEventToEditButton() {
      enableEdit();
    });
  }

  return {
    init: init
  };
}(window, document, Promise, $, mdDateTimePicker, moment, App));

var userMap = (function userMap(window, document, Promise, $, App) {
  'use strict';
  var context = 'admin';
  var lang = document.documentElement.lang;
  var $loading = $('.mdl-spinner');
  $(document)
  .ajaxStart(function start() {
    $('.spiner-wrapper').removeClass('visuallyhidden');
    $loading.addClass('is-active');
  })
  .ajaxStop(function stop() {
    $('.spiner-wrapper').addClass('visuallyhidden');
    $loading.removeClass('is-active');
  });
  toastr.options = {
    closeButton: false,
    debug: false,
    newestOnTop: false,
    progressBar: false,
    positionClass: 'toast-top-center',
    preventDuplicates: false,
    onclick: null,
    showDuration: '300',
    hideDuration: '1000',
    timeOut: '5000',
    extendedTimeOut: '1000',
    showEasing: 'swing',
    hideEasing: 'linear',
    showMethod: 'fadeIn',
    hideMethod: 'fadeOut'
  };
  function init() {
    Promise.resolve(
      $.ajax({
        url: 'http://127.0.0.1:3000/api/language',
        type: 'GET',
        data: {
          type: lang,
          context: context
        }
      })
      )
    .then(function resolve(data) {
      App.config.commons.trans = data;
      App.config.commons.map = App.config.modules.map.initialize();
    })
    .then(function resolve() {
      App.config.modules.info.init();
      App.config.modules.edit.init();
    })
    .catch(function error(e) {
      console.log(e);
    });
  }
  return {
    init: init
  };
}(window, document, Promise, jQuery, App));

var utils = window.App.utils;
userMap.init();
$('#logout').click(function logout() {
  location.href = '/logout';
});
document.getElementById('enter-fullscreen').addEventListener('click',
  function addClickEventToEnterFullsreen() {
    var elem = document.body;
    utils.requestFullScreen(elem);
    utils.removeClass(document.getElementById('exit-fullscreen').parentNode, 'visuallyhidden');
    utils.addClass(this.parentNode, 'visuallyhidden');
  }
);
document.getElementById('exit-fullscreen').addEventListener('click',
  function addClickEventToExitFullsreen() {
    var elem = document;
    utils.exitFullsreen(elem);
    utils.removeClass(document.getElementById('enter-fullscreen').parentNode, 'visuallyhidden');
    utils.addClass(this.parentNode, 'visuallyhidden');
  }
);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkN1c3RvbUV2ZW50LmpzIiwic2Nyb2xsSW50b1ZpZXdJZk5lZWRlZC5qcyIsImdsb2JhbHMuanMiLCJ1dGlscy5qcyIsIm9sMy1tYXAuanMiLCJpbmZvLmpzIiwiZWRpdC5qcyIsImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25LQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYWRtaW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgaWYgKCB0eXBlb2Ygd2luZG93LkN1c3RvbUV2ZW50ID09PSBcImZ1bmN0aW9uXCIgKSByZXR1cm4gZmFsc2U7XHJcblxyXG4gIGZ1bmN0aW9uIEN1c3RvbUV2ZW50ICggZXZlbnQsIHBhcmFtcyApIHtcclxuICAgIHBhcmFtcyA9IHBhcmFtcyB8fCB7IGJ1YmJsZXM6IGZhbHNlLCBjYW5jZWxhYmxlOiBmYWxzZSwgZGV0YWlsOiB1bmRlZmluZWQgfTtcclxuICAgIHZhciBldnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCggJ0N1c3RvbUV2ZW50JyApO1xyXG4gICAgZXZ0LmluaXRDdXN0b21FdmVudCggZXZlbnQsIHBhcmFtcy5idWJibGVzLCBwYXJhbXMuY2FuY2VsYWJsZSwgcGFyYW1zLmRldGFpbCApO1xyXG4gICAgcmV0dXJuIGV2dDtcclxuICAgfVxyXG5cclxuICBDdXN0b21FdmVudC5wcm90b3R5cGUgPSB3aW5kb3cuRXZlbnQucHJvdG90eXBlO1xyXG5cclxuICB3aW5kb3cuQ3VzdG9tRXZlbnQgPSBDdXN0b21FdmVudDtcclxufSkoKTtcclxuIiwiICAoZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKCFFbGVtZW50LnByb3RvdHlwZS5zY3JvbGxJbnRvVmlld0lmTmVlZGVkKSB7XHJcbiAgICAgIEVsZW1lbnQucHJvdG90eXBlLnNjcm9sbEludG9WaWV3SWZOZWVkZWQgPSBmdW5jdGlvbiAoY2VudGVySWZOZWVkZWQpIHtcclxuICAgICAgICBjZW50ZXJJZk5lZWRlZCA9IGFyZ3VtZW50cy5sZW5ndGggPT09IDAgPyB0cnVlIDogISFjZW50ZXJJZk5lZWRlZDtcclxuXHJcbiAgICAgICAgdmFyIHBhcmVudCA9IHRoaXMucGFyZW50Tm9kZSxcclxuICAgICAgICBwYXJlbnRDb21wdXRlZFN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50LCBudWxsKSxcclxuICAgICAgICBwYXJlbnRCb3JkZXJUb3BXaWR0aCA9IHBhcnNlSW50KHBhcmVudENvbXB1dGVkU3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgnYm9yZGVyLXRvcC13aWR0aCcpKSxcclxuICAgICAgICBwYXJlbnRCb3JkZXJMZWZ0V2lkdGggPSBwYXJzZUludChwYXJlbnRDb21wdXRlZFN0eWxlLmdldFByb3BlcnR5VmFsdWUoJ2JvcmRlci1sZWZ0LXdpZHRoJykpLFxyXG4gICAgICAgIG92ZXJUb3AgPSB0aGlzLm9mZnNldFRvcCAtIHBhcmVudC5vZmZzZXRUb3AgPCBwYXJlbnQuc2Nyb2xsVG9wLFxyXG4gICAgICAgIG92ZXJCb3R0b20gPSAodGhpcy5vZmZzZXRUb3AgLSBwYXJlbnQub2Zmc2V0VG9wICsgdGhpcy5jbGllbnRIZWlnaHQgLSBwYXJlbnRCb3JkZXJUb3BXaWR0aCkgPiAocGFyZW50LnNjcm9sbFRvcCArIHBhcmVudC5jbGllbnRIZWlnaHQpLFxyXG4gICAgICAgIG92ZXJMZWZ0ID0gdGhpcy5vZmZzZXRMZWZ0IC0gcGFyZW50Lm9mZnNldExlZnQgPCBwYXJlbnQuc2Nyb2xsTGVmdCxcclxuICAgICAgICBvdmVyUmlnaHQgPSAodGhpcy5vZmZzZXRMZWZ0IC0gcGFyZW50Lm9mZnNldExlZnQgKyB0aGlzLmNsaWVudFdpZHRoIC0gcGFyZW50Qm9yZGVyTGVmdFdpZHRoKSA+IChwYXJlbnQuc2Nyb2xsTGVmdCArIHBhcmVudC5jbGllbnRXaWR0aCksXHJcbiAgICAgICAgYWxpZ25XaXRoVG9wID0gb3ZlclRvcCAmJiAhb3ZlckJvdHRvbTtcclxuXHJcbiAgICAgICAgaWYgKChvdmVyVG9wIHx8IG92ZXJCb3R0b20pICYmIGNlbnRlcklmTmVlZGVkKSB7XHJcbiAgICAgICAgICBwYXJlbnQuc2Nyb2xsVG9wID0gdGhpcy5vZmZzZXRUb3AgLSBwYXJlbnQub2Zmc2V0VG9wIC0gcGFyZW50LmNsaWVudEhlaWdodCAvIDIgLSBwYXJlbnRCb3JkZXJUb3BXaWR0aCArIHRoaXMuY2xpZW50SGVpZ2h0IC8gMjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICgob3ZlckxlZnQgfHwgb3ZlclJpZ2h0KSAmJiBjZW50ZXJJZk5lZWRlZCkge1xyXG4gICAgICAgICAgcGFyZW50LnNjcm9sbExlZnQgPSB0aGlzLm9mZnNldExlZnQgLSBwYXJlbnQub2Zmc2V0TGVmdCAtIHBhcmVudC5jbGllbnRXaWR0aCAvIDIgLSBwYXJlbnRCb3JkZXJMZWZ0V2lkdGggKyB0aGlzLmNsaWVudFdpZHRoIC8gMjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICgob3ZlclRvcCB8fCBvdmVyQm90dG9tIHx8IG92ZXJMZWZ0IHx8IG92ZXJSaWdodCkgJiYgIWNlbnRlcklmTmVlZGVkKSB7XHJcbiAgICAgICAgICB0aGlzLnNjcm9sbEludG9WaWV3KGFsaWduV2l0aFRvcCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gIH0pKCk7XHJcbiIsIndpbmRvdy5BcHAgfHwgKHdpbmRvdy5BcHAgPSB7fSk7XHJcbndpbmRvdy5BcHAuY29uZmlnID0ge1xyXG4gIHByb21pc2VzOiB7XHJcbiAgICBkdXN0Qmx1ZWJpcmQ6IFByb21pc2UucHJvbWlzaWZ5QWxsKGR1c3QpLFxyXG4gICAgY2xvdWRpbmFyeUJpcmQ6IFByb21pc2UucHJvbWlzaWZ5QWxsKCQuY2xvdWRpbmFyeSlcclxuICB9LFxyXG4gIGNvbW1vbnM6IHtcclxuICAgIG1hcDoge30sXHJcbiAgICB0cmFuczoge31cclxuICB9LFxyXG4gIGNhY2hlOiB7XHJcbiAgICBhY3RpdmVFc3RhdGU6IHt9LFxyXG4gICAgYWN0aXZlRXN0YXRlTGlzdGluZzoge31cclxuICB9LFxyXG4gIG1vZHVsZXM6IHtcclxuICAgIG1hcDoge30sXHJcbiAgICBpbmZvOiB7fSxcclxuICAgIGVkaXQ6IHt9XHJcbiAgfVxyXG59O1xyXG53aW5kb3cuQXBwLnV0aWxzID0ge307XHJcbi8vIHZhciB0cmFucztcclxuLy8gdmFyIGNsb3VkaW5hcnlCaXJkID0gUHJvbWlzZS5wcm9taXNpZnlBbGwoJC5jbG91ZGluYXJ5KTtcclxuLy8gdmFyIGFjdGl2ZUVzdGF0ZTtcclxuLy8gdmFyIGFjdGl2ZUVzdGF0ZUxpc3Rpbmc7XHJcbiQuY2xvdWRpbmFyeS5jb25maWcoeyBjbG91ZF9uYW1lOiAnZmlydmFpbicsIGFwaV9rZXk6ICczNzUxMzg5MzI2ODk1OTEnIH0pO1xyXG4iLCJBcHAudXRpbHMgPSB7XHJcbiAgZmluZEJ5SWQ6IGZ1bmN0aW9uIGZpbmRCeUlkKG1hcCwgaWQpIHtcclxuICAgIHZhciBsYXllcnMgPSBtYXAuZ2V0TGF5ZXJzKCk7XHJcbiAgICB2YXIgbGVuZ3RoID0gbGF5ZXJzLmdldExlbmd0aCgpO1xyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xyXG4gICAgICBpZiAoaWQgPT09IGxheWVycy5pdGVtKGkpLmdldCgnaWQnKSkge1xyXG4gICAgICAgIHJldHVybiBsYXllcnMuaXRlbShpKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfSxcclxuICBmaW5kQnlOYW1lOiBmdW5jdGlvbiBmaW5kQnlOYW1lKG1hcCwgbmFtZSkge1xyXG4gICAgdmFyIGxheWVycyA9IG1hcC5nZXRMYXllcnMoKTtcclxuICAgIHZhciBsZW5ndGggPSBsYXllcnMuZ2V0TGVuZ3RoKCk7XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGlmIChuYW1lID09PSBsYXllcnMuaXRlbShpKS5nZXQoJ25hbWUnKSkge1xyXG4gICAgICAgIHJldHVybiBsYXllcnMuaXRlbShpKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfSxcclxuICBwcmV2ZW50RG90QW5kU3BhY2U6IGZ1bmN0aW9uIHByZXZlbnREb3RBbmRTcGFjZShlKSB7XHJcbiAgICB2YXIga2V5ID0gZS5jaGFyQ29kZSA/IGUuY2hhckNvZGUgOiBlLmtleUNvZGU7XHJcbiAgICB0aGlzLmlubmVySFRNTCA9IGtleTtcclxuICAgIGlmIChrZXkgPT09IDQ2IHx8IGtleSA9PT0gMzIpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfSxcclxuICBnZW9tZXRyeUZ1bmN0aW9uOiBmdW5jdGlvbiBnZW9tZXRyeUZ1bmN0aW9uKGNvb3JkaW5hdGVzLCBnZW9tZXRyeSkge1xyXG4gICAgdmFyIGdlb20gPSBnZW9tZXRyeTtcclxuICAgIHZhciBzdGFydDtcclxuICAgIHZhciBlbmQ7XHJcbiAgICBpZiAoIWdlb20pIHtcclxuICAgICAgZ2VvbSA9IG5ldyBvbC5nZW9tLlBvbHlnb24obnVsbCk7XHJcbiAgICB9XHJcbiAgICBzdGFydCA9IGNvb3JkaW5hdGVzWzBdO1xyXG4gICAgZW5kID0gY29vcmRpbmF0ZXNbMV07XHJcbiAgICBnZW9tLnNldENvb3JkaW5hdGVzKFtcclxuICAgICAgW3N0YXJ0LCBbc3RhcnRbMF0sIGVuZFsxXV0sIGVuZCwgW2VuZFswXSwgc3RhcnRbMV1dLCBzdGFydF1cclxuICAgICAgXSk7XHJcbiAgICByZXR1cm4gZ2VvbTtcclxuICB9LFxyXG4gIGhhc0NsYXNzOiBmdW5jdGlvbiBoYXNDbGFzcyhlbCwgY2xhc3NOYW1lKSB7XHJcbiAgICBpZiAoZWwuY2xhc3NMaXN0KSB7XHJcbiAgICAgIHJldHVybiBlbC5jbGFzc0xpc3QuY29udGFpbnMoY2xhc3NOYW1lKTtcclxuICAgIH1cclxuICAgIHJldHVybiBuZXcgUmVnRXhwKCcoXnwgKScgKyBjbGFzc05hbWUgKyAnKCB8JCknLCAnZ2knKS50ZXN0KGVsLmNsYXNzTmFtZSk7XHJcbiAgfSxcclxuICByZW1vdmVDbGFzczogZnVuY3Rpb24gcmVtb3ZlQ2xhc3MoZWwsIGNsYXNzTmFtZSkge1xyXG4gICAgdmFyIGVsZW1lbnQgPSBlbDtcclxuICAgIGlmIChlbGVtZW50LmNsYXNzTGlzdCkge1xyXG4gICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gZWxlbWVudC5jbGFzc05hbWUucmVwbGFjZShuZXcgUmVnRXhwKCcoXnxcXFxcYiknICsgY2xhc3NOYW1lLnNwbGl0KCcgJykuam9pbignfCcpICsgJyhcXFxcYnwkKScsICdnaScpLCAnICcpO1xyXG4gICAgfVxyXG4gIH0sXHJcbiAgYWRkQ2xhc3M6IGZ1bmN0aW9uIHJlbW92ZUNsYXNzKGVsLCBjbGFzc05hbWUpIHtcclxuICAgIHZhciBlbGVtZW50ID0gZWw7XHJcbiAgICBpZiAoZWxlbWVudC5jbGFzc0xpc3QpIHtcclxuICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBlbGVtZW50LmNsYXNzTmFtZSArPSAnICcgKyBjbGFzc05hbWU7XHJcbiAgICB9XHJcbiAgfSxcclxuICByZXF1ZXN0RnVsbFNjcmVlbjogZnVuY3Rpb24gcmVxdWVzdEZ1bGxTY3JlZW4oZWxlbWVudCkge1xyXG4gICAgLy8gU3VwcG9ydHMgbW9zdCBicm93c2VycyBhbmQgdGhlaXIgdmVyc2lvbnMuXHJcbiAgICB2YXIgcmVxdWVzdE1ldGhvZCA9IGVsZW1lbnQucmVxdWVzdEZ1bGxTY3JlZW4gfHwgZWxlbWVudC53ZWJraXRSZXF1ZXN0RnVsbFNjcmVlbiB8fCBlbGVtZW50Lm1velJlcXVlc3RGdWxsU2NyZWVuIHx8IGVsZW1lbnQubXNSZXF1ZXN0RnVsbFNjcmVlbjtcclxuICAgIHZhciB3c2NyaXB0O1xyXG4gICAgaWYgKHJlcXVlc3RNZXRob2QpIHsgLy8gTmF0aXZlIGZ1bGwgc2NyZWVuLlxyXG4gICAgICByZXF1ZXN0TWV0aG9kLmNhbGwoZWxlbWVudCk7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiB3aW5kb3cuQWN0aXZlWE9iamVjdCAhPT0gJ3VuZGVmaW5lZCcpIHsgLy8gT2xkZXIgSUUuXHJcbiAgICAgIHdzY3JpcHQgPSBuZXcgQWN0aXZlWE9iamVjdCgnV1NjcmlwdC5TaGVsbCcpO1xyXG4gICAgICBpZiAod3NjcmlwdCAhPT0gbnVsbCkge1xyXG4gICAgICAgIHdzY3JpcHQuU2VuZEtleXMoJ3tGMTF9Jyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9LFxyXG4gIGV4aXRGdWxsc3JlZW46IGZ1bmN0aW9uIGV4aXRGdWxsc3JlZW4oZWxlbWVudCkge1xyXG4gICAgdmFyIHJlcXVlc3RNZXRob2QgPSBlbGVtZW50LmV4aXRGdWxsU2NyZWVuIHx8IGVsZW1lbnQud2Via2l0RXhpdEZ1bGxzY3JlZW4gfHwgZWxlbWVudC5tb3pDYW5jZWxGdWxsU2NyZWVuIHx8IGVsZW1lbnQubXNFeGl0RnVsbHNjcmVlbjtcclxuICAgIHZhciB3c2NyaXB0O1xyXG4gICAgaWYgKHJlcXVlc3RNZXRob2QpIHsgLy8gTmF0aXZlIGZ1bGwgc2NyZWVuLlxyXG4gICAgICByZXF1ZXN0TWV0aG9kLmNhbGwoZWxlbWVudCk7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiB3aW5kb3cuQWN0aXZlWE9iamVjdCAhPT0gJ3VuZGVmaW5lZCcpIHsgLy8gT2xkZXIgSUUuXHJcbiAgICAgIHdzY3JpcHQgPSBuZXcgQWN0aXZlWE9iamVjdCgnV1NjcmlwdC5TaGVsbCcpO1xyXG4gICAgICBpZiAod3NjcmlwdCAhPT0gbnVsbCkge1xyXG4gICAgICAgIHdzY3JpcHQuU2VuZEtleXMoJ3tFc2N9Jyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgLy8gem9vbVRvR2lkOiBmdW5jdGlvbiB6b29tVG9HaWQobWFwLCBnaWQpIHtcclxuICAvLyAgIHZhciBjb29yZGluYXRlcyA9IHV0aWxzLmZpbmRCeUlkKG1hcCwgJ2ZpbHRlcmVkRXN0YXRlcycpLmdldFNvdXJjZSgpLmdldEZlYXR1cmVCeUlkKGdpZClcclxuICAvLyAgIC5nZXRHZW9tZXRyeSgpXHJcbiAgLy8gICAuZ2V0Q29vcmRpbmF0ZXMoKTtcclxuICAvLyAgIG1hcC5nZXRWaWV3KCkuc2V0Q2VudGVyKGNvb3JkaW5hdGVzKTtcclxuICAvLyB9XHJcbn07XHJcbiIsIkFwcC5jb25maWcubW9kdWxlcy5tYXAgPSAoZnVuY3Rpb24gKHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCwgUHJvbWlzZSwgb2wsIEFwcCkge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuICB2YXIgY2VudGVyID0gWzM2NzczODUsIDQxMjA5NDldO1xyXG4gIHZhciBleHRlbnQgPSBbMzY1Mjc3MiwgNDExMjgwOCwgMzcwMDAwMCwgNDEzMjc5N107XHJcbiAgdmFyIGdlb0pTT05Gb3JtYXQgPSBuZXcgb2wuZm9ybWF0Lkdlb0pTT04oe1xyXG4gICAgZGVmYXVsdERhdGFQcm9qZWN0aW9uOiAnRVBTRzo0MzI2J1xyXG4gIH0pO1xyXG5cclxuICB2YXIgbWFwU3R5bGVzID0ge1xyXG4gICAgaWNvblR5cGU6IGZ1bmN0aW9uIGdldEljb25UeXBlKGVzdGF0ZVR5cGUpIHtcclxuICAgICAgdmFyIGljb25UeXBlID0ge1xyXG4gICAgICAgIEFwYXJ0bWVudDogZnVuY3Rpb24gZ2V0QXBhcnRtZW50SWNvbigpIHtcclxuICAgICAgICAgIHJldHVybiAnYXBhcnRtZW50JztcclxuICAgICAgICB9LFxyXG4gICAgICAgIFN0b3JlOiBmdW5jdGlvbiBnZXRTdG9yZUljb24oKSB7XHJcbiAgICAgICAgICByZXR1cm4gJ3N0b3JlJztcclxuICAgICAgICB9LFxyXG4gICAgICAgICdEZXRhY2hlZCBIb3VzZSc6IGZ1bmN0aW9uIGdldERldGFjaGVkSG91c2VJY29uKCkge1xyXG4gICAgICAgICAgcmV0dXJuICdkZXRhY2hlZCc7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBNYWlzb25ldHRlOiBmdW5jdGlvbiBnZXRNYWlzb25ldHRlSWNvbigpIHtcclxuICAgICAgICAgIHJldHVybiAnbWFpc29uZXR0ZSc7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBWaWxsYTogZnVuY3Rpb24gZ2V0VmlsbGFJb24oKSB7XHJcbiAgICAgICAgICByZXR1cm4gJ3ZpbGxhJztcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIHJldHVybiAoaWNvblR5cGVbZXN0YXRlVHlwZV0pKCk7XHJcbiAgICB9LFxyXG4gICAgZXN0YXRlczogZnVuY3Rpb24gZXN0YXRlcyhmZWF0dXJlKSB7XHJcbiAgICAgIHZhciBzcmMgPSAnLi9pbWFnZXMvcGlucy9ub25lLycgK1xyXG4gICAgICBtYXBTdHlsZXMuaWNvblR5cGUoZmVhdHVyZS5nZXQoJ2VzdGF0ZXR5cGVfZW4nKSkgKyAnLTQ4LnBuZyc7XHJcbiAgICAgIHJldHVybiBuZXcgb2wuc3R5bGUuU3R5bGUoe1xyXG4gICAgICAgIGdlb21ldHJ5OiBmZWF0dXJlLmdldEdlb21ldHJ5KCksXHJcbiAgICAgICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5JY29uKCh7XHJcbiAgICAgICAgICBzcmM6IHNyYyxcclxuICAgICAgICAgIGFuY2hvck9yaWdpbjogJ2JvdHRvbS1sZWZ0JyxcclxuICAgICAgICAgIGFuY2hvcjogWzAuNSwgMF0sXHJcbiAgICAgICAgICBzY2FsZTogMVxyXG4gICAgICAgIH0pKVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICB2YXIgbWFwU291cmNlcyA9IHtcclxuICAgIGJpbmc6IGZ1bmN0aW9uIGJpbmcoKSB7XHJcbiAgICAgIHJldHVybiBuZXcgb2wuc291cmNlLkJpbmdNYXBzKHtcclxuICAgICAgICBrZXk6ICdBazJHcThWVWZJQ3NQcHVmN0xSQU5YbVh0MnNIV21TTFBob2htVkxGdEZJRXdZanNfNU1DeUFoQUZ3UlNWcExqJyxcclxuICAgICAgICBpbWFnZXJ5U2V0OiAnQWVyaWFsV2l0aExhYmVscydcclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgbWFwQm94OiBmdW5jdGlvbiBtYXBCb3goKSB7XHJcbiAgICAgIHJldHVybiBuZXcgb2wuc291cmNlLlhZWih7XHJcbiAgICAgICAgYXR0cmlidXRpb25zOiBbbmV3IG9sLkF0dHJpYnV0aW9uKHtcclxuICAgICAgICAgIGh0bWw6ICc8YSBocmVmPVwiaHR0cHM6Ly93d3cubWFwYm94LmNvbS9hYm91dC9tYXBzL1wiIHRhcmdldD1cIl9ibGFua1wiPiZjb3B5OyBNYXBib3ggJmNvcHk7IE9wZW5TdHJlZXRNYXA8L2E+J1xyXG4gICAgICAgIH0pXSxcclxuICAgICAgICB1cmw6ICdodHRwczovL2FwaS5tYXBib3guY29tL3Y0L21hcGJveC5zdHJlZXRzL3t6fS97eH0ve3l9LnBuZz9hY2Nlc3NfdG9rZW49cGsuZXlKMUlqb2labWx5ZG1GcGJpSXNJbUVpT2lKbE9XWXlZVE0wTlRoaU5XTTBZakpqT0RKak5ERTRPRFF6TnpBMk1HUXlOaUo5Li1OVkRPMjdIenQtd19uUW9zVVBmTEEnXHJcbiAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGVzdGF0ZXM6IGZ1bmN0aW9uIGVzdGF0ZXMoKSB7XHJcbiAgICAgIHJldHVybiBuZXcgb2wuc291cmNlLlZlY3Rvcih7XHJcbiAgICAgICAgZm9ybWF0OiBnZW9KU09ORm9ybWF0LFxyXG4gICAgICAgIGxvYWRlcjogZnVuY3Rpb24gcHJvcGVydHlMb2FkZXIoKSB7XHJcbiAgICAgICAgICB2YXIgdXJsID0gJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9hcGkvcHJvcGVydHkvYWxsLycgKyBpZDtcclxuICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICAgIFByb21pc2UucmVzb2x2ZShcclxuICAgICAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICAgICAgICB0eXBlOiAnR0VUJyxcclxuICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgICAudGhlbihmdW5jdGlvbiByZXNvbHZlKGRhdGEpIHtcclxuICAgICAgICAgICAgdmFyIGZlYXR1cmVzID0gZ2VvSlNPTkZvcm1hdC5yZWFkRmVhdHVyZXMoZGF0YSwge1xyXG4gICAgICAgICAgICAgIGZlYXR1cmVQcm9qZWN0aW9uOiAnRVBTRzozODU3J1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgc2VsZi5hZGRGZWF0dXJlcyhmZWF0dXJlcyk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIGVycm9yKGUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZSk7XHJcbiAgICAgICAgICAgIGlmIChlLnN0YXR1cyA9PT0gNDA0KSB7XHJcbiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCdTb3JyeSwgd2UgY2Fubm90IGZpbmQgYW55IHByb3BlcnRpZXMhJyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZS5zdGF0dXMgPT09IDUwMykge1xyXG4gICAgICAgICAgICAgIHRvYXN0ci5lcnJvcignU2VydmljZSBVbmF2YWlsYWJsZSEnKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoJ0ludGVybmFsIFNlcnZlciBFcnJvciEgUGxlYXNlIHJlbG9hZCBwYWdlIG9yIHRyeSBhZ2FpbiBsYXRlcicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHZhciBtYXBMYXllcnMgPSB7XHJcbiAgICBiaW5nOiBmdW5jdGlvbiBiaW5nKHRyYW5zKSB7XHJcbiAgICAgIHJldHVybiBuZXcgb2wubGF5ZXIuVGlsZSh7XHJcbiAgICAgICAgdmlzaWJsZTogdHJ1ZSxcclxuICAgICAgICBzb3VyY2U6IG1hcFNvdXJjZXMuYmluZygpLFxyXG4gICAgICAgIG1heFpvb206IDE5LFxyXG4gICAgICAgIGNyb3NzT3JpZ2luOiAnYW5vbnltb3VzJyxcclxuICAgICAgICBwcmVsb2FkOiBJbmZpbml0eSxcclxuICAgICAgICBpZDogJ2JpbmcnLFxyXG4gICAgICAgIG5hbWU6IHRyYW5zLmxheWVycy5iaW5nXHJcbiAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIG1hcEJveDogZnVuY3Rpb24gbWFwQm94KHRyYW5zKSB7XHJcbiAgICAgIHJldHVybiBuZXcgb2wubGF5ZXIuVGlsZSh7XHJcbiAgICAgICAgc291cmNlOiBtYXBTb3VyY2VzLm1hcEJveCgpLFxyXG4gICAgICAgIGlkOiAnbWFwYm94JyxcclxuICAgICAgICBuYW1lOiB0cmFucy5sYXllcnMubWFwQm94XHJcbiAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGVzdGF0ZXM6IGZ1bmN0aW9uIGVzdGF0ZXModHJhbnMpe1xyXG4gICAgICByZXR1cm4gbmV3IG9sLmxheWVyLlZlY3Rvcih7XHJcbiAgICAgICAgc291cmNlOiBtYXBTb3VyY2VzLmVzdGF0ZXMoKSxcclxuICAgICAgICBpZDogJ2VzdGF0ZXMnLFxyXG4gICAgICAgIHZpc2libGU6IHRydWUsXHJcbiAgICAgICAgc3R5bGU6IG1hcFN0eWxlcy5lc3RhdGVzXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcbiAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiBpbml0aWFsaXplKCkge1xyXG4gICAgdmFyIHRyYW5zID0gQXBwLmNvbmZpZy5jb21tb25zLnRyYW5zO1xyXG4gICAgdmFyIGxheWVycyA9IE9iamVjdC5rZXlzKG1hcExheWVycykubWFwKGZ1bmN0aW9uIGFkZE1hcExheWVycyhrZXkpIHtcclxuICAgICAgaWYgKGtleSAhPT0gJ2JpbmcnKSB7IHJldHVybiBtYXBMYXllcnNba2V5XSh0cmFucyk7IH1cclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBuZXcgb2wuTWFwKHtcclxuICAgICAgdGFyZ2V0OiAnbWFwJyxcclxuICAgICAgbGF5ZXJzOiBfLmNvbXBhY3QobGF5ZXJzKSxcclxuICAgICAgbG9hZFRpbGVzV2hpbGVBbmltYXRpbmc6IHRydWUsXHJcbiAgICAgIGxvYWRUaWxlc1doaWxlSW50ZXJhY3Rpbmc6IHRydWUsXHJcbiAgICAgIHJlbmRlcmVyOiAnY2FudmFzJyxcclxuICAgICAgY29udHJvbHM6IG9sLmNvbnRyb2wuZGVmYXVsdHMoe1xyXG4gICAgICAgIGF0dHJpYnV0aW9uT3B0aW9uczoge1xyXG4gICAgICAgICAgY29sbGFwc2libGU6IGZhbHNlLFxyXG4gICAgICAgICAgY29sbGFwc2VkOiBmYWxzZVxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICAgIC5leHRlbmQoW1xyXG4gICAgICAgICBuZXcgb2wuY29udHJvbC5TY2FsZUxpbmUoe1xyXG4gICAgICAgICAgIHVuaXRzOiAnbWV0cmljJ1xyXG4gICAgICAgICB9KSwgbmV3IG9sLmNvbnRyb2wuT3ZlcnZpZXdNYXAoe1xyXG4gICAgICAgICAgIGNsYXNzTmFtZTogJ29sLW92ZXJ2aWV3bWFwIG9sLWN1c3RvbS1vdmVydmlld21hcCcsXHJcbiAgICAgICAgICAgY29sbGFwc2libGU6IHRydWUsXHJcbiAgICAgICAgICAgY29sbGFwc2VkOiB0cnVlLFxyXG4gICAgICAgICAgIGxheWVyczogW21hcExheWVycy5iaW5nKHRyYW5zKV1cclxuICAgICAgICAgfSksXHJcbiAgICAgICAgIG5ldyBvbC5jb250cm9sLlpvb21Ub0V4dGVudCh7XHJcbiAgICAgICAgICAgZXh0ZW50OiBleHRlbnRcclxuICAgICAgICAgfSlcclxuICAgICAgIF0pLFxyXG4gICAgICB2aWV3OiBuZXcgb2wuVmlldyh7XHJcbiAgICAgICAgY2VudGVyOiBjZW50ZXIsXHJcbiAgICAgICAgZXh0ZW50OiBleHRlbnQsXHJcbiAgICAgICAgcHJvamVjdGlvbjogJ0VQU0c6Mzg1NycsXHJcbiAgICAgICAgem9vbTogMTQsXHJcbiAgICAgICAgbWF4Wm9vbTogMTksXHJcbiAgICAgICAgbWluWm9vbTogMTRcclxuICAgICAgfSlcclxuICAgIH0pO1xyXG4gIH07XHJcbiAgcmV0dXJuIHtcclxuICAgIGluaXRpYWxpemU6IGluaXRpYWxpemVcclxuICB9O1xyXG59KHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCwgUHJvbWlzZSwgb2wsIEFwcCkpO1xyXG4iLCJBcHAuY29uZmlnLm1vZHVsZXMuaW5mbyA9IChmdW5jdGlvbiBpbmZvKHdpbmRvdywgZG9jdW1lbnQsIFByb21pc2UsICQsIEFwcCkge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuICB2YXIgZ2VvSlNPTkZvcm1hdCA9IG5ldyBvbC5mb3JtYXQuR2VvSlNPTih7XHJcbiAgICBkZWZhdWx0RGF0YVByb2plY3Rpb246ICdFUFNHOjQzMjYnXHJcbiAgfSk7XHJcbiAgdmFyIGxhbmcgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZztcclxuICB2YXIgZWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNlZGl0Jyk7XHJcbiAgdmFyIGluZm9Cb3hDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2luZm9ib3gtY29udGVudCcpO1xyXG4gIHZhciBkdXN0Qmx1ZWJpcmQgPSBBcHAuY29uZmlnLnByb21pc2VzLmR1c3RCbHVlYmlyZDtcclxuICB2YXIgdXRpbHMgPSBBcHAudXRpbHM7XHJcbiAgZnVuY3Rpb24gZHVzdEVzdGF0ZUluZm8oZGF0YSkge1xyXG4gICAgZHVzdEJsdWViaXJkLnJlbmRlckFzeW5jKCdlZGl0JywgZGF0YSlcclxuICAgIC50aGVuKGZ1bmN0aW9uIHJlc29sdmVEdXN0KHJlc3VsdCkge1xyXG4gICAgICB1dGlscy5yZW1vdmVDbGFzcyhpbmZvQm94Q29udGVudCwgJ3Zpc3VhbGx5aGlkZGVuJyk7XHJcbiAgICAgIGluZm9Cb3hDb250ZW50LmlubmVySFRNTCA9IHJlc3VsdDtcclxuICAgICAgZ2V0bWRsU2VsZWN0LmluaXQoJy5nZXRtZGwtc2VsZWN0Jyk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGZ1bmN0aW9uIGVycm9yKGUpIHtcclxuICAgICAgY29uc29sZS5sb2coZSk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgZnVuY3Rpb24gc2VsZWN0RmVhdHVyZShldnQpIHtcclxuICAgIHZhciBtYXAgPSBldnQubWFwO1xyXG4gICAgdmFyIGNvb3JkaW5hdGVzO1xyXG4gICAgdmFyIGVzdGF0ZTtcclxuICAgIHZhciBnaWQ7XHJcbiAgICB2YXIgcmVuZGVyRGF0YSA9IEFwcC5jb25maWcuY29tbW9ucy50cmFucztcclxuICAgIC8vIHZhciBjb29yZGluYXRlID0gZXZ0LmNvb3JkaW5hdGU7XHJcbiAgICB2YXIgY2xpY2tlZEZlYXR1cmUgPSBtYXAuZm9yRWFjaEZlYXR1cmVBdFBpeGVsKGV2dC5waXhlbCwgZnVuY3Rpb24gZmluZEZlYXR1cmUoZmVhdHVyZSwgbGF5ZXIpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBmZWF0dXJlOiBmZWF0dXJlLFxyXG4gICAgICAgIGxheWVyOiBsYXllclxyXG4gICAgICB9O1xyXG4gICAgfSwgdGhpcywgZnVuY3Rpb24gY2xpY2tlZEZlYXR1cmVMYXllckZpbHRlcihsYXllcikge1xyXG4gICAgICBpZiAobGF5ZXIuZ2V0KCdpZCcpID09PSAnZXN0YXRlcycpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9LCB0aGlzKTtcclxuICAgIGlmIChjbGlja2VkRmVhdHVyZSkge1xyXG4gICAgICBlc3RhdGUgPSBjbGlja2VkRmVhdHVyZS5mZWF0dXJlO1xyXG4gICAgICBjb29yZGluYXRlcyA9IGVzdGF0ZS5nZXRHZW9tZXRyeSgpLmdldENvb3JkaW5hdGVzKCk7XHJcbiAgICAgIG1hcC5nZXRWaWV3KCkuc2V0Q2VudGVyKGNvb3JkaW5hdGVzKTtcclxuICAgICAgbWFwLmdldFZpZXcoKS5zZXRab29tKDE2KTtcclxuICAgICAgZ2lkID0gZXN0YXRlLmdldFByb3BlcnRpZXMoKS5naWQ7XHJcbiAgICAgIHV0aWxzLnJlbW92ZUNsYXNzKGVkaXRCdXR0b24sICdtZGwtYnV0dG9uLS1hY2NlbnQnKTtcclxuICAgICAgdXRpbHMucmVtb3ZlQ2xhc3MoZWRpdEJ1dHRvbiwgJ21kbC1idXR0b24tLXJhaXNlZCcpO1xyXG4gICAgICB2YXIgcDEgPSBQcm9taXNlLnJlc29sdmUoXHJcbiAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgIHVybDogJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMC9hcGkvcHJvcGVydHknLFxyXG4gICAgICAgICAgdHlwZTogJ0dFVCcsXHJcbiAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgIGdpZDogZ2lkXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgKTtcclxuICAgICAgcDEudGhlbihmdW5jdGlvbiByZXNvbHZlKGRhdGEpIHtcclxuICAgICAgICB2YXIgZmVhdHVyZSA9IGRhdGEuZmVhdHVyZXNbMF07XHJcbiAgICAgICAgQXBwLmNvbmZpZy5jYWNoZS5hY3RpdmVFc3RhdGUgPSBmZWF0dXJlLnByb3BlcnRpZXM7XHJcbiAgICAgICAgcmV0dXJuIGZlYXR1cmU7XHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKGZ1bmN0aW9uIHJlc29sdmUoZmVhdHVyZSkge1xyXG4gICAgICAgIGlmIChsYW5nID09PSAnZWwnKSB7XHJcbiAgICAgICAgICByZW5kZXJEYXRhLnZhbHVlcyA9IHtcclxuICAgICAgICAgICAgZ2lkOiBmZWF0dXJlLnByb3BlcnRpZXMuZ2lkLFxyXG4gICAgICAgICAgICBlc3RhdGVUeXBlOiBmZWF0dXJlLnByb3BlcnRpZXMuZXN0YXRldHlwZSxcclxuICAgICAgICAgICAgYWRkcmVzczogZmVhdHVyZS5wcm9wZXJ0aWVzLnN0cmVldF9lbCxcclxuICAgICAgICAgICAgYWRkcmVzc051bWJlcjogZmVhdHVyZS5wcm9wZXJ0aWVzLnN0cmVldF9udW1iZXIsXHJcbiAgICAgICAgICAgIHBzY29kZTogZmVhdHVyZS5wcm9wZXJ0aWVzLnBzX2NvZGUsXHJcbiAgICAgICAgICAgIGVzdGF0ZUFyZWE6IGZlYXR1cmUucHJvcGVydGllcy5lc3RhdGVhcmVhLFxyXG4gICAgICAgICAgICBiZWRyb29tczogZmVhdHVyZS5wcm9wZXJ0aWVzLmJlZHJvb21zLFxyXG4gICAgICAgICAgICBmbG9vcjogZmVhdHVyZS5wcm9wZXJ0aWVzLmZsb29yLFxyXG4gICAgICAgICAgICB5ZWFyOiBmZWF0dXJlLnByb3BlcnRpZXMueWVhcixcclxuICAgICAgICAgICAgcGxvdEFyZWE6IGZlYXR1cmUucHJvcGVydGllcy5wbG90YXJlYSxcclxuICAgICAgICAgICAgcGFyY2VsTnVtYmVyOiBmZWF0dXJlLnByb3BlcnRpZXMucGFyY2VsX251bSxcclxuICAgICAgICAgICAgcGFya2luZzogZmVhdHVyZS5wcm9wZXJ0aWVzLnBhcmtpbmcsXHJcbiAgICAgICAgICAgIGZ1cm5pc2hlZDogZmVhdHVyZS5wcm9wZXJ0aWVzLmZ1cm5pc2hlZCxcclxuICAgICAgICAgICAgaXNuZXc6IGZlYXR1cmUucHJvcGVydGllcy5pc25ldyxcclxuICAgICAgICAgICAgaGVhdGluZzogZmVhdHVyZS5wcm9wZXJ0aWVzLmhlYXRpbmcsXHJcbiAgICAgICAgICAgIGNvb2xpbmc6IGZlYXR1cmUucHJvcGVydGllcy5jb29saW5nLFxyXG4gICAgICAgICAgICB2aWV3OiBmZWF0dXJlLnByb3BlcnRpZXMudmlldyxcclxuICAgICAgICAgICAgdGl0bGU6IGZlYXR1cmUucHJvcGVydGllcy50aXRsZVxyXG4gICAgICAgICAgfTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmVuZGVyRGF0YS52YWx1ZXMgPSB7XHJcbiAgICAgICAgICAgIGdpZDogZmVhdHVyZS5wcm9wZXJ0aWVzLmdpZCxcclxuICAgICAgICAgICAgZXN0YXRlVHlwZTogZmVhdHVyZS5wcm9wZXJ0aWVzLmVzdGF0ZXR5cGVfZW4sXHJcbiAgICAgICAgICAgIGFkZHJlc3M6IGZlYXR1cmUucHJvcGVydGllcy5zdHJlZXRfZW4sXHJcbiAgICAgICAgICAgIGFkZHJlc3NOdW1iZXI6IGZlYXR1cmUucHJvcGVydGllcy5zdHJlZXRfbnVtYmVyLFxyXG4gICAgICAgICAgICBwc2NvZGU6IGZlYXR1cmUucHJvcGVydGllcy5wc19jb2RlLFxyXG4gICAgICAgICAgICBlc3RhdGVBcmVhOiBmZWF0dXJlLnByb3BlcnRpZXMuZXN0YXRlYXJlYSxcclxuICAgICAgICAgICAgYmVkcm9vbXM6IGZlYXR1cmUucHJvcGVydGllcy5iZWRyb29tcyxcclxuICAgICAgICAgICAgZmxvb3I6IGZlYXR1cmUucHJvcGVydGllcy5mbG9vcixcclxuICAgICAgICAgICAgeWVhcjogZmVhdHVyZS5wcm9wZXJ0aWVzLnllYXIsXHJcbiAgICAgICAgICAgIHBsb3RBcmVhOiBmZWF0dXJlLnByb3BlcnRpZXMucGxvdGFyZWEsXHJcbiAgICAgICAgICAgIHBhcmNlbE51bWJlcjogZmVhdHVyZS5wcm9wZXJ0aWVzLnBhcmNlbF9udW0sXHJcbiAgICAgICAgICAgIHBhcmtpbmc6IGZlYXR1cmUucHJvcGVydGllcy5wYXJraW5nLFxyXG4gICAgICAgICAgICBmdXJuaXNoZWQ6IGZlYXR1cmUucHJvcGVydGllcy5mdXJuaXNoZWQsXHJcbiAgICAgICAgICAgIGlzbmV3OiBmZWF0dXJlLnByb3BlcnRpZXMuaXNuZXcsXHJcbiAgICAgICAgICAgIGhlYXRpbmc6IGZlYXR1cmUucHJvcGVydGllcy5oZWF0aW5nLFxyXG4gICAgICAgICAgICBjb29saW5nOiBmZWF0dXJlLnByb3BlcnRpZXMuY29vbGluZyxcclxuICAgICAgICAgICAgdmlldzogZmVhdHVyZS5wcm9wZXJ0aWVzLnZpZXcsXHJcbiAgICAgICAgICAgIHRpdGxlOiBmZWF0dXJlLnByb3BlcnRpZXMudGl0bGVcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgcDEuY2F0Y2goZnVuY3Rpb24gZXJyb3IoZSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGUpO1xyXG4gICAgICB9KTtcclxuICAgICAgdmFyIHAyID0gUHJvbWlzZS5yZXNvbHZlKFxyXG4gICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICB1cmw6ICdodHRwOi8vMTI3LjAuMC4xOjMwMDAvYXBpL2xpc3RpbmcnLFxyXG4gICAgICAgICAgdHlwZTogJ0dFVCcsXHJcbiAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgIGdpZDogZ2lkXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgKVxyXG4gICAgICAudGhlbihmdW5jdGlvbiByZXNvbHZlKGRhdGEpIHtcclxuICAgICAgICBBcHAuY29uZmlnLmNhY2hlLmFjdGl2ZUVzdGF0ZUxpc3RpbmcgPSBkYXRhO1xyXG4gICAgICAgIHJlbmRlckRhdGEubGlzdGluZy52YWx1ZXMgPSBkYXRhO1xyXG4gICAgICAgIHJlbmRlckRhdGEubGlzdGluZy5leGlzdHMgPSB0cnVlO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZnVuY3Rpb24gZXJyb3IoZSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGUpO1xyXG5cclxuICAgICAgICBpZiAoZS5zdGF0dXMgPT09IDQwNCkge1xyXG4gICAgICAgICAgcmVuZGVyRGF0YS5saXN0aW5nLnZhbHVlcyA9IHt9O1xyXG4gICAgICAgICAgcmVuZGVyRGF0YS5saXN0aW5nLmV4aXN0cyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIFByb21pc2UuZWFjaChbcDEsIHAyXSwgZnVuY3Rpb24gZSgpIHtcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oZnVuY3Rpb24gcmVzb2x2ZSgpIHtcclxuICAgICAgICBkdXN0RXN0YXRlSW5mbyhyZW5kZXJEYXRhKTtcclxuICAgICAgICBlZGl0QnV0dG9uLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcclxuICAgICAgICB1dGlscy5hZGRDbGFzcyhlZGl0QnV0dG9uLCAnbWRsLWJ1dHRvbi0tYWNjZW50Jyk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChmdW5jdGlvbiBlcnJvcihlKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaW5mb0JveENvbnRlbnQuaW5uZXJIVE1MID0gJyc7XHJcbiAgICAgIHV0aWxzLmFkZENsYXNzKGluZm9Cb3hDb250ZW50LCAndmlzdWFsbHloaWRkZW4nKTtcclxuICAgICAgZWRpdEJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgdHJ1ZSk7XHJcbiAgICAgIHV0aWxzLnJlbW92ZUNsYXNzKGVkaXRCdXR0b24sICdtZGwtYnV0dG9uLS1hY2NlbnQnKTtcclxuICAgICAgdXRpbHMucmVtb3ZlQ2xhc3MoZWRpdEJ1dHRvbiwgJ21kbC1idXR0b24tLXJhaXNlZCcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gaW5pdCgpIHtcclxuICAgIHZhciBtYXAgPSBBcHAuY29uZmlnLmNvbW1vbnMubWFwO1xyXG4gICAgbWFwLm9uKCdjbGljaycsIHNlbGVjdEZlYXR1cmUpO1xyXG4gIH1cclxuICBmdW5jdGlvbiBkaXNhYmxlKCkge1xyXG4gICAgdmFyIG1hcCA9IEFwcC5jb25maWcuY29tbW9ucy5tYXA7XHJcbiAgICBtYXAudW4oJ2NsaWNrJywgc2VsZWN0RmVhdHVyZSk7XHJcbiAgfVxyXG4gIHJldHVybiB7XHJcbiAgICBpbml0OiBpbml0LFxyXG4gICAgZGlzYWJsZTogZGlzYWJsZVxyXG4gIH07XHJcbn0od2luZG93LCBkb2N1bWVudCwgUHJvbWlzZSwgalF1ZXJ5LCBBcHApKTtcclxuIiwiQXBwLmNvbmZpZy5tb2R1bGVzLmVkaXQgPSAoZnVuY3Rpb24gZWRpdCh3aW5kb3csIGRvY3VtZW50LCBQcm9taXNlLCAkLCBkUGljaywgbW9tZW50KSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG4gIHZhciBlZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2VkaXQnKTtcclxuICB2YXIgaW5mb0JveENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjaW5mb2JveC1jb250ZW50Jyk7XHJcbiAgdmFyIGxhbmcgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubGFuZztcclxuICB2YXIgbWFwID0gQXBwLmNvbmZpZy5jb21tb25zLm1hcDtcclxuICB2YXIgaW5mbyA9IEFwcC5jb25maWcubW9kdWxlcy5pbmZvO1xyXG4gIHZhciB1dGlscyA9IEFwcC51dGlscztcclxuICBmdW5jdGlvbiBkYXRlUGlja2VyKCkge1xyXG4gICAgdmFyIGZvcm1hdCA9IChsYW5nID09PSAnZWwnKSA/ICdERC1NTS1ZWVlZJyA6ICdNTS1ERC1ZWVlZJztcclxuICAgIHZhciBkYXRlU3RhcnRQaWNrZXI7XHJcbiAgICB2YXIgZGF0ZUVuZFBpY2tlcjtcclxuICAgIHZhciBkYXRlU3RhcnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGlzdGluZy1kYXRlLS1zdGFydF9fdG9nZ2xlJyk7XHJcbiAgICB2YXIgZGF0ZUVuZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaXN0aW5nLWRhdGUtLWVuZF9fdG9nZ2xlJyk7XHJcbiAgICB2YXIgZGF0ZVN0YXJ0SW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGlzdGluZy1kYXRlLS1zdGFydCcpO1xyXG4gICAgdmFyIGRhdGVFbmRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaXN0aW5nLWRhdGUtLWVuZCcpO1xyXG4gICAgdmFyIG9ic2VydmVEYXRlUGlja2VyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24gb2JzZXJ2ZURhdGVQaWNrZXIobXV0YXRpb25zKSB7XHJcbiAgICAgIHZhciBhdHRyaWJ1dGVWYWx1ZTtcclxuICAgICAgbXV0YXRpb25zLmZvckVhY2goZnVuY3Rpb24gZm9lckVhY2hNdXRhdGlvbihtdXRhdGlvbikge1xyXG4gICAgICAgIGlmIChtdXRhdGlvbi5hdHRyaWJ1dGVOYW1lID09PSAnY2xhc3MnKSB7XHJcbiAgICAgICAgICBhdHRyaWJ1dGVWYWx1ZSA9ICQobXV0YXRpb24udGFyZ2V0KS5wcm9wKG11dGF0aW9uLmF0dHJpYnV0ZU5hbWUpO1xyXG4gICAgICAgICAgaWYgKGF0dHJpYnV0ZVZhbHVlLmluZGV4T2YoJ21kZHRwLXBpY2tlci0taW5hY3RpdmUnKSA+IC0xKSB7XHJcbiAgICAgICAgICAgIGluZm8uaW5pdCgpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaW5mby5kaXNhYmxlKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChkYXRlU3RhcnRJbnB1dCAhPT0gbnVsbCkge1xyXG4gICAgICBkYXRlU3RhcnRQaWNrZXIgPSBuZXcgZFBpY2suZGVmYXVsdCh7XHJcbiAgICAgICAgdHlwZTogJ2RhdGUnLFxyXG4gICAgICAgIGluaXQ6IG1vbWVudChkYXRlU3RhcnRJbnB1dC52YWx1ZSwgZm9ybWF0KSxcclxuICAgICAgICBmdXR1cmU6IG1vbWVudCgpLmFkZCg1LCAneWVhcnMnKSxcclxuICAgICAgICB0cmlnZ2VyOiBkYXRlU3RhcnRJbnB1dCxcclxuICAgICAgICBvcmllbnRhdGlvbjogJ1BPUlRSQUlUJ1xyXG4gICAgICB9KTtcclxuICAgICAgb2JzZXJ2ZURhdGVQaWNrZXIub2JzZXJ2ZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWRkdHAtcGlja2VyX19kYXRlJyksIHtcclxuICAgICAgICBhdHRyaWJ1dGVzOiB0cnVlXHJcbiAgICAgIH0pO1xyXG4gICAgICBkYXRlU3RhcnRJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdvbk9rJywgZnVuY3Rpb24gZGlzcGxheVBpY2tlZGF0ZSgpIHtcclxuICAgICAgICB0aGlzLnZhbHVlID0gZGF0ZVN0YXJ0UGlja2VyLnRpbWUuZm9ybWF0KGZvcm1hdCkudG9TdHJpbmcoKTtcclxuICAgICAgfSk7XHJcbiAgICAgIGRhdGVTdGFydC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIHNob3dEYXRlUGlja2VyKGUpIHtcclxuICAgICAgICBkYXRlU3RhcnRQaWNrZXIudG9nZ2xlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgaWYgKGRhdGVFbmRJbnB1dCAhPT0gbnVsbCkge1xyXG4gICAgICBkYXRlRW5kSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignb25PaycsIGZ1bmN0aW9uIGRpc3BsYXlQaWNrZWRhdGUoKSB7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IGRhdGVFbmRQaWNrZXIudGltZS5mb3JtYXQoZm9ybWF0KS50b1N0cmluZygpO1xyXG4gICAgICB9KTtcclxuICAgICAgZGF0ZUVuZFBpY2tlciA9IG5ldyBkUGljay5kZWZhdWx0KHtcclxuICAgICAgICB0eXBlOiAnZGF0ZScsXHJcbiAgICAgICAgaW5pdDogbW9tZW50KGRhdGVFbmRJbnB1dC52YWx1ZSwgZm9ybWF0KSxcclxuICAgICAgICBmdXR1cmU6IG1vbWVudCgpLmFkZCg1LCAneWVhcnMnKSxcclxuICAgICAgICB0cmlnZ2VyOiBkYXRlRW5kSW5wdXQsXHJcbiAgICAgICAgb3JpZW50YXRpb246ICdQT1JUUkFJVCdcclxuICAgICAgfSk7XHJcbiAgICAgIG9ic2VydmVEYXRlUGlja2VyLm9ic2VydmUoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21kZHRwLXBpY2tlcl9fZGF0ZScpLCB7XHJcbiAgICAgICAgYXR0cmlidXRlczogdHJ1ZVxyXG4gICAgICB9KTtcclxuICAgICAgZGF0ZUVuZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIHNob3dEYXRlUGlja2VyKGUpIHtcclxuICAgICAgICBkYXRlRW5kUGlja2VyLnRvZ2dsZSgpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgZnVuY3Rpb24gZW5hYmxlRWRpdCgpIHtcclxuICAgIHZhciBpbnB1dHMgPSBpbmZvQm94Q29udGVudC5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dCcpO1xyXG4gICAgdmFyIGxhYmVscyA9IGluZm9Cb3hDb250ZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2xhYmVsJyk7XHJcbiAgICB2YXIgYnV0dG9ucyA9IGluZm9Cb3hDb250ZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2J1dHRvbicpO1xyXG4gICAgdmFyIGVkaXRDbG9zZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jbG9zZScpO1xyXG4gICAgW10uZm9yRWFjaC5jYWxsKGlucHV0cywgZnVuY3Rpb24gcmVtb3ZlRGlzYWJsZWRJbnB1dHMoZWwpIHtcclxuICAgICAgaWYgKCF1dGlscy5oYXNDbGFzcyhlbCwgJ25vdC1lZGRpdGFibGUnKSkge1xyXG4gICAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBbXS5mb3JFYWNoLmNhbGwobGFiZWxzLCBmdW5jdGlvbiByZW1vdmVEaXNhYmxlZExhYmVscyhlbCkge1xyXG4gICAgICB1dGlscy5yZW1vdmVDbGFzcyhlbCwgJ2lzLWRpc2FibGVkJyk7XHJcbiAgICB9KTtcclxuICAgIFtdLmZvckVhY2guY2FsbChidXR0b25zLCBmdW5jdGlvbiByZW1vdmVEaXNhYmxlZExhYmVscyhlbCkge1xyXG4gICAgICBlbC5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XHJcbiAgICB9KTtcclxuICAgIHV0aWxzLmFkZENsYXNzKGVkaXRCdXR0b24sICdtZGwtYnV0dG9uLS1yYWlzZWQnKTtcclxuICAgIHV0aWxzLnJlbW92ZUNsYXNzKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNlZGl0LWFjdGlvbnMnKSwgJ3Zpc3VhbGx5aGlkZGVuJyk7XHJcbiAgICBlZGl0Q2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiBjYW5jZWxFZGl0KCkge1xyXG4gICAgICBpbmZvQm94Q29udGVudC5pbm5lckhUTUwgPSAnJztcclxuICAgICAgdXRpbHMuYWRkQ2xhc3MoaW5mb0JveENvbnRlbnQsICd2aXN1YWxseWhpZGRlbicpO1xyXG4gICAgICBlZGl0QnV0dG9uLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCB0cnVlKTtcclxuICAgICAgdXRpbHMucmVtb3ZlQ2xhc3MoZWRpdEJ1dHRvbiwgJ21kbC1idXR0b24tLWFjY2VudCcpO1xyXG4gICAgICB1dGlscy5yZW1vdmVDbGFzcyhlZGl0QnV0dG9uLCAnbWRsLWJ1dHRvbi0tcmFpc2VkJyk7XHJcbiAgICB9KTtcclxuICAgIGRhdGVQaWNrZXIoKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGluaXQoKSB7XHJcbiAgICBlZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gYWRkQ2xpY2tFdmVudFRvRWRpdEJ1dHRvbigpIHtcclxuICAgICAgZW5hYmxlRWRpdCgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgaW5pdDogaW5pdFxyXG4gIH07XHJcbn0od2luZG93LCBkb2N1bWVudCwgUHJvbWlzZSwgJCwgbWREYXRlVGltZVBpY2tlciwgbW9tZW50LCBBcHApKTtcclxuIiwidmFyIHVzZXJNYXAgPSAoZnVuY3Rpb24gdXNlck1hcCh3aW5kb3csIGRvY3VtZW50LCBQcm9taXNlLCAkLCBBcHApIHtcclxuICAndXNlIHN0cmljdCc7XHJcbiAgdmFyIGNvbnRleHQgPSAnYWRtaW4nO1xyXG4gIHZhciBsYW5nID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lmxhbmc7XHJcbiAgdmFyICRsb2FkaW5nID0gJCgnLm1kbC1zcGlubmVyJyk7XHJcbiAgJChkb2N1bWVudClcclxuICAuYWpheFN0YXJ0KGZ1bmN0aW9uIHN0YXJ0KCkge1xyXG4gICAgJCgnLnNwaW5lci13cmFwcGVyJykucmVtb3ZlQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7XHJcbiAgICAkbG9hZGluZy5hZGRDbGFzcygnaXMtYWN0aXZlJyk7XHJcbiAgfSlcclxuICAuYWpheFN0b3AoZnVuY3Rpb24gc3RvcCgpIHtcclxuICAgICQoJy5zcGluZXItd3JhcHBlcicpLmFkZENsYXNzKCd2aXN1YWxseWhpZGRlbicpO1xyXG4gICAgJGxvYWRpbmcucmVtb3ZlQ2xhc3MoJ2lzLWFjdGl2ZScpO1xyXG4gIH0pO1xyXG4gIHRvYXN0ci5vcHRpb25zID0ge1xyXG4gICAgY2xvc2VCdXR0b246IGZhbHNlLFxyXG4gICAgZGVidWc6IGZhbHNlLFxyXG4gICAgbmV3ZXN0T25Ub3A6IGZhbHNlLFxyXG4gICAgcHJvZ3Jlc3NCYXI6IGZhbHNlLFxyXG4gICAgcG9zaXRpb25DbGFzczogJ3RvYXN0LXRvcC1jZW50ZXInLFxyXG4gICAgcHJldmVudER1cGxpY2F0ZXM6IGZhbHNlLFxyXG4gICAgb25jbGljazogbnVsbCxcclxuICAgIHNob3dEdXJhdGlvbjogJzMwMCcsXHJcbiAgICBoaWRlRHVyYXRpb246ICcxMDAwJyxcclxuICAgIHRpbWVPdXQ6ICc1MDAwJyxcclxuICAgIGV4dGVuZGVkVGltZU91dDogJzEwMDAnLFxyXG4gICAgc2hvd0Vhc2luZzogJ3N3aW5nJyxcclxuICAgIGhpZGVFYXNpbmc6ICdsaW5lYXInLFxyXG4gICAgc2hvd01ldGhvZDogJ2ZhZGVJbicsXHJcbiAgICBoaWRlTWV0aG9kOiAnZmFkZU91dCdcclxuICB9O1xyXG4gIGZ1bmN0aW9uIGluaXQoKSB7XHJcbiAgICBQcm9taXNlLnJlc29sdmUoXHJcbiAgICAgICQuYWpheCh7XHJcbiAgICAgICAgdXJsOiAnaHR0cDovLzEyNy4wLjAuMTozMDAwL2FwaS9sYW5ndWFnZScsXHJcbiAgICAgICAgdHlwZTogJ0dFVCcsXHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgdHlwZTogbGFuZyxcclxuICAgICAgICAgIGNvbnRleHQ6IGNvbnRleHRcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICAgIClcclxuICAgIC50aGVuKGZ1bmN0aW9uIHJlc29sdmUoZGF0YSkge1xyXG4gICAgICBBcHAuY29uZmlnLmNvbW1vbnMudHJhbnMgPSBkYXRhO1xyXG4gICAgICBBcHAuY29uZmlnLmNvbW1vbnMubWFwID0gQXBwLmNvbmZpZy5tb2R1bGVzLm1hcC5pbml0aWFsaXplKCk7XHJcbiAgICB9KVxyXG4gICAgLnRoZW4oZnVuY3Rpb24gcmVzb2x2ZSgpIHtcclxuICAgICAgQXBwLmNvbmZpZy5tb2R1bGVzLmluZm8uaW5pdCgpO1xyXG4gICAgICBBcHAuY29uZmlnLm1vZHVsZXMuZWRpdC5pbml0KCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGZ1bmN0aW9uIGVycm9yKGUpIHtcclxuICAgICAgY29uc29sZS5sb2coZSk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgcmV0dXJuIHtcclxuICAgIGluaXQ6IGluaXRcclxuICB9O1xyXG59KHdpbmRvdywgZG9jdW1lbnQsIFByb21pc2UsIGpRdWVyeSwgQXBwKSk7XHJcblxyXG52YXIgdXRpbHMgPSB3aW5kb3cuQXBwLnV0aWxzO1xyXG51c2VyTWFwLmluaXQoKTtcclxuJCgnI2xvZ291dCcpLmNsaWNrKGZ1bmN0aW9uIGxvZ291dCgpIHtcclxuICBsb2NhdGlvbi5ocmVmID0gJy9sb2dvdXQnO1xyXG59KTtcclxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VudGVyLWZ1bGxzY3JlZW4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsXHJcbiAgZnVuY3Rpb24gYWRkQ2xpY2tFdmVudFRvRW50ZXJGdWxsc3JlZW4oKSB7XHJcbiAgICB2YXIgZWxlbSA9IGRvY3VtZW50LmJvZHk7XHJcbiAgICB1dGlscy5yZXF1ZXN0RnVsbFNjcmVlbihlbGVtKTtcclxuICAgIHV0aWxzLnJlbW92ZUNsYXNzKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleGl0LWZ1bGxzY3JlZW4nKS5wYXJlbnROb2RlLCAndmlzdWFsbHloaWRkZW4nKTtcclxuICAgIHV0aWxzLmFkZENsYXNzKHRoaXMucGFyZW50Tm9kZSwgJ3Zpc3VhbGx5aGlkZGVuJyk7XHJcbiAgfVxyXG4pO1xyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhpdC1mdWxsc2NyZWVuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLFxyXG4gIGZ1bmN0aW9uIGFkZENsaWNrRXZlbnRUb0V4aXRGdWxsc3JlZW4oKSB7XHJcbiAgICB2YXIgZWxlbSA9IGRvY3VtZW50O1xyXG4gICAgdXRpbHMuZXhpdEZ1bGxzcmVlbihlbGVtKTtcclxuICAgIHV0aWxzLnJlbW92ZUNsYXNzKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbnRlci1mdWxsc2NyZWVuJykucGFyZW50Tm9kZSwgJ3Zpc3VhbGx5aGlkZGVuJyk7XHJcbiAgICB1dGlscy5hZGRDbGFzcyh0aGlzLnBhcmVudE5vZGUsICd2aXN1YWxseWhpZGRlbicpO1xyXG4gIH1cclxuKTtcclxuIl19
