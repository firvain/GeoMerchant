 var center = [3677385, 4120949],
   extent = [3590094, 4102833, 3855483, 4261211],
   lang = document.documentElement.lang,
   styleCache = {},
   geoJSONFormat = new ol.format.GeoJSON({
     defaultDataProjection: 'EPSG:4326'
   });
 var bing = new ol.layer.Tile({
   visible: true,
   source: new ol.source.BingMaps({
     key: 'Ak2Gq8VUfICsPpuf7LRANXmXt2sHWmSLPhohmVLFtFIEwYjs_5MCyAhAFwRSVpLj',
     imagerySet: 'Aerial'
   }),
   maxZoom: 19,
   crossOrigin: 'anonymous',
   preload: Infinity,
   id: 'bing'
 });
 var mapbox = new ol.layer.Tile({
   source: new ol.source.XYZ({
     attributions: [new ol.Attribution({
       html: '<a href=\"https://www.mapbox.com/about/maps/\" target=\"_blank\">&copy; Mapbox &copy; OpenStreetMap</a>'
     })],
     url: 'https://api.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZmlydmFpbiIsImEiOiJlOWYyYTM0NThiNWM0YjJjODJjNDE4ODQzNzA2MGQyNiJ9.-NVDO27Hzt-w_nQosUPfLA'
   }),
   id: 'mapbox'
 });

 function createPropertyStyle(feature) {
   var src;
   if (feature.get('type_en') === 'Sale') {
     src = '../images/map-icons/pins/48/pin2.png';
   } else {
     src = '../images/map-icons/pins/48/pin5.png';
   }
   return new ol.style.Style({
     geometry: feature.getGeometry(),
     image: new ol.style.Icon(({
       src: src,
       anchorOrigin: 'bottom-left',
       anchor: [0, 0],
       scale: 0.7,
     }))
   });
 }

 function propertyStyleFunction(feature, resolution) {
   var size = feature.get('features').length;
   if (size > 1) {
     style = [new ol.style.Style({
       image: new ol.style.Circle({
         radius: 20,
         stroke: new ol.style.Stroke({
           color: [156, 39, 176, 1],
           width: 5
         }),
         fill: new ol.style.Fill({
           color: [68, 138, 255, 0.8]
         })
       }),
       text: new ol.style.Text({
         text: size.toString(),
         fill: new ol.style.Fill({
           color: '#FFFFFF'
         })
       }),
       zIndex: 101
     })];
   } else {
     var originalFeature = feature.get('features')[0];
     style = [createPropertyStyle(originalFeature)];
   }
   return style;
 }

 function selectStyleFunction(feature, resolution) {
   var styles = [new ol.style.Style({})];
   var originalFeatures = feature.get('features');
   var originaFeature;
   for (var i = originalFeatures.length - 1; i >= 0; --i) {
     originalFeature = originalFeatures[i];
     styles.push(createPropertyStyle(originalFeature));
   }
   return styles;
 }
 var propertySource = new ol.source.Vector({
   format: geoJSONFormat,
   loader: function(extent, resolution, projection) {
     var epsg4326Extent = ol.proj.transformExtent(extent, 'EPSG:3857', 'EPSG:4326');
     var url = 'http://localhost:3000/db/property?bbox[x1]=' + epsg4326Extent[0] + '&bbox[y1]=' + epsg4326Extent[1] + '&bbox[x2]=' + epsg4326Extent[2] + '&bbox[y2]=' + epsg4326Extent[3];
     var that = this;
     this.clear();
     $.ajax({
       url: url,
       type: 'GET',
       dataType: 'json',
     }).done(function(response) {
       var features = geoJSONFormat.readFeatures(response, {
         featureProjection: 'EPSG:3857'
       });
       that.addFeatures(features);
     }).fail(function() {
       console.log("error");
     });
   },
   strategy: ol.loadingstrategy.bbox
 });
 var propertyClusterSource = new ol.source.Cluster({
   distance: 40,
   source: propertySource,
   attributions: [new ol.Attribution({
     html: 'All maps © ' + '<a href="http://www.terracognita.gr/">Terra Cognita</a>'
   })]
 });
 var property = new ol.layer.Vector({
   source: propertyClusterSource,
   id: 'estates',
   visible: true,
   style: propertyStyleFunction
 });
 property.setZIndex(2);
 var PSAStyleFunction = function(feature, resolution) {
   var symbol = feature.get('style');
   var text;
   if (lang === 'el') {
     text = feature.get('name_el');
   } else {
     text = feature.get('name_en');
   }
   if (!styleCache[symbol]) {
     styleCache = [new ol.style.Style({
       image: new ol.style.Icon(({
         src: '../images/maki/renders/' + symbol + '-24.png',
         anchorOrigin: 'bottom-left',
         anchor: [0.5, 0.5],
         scale: 1,
       })),
       text: new ol.style.Text({
         text: text,
         stroke: new ol.style.Stroke({
           color: [156, 39, 176, 0.8],
           width: 1
         }),
         offsetY: 12
       })
     })];
   }
   return styleCache;
 };
 var PSA = new ol.layer.Vector({
   style: PSAStyleFunction,
   maxResolution: 3
 });
 PSA.setZIndex(1);

 function filteredEsateStyle(feature, resolution) {
   styleCache = [new ol.style.Style({
     image: new ol.style.Icon(({
       src: '../images/map-icons/pins/48/pin4.png',
       anchorOrigin: 'bottom-left',
       anchor: [0.5, 0.5],
       scale: 0.7,
     }))
   })];
   return styleCache;
 }
 var filteredEstates = new ol.layer.Vector({
   source: new ol.source.Vector({
     format: geoJSONFormat
   }),
   id: 'filteredEstates',
   visible: true,
   style: filteredEsateStyle
 });
 filteredEstates.setZIndex(2);
 var map = new ol.Map({
   target: 'map',
   layers: [mapbox, property, PSA, filteredEstates],
   // interactions: ol.interaction.defaults().extend([new ol.interaction.Select({
   //   condition: function(evt) {
   //     return evt.type === 'singleclick' && ol.events.condition.shiftKeyOnly(evt);
   //   },
   //   style: selectStyleFunction
   // })]),
   loadTilesWhileAnimating: true,
   loadTilesWhileInteracting: true,
   renderer: 'canvas',
   controls: ol.control.defaults({
     attributionOptions: {
       collapsible: false,
       collapsed: false
     }
   }).extend([
     new ol.control.ScaleLine({
       units: 'metric'
     }), new ol.control.OverviewMap({
       className: 'ol-overviewmap ol-custom-overviewmap',
       collapsible: true,
       collapsed: true,
       layers: [bing]
     }),
     new ol.control.ZoomToExtent({
       extent: extent
     })
   ]),
   view: new ol.View({
     center: center,
     extent: extent,
     projection: 'EPSG:3857',
     zoom: 14,
     maxZoom: 19,
     minZoom: 10
   }),
 });
 if (lang === 'el') {
   bing.set('name', 'Δορυφορική εικόνα');
   mapbox.set('name', 'Χάρτης');
   property.set('name', 'Ακίνητα');
 } else {
   bing.set('name', 'Sattelite Image');
   mapbox.set('name', 'Map');
   property.set('name', 'Properties');
 }

 function selectByFilters() {
   PSA.setSource(null);
   var params = {};
   params.leaseType = $("input[name=options]:checked").val();
   params.startPrice = $('#startPrice').val();
   params.endPrice = $('#endPrice').val();
   params.parking = $('#checkbox-1').prop('checked');
   params.furnished = $('#checkbox-2').prop('checked');
   params.heating = $('#checkbox-3').prop('checked');
   params.cooling = $('#checkbox-4').prop('checked');
   params.view = $('#checkbox-5').prop('checked');
   var epsg4326Extent = ol.proj.transformExtent(extent, 'EPSG:3857', 'EPSG:4326');
        toastr.options = {
         "closeButton": false,
         "debug": false,
         "newestOnTop": false,
         "progressBar": false,
         "positionClass": "toast-top-center",
         "preventDuplicates": false,
         "onclick": null,
         "showDuration": "300",
         "hideDuration": "1000",
         "timeOut": "5000",
         "extendedTimeOut": "1000",
         "showEasing": "swing",
         "hideEasing": "linear",
         "showMethod": "fadeIn",
         "hideMethod": "fadeOut"
       };
   $.ajax({
     url: 'http://localhost:3000/db/filteredproperty?bbox[x1]=' + epsg4326Extent[0] + '&bbox[y1]=' + epsg4326Extent[1] + '&bbox[x2]=' + epsg4326Extent[2] + '&bbox[y2]=' + epsg4326Extent[3],
     type: 'GET',
     dataType: 'json',
     data: {
       leaseType: params.leaseType,
       furnished: params.furnished,
       heating: params.heating,
       parking: params.parking,
       cooling: params.cooling,
       view: params.view,
       startPrice: params.startPrice,
       endPrice: params.endPrice
     },
   }).done(function(response) {
     var features = geoJSONFormat.readFeatures(response, {
       featureProjection: 'EPSG:3857'
     });
     console.log(features.length);
     if (features.length > 0) {
      toastr.clear();
       filteredEstates.getSource().clear();
       filteredEstates.getSource().addFeatures(features);
       filteredEstates.setVisible(true);
       property.setVisible(false);
       var extent = filteredEstates.getSource().getExtent();
       var center = [];
     } else {
       toastr.error("No Info Found!");
       filteredEstates.setVisible(false);
       property.setVisible(true);
     }
   });
 }
 $("#clearFilters").click(function() {
   $("input[name=options]").prop('checked', false);
   $('label[for=option-1]').removeClass('is-checked');
   $('label[for=option-2]').removeClass('is-checked');
   $('label[for=checkbox-1]').removeClass('is-checked');
   $('label[for=checkbox-2]').removeClass('is-checked');
   $('label[for=checkbox-3]').removeClass('is-checked');
   $('label[for=checkbox-4]').removeClass('is-checked');
   $('label[for=checkbox-5]').removeClass('is-checked');
   filteredEstates.getSource().clear();
   property.setVisible(true);
   PSA.setSource(null);
 });

(function() {
  var geolocation = new ol.Geolocation({
    // take the projection to use from the map's view
    projection: map.getView().getProjection(),
    trackingOptions: {
      maximumAge: 10000,
      enableHighAccuracy: true,
      timeout: 600000
    }
  });
  var accuracyFeature = new ol.Feature();
  geolocation.on('change:accuracyGeometry', function() {
    accuracyFeature.setGeometry(geolocation.getAccuracyGeometry());
  });
  var positionFeature = new ol.Feature();
  positionFeature.setStyle(new ol.style.Style({
    image: new ol.style.Circle({
      radius: 6,
      fill: new ol.style.Fill({
        color: '#3399CC'
      }),
      stroke: new ol.style.Stroke({
        color: '#fff',
        width: 2
      })
    })
  }));
  // listen to changes in position
  geolocation.on('change:position', function() {
    var coordinates = geolocation.getPosition();
    positionFeature.setGeometry(coordinates ? new ol.geom.Point(coordinates) : null);
  });
  featuresOverlaySource = new ol.source.Vector({});
  var featuresOverlay = new ol.layer.Vector({
    map: map,
    source: featuresOverlaySource
  });
  $('.geolocation').on('change', function(e) {
    e.preventDefault();
    if ($(this).prop('checked') === true) {
      geolocation.setTracking(true);
      featuresOverlaySource.addFeatures([positionFeature,accuracyFeature]);
    } else {
      geolocation.setTracking(false);
      featuresOverlaySource.clear();
    }
  });
}());

function handleInfo(evt) {
  evt.preventDefault();
  var coordinate = evt.coordinate;
  var obj = {};
  var title = {};
  var owner = {};
  var features = [];
  obj.title = title;
  if (lang === 'el') {
    title.estateCode = 'Κωδικός Ιδιοκτησίας';
    title.type = 'Τύπος';
    title.area = 'Εμβαδό';
    title.address = 'Διευθυνση';
    title.bedrooms = 'Υπνοδωμάτια';
    title.price = 'Τιμή';
    title.new = 'Νεόδμητο';
    title.parking = 'Στάθμεση';
    title.furnished = 'Επιπλωμένο';
    title.pets = 'Κατοικίδια';
    title.view = 'Θέα';
    title.heating = 'Θέρμανση';
    title.cooling = 'Ψύξη';
    title.contactInfo = 'Στοιχεία Επικοινωνίας';
    title.name = 'Όνομα';
    title.lastname = 'Επίθετο';
    title.phone = 'Τηλέφωνο';
    title.email = 'Ηλεκτρονική Διεύθυνση';
  } else {
    title.estateCode = 'Estate Code';
    title.type = 'Type';
    title.area = 'Size';
    title.address = 'Address';
    title.bedrooms = 'Bedrooms';
    title.price = 'Price';
    title.new = 'Newly Build';
    title.parking = 'Parking';
    title.furnished = 'Furnished';
    title.pets = 'Pets Allowed';
    title.view = 'View';
    title.heating = 'Heating';
    title.cooling = 'Cooling';
    title.contactInfo = 'Contact Info';
    title.name = 'Name';
    title.lastname = 'Last Name';
    title.phone = 'Telephone';
    title.email = 'Email';
  }
  clickedFeature = map.forEachFeatureAtPixel(evt.pixel, function(feature, layer) {
    return {
      feature: feature,
      layer: layer
    };
  }, this, function(layer) {
    if (layer.get('id') === 'estates' || layer.get('id') === 'filteredEstates') {
      return true;
    }
  }, this);
  var f;
  if (clickedFeature) {
    if (clickedFeature.layer.get('id') === 'estates' && clickedFeature.feature.get('features').length === 1) {
      f = clickedFeature.feature.getProperties().features[0];
      createPSAandCard(f,obj);
    } else if (clickedFeature.layer.get('id') === 'filteredEstates') {
      f = clickedFeature.feature;
      createPSAandCard(f,obj);
    }
  } else {
    PSA.setSource(null);
  }
}

function createPSAandCard(f,obj) {
  var feature = {};
  feature.gid = f.get('gid');
  feature.type = f.get('estatetype');
  feature.area = f.get('estatearea');
  if (lang === 'el') {
    feature.address = f.get('street_el') + ' ' + f.get('h_num_el');
  } else {
    feature.address = f.get('street_en') + ' ' + f.get('h_num_en');
  }
  feature.bedrooms = f.get('bedrooms');
  feature.price = f.get('price');
  feature.new = f.get('new');
  feature.parking = f.get('parking');
  feature.furnished = f.get('furnished');
  feature.pets = f.get('pets');
  feature.view = f.get('view');
  feature.heating = f.get('heating');
  feature.cooling = f.get('cooling');
  if (lang === 'el') {
    feature.name = f.get('name_el');
    feature.lastname = f.get('lastname_el');
  } else {
    feature.name = f.get('name_en');
    feature.lastname = f.get('lastname_en');
  }
  feature.phone = f.get('phone1');
  feature.email = f.get('email');
  feature.coordinate = f.get('geometry').getCoordinates();
  var PSASource = new ol.source.Vector({
    attributions: [new ol.Attribution({
      html: 'POI by ' + '<a href="http://www.terracognita.gr/">Terra Cognita</a>'
    })],
    format: geoJSONFormat,
    loader: function(extent, resolution, projection) {
      var url = 'http://localhost:3000/db/uses/' + feature.gid;
      var that = this;
      $.ajax({
        url: url,
        type: 'GET',
        dataType: 'json',
      }).done(function(response) {
        var features = geoJSONFormat.readFeatures(response.property_services_analysis, {
          featureProjection: 'EPSG:3857'
        });
        var area = new ol.style.Style({
          fill: new ol.style.Fill({
            color: [156, 39, 176, 0.1]
          })
        });
        features[0].setStyle(area);
        that.addFeatures(features);
      }).fail(function() {
        console.log("error");
      });
    },
    strategy: ol.loadingstrategy.all
  });
  PSA.setSource(PSASource);
  map.getView().setCenter(feature.coordinate);
  map.getView().setResolution(1.2);
  obj.feature = feature;
  dust.render('estateCards.dust', obj, function(err, out) {
    $('.estate-cards').html(out);
    $('.estate-cards').removeClass('visuallyhidden');
  });
  $('a[href="#openModal"]').click(function() {
    dust.render('modalInfo.dust', obj, function(err, out) {
      $('.modal-content').html(out);
    });
  });
}
$('.info').on('change', function(e) {
  e.preventDefault();
  PSA.setSource(null);
  if ($(this).prop('checked') === true) {
    map.on('click', handleInfo);
  } else {
    map.un('click', handleInfo);
  }
});

(function() {
  var marker = new ol.Feature();
  var iconStyle = new ol.style.Style({
    image: new ol.style.Icon( /** @type {olx.style.IconOptions} */ ({
      anchor: [0.5, 1],
      anchorXUnits: 'fraction',
      anchorYUnits: 'fraction',
      opacity: 1,
      scale: 1,
      src: '../images/map-icons/pins/24/pin1.png',
      snapToPixel: false
    })),
    zIndex: 100
  });
  marker.setStyle(iconStyle);
  var featuresOverlayStyle = new ol.style.Style({
    stroke: new ol.style.Stroke({
      color: '#408080',
      width: 5,
      lineDash: [4, 4]
    })
  });
  var featuresOverlay = new ol.layer.Vector({
    map: map,
    source: new ol.source.Vector(),
    style: featuresOverlayStyle,
    id: 'route',
    nameEl: 'Διαδρομή',
    NameEn: 'Route'
  });
  var routeCoords = [];

  function handleMarker(event) {
    event.preventDefault();
    var featureCount = featuresOverlay.getSource().getFeatures().length;
    var coordinates = event.coordinate;
    if (featureCount === 0) {
      marker.setGeometry(new ol.geom.Point(coordinates));
      marker.setId('first');
      featuresOverlay.getSource().addFeature(marker);
      routeCoords[0] = coordinates[0];
      routeCoords[1] = coordinates[1];
    } else if (featureCount === 1) {
      var clone = marker.clone();
      clone.setGeometry(new ol.geom.Point(coordinates));
      clone.setId('second');
      featuresOverlay.getSource().addFeature(clone);
      routeCoords[2] = coordinates[0];
      routeCoords[3] = coordinates[1];
      callRoute(routeCoords);
    } else {
      featuresOverlay.getSource().clear();
    }
  }

  geoJSONFormat = new ol.format.GeoJSON({
    defaultDataProjection: 'EPSG:4326',
    geometryName: 'geometry'
  });

  function callRoute(routeCoords) {
    var first = ol.proj.transform([routeCoords[0], routeCoords[1]], 'EPSG:3857', 'EPSG:4326');
    var second = ol.proj.transform([routeCoords[2], routeCoords[3]], 'EPSG:3857', 'EPSG:4326');
    var x1 = first[0];
    var y1 = first[1];
    var x2 = second[0];
    var y2 = second[1];
    $.ajax({
      url: 'https://api.mapbox.com/v4/directions/mapbox.driving/' + x1 + ',' + y1 + ';' + x2 + ',' + y2 + '.json?alternatives=false&access_token=pk.eyJ1IjoiZmlydmFpbiIsImEiOiJlOWYyYTM0NThiNWM0YjJjODJjNDE4ODQzNzA2MGQyNiJ9.-NVDO27Hzt-w_nQosUPfLA',
      type: 'GET',
      dataType: 'json'
    }).done(function(data) {
      var route={};
      route.type ="Feature";
      route.geometry = data.routes[0].geometry;
      featuresOverlay.getSource().addFeatures(geoJSONFormat.readFeatures(route, {
        dataProjection: 'EPSG:4326',
        featureProjection: 'EPSG:3857'
      }));
      map.getView().fit(featuresOverlay.getSource().getExtent(), map.getSize());
    }).fail(function() {
      console.log("error");
    }).always(function() {
      console.log("complete");
    });
  }
  $('.marker').on('change', function(event) {
    event.preventDefault();
    /* Act on the event */
    if ($(this).prop('checked') === true) {
      map.on('singleclick', handleMarker);
    } else {
      map.un('singleclick', handleMarker);
      featuresOverlay.getSource().clear();
    }
  });
}());

(function() {
  $('.weather').change(function() {
    if ($(this).prop('checked') === true) {
        map.getOverlays().forEach(function(ovl) {
        if (ovl.get('name') === 'weather') {
          ($(ovl.getElement()).parent()).remove();
          $(ovl.getElement()).remove();
        }
      });
      var center = ol.proj.transform(map.getView().getCenter(), 'EPSG:3857', 'EPSG:4326');
      var lat = center[1];
      var lon = center[0];
      $.ajax({
        url: 'http://api.openweathermap.org/data/2.5/find?lat=' + lat + '&lon=' + lon + '&cnt=5&cluster=no&units=metric&type=accurate&APPID=f9cd9fa2c427c3b115e87e4862619c5c',
        type: 'GET',
        dataType: 'json',
      }).done(function(data) {
        function createWeatherOverlay(position, index) {
          var elem = document.createElement('div');
          elem.setAttribute('class', 'weather-popup default-primary-color mdl-shadow--6dp');
          elem.setAttribute('id', index);
          elem.setAttribute('data-name', 'weather');
          return new ol.Overlay({
            element: elem,
            position: position,
          });
        }
        var objs = data.list;
        var overlay, coordinates;
        $.each(objs, function(index, val) {
          coordinates = ol.proj.transform([val.coord.lon, val.coord.lat], 'EPSG:4326', 'EPSG:3857');
          overlay = createWeatherOverlay(coordinates, index);
          map.addOverlay(overlay);
          overlay.set('name', 'weather');
          weatherData = {
            'name': val.name,
            'temp': val.main.temp,
            'pressure': val.main.pressure,
            'humidity': val.main.humidity
          };
          dust.render('weatherPopup.dust', weatherData, function(err, out) {
            $("#" + index).html(out);
          });
        });
      }).fail(function() {
        // toastr.error("Δεν βρέθηκαν πληροφορίες για τις καιρικές συνθήκες!");
      });
    } else if ($(this).prop('checked') === false) {
      map.getOverlays().forEach(function(ovl) {
        if (ovl.get('name') === 'weather') {
          ($(ovl.getElement()).parent()).remove();
          $(ovl.getElement()).remove();
        }
      });
    }
  });
}());

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hcC5qcyIsImZpbHRlcnMuanMiLCJnZW9sb2NhdGlvbi5qcyIsImluZm8uanMiLCJyb3V0aW5nLmpzIiwid2VhdGhlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoic2NyaXB0cy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIgdmFyIGNlbnRlciA9IFszNjc3Mzg1LCA0MTIwOTQ5XSxcclxuICAgZXh0ZW50ID0gWzM1OTAwOTQsIDQxMDI4MzMsIDM4NTU0ODMsIDQyNjEyMTFdLFxyXG4gICBsYW5nID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmxhbmcsXHJcbiAgIHN0eWxlQ2FjaGUgPSB7fSxcclxuICAgZ2VvSlNPTkZvcm1hdCA9IG5ldyBvbC5mb3JtYXQuR2VvSlNPTih7XHJcbiAgICAgZGVmYXVsdERhdGFQcm9qZWN0aW9uOiAnRVBTRzo0MzI2J1xyXG4gICB9KTtcclxuIHZhciBiaW5nID0gbmV3IG9sLmxheWVyLlRpbGUoe1xyXG4gICB2aXNpYmxlOiB0cnVlLFxyXG4gICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuQmluZ01hcHMoe1xyXG4gICAgIGtleTogJ0FrMkdxOFZVZklDc1BwdWY3TFJBTlhtWHQyc0hXbVNMUGhvaG1WTEZ0RklFd1lqc181TUN5QWhBRndSU1ZwTGonLFxyXG4gICAgIGltYWdlcnlTZXQ6ICdBZXJpYWwnXHJcbiAgIH0pLFxyXG4gICBtYXhab29tOiAxOSxcclxuICAgY3Jvc3NPcmlnaW46ICdhbm9ueW1vdXMnLFxyXG4gICBwcmVsb2FkOiBJbmZpbml0eSxcclxuICAgaWQ6ICdiaW5nJ1xyXG4gfSk7XHJcbiB2YXIgbWFwYm94ID0gbmV3IG9sLmxheWVyLlRpbGUoe1xyXG4gICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuWFlaKHtcclxuICAgICBhdHRyaWJ1dGlvbnM6IFtuZXcgb2wuQXR0cmlidXRpb24oe1xyXG4gICAgICAgaHRtbDogJzxhIGhyZWY9XFxcImh0dHBzOi8vd3d3Lm1hcGJveC5jb20vYWJvdXQvbWFwcy9cXFwiIHRhcmdldD1cXFwiX2JsYW5rXFxcIj4mY29weTsgTWFwYm94ICZjb3B5OyBPcGVuU3RyZWV0TWFwPC9hPidcclxuICAgICB9KV0sXHJcbiAgICAgdXJsOiAnaHR0cHM6Ly9hcGkubWFwYm94LmNvbS92NC9tYXBib3guc3RyZWV0cy97en0ve3h9L3t5fS5wbmc/YWNjZXNzX3Rva2VuPXBrLmV5SjFJam9pWm1seWRtRnBiaUlzSW1FaU9pSmxPV1l5WVRNME5UaGlOV00wWWpKak9ESmpOREU0T0RRek56QTJNR1F5TmlKOS4tTlZETzI3SHp0LXdfblFvc1VQZkxBJ1xyXG4gICB9KSxcclxuICAgaWQ6ICdtYXBib3gnXHJcbiB9KTtcclxuXHJcbiBmdW5jdGlvbiBjcmVhdGVQcm9wZXJ0eVN0eWxlKGZlYXR1cmUpIHtcclxuICAgdmFyIHNyYztcclxuICAgaWYgKGZlYXR1cmUuZ2V0KCd0eXBlX2VuJykgPT09ICdTYWxlJykge1xyXG4gICAgIHNyYyA9ICcuLi9pbWFnZXMvbWFwLWljb25zL3BpbnMvNDgvcGluMi5wbmcnO1xyXG4gICB9IGVsc2Uge1xyXG4gICAgIHNyYyA9ICcuLi9pbWFnZXMvbWFwLWljb25zL3BpbnMvNDgvcGluNS5wbmcnO1xyXG4gICB9XHJcbiAgIHJldHVybiBuZXcgb2wuc3R5bGUuU3R5bGUoe1xyXG4gICAgIGdlb21ldHJ5OiBmZWF0dXJlLmdldEdlb21ldHJ5KCksXHJcbiAgICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5JY29uKCh7XHJcbiAgICAgICBzcmM6IHNyYyxcclxuICAgICAgIGFuY2hvck9yaWdpbjogJ2JvdHRvbS1sZWZ0JyxcclxuICAgICAgIGFuY2hvcjogWzAsIDBdLFxyXG4gICAgICAgc2NhbGU6IDAuNyxcclxuICAgICB9KSlcclxuICAgfSk7XHJcbiB9XHJcblxyXG4gZnVuY3Rpb24gcHJvcGVydHlTdHlsZUZ1bmN0aW9uKGZlYXR1cmUsIHJlc29sdXRpb24pIHtcclxuICAgdmFyIHNpemUgPSBmZWF0dXJlLmdldCgnZmVhdHVyZXMnKS5sZW5ndGg7XHJcbiAgIGlmIChzaXplID4gMSkge1xyXG4gICAgIHN0eWxlID0gW25ldyBvbC5zdHlsZS5TdHlsZSh7XHJcbiAgICAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkNpcmNsZSh7XHJcbiAgICAgICAgIHJhZGl1czogMjAsXHJcbiAgICAgICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XHJcbiAgICAgICAgICAgY29sb3I6IFsxNTYsIDM5LCAxNzYsIDFdLFxyXG4gICAgICAgICAgIHdpZHRoOiA1XHJcbiAgICAgICAgIH0pLFxyXG4gICAgICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XHJcbiAgICAgICAgICAgY29sb3I6IFs2OCwgMTM4LCAyNTUsIDAuOF1cclxuICAgICAgICAgfSlcclxuICAgICAgIH0pLFxyXG4gICAgICAgdGV4dDogbmV3IG9sLnN0eWxlLlRleHQoe1xyXG4gICAgICAgICB0ZXh0OiBzaXplLnRvU3RyaW5nKCksXHJcbiAgICAgICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcclxuICAgICAgICAgICBjb2xvcjogJyNGRkZGRkYnXHJcbiAgICAgICAgIH0pXHJcbiAgICAgICB9KSxcclxuICAgICAgIHpJbmRleDogMTAxXHJcbiAgICAgfSldO1xyXG4gICB9IGVsc2Uge1xyXG4gICAgIHZhciBvcmlnaW5hbEZlYXR1cmUgPSBmZWF0dXJlLmdldCgnZmVhdHVyZXMnKVswXTtcclxuICAgICBzdHlsZSA9IFtjcmVhdGVQcm9wZXJ0eVN0eWxlKG9yaWdpbmFsRmVhdHVyZSldO1xyXG4gICB9XHJcbiAgIHJldHVybiBzdHlsZTtcclxuIH1cclxuXHJcbiBmdW5jdGlvbiBzZWxlY3RTdHlsZUZ1bmN0aW9uKGZlYXR1cmUsIHJlc29sdXRpb24pIHtcclxuICAgdmFyIHN0eWxlcyA9IFtuZXcgb2wuc3R5bGUuU3R5bGUoe30pXTtcclxuICAgdmFyIG9yaWdpbmFsRmVhdHVyZXMgPSBmZWF0dXJlLmdldCgnZmVhdHVyZXMnKTtcclxuICAgdmFyIG9yaWdpbmFGZWF0dXJlO1xyXG4gICBmb3IgKHZhciBpID0gb3JpZ2luYWxGZWF0dXJlcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xyXG4gICAgIG9yaWdpbmFsRmVhdHVyZSA9IG9yaWdpbmFsRmVhdHVyZXNbaV07XHJcbiAgICAgc3R5bGVzLnB1c2goY3JlYXRlUHJvcGVydHlTdHlsZShvcmlnaW5hbEZlYXR1cmUpKTtcclxuICAgfVxyXG4gICByZXR1cm4gc3R5bGVzO1xyXG4gfVxyXG4gdmFyIHByb3BlcnR5U291cmNlID0gbmV3IG9sLnNvdXJjZS5WZWN0b3Ioe1xyXG4gICBmb3JtYXQ6IGdlb0pTT05Gb3JtYXQsXHJcbiAgIGxvYWRlcjogZnVuY3Rpb24oZXh0ZW50LCByZXNvbHV0aW9uLCBwcm9qZWN0aW9uKSB7XHJcbiAgICAgdmFyIGVwc2c0MzI2RXh0ZW50ID0gb2wucHJvai50cmFuc2Zvcm1FeHRlbnQoZXh0ZW50LCAnRVBTRzozODU3JywgJ0VQU0c6NDMyNicpO1xyXG4gICAgIHZhciB1cmwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2RiL3Byb3BlcnR5P2Jib3hbeDFdPScgKyBlcHNnNDMyNkV4dGVudFswXSArICcmYmJveFt5MV09JyArIGVwc2c0MzI2RXh0ZW50WzFdICsgJyZiYm94W3gyXT0nICsgZXBzZzQzMjZFeHRlbnRbMl0gKyAnJmJib3hbeTJdPScgKyBlcHNnNDMyNkV4dGVudFszXTtcclxuICAgICB2YXIgdGhhdCA9IHRoaXM7XHJcbiAgICAgdGhpcy5jbGVhcigpO1xyXG4gICAgICQuYWpheCh7XHJcbiAgICAgICB1cmw6IHVybCxcclxuICAgICAgIHR5cGU6ICdHRVQnLFxyXG4gICAgICAgZGF0YVR5cGU6ICdqc29uJyxcclxuICAgICB9KS5kb25lKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICB2YXIgZmVhdHVyZXMgPSBnZW9KU09ORm9ybWF0LnJlYWRGZWF0dXJlcyhyZXNwb25zZSwge1xyXG4gICAgICAgICBmZWF0dXJlUHJvamVjdGlvbjogJ0VQU0c6Mzg1NydcclxuICAgICAgIH0pO1xyXG4gICAgICAgdGhhdC5hZGRGZWF0dXJlcyhmZWF0dXJlcyk7XHJcbiAgICAgfSkuZmFpbChmdW5jdGlvbigpIHtcclxuICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3JcIik7XHJcbiAgICAgfSk7XHJcbiAgIH0sXHJcbiAgIHN0cmF0ZWd5OiBvbC5sb2FkaW5nc3RyYXRlZ3kuYmJveFxyXG4gfSk7XHJcbiB2YXIgcHJvcGVydHlDbHVzdGVyU291cmNlID0gbmV3IG9sLnNvdXJjZS5DbHVzdGVyKHtcclxuICAgZGlzdGFuY2U6IDQwLFxyXG4gICBzb3VyY2U6IHByb3BlcnR5U291cmNlLFxyXG4gICBhdHRyaWJ1dGlvbnM6IFtuZXcgb2wuQXR0cmlidXRpb24oe1xyXG4gICAgIGh0bWw6ICdBbGwgbWFwcyDCqSAnICsgJzxhIGhyZWY9XCJodHRwOi8vd3d3LnRlcnJhY29nbml0YS5nci9cIj5UZXJyYSBDb2duaXRhPC9hPidcclxuICAgfSldXHJcbiB9KTtcclxuIHZhciBwcm9wZXJ0eSA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xyXG4gICBzb3VyY2U6IHByb3BlcnR5Q2x1c3RlclNvdXJjZSxcclxuICAgaWQ6ICdlc3RhdGVzJyxcclxuICAgdmlzaWJsZTogdHJ1ZSxcclxuICAgc3R5bGU6IHByb3BlcnR5U3R5bGVGdW5jdGlvblxyXG4gfSk7XHJcbiBwcm9wZXJ0eS5zZXRaSW5kZXgoMik7XHJcbiB2YXIgUFNBU3R5bGVGdW5jdGlvbiA9IGZ1bmN0aW9uKGZlYXR1cmUsIHJlc29sdXRpb24pIHtcclxuICAgdmFyIHN5bWJvbCA9IGZlYXR1cmUuZ2V0KCdzdHlsZScpO1xyXG4gICB2YXIgdGV4dDtcclxuICAgaWYgKGxhbmcgPT09ICdlbCcpIHtcclxuICAgICB0ZXh0ID0gZmVhdHVyZS5nZXQoJ25hbWVfZWwnKTtcclxuICAgfSBlbHNlIHtcclxuICAgICB0ZXh0ID0gZmVhdHVyZS5nZXQoJ25hbWVfZW4nKTtcclxuICAgfVxyXG4gICBpZiAoIXN0eWxlQ2FjaGVbc3ltYm9sXSkge1xyXG4gICAgIHN0eWxlQ2FjaGUgPSBbbmV3IG9sLnN0eWxlLlN0eWxlKHtcclxuICAgICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuSWNvbigoe1xyXG4gICAgICAgICBzcmM6ICcuLi9pbWFnZXMvbWFraS9yZW5kZXJzLycgKyBzeW1ib2wgKyAnLTI0LnBuZycsXHJcbiAgICAgICAgIGFuY2hvck9yaWdpbjogJ2JvdHRvbS1sZWZ0JyxcclxuICAgICAgICAgYW5jaG9yOiBbMC41LCAwLjVdLFxyXG4gICAgICAgICBzY2FsZTogMSxcclxuICAgICAgIH0pKSxcclxuICAgICAgIHRleHQ6IG5ldyBvbC5zdHlsZS5UZXh0KHtcclxuICAgICAgICAgdGV4dDogdGV4dCxcclxuICAgICAgICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcclxuICAgICAgICAgICBjb2xvcjogWzE1NiwgMzksIDE3NiwgMC44XSxcclxuICAgICAgICAgICB3aWR0aDogMVxyXG4gICAgICAgICB9KSxcclxuICAgICAgICAgb2Zmc2V0WTogMTJcclxuICAgICAgIH0pXHJcbiAgICAgfSldO1xyXG4gICB9XHJcbiAgIHJldHVybiBzdHlsZUNhY2hlO1xyXG4gfTtcclxuIHZhciBQU0EgPSBuZXcgb2wubGF5ZXIuVmVjdG9yKHtcclxuICAgc3R5bGU6IFBTQVN0eWxlRnVuY3Rpb24sXHJcbiAgIG1heFJlc29sdXRpb246IDNcclxuIH0pO1xyXG4gUFNBLnNldFpJbmRleCgxKTtcclxuXHJcbiBmdW5jdGlvbiBmaWx0ZXJlZEVzYXRlU3R5bGUoZmVhdHVyZSwgcmVzb2x1dGlvbikge1xyXG4gICBzdHlsZUNhY2hlID0gW25ldyBvbC5zdHlsZS5TdHlsZSh7XHJcbiAgICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5JY29uKCh7XHJcbiAgICAgICBzcmM6ICcuLi9pbWFnZXMvbWFwLWljb25zL3BpbnMvNDgvcGluNC5wbmcnLFxyXG4gICAgICAgYW5jaG9yT3JpZ2luOiAnYm90dG9tLWxlZnQnLFxyXG4gICAgICAgYW5jaG9yOiBbMC41LCAwLjVdLFxyXG4gICAgICAgc2NhbGU6IDAuNyxcclxuICAgICB9KSlcclxuICAgfSldO1xyXG4gICByZXR1cm4gc3R5bGVDYWNoZTtcclxuIH1cclxuIHZhciBmaWx0ZXJlZEVzdGF0ZXMgPSBuZXcgb2wubGF5ZXIuVmVjdG9yKHtcclxuICAgc291cmNlOiBuZXcgb2wuc291cmNlLlZlY3Rvcih7XHJcbiAgICAgZm9ybWF0OiBnZW9KU09ORm9ybWF0XHJcbiAgIH0pLFxyXG4gICBpZDogJ2ZpbHRlcmVkRXN0YXRlcycsXHJcbiAgIHZpc2libGU6IHRydWUsXHJcbiAgIHN0eWxlOiBmaWx0ZXJlZEVzYXRlU3R5bGVcclxuIH0pO1xyXG4gZmlsdGVyZWRFc3RhdGVzLnNldFpJbmRleCgyKTtcclxuIHZhciBtYXAgPSBuZXcgb2wuTWFwKHtcclxuICAgdGFyZ2V0OiAnbWFwJyxcclxuICAgbGF5ZXJzOiBbbWFwYm94LCBwcm9wZXJ0eSwgUFNBLCBmaWx0ZXJlZEVzdGF0ZXNdLFxyXG4gICAvLyBpbnRlcmFjdGlvbnM6IG9sLmludGVyYWN0aW9uLmRlZmF1bHRzKCkuZXh0ZW5kKFtuZXcgb2wuaW50ZXJhY3Rpb24uU2VsZWN0KHtcclxuICAgLy8gICBjb25kaXRpb246IGZ1bmN0aW9uKGV2dCkge1xyXG4gICAvLyAgICAgcmV0dXJuIGV2dC50eXBlID09PSAnc2luZ2xlY2xpY2snICYmIG9sLmV2ZW50cy5jb25kaXRpb24uc2hpZnRLZXlPbmx5KGV2dCk7XHJcbiAgIC8vICAgfSxcclxuICAgLy8gICBzdHlsZTogc2VsZWN0U3R5bGVGdW5jdGlvblxyXG4gICAvLyB9KV0pLFxyXG4gICBsb2FkVGlsZXNXaGlsZUFuaW1hdGluZzogdHJ1ZSxcclxuICAgbG9hZFRpbGVzV2hpbGVJbnRlcmFjdGluZzogdHJ1ZSxcclxuICAgcmVuZGVyZXI6ICdjYW52YXMnLFxyXG4gICBjb250cm9sczogb2wuY29udHJvbC5kZWZhdWx0cyh7XHJcbiAgICAgYXR0cmlidXRpb25PcHRpb25zOiB7XHJcbiAgICAgICBjb2xsYXBzaWJsZTogZmFsc2UsXHJcbiAgICAgICBjb2xsYXBzZWQ6IGZhbHNlXHJcbiAgICAgfVxyXG4gICB9KS5leHRlbmQoW1xyXG4gICAgIG5ldyBvbC5jb250cm9sLlNjYWxlTGluZSh7XHJcbiAgICAgICB1bml0czogJ21ldHJpYydcclxuICAgICB9KSwgbmV3IG9sLmNvbnRyb2wuT3ZlcnZpZXdNYXAoe1xyXG4gICAgICAgY2xhc3NOYW1lOiAnb2wtb3ZlcnZpZXdtYXAgb2wtY3VzdG9tLW92ZXJ2aWV3bWFwJyxcclxuICAgICAgIGNvbGxhcHNpYmxlOiB0cnVlLFxyXG4gICAgICAgY29sbGFwc2VkOiB0cnVlLFxyXG4gICAgICAgbGF5ZXJzOiBbYmluZ11cclxuICAgICB9KSxcclxuICAgICBuZXcgb2wuY29udHJvbC5ab29tVG9FeHRlbnQoe1xyXG4gICAgICAgZXh0ZW50OiBleHRlbnRcclxuICAgICB9KVxyXG4gICBdKSxcclxuICAgdmlldzogbmV3IG9sLlZpZXcoe1xyXG4gICAgIGNlbnRlcjogY2VudGVyLFxyXG4gICAgIGV4dGVudDogZXh0ZW50LFxyXG4gICAgIHByb2plY3Rpb246ICdFUFNHOjM4NTcnLFxyXG4gICAgIHpvb206IDE0LFxyXG4gICAgIG1heFpvb206IDE5LFxyXG4gICAgIG1pblpvb206IDEwXHJcbiAgIH0pLFxyXG4gfSk7XHJcbiBpZiAobGFuZyA9PT0gJ2VsJykge1xyXG4gICBiaW5nLnNldCgnbmFtZScsICfOlM6/z4HPhc+Gzr/Pgc65zrrOriDOtc65zrrPjM69zrEnKTtcclxuICAgbWFwYm94LnNldCgnbmFtZScsICfOp86sz4HPhM63z4InKTtcclxuICAgcHJvcGVydHkuc2V0KCduYW1lJywgJ86RzrrOr869zrfPhM6xJyk7XHJcbiB9IGVsc2Uge1xyXG4gICBiaW5nLnNldCgnbmFtZScsICdTYXR0ZWxpdGUgSW1hZ2UnKTtcclxuICAgbWFwYm94LnNldCgnbmFtZScsICdNYXAnKTtcclxuICAgcHJvcGVydHkuc2V0KCduYW1lJywgJ1Byb3BlcnRpZXMnKTtcclxuIH1cclxuIiwiIGZ1bmN0aW9uIHNlbGVjdEJ5RmlsdGVycygpIHtcclxuICAgUFNBLnNldFNvdXJjZShudWxsKTtcclxuICAgdmFyIHBhcmFtcyA9IHt9O1xyXG4gICBwYXJhbXMubGVhc2VUeXBlID0gJChcImlucHV0W25hbWU9b3B0aW9uc106Y2hlY2tlZFwiKS52YWwoKTtcclxuICAgcGFyYW1zLnN0YXJ0UHJpY2UgPSAkKCcjc3RhcnRQcmljZScpLnZhbCgpO1xyXG4gICBwYXJhbXMuZW5kUHJpY2UgPSAkKCcjZW5kUHJpY2UnKS52YWwoKTtcclxuICAgcGFyYW1zLnBhcmtpbmcgPSAkKCcjY2hlY2tib3gtMScpLnByb3AoJ2NoZWNrZWQnKTtcclxuICAgcGFyYW1zLmZ1cm5pc2hlZCA9ICQoJyNjaGVja2JveC0yJykucHJvcCgnY2hlY2tlZCcpO1xyXG4gICBwYXJhbXMuaGVhdGluZyA9ICQoJyNjaGVja2JveC0zJykucHJvcCgnY2hlY2tlZCcpO1xyXG4gICBwYXJhbXMuY29vbGluZyA9ICQoJyNjaGVja2JveC00JykucHJvcCgnY2hlY2tlZCcpO1xyXG4gICBwYXJhbXMudmlldyA9ICQoJyNjaGVja2JveC01JykucHJvcCgnY2hlY2tlZCcpO1xyXG4gICB2YXIgZXBzZzQzMjZFeHRlbnQgPSBvbC5wcm9qLnRyYW5zZm9ybUV4dGVudChleHRlbnQsICdFUFNHOjM4NTcnLCAnRVBTRzo0MzI2Jyk7XHJcbiAgICAgICAgdG9hc3RyLm9wdGlvbnMgPSB7XHJcbiAgICAgICAgIFwiY2xvc2VCdXR0b25cIjogZmFsc2UsXHJcbiAgICAgICAgIFwiZGVidWdcIjogZmFsc2UsXHJcbiAgICAgICAgIFwibmV3ZXN0T25Ub3BcIjogZmFsc2UsXHJcbiAgICAgICAgIFwicHJvZ3Jlc3NCYXJcIjogZmFsc2UsXHJcbiAgICAgICAgIFwicG9zaXRpb25DbGFzc1wiOiBcInRvYXN0LXRvcC1jZW50ZXJcIixcclxuICAgICAgICAgXCJwcmV2ZW50RHVwbGljYXRlc1wiOiBmYWxzZSxcclxuICAgICAgICAgXCJvbmNsaWNrXCI6IG51bGwsXHJcbiAgICAgICAgIFwic2hvd0R1cmF0aW9uXCI6IFwiMzAwXCIsXHJcbiAgICAgICAgIFwiaGlkZUR1cmF0aW9uXCI6IFwiMTAwMFwiLFxyXG4gICAgICAgICBcInRpbWVPdXRcIjogXCI1MDAwXCIsXHJcbiAgICAgICAgIFwiZXh0ZW5kZWRUaW1lT3V0XCI6IFwiMTAwMFwiLFxyXG4gICAgICAgICBcInNob3dFYXNpbmdcIjogXCJzd2luZ1wiLFxyXG4gICAgICAgICBcImhpZGVFYXNpbmdcIjogXCJsaW5lYXJcIixcclxuICAgICAgICAgXCJzaG93TWV0aG9kXCI6IFwiZmFkZUluXCIsXHJcbiAgICAgICAgIFwiaGlkZU1ldGhvZFwiOiBcImZhZGVPdXRcIlxyXG4gICAgICAgfTtcclxuICAgJC5hamF4KHtcclxuICAgICB1cmw6ICdodHRwOi8vbG9jYWxob3N0OjMwMDAvZGIvZmlsdGVyZWRwcm9wZXJ0eT9iYm94W3gxXT0nICsgZXBzZzQzMjZFeHRlbnRbMF0gKyAnJmJib3hbeTFdPScgKyBlcHNnNDMyNkV4dGVudFsxXSArICcmYmJveFt4Ml09JyArIGVwc2c0MzI2RXh0ZW50WzJdICsgJyZiYm94W3kyXT0nICsgZXBzZzQzMjZFeHRlbnRbM10sXHJcbiAgICAgdHlwZTogJ0dFVCcsXHJcbiAgICAgZGF0YVR5cGU6ICdqc29uJyxcclxuICAgICBkYXRhOiB7XHJcbiAgICAgICBsZWFzZVR5cGU6IHBhcmFtcy5sZWFzZVR5cGUsXHJcbiAgICAgICBmdXJuaXNoZWQ6IHBhcmFtcy5mdXJuaXNoZWQsXHJcbiAgICAgICBoZWF0aW5nOiBwYXJhbXMuaGVhdGluZyxcclxuICAgICAgIHBhcmtpbmc6IHBhcmFtcy5wYXJraW5nLFxyXG4gICAgICAgY29vbGluZzogcGFyYW1zLmNvb2xpbmcsXHJcbiAgICAgICB2aWV3OiBwYXJhbXMudmlldyxcclxuICAgICAgIHN0YXJ0UHJpY2U6IHBhcmFtcy5zdGFydFByaWNlLFxyXG4gICAgICAgZW5kUHJpY2U6IHBhcmFtcy5lbmRQcmljZVxyXG4gICAgIH0sXHJcbiAgIH0pLmRvbmUoZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICB2YXIgZmVhdHVyZXMgPSBnZW9KU09ORm9ybWF0LnJlYWRGZWF0dXJlcyhyZXNwb25zZSwge1xyXG4gICAgICAgZmVhdHVyZVByb2plY3Rpb246ICdFUFNHOjM4NTcnXHJcbiAgICAgfSk7XHJcbiAgICAgY29uc29sZS5sb2coZmVhdHVyZXMubGVuZ3RoKTtcclxuICAgICBpZiAoZmVhdHVyZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0b2FzdHIuY2xlYXIoKTtcclxuICAgICAgIGZpbHRlcmVkRXN0YXRlcy5nZXRTb3VyY2UoKS5jbGVhcigpO1xyXG4gICAgICAgZmlsdGVyZWRFc3RhdGVzLmdldFNvdXJjZSgpLmFkZEZlYXR1cmVzKGZlYXR1cmVzKTtcclxuICAgICAgIGZpbHRlcmVkRXN0YXRlcy5zZXRWaXNpYmxlKHRydWUpO1xyXG4gICAgICAgcHJvcGVydHkuc2V0VmlzaWJsZShmYWxzZSk7XHJcbiAgICAgICB2YXIgZXh0ZW50ID0gZmlsdGVyZWRFc3RhdGVzLmdldFNvdXJjZSgpLmdldEV4dGVudCgpO1xyXG4gICAgICAgdmFyIGNlbnRlciA9IFtdO1xyXG4gICAgIH0gZWxzZSB7XHJcbiAgICAgICB0b2FzdHIuZXJyb3IoXCJObyBJbmZvIEZvdW5kIVwiKTtcclxuICAgICAgIGZpbHRlcmVkRXN0YXRlcy5zZXRWaXNpYmxlKGZhbHNlKTtcclxuICAgICAgIHByb3BlcnR5LnNldFZpc2libGUodHJ1ZSk7XHJcbiAgICAgfVxyXG4gICB9KTtcclxuIH1cclxuICQoXCIjY2xlYXJGaWx0ZXJzXCIpLmNsaWNrKGZ1bmN0aW9uKCkge1xyXG4gICAkKFwiaW5wdXRbbmFtZT1vcHRpb25zXVwiKS5wcm9wKCdjaGVja2VkJywgZmFsc2UpO1xyXG4gICAkKCdsYWJlbFtmb3I9b3B0aW9uLTFdJykucmVtb3ZlQ2xhc3MoJ2lzLWNoZWNrZWQnKTtcclxuICAgJCgnbGFiZWxbZm9yPW9wdGlvbi0yXScpLnJlbW92ZUNsYXNzKCdpcy1jaGVja2VkJyk7XHJcbiAgICQoJ2xhYmVsW2Zvcj1jaGVja2JveC0xXScpLnJlbW92ZUNsYXNzKCdpcy1jaGVja2VkJyk7XHJcbiAgICQoJ2xhYmVsW2Zvcj1jaGVja2JveC0yXScpLnJlbW92ZUNsYXNzKCdpcy1jaGVja2VkJyk7XHJcbiAgICQoJ2xhYmVsW2Zvcj1jaGVja2JveC0zXScpLnJlbW92ZUNsYXNzKCdpcy1jaGVja2VkJyk7XHJcbiAgICQoJ2xhYmVsW2Zvcj1jaGVja2JveC00XScpLnJlbW92ZUNsYXNzKCdpcy1jaGVja2VkJyk7XHJcbiAgICQoJ2xhYmVsW2Zvcj1jaGVja2JveC01XScpLnJlbW92ZUNsYXNzKCdpcy1jaGVja2VkJyk7XHJcbiAgIGZpbHRlcmVkRXN0YXRlcy5nZXRTb3VyY2UoKS5jbGVhcigpO1xyXG4gICBwcm9wZXJ0eS5zZXRWaXNpYmxlKHRydWUpO1xyXG4gICBQU0Euc2V0U291cmNlKG51bGwpO1xyXG4gfSk7XHJcbiIsIihmdW5jdGlvbigpIHtcclxuICB2YXIgZ2VvbG9jYXRpb24gPSBuZXcgb2wuR2VvbG9jYXRpb24oe1xyXG4gICAgLy8gdGFrZSB0aGUgcHJvamVjdGlvbiB0byB1c2UgZnJvbSB0aGUgbWFwJ3Mgdmlld1xyXG4gICAgcHJvamVjdGlvbjogbWFwLmdldFZpZXcoKS5nZXRQcm9qZWN0aW9uKCksXHJcbiAgICB0cmFja2luZ09wdGlvbnM6IHtcclxuICAgICAgbWF4aW11bUFnZTogMTAwMDAsXHJcbiAgICAgIGVuYWJsZUhpZ2hBY2N1cmFjeTogdHJ1ZSxcclxuICAgICAgdGltZW91dDogNjAwMDAwXHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgdmFyIGFjY3VyYWN5RmVhdHVyZSA9IG5ldyBvbC5GZWF0dXJlKCk7XHJcbiAgZ2VvbG9jYXRpb24ub24oJ2NoYW5nZTphY2N1cmFjeUdlb21ldHJ5JywgZnVuY3Rpb24oKSB7XHJcbiAgICBhY2N1cmFjeUZlYXR1cmUuc2V0R2VvbWV0cnkoZ2VvbG9jYXRpb24uZ2V0QWNjdXJhY3lHZW9tZXRyeSgpKTtcclxuICB9KTtcclxuICB2YXIgcG9zaXRpb25GZWF0dXJlID0gbmV3IG9sLkZlYXR1cmUoKTtcclxuICBwb3NpdGlvbkZlYXR1cmUuc2V0U3R5bGUobmV3IG9sLnN0eWxlLlN0eWxlKHtcclxuICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuQ2lyY2xlKHtcclxuICAgICAgcmFkaXVzOiA2LFxyXG4gICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XHJcbiAgICAgICAgY29sb3I6ICcjMzM5OUNDJ1xyXG4gICAgICB9KSxcclxuICAgICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcclxuICAgICAgICBjb2xvcjogJyNmZmYnLFxyXG4gICAgICAgIHdpZHRoOiAyXHJcbiAgICAgIH0pXHJcbiAgICB9KVxyXG4gIH0pKTtcclxuICAvLyBsaXN0ZW4gdG8gY2hhbmdlcyBpbiBwb3NpdGlvblxyXG4gIGdlb2xvY2F0aW9uLm9uKCdjaGFuZ2U6cG9zaXRpb24nLCBmdW5jdGlvbigpIHtcclxuICAgIHZhciBjb29yZGluYXRlcyA9IGdlb2xvY2F0aW9uLmdldFBvc2l0aW9uKCk7XHJcbiAgICBwb3NpdGlvbkZlYXR1cmUuc2V0R2VvbWV0cnkoY29vcmRpbmF0ZXMgPyBuZXcgb2wuZ2VvbS5Qb2ludChjb29yZGluYXRlcykgOiBudWxsKTtcclxuICB9KTtcclxuICBmZWF0dXJlc092ZXJsYXlTb3VyY2UgPSBuZXcgb2wuc291cmNlLlZlY3Rvcih7fSk7XHJcbiAgdmFyIGZlYXR1cmVzT3ZlcmxheSA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xyXG4gICAgbWFwOiBtYXAsXHJcbiAgICBzb3VyY2U6IGZlYXR1cmVzT3ZlcmxheVNvdXJjZVxyXG4gIH0pO1xyXG4gICQoJy5nZW9sb2NhdGlvbicpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihlKSB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBpZiAoJCh0aGlzKS5wcm9wKCdjaGVja2VkJykgPT09IHRydWUpIHtcclxuICAgICAgZ2VvbG9jYXRpb24uc2V0VHJhY2tpbmcodHJ1ZSk7XHJcbiAgICAgIGZlYXR1cmVzT3ZlcmxheVNvdXJjZS5hZGRGZWF0dXJlcyhbcG9zaXRpb25GZWF0dXJlLGFjY3VyYWN5RmVhdHVyZV0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZ2VvbG9jYXRpb24uc2V0VHJhY2tpbmcoZmFsc2UpO1xyXG4gICAgICBmZWF0dXJlc092ZXJsYXlTb3VyY2UuY2xlYXIoKTtcclxuICAgIH1cclxuICB9KTtcclxufSgpKTtcclxuIiwiZnVuY3Rpb24gaGFuZGxlSW5mbyhldnQpIHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICB2YXIgY29vcmRpbmF0ZSA9IGV2dC5jb29yZGluYXRlO1xyXG4gIHZhciBvYmogPSB7fTtcclxuICB2YXIgdGl0bGUgPSB7fTtcclxuICB2YXIgb3duZXIgPSB7fTtcclxuICB2YXIgZmVhdHVyZXMgPSBbXTtcclxuICBvYmoudGl0bGUgPSB0aXRsZTtcclxuICBpZiAobGFuZyA9PT0gJ2VsJykge1xyXG4gICAgdGl0bGUuZXN0YXRlQ29kZSA9ICfOms+JzrTOuc66z4zPgiDOmc60zrnOv866z4TOt8+Dzq/Osc+CJztcclxuICAgIHRpdGxlLnR5cGUgPSAnzqTPjc+Azr/Pgic7XHJcbiAgICB0aXRsZS5hcmVhID0gJ86VzrzOss6xzrTPjCc7XHJcbiAgICB0aXRsZS5hZGRyZXNzID0gJ86UzrnOtc+FzrjPhc69z4POtyc7XHJcbiAgICB0aXRsZS5iZWRyb29tcyA9ICfOpc+Azr3Ov860z4nOvM6sz4TOuc6xJztcclxuICAgIHRpdGxlLnByaWNlID0gJ86kzrnOvM6uJztcclxuICAgIHRpdGxlLm5ldyA9ICfOnc61z4zOtM68zrfPhM6/JztcclxuICAgIHRpdGxlLnBhcmtpbmcgPSAnzqPPhM6szrjOvM61z4POtyc7XHJcbiAgICB0aXRsZS5mdXJuaXNoZWQgPSAnzpXPgM65z4DOu8+JzrzOrc69zr8nO1xyXG4gICAgdGl0bGUucGV0cyA9ICfOms6xz4TOv865zrrOr860zrnOsSc7XHJcbiAgICB0aXRsZS52aWV3ID0gJ86Yzq3OsSc7XHJcbiAgICB0aXRsZS5oZWF0aW5nID0gJ86Yzq3Pgc68zrHOvc+DzrcnO1xyXG4gICAgdGl0bGUuY29vbGluZyA9ICfOqM+Nzr7Otyc7XHJcbiAgICB0aXRsZS5jb250YWN0SW5mbyA9ICfOo8+Ezr/Ouc+HzrXOr86xIM6Vz4DOuc66zr/Ouc69z4nOvc6vzrHPgic7XHJcbiAgICB0aXRsZS5uYW1lID0gJ86Mzr3Ov868zrEnO1xyXG4gICAgdGl0bGUubGFzdG5hbWUgPSAnzpXPgM6vzrjOtc+Ezr8nO1xyXG4gICAgdGl0bGUucGhvbmUgPSAnzqTOt867zq3Phs+Jzr3Ovyc7XHJcbiAgICB0aXRsZS5lbWFpbCA9ICfOl867zrXOus+Ez4HOv869zrnOus6uIM6UzrnOtc+NzrjPhc69z4POtyc7XHJcbiAgfSBlbHNlIHtcclxuICAgIHRpdGxlLmVzdGF0ZUNvZGUgPSAnRXN0YXRlIENvZGUnO1xyXG4gICAgdGl0bGUudHlwZSA9ICdUeXBlJztcclxuICAgIHRpdGxlLmFyZWEgPSAnU2l6ZSc7XHJcbiAgICB0aXRsZS5hZGRyZXNzID0gJ0FkZHJlc3MnO1xyXG4gICAgdGl0bGUuYmVkcm9vbXMgPSAnQmVkcm9vbXMnO1xyXG4gICAgdGl0bGUucHJpY2UgPSAnUHJpY2UnO1xyXG4gICAgdGl0bGUubmV3ID0gJ05ld2x5IEJ1aWxkJztcclxuICAgIHRpdGxlLnBhcmtpbmcgPSAnUGFya2luZyc7XHJcbiAgICB0aXRsZS5mdXJuaXNoZWQgPSAnRnVybmlzaGVkJztcclxuICAgIHRpdGxlLnBldHMgPSAnUGV0cyBBbGxvd2VkJztcclxuICAgIHRpdGxlLnZpZXcgPSAnVmlldyc7XHJcbiAgICB0aXRsZS5oZWF0aW5nID0gJ0hlYXRpbmcnO1xyXG4gICAgdGl0bGUuY29vbGluZyA9ICdDb29saW5nJztcclxuICAgIHRpdGxlLmNvbnRhY3RJbmZvID0gJ0NvbnRhY3QgSW5mbyc7XHJcbiAgICB0aXRsZS5uYW1lID0gJ05hbWUnO1xyXG4gICAgdGl0bGUubGFzdG5hbWUgPSAnTGFzdCBOYW1lJztcclxuICAgIHRpdGxlLnBob25lID0gJ1RlbGVwaG9uZSc7XHJcbiAgICB0aXRsZS5lbWFpbCA9ICdFbWFpbCc7XHJcbiAgfVxyXG4gIGNsaWNrZWRGZWF0dXJlID0gbWFwLmZvckVhY2hGZWF0dXJlQXRQaXhlbChldnQucGl4ZWwsIGZ1bmN0aW9uKGZlYXR1cmUsIGxheWVyKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBmZWF0dXJlOiBmZWF0dXJlLFxyXG4gICAgICBsYXllcjogbGF5ZXJcclxuICAgIH07XHJcbiAgfSwgdGhpcywgZnVuY3Rpb24obGF5ZXIpIHtcclxuICAgIGlmIChsYXllci5nZXQoJ2lkJykgPT09ICdlc3RhdGVzJyB8fCBsYXllci5nZXQoJ2lkJykgPT09ICdmaWx0ZXJlZEVzdGF0ZXMnKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gIH0sIHRoaXMpO1xyXG4gIHZhciBmO1xyXG4gIGlmIChjbGlja2VkRmVhdHVyZSkge1xyXG4gICAgaWYgKGNsaWNrZWRGZWF0dXJlLmxheWVyLmdldCgnaWQnKSA9PT0gJ2VzdGF0ZXMnICYmIGNsaWNrZWRGZWF0dXJlLmZlYXR1cmUuZ2V0KCdmZWF0dXJlcycpLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICBmID0gY2xpY2tlZEZlYXR1cmUuZmVhdHVyZS5nZXRQcm9wZXJ0aWVzKCkuZmVhdHVyZXNbMF07XHJcbiAgICAgIGNyZWF0ZVBTQWFuZENhcmQoZixvYmopO1xyXG4gICAgfSBlbHNlIGlmIChjbGlja2VkRmVhdHVyZS5sYXllci5nZXQoJ2lkJykgPT09ICdmaWx0ZXJlZEVzdGF0ZXMnKSB7XHJcbiAgICAgIGYgPSBjbGlja2VkRmVhdHVyZS5mZWF0dXJlO1xyXG4gICAgICBjcmVhdGVQU0FhbmRDYXJkKGYsb2JqKTtcclxuICAgIH1cclxuICB9IGVsc2Uge1xyXG4gICAgUFNBLnNldFNvdXJjZShudWxsKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZVBTQWFuZENhcmQoZixvYmopIHtcclxuICB2YXIgZmVhdHVyZSA9IHt9O1xyXG4gIGZlYXR1cmUuZ2lkID0gZi5nZXQoJ2dpZCcpO1xyXG4gIGZlYXR1cmUudHlwZSA9IGYuZ2V0KCdlc3RhdGV0eXBlJyk7XHJcbiAgZmVhdHVyZS5hcmVhID0gZi5nZXQoJ2VzdGF0ZWFyZWEnKTtcclxuICBpZiAobGFuZyA9PT0gJ2VsJykge1xyXG4gICAgZmVhdHVyZS5hZGRyZXNzID0gZi5nZXQoJ3N0cmVldF9lbCcpICsgJyAnICsgZi5nZXQoJ2hfbnVtX2VsJyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGZlYXR1cmUuYWRkcmVzcyA9IGYuZ2V0KCdzdHJlZXRfZW4nKSArICcgJyArIGYuZ2V0KCdoX251bV9lbicpO1xyXG4gIH1cclxuICBmZWF0dXJlLmJlZHJvb21zID0gZi5nZXQoJ2JlZHJvb21zJyk7XHJcbiAgZmVhdHVyZS5wcmljZSA9IGYuZ2V0KCdwcmljZScpO1xyXG4gIGZlYXR1cmUubmV3ID0gZi5nZXQoJ25ldycpO1xyXG4gIGZlYXR1cmUucGFya2luZyA9IGYuZ2V0KCdwYXJraW5nJyk7XHJcbiAgZmVhdHVyZS5mdXJuaXNoZWQgPSBmLmdldCgnZnVybmlzaGVkJyk7XHJcbiAgZmVhdHVyZS5wZXRzID0gZi5nZXQoJ3BldHMnKTtcclxuICBmZWF0dXJlLnZpZXcgPSBmLmdldCgndmlldycpO1xyXG4gIGZlYXR1cmUuaGVhdGluZyA9IGYuZ2V0KCdoZWF0aW5nJyk7XHJcbiAgZmVhdHVyZS5jb29saW5nID0gZi5nZXQoJ2Nvb2xpbmcnKTtcclxuICBpZiAobGFuZyA9PT0gJ2VsJykge1xyXG4gICAgZmVhdHVyZS5uYW1lID0gZi5nZXQoJ25hbWVfZWwnKTtcclxuICAgIGZlYXR1cmUubGFzdG5hbWUgPSBmLmdldCgnbGFzdG5hbWVfZWwnKTtcclxuICB9IGVsc2Uge1xyXG4gICAgZmVhdHVyZS5uYW1lID0gZi5nZXQoJ25hbWVfZW4nKTtcclxuICAgIGZlYXR1cmUubGFzdG5hbWUgPSBmLmdldCgnbGFzdG5hbWVfZW4nKTtcclxuICB9XHJcbiAgZmVhdHVyZS5waG9uZSA9IGYuZ2V0KCdwaG9uZTEnKTtcclxuICBmZWF0dXJlLmVtYWlsID0gZi5nZXQoJ2VtYWlsJyk7XHJcbiAgZmVhdHVyZS5jb29yZGluYXRlID0gZi5nZXQoJ2dlb21ldHJ5JykuZ2V0Q29vcmRpbmF0ZXMoKTtcclxuICB2YXIgUFNBU291cmNlID0gbmV3IG9sLnNvdXJjZS5WZWN0b3Ioe1xyXG4gICAgYXR0cmlidXRpb25zOiBbbmV3IG9sLkF0dHJpYnV0aW9uKHtcclxuICAgICAgaHRtbDogJ1BPSSBieSAnICsgJzxhIGhyZWY9XCJodHRwOi8vd3d3LnRlcnJhY29nbml0YS5nci9cIj5UZXJyYSBDb2duaXRhPC9hPidcclxuICAgIH0pXSxcclxuICAgIGZvcm1hdDogZ2VvSlNPTkZvcm1hdCxcclxuICAgIGxvYWRlcjogZnVuY3Rpb24oZXh0ZW50LCByZXNvbHV0aW9uLCBwcm9qZWN0aW9uKSB7XHJcbiAgICAgIHZhciB1cmwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2RiL3VzZXMvJyArIGZlYXR1cmUuZ2lkO1xyXG4gICAgICB2YXIgdGhhdCA9IHRoaXM7XHJcbiAgICAgICQuYWpheCh7XHJcbiAgICAgICAgdXJsOiB1cmwsXHJcbiAgICAgICAgdHlwZTogJ0dFVCcsXHJcbiAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcclxuICAgICAgfSkuZG9uZShmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgIHZhciBmZWF0dXJlcyA9IGdlb0pTT05Gb3JtYXQucmVhZEZlYXR1cmVzKHJlc3BvbnNlLnByb3BlcnR5X3NlcnZpY2VzX2FuYWx5c2lzLCB7XHJcbiAgICAgICAgICBmZWF0dXJlUHJvamVjdGlvbjogJ0VQU0c6Mzg1NydcclxuICAgICAgICB9KTtcclxuICAgICAgICB2YXIgYXJlYSA9IG5ldyBvbC5zdHlsZS5TdHlsZSh7XHJcbiAgICAgICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XHJcbiAgICAgICAgICAgIGNvbG9yOiBbMTU2LCAzOSwgMTc2LCAwLjFdXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGZlYXR1cmVzWzBdLnNldFN0eWxlKGFyZWEpO1xyXG4gICAgICAgIHRoYXQuYWRkRmVhdHVyZXMoZmVhdHVyZXMpO1xyXG4gICAgICB9KS5mYWlsKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3JcIik7XHJcbiAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIHN0cmF0ZWd5OiBvbC5sb2FkaW5nc3RyYXRlZ3kuYWxsXHJcbiAgfSk7XHJcbiAgUFNBLnNldFNvdXJjZShQU0FTb3VyY2UpO1xyXG4gIG1hcC5nZXRWaWV3KCkuc2V0Q2VudGVyKGZlYXR1cmUuY29vcmRpbmF0ZSk7XHJcbiAgbWFwLmdldFZpZXcoKS5zZXRSZXNvbHV0aW9uKDEuMik7XHJcbiAgb2JqLmZlYXR1cmUgPSBmZWF0dXJlO1xyXG4gIGR1c3QucmVuZGVyKCdlc3RhdGVDYXJkcy5kdXN0Jywgb2JqLCBmdW5jdGlvbihlcnIsIG91dCkge1xyXG4gICAgJCgnLmVzdGF0ZS1jYXJkcycpLmh0bWwob3V0KTtcclxuICAgICQoJy5lc3RhdGUtY2FyZHMnKS5yZW1vdmVDbGFzcygndmlzdWFsbHloaWRkZW4nKTtcclxuICB9KTtcclxuICAkKCdhW2hyZWY9XCIjb3Blbk1vZGFsXCJdJykuY2xpY2soZnVuY3Rpb24oKSB7XHJcbiAgICBkdXN0LnJlbmRlcignbW9kYWxJbmZvLmR1c3QnLCBvYmosIGZ1bmN0aW9uKGVyciwgb3V0KSB7XHJcbiAgICAgICQoJy5tb2RhbC1jb250ZW50JykuaHRtbChvdXQpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn1cclxuJCgnLmluZm8nKS5vbignY2hhbmdlJywgZnVuY3Rpb24oZSkge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuICBQU0Euc2V0U291cmNlKG51bGwpO1xyXG4gIGlmICgkKHRoaXMpLnByb3AoJ2NoZWNrZWQnKSA9PT0gdHJ1ZSkge1xyXG4gICAgbWFwLm9uKCdjbGljaycsIGhhbmRsZUluZm8pO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBtYXAudW4oJ2NsaWNrJywgaGFuZGxlSW5mbyk7XHJcbiAgfVxyXG59KTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gIHZhciBtYXJrZXIgPSBuZXcgb2wuRmVhdHVyZSgpO1xyXG4gIHZhciBpY29uU3R5bGUgPSBuZXcgb2wuc3R5bGUuU3R5bGUoe1xyXG4gICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5JY29uKCAvKiogQHR5cGUge29seC5zdHlsZS5JY29uT3B0aW9uc30gKi8gKHtcclxuICAgICAgYW5jaG9yOiBbMC41LCAxXSxcclxuICAgICAgYW5jaG9yWFVuaXRzOiAnZnJhY3Rpb24nLFxyXG4gICAgICBhbmNob3JZVW5pdHM6ICdmcmFjdGlvbicsXHJcbiAgICAgIG9wYWNpdHk6IDEsXHJcbiAgICAgIHNjYWxlOiAxLFxyXG4gICAgICBzcmM6ICcuLi9pbWFnZXMvbWFwLWljb25zL3BpbnMvMjQvcGluMS5wbmcnLFxyXG4gICAgICBzbmFwVG9QaXhlbDogZmFsc2VcclxuICAgIH0pKSxcclxuICAgIHpJbmRleDogMTAwXHJcbiAgfSk7XHJcbiAgbWFya2VyLnNldFN0eWxlKGljb25TdHlsZSk7XHJcbiAgdmFyIGZlYXR1cmVzT3ZlcmxheVN0eWxlID0gbmV3IG9sLnN0eWxlLlN0eWxlKHtcclxuICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XHJcbiAgICAgIGNvbG9yOiAnIzQwODA4MCcsXHJcbiAgICAgIHdpZHRoOiA1LFxyXG4gICAgICBsaW5lRGFzaDogWzQsIDRdXHJcbiAgICB9KVxyXG4gIH0pO1xyXG4gIHZhciBmZWF0dXJlc092ZXJsYXkgPSBuZXcgb2wubGF5ZXIuVmVjdG9yKHtcclxuICAgIG1hcDogbWFwLFxyXG4gICAgc291cmNlOiBuZXcgb2wuc291cmNlLlZlY3RvcigpLFxyXG4gICAgc3R5bGU6IGZlYXR1cmVzT3ZlcmxheVN0eWxlLFxyXG4gICAgaWQ6ICdyb3V0ZScsXHJcbiAgICBuYW1lRWw6ICfOlM65zrHOtM+Bzr/OvM6uJyxcclxuICAgIE5hbWVFbjogJ1JvdXRlJ1xyXG4gIH0pO1xyXG4gIHZhciByb3V0ZUNvb3JkcyA9IFtdO1xyXG5cclxuICBmdW5jdGlvbiBoYW5kbGVNYXJrZXIoZXZlbnQpIHtcclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB2YXIgZmVhdHVyZUNvdW50ID0gZmVhdHVyZXNPdmVybGF5LmdldFNvdXJjZSgpLmdldEZlYXR1cmVzKCkubGVuZ3RoO1xyXG4gICAgdmFyIGNvb3JkaW5hdGVzID0gZXZlbnQuY29vcmRpbmF0ZTtcclxuICAgIGlmIChmZWF0dXJlQ291bnQgPT09IDApIHtcclxuICAgICAgbWFya2VyLnNldEdlb21ldHJ5KG5ldyBvbC5nZW9tLlBvaW50KGNvb3JkaW5hdGVzKSk7XHJcbiAgICAgIG1hcmtlci5zZXRJZCgnZmlyc3QnKTtcclxuICAgICAgZmVhdHVyZXNPdmVybGF5LmdldFNvdXJjZSgpLmFkZEZlYXR1cmUobWFya2VyKTtcclxuICAgICAgcm91dGVDb29yZHNbMF0gPSBjb29yZGluYXRlc1swXTtcclxuICAgICAgcm91dGVDb29yZHNbMV0gPSBjb29yZGluYXRlc1sxXTtcclxuICAgIH0gZWxzZSBpZiAoZmVhdHVyZUNvdW50ID09PSAxKSB7XHJcbiAgICAgIHZhciBjbG9uZSA9IG1hcmtlci5jbG9uZSgpO1xyXG4gICAgICBjbG9uZS5zZXRHZW9tZXRyeShuZXcgb2wuZ2VvbS5Qb2ludChjb29yZGluYXRlcykpO1xyXG4gICAgICBjbG9uZS5zZXRJZCgnc2Vjb25kJyk7XHJcbiAgICAgIGZlYXR1cmVzT3ZlcmxheS5nZXRTb3VyY2UoKS5hZGRGZWF0dXJlKGNsb25lKTtcclxuICAgICAgcm91dGVDb29yZHNbMl0gPSBjb29yZGluYXRlc1swXTtcclxuICAgICAgcm91dGVDb29yZHNbM10gPSBjb29yZGluYXRlc1sxXTtcclxuICAgICAgY2FsbFJvdXRlKHJvdXRlQ29vcmRzKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGZlYXR1cmVzT3ZlcmxheS5nZXRTb3VyY2UoKS5jbGVhcigpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2VvSlNPTkZvcm1hdCA9IG5ldyBvbC5mb3JtYXQuR2VvSlNPTih7XHJcbiAgICBkZWZhdWx0RGF0YVByb2plY3Rpb246ICdFUFNHOjQzMjYnLFxyXG4gICAgZ2VvbWV0cnlOYW1lOiAnZ2VvbWV0cnknXHJcbiAgfSk7XHJcblxyXG4gIGZ1bmN0aW9uIGNhbGxSb3V0ZShyb3V0ZUNvb3Jkcykge1xyXG4gICAgdmFyIGZpcnN0ID0gb2wucHJvai50cmFuc2Zvcm0oW3JvdXRlQ29vcmRzWzBdLCByb3V0ZUNvb3Jkc1sxXV0sICdFUFNHOjM4NTcnLCAnRVBTRzo0MzI2Jyk7XHJcbiAgICB2YXIgc2Vjb25kID0gb2wucHJvai50cmFuc2Zvcm0oW3JvdXRlQ29vcmRzWzJdLCByb3V0ZUNvb3Jkc1szXV0sICdFUFNHOjM4NTcnLCAnRVBTRzo0MzI2Jyk7XHJcbiAgICB2YXIgeDEgPSBmaXJzdFswXTtcclxuICAgIHZhciB5MSA9IGZpcnN0WzFdO1xyXG4gICAgdmFyIHgyID0gc2Vjb25kWzBdO1xyXG4gICAgdmFyIHkyID0gc2Vjb25kWzFdO1xyXG4gICAgJC5hamF4KHtcclxuICAgICAgdXJsOiAnaHR0cHM6Ly9hcGkubWFwYm94LmNvbS92NC9kaXJlY3Rpb25zL21hcGJveC5kcml2aW5nLycgKyB4MSArICcsJyArIHkxICsgJzsnICsgeDIgKyAnLCcgKyB5MiArICcuanNvbj9hbHRlcm5hdGl2ZXM9ZmFsc2UmYWNjZXNzX3Rva2VuPXBrLmV5SjFJam9pWm1seWRtRnBiaUlzSW1FaU9pSmxPV1l5WVRNME5UaGlOV00wWWpKak9ESmpOREU0T0RRek56QTJNR1F5TmlKOS4tTlZETzI3SHp0LXdfblFvc1VQZkxBJyxcclxuICAgICAgdHlwZTogJ0dFVCcsXHJcbiAgICAgIGRhdGFUeXBlOiAnanNvbidcclxuICAgIH0pLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICB2YXIgcm91dGU9e307XHJcbiAgICAgIHJvdXRlLnR5cGUgPVwiRmVhdHVyZVwiO1xyXG4gICAgICByb3V0ZS5nZW9tZXRyeSA9IGRhdGEucm91dGVzWzBdLmdlb21ldHJ5O1xyXG4gICAgICBmZWF0dXJlc092ZXJsYXkuZ2V0U291cmNlKCkuYWRkRmVhdHVyZXMoZ2VvSlNPTkZvcm1hdC5yZWFkRmVhdHVyZXMocm91dGUsIHtcclxuICAgICAgICBkYXRhUHJvamVjdGlvbjogJ0VQU0c6NDMyNicsXHJcbiAgICAgICAgZmVhdHVyZVByb2plY3Rpb246ICdFUFNHOjM4NTcnXHJcbiAgICAgIH0pKTtcclxuICAgICAgbWFwLmdldFZpZXcoKS5maXQoZmVhdHVyZXNPdmVybGF5LmdldFNvdXJjZSgpLmdldEV4dGVudCgpLCBtYXAuZ2V0U2l6ZSgpKTtcclxuICAgIH0pLmZhaWwoZnVuY3Rpb24oKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3JcIik7XHJcbiAgICB9KS5hbHdheXMoZnVuY3Rpb24oKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiY29tcGxldGVcIik7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgJCgnLm1hcmtlcicpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihldmVudCkge1xyXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIC8qIEFjdCBvbiB0aGUgZXZlbnQgKi9cclxuICAgIGlmICgkKHRoaXMpLnByb3AoJ2NoZWNrZWQnKSA9PT0gdHJ1ZSkge1xyXG4gICAgICBtYXAub24oJ3NpbmdsZWNsaWNrJywgaGFuZGxlTWFya2VyKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIG1hcC51bignc2luZ2xlY2xpY2snLCBoYW5kbGVNYXJrZXIpO1xyXG4gICAgICBmZWF0dXJlc092ZXJsYXkuZ2V0U291cmNlKCkuY2xlYXIoKTtcclxuICAgIH1cclxuICB9KTtcclxufSgpKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICQoJy53ZWF0aGVyJykuY2hhbmdlKGZ1bmN0aW9uKCkge1xyXG4gICAgaWYgKCQodGhpcykucHJvcCgnY2hlY2tlZCcpID09PSB0cnVlKSB7XHJcbiAgICAgICAgbWFwLmdldE92ZXJsYXlzKCkuZm9yRWFjaChmdW5jdGlvbihvdmwpIHtcclxuICAgICAgICBpZiAob3ZsLmdldCgnbmFtZScpID09PSAnd2VhdGhlcicpIHtcclxuICAgICAgICAgICgkKG92bC5nZXRFbGVtZW50KCkpLnBhcmVudCgpKS5yZW1vdmUoKTtcclxuICAgICAgICAgICQob3ZsLmdldEVsZW1lbnQoKSkucmVtb3ZlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgdmFyIGNlbnRlciA9IG9sLnByb2oudHJhbnNmb3JtKG1hcC5nZXRWaWV3KCkuZ2V0Q2VudGVyKCksICdFUFNHOjM4NTcnLCAnRVBTRzo0MzI2Jyk7XHJcbiAgICAgIHZhciBsYXQgPSBjZW50ZXJbMV07XHJcbiAgICAgIHZhciBsb24gPSBjZW50ZXJbMF07XHJcbiAgICAgICQuYWpheCh7XHJcbiAgICAgICAgdXJsOiAnaHR0cDovL2FwaS5vcGVud2VhdGhlcm1hcC5vcmcvZGF0YS8yLjUvZmluZD9sYXQ9JyArIGxhdCArICcmbG9uPScgKyBsb24gKyAnJmNudD01JmNsdXN0ZXI9bm8mdW5pdHM9bWV0cmljJnR5cGU9YWNjdXJhdGUmQVBQSUQ9ZjljZDlmYTJjNDI3YzNiMTE1ZTg3ZTQ4NjI2MTljNWMnLFxyXG4gICAgICAgIHR5cGU6ICdHRVQnLFxyXG4gICAgICAgIGRhdGFUeXBlOiAnanNvbicsXHJcbiAgICAgIH0pLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVdlYXRoZXJPdmVybGF5KHBvc2l0aW9uLCBpbmRleCkge1xyXG4gICAgICAgICAgdmFyIGVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgIGVsZW0uc2V0QXR0cmlidXRlKCdjbGFzcycsICd3ZWF0aGVyLXBvcHVwIGRlZmF1bHQtcHJpbWFyeS1jb2xvciBtZGwtc2hhZG93LS02ZHAnKTtcclxuICAgICAgICAgIGVsZW0uc2V0QXR0cmlidXRlKCdpZCcsIGluZGV4KTtcclxuICAgICAgICAgIGVsZW0uc2V0QXR0cmlidXRlKCdkYXRhLW5hbWUnLCAnd2VhdGhlcicpO1xyXG4gICAgICAgICAgcmV0dXJuIG5ldyBvbC5PdmVybGF5KHtcclxuICAgICAgICAgICAgZWxlbWVudDogZWxlbSxcclxuICAgICAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uLFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBvYmpzID0gZGF0YS5saXN0O1xyXG4gICAgICAgIHZhciBvdmVybGF5LCBjb29yZGluYXRlcztcclxuICAgICAgICAkLmVhY2gob2JqcywgZnVuY3Rpb24oaW5kZXgsIHZhbCkge1xyXG4gICAgICAgICAgY29vcmRpbmF0ZXMgPSBvbC5wcm9qLnRyYW5zZm9ybShbdmFsLmNvb3JkLmxvbiwgdmFsLmNvb3JkLmxhdF0sICdFUFNHOjQzMjYnLCAnRVBTRzozODU3Jyk7XHJcbiAgICAgICAgICBvdmVybGF5ID0gY3JlYXRlV2VhdGhlck92ZXJsYXkoY29vcmRpbmF0ZXMsIGluZGV4KTtcclxuICAgICAgICAgIG1hcC5hZGRPdmVybGF5KG92ZXJsYXkpO1xyXG4gICAgICAgICAgb3ZlcmxheS5zZXQoJ25hbWUnLCAnd2VhdGhlcicpO1xyXG4gICAgICAgICAgd2VhdGhlckRhdGEgPSB7XHJcbiAgICAgICAgICAgICduYW1lJzogdmFsLm5hbWUsXHJcbiAgICAgICAgICAgICd0ZW1wJzogdmFsLm1haW4udGVtcCxcclxuICAgICAgICAgICAgJ3ByZXNzdXJlJzogdmFsLm1haW4ucHJlc3N1cmUsXHJcbiAgICAgICAgICAgICdodW1pZGl0eSc6IHZhbC5tYWluLmh1bWlkaXR5XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgZHVzdC5yZW5kZXIoJ3dlYXRoZXJQb3B1cC5kdXN0Jywgd2VhdGhlckRhdGEsIGZ1bmN0aW9uKGVyciwgb3V0KSB7XHJcbiAgICAgICAgICAgICQoXCIjXCIgKyBpbmRleCkuaHRtbChvdXQpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pLmZhaWwoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgLy8gdG9hc3RyLmVycm9yKFwizpTOtc69IM6yz4HOrc64zrfOus6xzr0gz4DOu863z4HOv8+Gzr/Pgc6vzrXPgiDOs865zrEgz4TOuc+CIM66zrHOuc+BzrnOus6tz4Igz4PPhc69zrjOrs66zrXPgiFcIik7XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIGlmICgkKHRoaXMpLnByb3AoJ2NoZWNrZWQnKSA9PT0gZmFsc2UpIHtcclxuICAgICAgbWFwLmdldE92ZXJsYXlzKCkuZm9yRWFjaChmdW5jdGlvbihvdmwpIHtcclxuICAgICAgICBpZiAob3ZsLmdldCgnbmFtZScpID09PSAnd2VhdGhlcicpIHtcclxuICAgICAgICAgICgkKG92bC5nZXRFbGVtZW50KCkpLnBhcmVudCgpKS5yZW1vdmUoKTtcclxuICAgICAgICAgICQob3ZsLmdldEVsZW1lbnQoKSkucmVtb3ZlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9KTtcclxufSgpKTtcclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9