 var center = [3677385, 4120949],
   extent = [3590094, 4102833, 3855483, 4261211],
   lang = document.documentElement.lang,
   styleCache = {},
   geoJSONFormat = new ol.format.GeoJSON({
     defaultDataProjection: 'EPSG:4326'
   });
 var bing = new ol.layer.Tile({
   visible: true,
   source: new ol.source.BingMaps({
     key: 'Ak2Gq8VUfICsPpuf7LRANXmXt2sHWmSLPhohmVLFtFIEwYjs_5MCyAhAFwRSVpLj',
     imagerySet: 'Aerial'
   }),
   maxZoom: 19,
   crossOrigin: 'anonymous',
   preload: Infinity,
   id: 'bing'
 });
 var mapbox = new ol.layer.Tile({
   source: new ol.source.XYZ({
     attributions: [new ol.Attribution({
       html: '<a href=\"https://www.mapbox.com/about/maps/\" target=\"_blank\">&copy; Mapbox &copy; OpenStreetMap</a>'
     })],
     url: 'https://api.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZmlydmFpbiIsImEiOiJlOWYyYTM0NThiNWM0YjJjODJjNDE4ODQzNzA2MGQyNiJ9.-NVDO27Hzt-w_nQosUPfLA'
   }),
   id: 'mapbox'
 });

 function createPropertyStyle(feature) {
   var src;
   if (feature.get('type_en') === 'Sale') {
     src = '../images/map-icons/pins/48/pin2.png';
   } else {
     src = '../images/map-icons/pins/48/pin5.png';
   }
   return new ol.style.Style({
     geometry: feature.getGeometry(),
     image: new ol.style.Icon(({
       src: src,
       anchorOrigin: 'bottom-left',
       anchor: [0, 0],
       scale: 0.7,
     }))
   });
 }

 function propertyStyleFunction(feature, resolution) {
   var size = feature.get('features').length;
   if (size > 1) {
     style = [new ol.style.Style({
       image: new ol.style.Circle({
         radius: 20,
         stroke: new ol.style.Stroke({
           color: [156, 39, 176, 1],
           width: 5
         }),
         fill: new ol.style.Fill({
           color: [68, 138, 255, 0.8]
         })
       }),
       text: new ol.style.Text({
         text: size.toString(),
         fill: new ol.style.Fill({
           color: '#FFFFFF'
         })
       }),
       zIndex: 101
     })];
   } else {
     var originalFeature = feature.get('features')[0];
     style = [createPropertyStyle(originalFeature)];
   }
   return style;
 }

 function selectStyleFunction(feature, resolution) {
   var styles = [new ol.style.Style({})];
   var originalFeatures = feature.get('features');
   var originaFeature;
   for (var i = originalFeatures.length - 1; i >= 0; --i) {
     originalFeature = originalFeatures[i];
     styles.push(createPropertyStyle(originalFeature));
   }
   return styles;
 }
 var propertySource = new ol.source.Vector({
   format: geoJSONFormat,
   loader: function(extent, resolution, projection) {
     var epsg4326Extent = ol.proj.transformExtent(extent, 'EPSG:3857', 'EPSG:4326');
     var url = 'http://localhost:3000/db/property?bbox[x1]=' + epsg4326Extent[0] + '&bbox[y1]=' + epsg4326Extent[1] + '&bbox[x2]=' + epsg4326Extent[2] + '&bbox[y2]=' + epsg4326Extent[3];
     var that = this;
     this.clear();
     $.ajax({
       url: url,
       type: 'GET',
       dataType: 'json',
     }).done(function(response) {
       var features = geoJSONFormat.readFeatures(response, {
         featureProjection: 'EPSG:3857'
       });
       that.addFeatures(features);
     }).fail(function() {
       console.log("error");
     });
   },
   strategy: ol.loadingstrategy.bbox
 });
 var propertyClusterSource = new ol.source.Cluster({
   distance: 40,
   source: propertySource,
   attributions: [new ol.Attribution({
     html: 'All maps © ' + '<a href="http://www.terracognita.gr/">Terra Cognita</a>'
   })]
 });
 var property = new ol.layer.Vector({
   source: propertyClusterSource,
   id: 'estates',
   visible: true,
   style: propertyStyleFunction
 });
 property.setZIndex(2);
 var PSAStyleFunction = function(feature, resolution) {
   var symbol = feature.get('style');
   var text;
   if (lang === 'el') {
     text = feature.get('name_el');
   } else {
     text = feature.get('name_en');
   }
   if (!styleCache[symbol]) {
     styleCache = [new ol.style.Style({
       image: new ol.style.Icon(({
         src: '../images/maki/renders/' + symbol + '-24.png',
         anchorOrigin: 'bottom-left',
         anchor: [0.5, 0.5],
         scale: 1,
       })),
       text: new ol.style.Text({
         text: text,
         stroke: new ol.style.Stroke({
           color: [156, 39, 176, 0.8],
           width: 1
         }),
         offsetY: 12
       })
     })];
   }
   return styleCache;
 };
 var PSA = new ol.layer.Vector({
   style: PSAStyleFunction,
   maxResolution: 3
 });
 PSA.setZIndex(1);

 function filteredEsateStyle(feature, resolution) {
   styleCache = [new ol.style.Style({
     image: new ol.style.Icon(({
       src: '../images/map-icons/pins/48/pin4.png',
       anchorOrigin: 'bottom-left',
       anchor: [0.5, 0.5],
       scale: 0.7,
     }))
   })];
   return styleCache;
 }
 var filteredEstates = new ol.layer.Vector({
   source: new ol.source.Vector({
     format: geoJSONFormat
   }),
   id: 'filteredEstates',
   visible: true,
   style: filteredEsateStyle
 });
 filteredEstates.setZIndex(2);
 var selectSource = new ol.source.Vector({});

var selectBox = new ol.layer.Vector({
  source: selectSource,
  style: new ol.style.Style({
    fill: new ol.style.Fill({
      color: 'rgba(227, 72, 27, 0.2)'
    }),
    stroke: new ol.style.Stroke({
      color: '#E3481B',
      width: 2
    }),
    image: new ol.style.Circle({
      radius: 7,
      fill: new ol.style.Fill({
        color: '#E3481B'
      })
    })
  })
});
selectBox.setZIndex(3);
 var map = new ol.Map({
   target: 'map',
   layers: [mapbox, property, PSA, filteredEstates,selectBox],
   // interactions: ol.interaction.defaults().extend([new ol.interaction.Select({
   //   condition: function(evt) {
   //     return evt.type === 'singleclick' && ol.events.condition.shiftKeyOnly(evt);
   //   },
   //   style: selectStyleFunction
   // })]),
   loadTilesWhileAnimating: true,
   loadTilesWhileInteracting: true,
   renderer: 'canvas',
   controls: ol.control.defaults({
     attributionOptions: {
       collapsible: false,
       collapsed: false
     }
   }).extend([
     new ol.control.ScaleLine({
       units: 'metric'
     }), new ol.control.OverviewMap({
       className: 'ol-overviewmap ol-custom-overviewmap',
       collapsible: true,
       collapsed: true,
       layers: [bing]
     }),
     new ol.control.ZoomToExtent({
       extent: extent
     })
   ]),
   view: new ol.View({
     center: center,
     extent: extent,
     projection: 'EPSG:3857',
     zoom: 14,
     maxZoom: 19,
     minZoom: 10
   }),
 });
 if (lang === 'el') {
   bing.set('name', 'Δορυφορική εικόνα');
   mapbox.set('name', 'Χάρτης');
   property.set('name', 'Ακίνητα');
 } else {
   bing.set('name', 'Sattelite Image');
   mapbox.set('name', 'Map');
   property.set('name', 'Properties');
 }

 function selectByFilters() {
   PSA.setSource(null);
   var params = {};
   var epsg4326Extent;
   params.leaseType = $("input[name=options]:checked").val();
   params.startPrice = $('#startPrice').val();
   params.endPrice = $('#endPrice').val();
   params.parking = $('#checkbox-1').prop('checked');
   params.furnished = $('#checkbox-2').prop('checked');
   params.heating = $('#checkbox-3').prop('checked');
   params.cooling = $('#checkbox-4').prop('checked');
   params.view = $('#checkbox-5').prop('checked');
   if (selectSource.getFeatures().length === 0) {
     epsg4326Extent = ol.proj.transformExtent(extent, 'EPSG:3857', 'EPSG:4326');
   } else {
     epsg4326Extent = ol.proj.transformExtent(selectSource.getFeatures()[0].getGeometry().getExtent(), 'EPSG:3857', 'EPSG:4326');
   }
   toastr.options = {
     "closeButton": false,
     "debug": false,
     "newestOnTop": false,
     "progressBar": false,
     "positionClass": "toast-top-center",
     "preventDuplicates": false,
     "onclick": null,
     "showDuration": "300",
     "hideDuration": "1000",
     "timeOut": "5000",
     "extendedTimeOut": "1000",
     "showEasing": "swing",
     "hideEasing": "linear",
     "showMethod": "fadeIn",
     "hideMethod": "fadeOut"
   };
   $.ajax({
     url: 'http://localhost:3000/db/filteredproperty?bbox[x1]=' + epsg4326Extent[0] + '&bbox[y1]=' + epsg4326Extent[1] + '&bbox[x2]=' + epsg4326Extent[2] + '&bbox[y2]=' + epsg4326Extent[3],
     type: 'GET',
     dataType: 'json',
     data: {
       leaseType: params.leaseType,
       furnished: params.furnished,
       heating: params.heating,
       parking: params.parking,
       cooling: params.cooling,
       view: params.view,
       startPrice: params.startPrice,
       endPrice: params.endPrice
     },
   }).done(function(response) {
     var features = geoJSONFormat.readFeatures(response, {
       featureProjection: 'EPSG:3857'
     });

     if (features.length > 0) {
       toastr.clear();
       filteredEstates.getSource().clear();
       filteredEstates.getSource().addFeatures(features);
       filteredEstates.setVisible(true);
       property.setVisible(false);
       var extent = filteredEstates.getSource().getExtent();
       var center = [];
     } else {
       toastr.error("No Info Found!");
       filteredEstates.setVisible(false);
       property.setVisible(true);
     }
   });
 }
 $("#clearFilters").click(function() {
   $("input[name=options]").prop('checked', false);
   $('label[for=option-1]').removeClass('is-checked');
   $('label[for=option-2]').removeClass('is-checked');
   $('label[for=checkbox-1]').removeClass('is-checked');
   $('label[for=checkbox-2]').removeClass('is-checked');
   $('label[for=checkbox-3]').removeClass('is-checked');
   $('label[for=checkbox-4]').removeClass('is-checked');
   $('label[for=checkbox-5]').removeClass('is-checked');
   $('label[for=checkbox-6]').removeClass('is-checked');
   filteredEstates.getSource().clear();
   property.setVisible(true);
   PSA.setSource(null);
   selectSource.clear();
   map.removeInteraction(draw);
 });
 var draw;

 function addInteraction() {
   selectSource.clear();
   draw = new ol.interaction.Draw({
     source: selectSource,
     type: 'LineString',
     geometryFunction: geometryFunction,
     maxPoints: 2
   });
   draw.on('drawstart', function() {
     selectSource.clear();
   });
   map.addInteraction(draw);
 }

 function geometryFunction(coordinates, geometry) {
   if (!geometry) {
     geometry = new ol.geom.Polygon(null);
   }
   var start = coordinates[0];
   var end = coordinates[1];
   geometry.setCoordinates([
     [start, [start[0], end[1]], end, [end[0], start[1]], start]
   ]);
   return geometry;
 }
 $("#checkbox-6").change(function() {
   if (this.checked) {
     addInteraction();
   } else {
     map.removeInteraction(draw);
     selectSource.clear();
   }
 });

(function() {
  var geolocation = new ol.Geolocation({
    // take the projection to use from the map's view
    projection: map.getView().getProjection(),
    trackingOptions: {
      maximumAge: 10000,
      enableHighAccuracy: true,
      timeout: 600000
    }
  });
  var accuracyFeature = new ol.Feature();
  geolocation.on('change:accuracyGeometry', function() {
    accuracyFeature.setGeometry(geolocation.getAccuracyGeometry());
  });
  var positionFeature = new ol.Feature();
  positionFeature.setStyle(new ol.style.Style({
    image: new ol.style.Circle({
      radius: 6,
      fill: new ol.style.Fill({
        color: '#3399CC'
      }),
      stroke: new ol.style.Stroke({
        color: '#fff',
        width: 2
      })
    })
  }));
  // listen to changes in position
  geolocation.on('change:position', function() {
    var coordinates = geolocation.getPosition();
    positionFeature.setGeometry(coordinates ? new ol.geom.Point(coordinates) : null);
  });
  featuresOverlaySource = new ol.source.Vector({});
  var featuresOverlay = new ol.layer.Vector({
    map: map,
    source: featuresOverlaySource
  });
  $('.geolocation').on('change', function(e) {
    e.preventDefault();
    if ($(this).prop('checked') === true) {
      geolocation.setTracking(true);
      featuresOverlaySource.addFeatures([positionFeature,accuracyFeature]);
    } else {
      geolocation.setTracking(false);
      featuresOverlaySource.clear();
    }
  });
}());

function handleInfo(evt) {
  evt.preventDefault();
  map.removeInteraction(draw);
  var coordinate = evt.coordinate;
  var obj = {};
  var title = {};
  var owner = {};
  var features = [];
  obj.title = title;
  if (lang === 'el') {
    title.estateCode = 'Κωδικός Ιδιοκτησίας';
    title.type = 'Τύπος';
    title.area = 'Εμβαδό';
    title.address = 'Διευθυνση';
    title.bedrooms = 'Υπνοδωμάτια';
    title.price = 'Τιμή';
    title.new = 'Νεόδμητο';
    title.parking = 'Στάθμεση';
    title.furnished = 'Επιπλωμένο';
    title.pets = 'Κατοικίδια';
    title.view = 'Θέα';
    title.heating = 'Θέρμανση';
    title.cooling = 'Ψύξη';
    title.contactInfo = 'Στοιχεία Επικοινωνίας';
    title.name = 'Όνομα';
    title.lastname = 'Επίθετο';
    title.phone = 'Τηλέφωνο';
    title.email = 'Ηλεκτρονική Διεύθυνση';
  } else {
    title.estateCode = 'Estate Code';
    title.type = 'Type';
    title.area = 'Size';
    title.address = 'Address';
    title.bedrooms = 'Bedrooms';
    title.price = 'Price';
    title.new = 'Newly Build';
    title.parking = 'Parking';
    title.furnished = 'Furnished';
    title.pets = 'Pets Allowed';
    title.view = 'View';
    title.heating = 'Heating';
    title.cooling = 'Cooling';
    title.contactInfo = 'Contact Info';
    title.name = 'Name';
    title.lastname = 'Last Name';
    title.phone = 'Telephone';
    title.email = 'Email';
  }
  clickedFeature = map.forEachFeatureAtPixel(evt.pixel, function(feature, layer) {
    return {
      feature: feature,
      layer: layer
    };
  }, this, function(layer) {
    if (layer.get('id') === 'estates' || layer.get('id') === 'filteredEstates') {
      return true;
    }
  }, this);
  var f;
  if (clickedFeature) {
    if (clickedFeature.layer.get('id') === 'estates' && clickedFeature.feature.get('features').length === 1) {
      f = clickedFeature.feature.getProperties().features[0];
      createPSAandCard(f, obj);
    } else if (clickedFeature.layer.get('id') === 'filteredEstates') {
      f = clickedFeature.feature;
      createPSAandCard(f, obj);
    }
  } else {
    PSA.setSource(null);
  }
}

function createPSAandCard(f, obj) {
  var feature = {};
  feature.gid = f.get('gid');
  feature.type = f.get('estatetype');
  feature.area = f.get('estatearea');
  if (lang === 'el') {
    feature.address = f.get('street_el') + ' ' + f.get('h_num_el');
  } else {
    feature.address = f.get('street_en') + ' ' + f.get('h_num_en');
  }
  feature.bedrooms = f.get('bedrooms');
  feature.price = f.get('price');
  feature.new = f.get('new');
  feature.parking = f.get('parking');
  feature.furnished = f.get('furnished');
  feature.pets = f.get('pets');
  feature.view = f.get('view');
  feature.heating = f.get('heating');
  feature.cooling = f.get('cooling');
  if (lang === 'el') {
    feature.name = f.get('name_el');
    feature.lastname = f.get('lastname_el');
  } else {
    feature.name = f.get('name_en');
    feature.lastname = f.get('lastname_en');
  }
  feature.phone = f.get('phone1');
  feature.email = f.get('email');
  feature.coordinate = f.get('geometry').getCoordinates();
  var PSASource = new ol.source.Vector({
    attributions: [new ol.Attribution({
      html: 'POI by ' + '<a href="http://www.terracognita.gr/">Terra Cognita</a>'
    })],
    format: geoJSONFormat,
    loader: function(extent, resolution, projection) {
      var url = 'http://localhost:3000/db/uses/' + feature.gid;
      var that = this;
      $.ajax({
        url: url,
        type: 'GET',
        dataType: 'json',
      }).done(function(response) {
        var features = geoJSONFormat.readFeatures(response.property_services_analysis, {
          featureProjection: 'EPSG:3857'
        });
        var area = new ol.style.Style({
          fill: new ol.style.Fill({
            color: [156, 39, 176, 0.1]
          })
        });
        features[0].setStyle(area);
        that.addFeatures(features);
      }).fail(function() {
        console.log("error");
      });
    },
    strategy: ol.loadingstrategy.all
  });
  PSA.setSource(PSASource);
  map.getView().setCenter(feature.coordinate);
  map.getView().setResolution(1.2);
  obj.feature = feature;
  dust.render('estateCards.dust', obj, function(err, out) {
    $('.estate-cards').html(out);
    $('.estate-cards').removeClass('visuallyhidden');
  });
  $('a[href="#openModal"]').click(function() {
    dust.render('modalInfo.dust', obj, function(err, out) {
      $('.modal-content').html(out);
    });
  });
}
$('.info').on('change', function(e) {
  e.preventDefault();
  PSA.setSource(null);
    
  if ($(this).prop('checked') === true) {
    map.on('click', handleInfo);
  } else {
    map.un('click', handleInfo);
  }
});

(function() {
  var marker = new ol.Feature();
  var iconStyle = new ol.style.Style({
    image: new ol.style.Icon( /** @type {olx.style.IconOptions} */ ({
      anchor: [0.5, 1],
      anchorXUnits: 'fraction',
      anchorYUnits: 'fraction',
      opacity: 1,
      scale: 1,
      src: '../images/map-icons/pins/24/pin1.png',
      snapToPixel: false
    })),
    zIndex: 100
  });
  marker.setStyle(iconStyle);
  var featuresOverlayStyle = new ol.style.Style({
    stroke: new ol.style.Stroke({
      color: '#408080',
      width: 5,
      lineDash: [4, 4]
    })
  });
  var featuresOverlay = new ol.layer.Vector({
    map: map,
    source: new ol.source.Vector(),
    style: featuresOverlayStyle,
    id: 'route',
    nameEl: 'Διαδρομή',
    NameEn: 'Route'
  });
  var routeCoords = [];

  function handleMarker(event) {
    event.preventDefault();
    var featureCount = featuresOverlay.getSource().getFeatures().length;
    var coordinates = event.coordinate;
    if (featureCount === 0) {
      marker.setGeometry(new ol.geom.Point(coordinates));
      marker.setId('first');
      featuresOverlay.getSource().addFeature(marker);
      routeCoords[0] = coordinates[0];
      routeCoords[1] = coordinates[1];
    } else if (featureCount === 1) {
      var clone = marker.clone();
      clone.setGeometry(new ol.geom.Point(coordinates));
      clone.setId('second');
      featuresOverlay.getSource().addFeature(clone);
      routeCoords[2] = coordinates[0];
      routeCoords[3] = coordinates[1];
      callRoute(routeCoords);
    } else {
      featuresOverlay.getSource().clear();
    }
  }

  geoJSONFormat = new ol.format.GeoJSON({
    defaultDataProjection: 'EPSG:4326',
    geometryName: 'geometry'
  });

  function callRoute(routeCoords) {
    var first = ol.proj.transform([routeCoords[0], routeCoords[1]], 'EPSG:3857', 'EPSG:4326');
    var second = ol.proj.transform([routeCoords[2], routeCoords[3]], 'EPSG:3857', 'EPSG:4326');
    var x1 = first[0];
    var y1 = first[1];
    var x2 = second[0];
    var y2 = second[1];
    $.ajax({
      url: 'https://api.mapbox.com/v4/directions/mapbox.driving/' + x1 + ',' + y1 + ';' + x2 + ',' + y2 + '.json?alternatives=false&access_token=pk.eyJ1IjoiZmlydmFpbiIsImEiOiJlOWYyYTM0NThiNWM0YjJjODJjNDE4ODQzNzA2MGQyNiJ9.-NVDO27Hzt-w_nQosUPfLA',
      type: 'GET',
      dataType: 'json'
    }).done(function(data) {
      var route={};
      route.type ="Feature";
      route.geometry = data.routes[0].geometry;
      featuresOverlay.getSource().addFeatures(geoJSONFormat.readFeatures(route, {
        dataProjection: 'EPSG:4326',
        featureProjection: 'EPSG:3857'
      }));
      map.getView().fit(featuresOverlay.getSource().getExtent(), map.getSize());
    }).fail(function() {
      console.log("error");
    }).always(function() {
      console.log("complete");
    });
  }
  $('.marker').on('change', function(event) {
    event.preventDefault();
    /* Act on the event */
    if ($(this).prop('checked') === true) {
      map.on('singleclick', handleMarker);
    } else {
      map.un('singleclick', handleMarker);
      featuresOverlay.getSource().clear();
    }
  });
}());

(function() {
  $('.weather').change(function() {
    if ($(this).prop('checked') === true) {
        map.getOverlays().forEach(function(ovl) {
        if (ovl.get('name') === 'weather') {
          ($(ovl.getElement()).parent()).remove();
          $(ovl.getElement()).remove();
        }
      });
      var center = ol.proj.transform(map.getView().getCenter(), 'EPSG:3857', 'EPSG:4326');
      var lat = center[1];
      var lon = center[0];
      $.ajax({
        url: 'http://api.openweathermap.org/data/2.5/find?lat=' + lat + '&lon=' + lon + '&cnt=5&cluster=no&units=metric&type=accurate&APPID=f9cd9fa2c427c3b115e87e4862619c5c',
        type: 'GET',
        dataType: 'json',
      }).done(function(data) {
        function createWeatherOverlay(position, index) {
          var elem = document.createElement('div');
          elem.setAttribute('class', 'weather-popup default-primary-color mdl-shadow--6dp');
          elem.setAttribute('id', index);
          elem.setAttribute('data-name', 'weather');
          return new ol.Overlay({
            element: elem,
            position: position,
          });
        }
        var objs = data.list;
        var overlay, coordinates;
        $.each(objs, function(index, val) {
          coordinates = ol.proj.transform([val.coord.lon, val.coord.lat], 'EPSG:4326', 'EPSG:3857');
          overlay = createWeatherOverlay(coordinates, index);
          map.addOverlay(overlay);
          overlay.set('name', 'weather');
          weatherData = {
            'name': val.name,
            'temp': val.main.temp,
            'pressure': val.main.pressure,
            'humidity': val.main.humidity
          };
          dust.render('weatherPopup.dust', weatherData, function(err, out) {
            $("#" + index).html(out);
          });
        });
      }).fail(function() {
        // toastr.error("Δεν βρέθηκαν πληροφορίες για τις καιρικές συνθήκες!");
      });
    } else if ($(this).prop('checked') === false) {
      map.getOverlays().forEach(function(ovl) {
        if (ovl.get('name') === 'weather') {
          ($(ovl.getElement()).parent()).remove();
          $(ovl.getElement()).remove();
        }
      });
    }
  });
}());

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hcC5qcyIsImZpbHRlcnMuanMiLCJnZW9sb2NhdGlvbi5qcyIsImluZm8uanMiLCJyb3V0aW5nLmpzIiwid2VhdGhlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcFBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoic2NyaXB0cy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIgdmFyIGNlbnRlciA9IFszNjc3Mzg1LCA0MTIwOTQ5XSxcclxuICAgZXh0ZW50ID0gWzM1OTAwOTQsIDQxMDI4MzMsIDM4NTU0ODMsIDQyNjEyMTFdLFxyXG4gICBsYW5nID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmxhbmcsXHJcbiAgIHN0eWxlQ2FjaGUgPSB7fSxcclxuICAgZ2VvSlNPTkZvcm1hdCA9IG5ldyBvbC5mb3JtYXQuR2VvSlNPTih7XHJcbiAgICAgZGVmYXVsdERhdGFQcm9qZWN0aW9uOiAnRVBTRzo0MzI2J1xyXG4gICB9KTtcclxuIHZhciBiaW5nID0gbmV3IG9sLmxheWVyLlRpbGUoe1xyXG4gICB2aXNpYmxlOiB0cnVlLFxyXG4gICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuQmluZ01hcHMoe1xyXG4gICAgIGtleTogJ0FrMkdxOFZVZklDc1BwdWY3TFJBTlhtWHQyc0hXbVNMUGhvaG1WTEZ0RklFd1lqc181TUN5QWhBRndSU1ZwTGonLFxyXG4gICAgIGltYWdlcnlTZXQ6ICdBZXJpYWwnXHJcbiAgIH0pLFxyXG4gICBtYXhab29tOiAxOSxcclxuICAgY3Jvc3NPcmlnaW46ICdhbm9ueW1vdXMnLFxyXG4gICBwcmVsb2FkOiBJbmZpbml0eSxcclxuICAgaWQ6ICdiaW5nJ1xyXG4gfSk7XHJcbiB2YXIgbWFwYm94ID0gbmV3IG9sLmxheWVyLlRpbGUoe1xyXG4gICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuWFlaKHtcclxuICAgICBhdHRyaWJ1dGlvbnM6IFtuZXcgb2wuQXR0cmlidXRpb24oe1xyXG4gICAgICAgaHRtbDogJzxhIGhyZWY9XFxcImh0dHBzOi8vd3d3Lm1hcGJveC5jb20vYWJvdXQvbWFwcy9cXFwiIHRhcmdldD1cXFwiX2JsYW5rXFxcIj4mY29weTsgTWFwYm94ICZjb3B5OyBPcGVuU3RyZWV0TWFwPC9hPidcclxuICAgICB9KV0sXHJcbiAgICAgdXJsOiAnaHR0cHM6Ly9hcGkubWFwYm94LmNvbS92NC9tYXBib3guc3RyZWV0cy97en0ve3h9L3t5fS5wbmc/YWNjZXNzX3Rva2VuPXBrLmV5SjFJam9pWm1seWRtRnBiaUlzSW1FaU9pSmxPV1l5WVRNME5UaGlOV00wWWpKak9ESmpOREU0T0RRek56QTJNR1F5TmlKOS4tTlZETzI3SHp0LXdfblFvc1VQZkxBJ1xyXG4gICB9KSxcclxuICAgaWQ6ICdtYXBib3gnXHJcbiB9KTtcclxuXHJcbiBmdW5jdGlvbiBjcmVhdGVQcm9wZXJ0eVN0eWxlKGZlYXR1cmUpIHtcclxuICAgdmFyIHNyYztcclxuICAgaWYgKGZlYXR1cmUuZ2V0KCd0eXBlX2VuJykgPT09ICdTYWxlJykge1xyXG4gICAgIHNyYyA9ICcuLi9pbWFnZXMvbWFwLWljb25zL3BpbnMvNDgvcGluMi5wbmcnO1xyXG4gICB9IGVsc2Uge1xyXG4gICAgIHNyYyA9ICcuLi9pbWFnZXMvbWFwLWljb25zL3BpbnMvNDgvcGluNS5wbmcnO1xyXG4gICB9XHJcbiAgIHJldHVybiBuZXcgb2wuc3R5bGUuU3R5bGUoe1xyXG4gICAgIGdlb21ldHJ5OiBmZWF0dXJlLmdldEdlb21ldHJ5KCksXHJcbiAgICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5JY29uKCh7XHJcbiAgICAgICBzcmM6IHNyYyxcclxuICAgICAgIGFuY2hvck9yaWdpbjogJ2JvdHRvbS1sZWZ0JyxcclxuICAgICAgIGFuY2hvcjogWzAsIDBdLFxyXG4gICAgICAgc2NhbGU6IDAuNyxcclxuICAgICB9KSlcclxuICAgfSk7XHJcbiB9XHJcblxyXG4gZnVuY3Rpb24gcHJvcGVydHlTdHlsZUZ1bmN0aW9uKGZlYXR1cmUsIHJlc29sdXRpb24pIHtcclxuICAgdmFyIHNpemUgPSBmZWF0dXJlLmdldCgnZmVhdHVyZXMnKS5sZW5ndGg7XHJcbiAgIGlmIChzaXplID4gMSkge1xyXG4gICAgIHN0eWxlID0gW25ldyBvbC5zdHlsZS5TdHlsZSh7XHJcbiAgICAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkNpcmNsZSh7XHJcbiAgICAgICAgIHJhZGl1czogMjAsXHJcbiAgICAgICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XHJcbiAgICAgICAgICAgY29sb3I6IFsxNTYsIDM5LCAxNzYsIDFdLFxyXG4gICAgICAgICAgIHdpZHRoOiA1XHJcbiAgICAgICAgIH0pLFxyXG4gICAgICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XHJcbiAgICAgICAgICAgY29sb3I6IFs2OCwgMTM4LCAyNTUsIDAuOF1cclxuICAgICAgICAgfSlcclxuICAgICAgIH0pLFxyXG4gICAgICAgdGV4dDogbmV3IG9sLnN0eWxlLlRleHQoe1xyXG4gICAgICAgICB0ZXh0OiBzaXplLnRvU3RyaW5nKCksXHJcbiAgICAgICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcclxuICAgICAgICAgICBjb2xvcjogJyNGRkZGRkYnXHJcbiAgICAgICAgIH0pXHJcbiAgICAgICB9KSxcclxuICAgICAgIHpJbmRleDogMTAxXHJcbiAgICAgfSldO1xyXG4gICB9IGVsc2Uge1xyXG4gICAgIHZhciBvcmlnaW5hbEZlYXR1cmUgPSBmZWF0dXJlLmdldCgnZmVhdHVyZXMnKVswXTtcclxuICAgICBzdHlsZSA9IFtjcmVhdGVQcm9wZXJ0eVN0eWxlKG9yaWdpbmFsRmVhdHVyZSldO1xyXG4gICB9XHJcbiAgIHJldHVybiBzdHlsZTtcclxuIH1cclxuXHJcbiBmdW5jdGlvbiBzZWxlY3RTdHlsZUZ1bmN0aW9uKGZlYXR1cmUsIHJlc29sdXRpb24pIHtcclxuICAgdmFyIHN0eWxlcyA9IFtuZXcgb2wuc3R5bGUuU3R5bGUoe30pXTtcclxuICAgdmFyIG9yaWdpbmFsRmVhdHVyZXMgPSBmZWF0dXJlLmdldCgnZmVhdHVyZXMnKTtcclxuICAgdmFyIG9yaWdpbmFGZWF0dXJlO1xyXG4gICBmb3IgKHZhciBpID0gb3JpZ2luYWxGZWF0dXJlcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xyXG4gICAgIG9yaWdpbmFsRmVhdHVyZSA9IG9yaWdpbmFsRmVhdHVyZXNbaV07XHJcbiAgICAgc3R5bGVzLnB1c2goY3JlYXRlUHJvcGVydHlTdHlsZShvcmlnaW5hbEZlYXR1cmUpKTtcclxuICAgfVxyXG4gICByZXR1cm4gc3R5bGVzO1xyXG4gfVxyXG4gdmFyIHByb3BlcnR5U291cmNlID0gbmV3IG9sLnNvdXJjZS5WZWN0b3Ioe1xyXG4gICBmb3JtYXQ6IGdlb0pTT05Gb3JtYXQsXHJcbiAgIGxvYWRlcjogZnVuY3Rpb24oZXh0ZW50LCByZXNvbHV0aW9uLCBwcm9qZWN0aW9uKSB7XHJcbiAgICAgdmFyIGVwc2c0MzI2RXh0ZW50ID0gb2wucHJvai50cmFuc2Zvcm1FeHRlbnQoZXh0ZW50LCAnRVBTRzozODU3JywgJ0VQU0c6NDMyNicpO1xyXG4gICAgIHZhciB1cmwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2RiL3Byb3BlcnR5P2Jib3hbeDFdPScgKyBlcHNnNDMyNkV4dGVudFswXSArICcmYmJveFt5MV09JyArIGVwc2c0MzI2RXh0ZW50WzFdICsgJyZiYm94W3gyXT0nICsgZXBzZzQzMjZFeHRlbnRbMl0gKyAnJmJib3hbeTJdPScgKyBlcHNnNDMyNkV4dGVudFszXTtcclxuICAgICB2YXIgdGhhdCA9IHRoaXM7XHJcbiAgICAgdGhpcy5jbGVhcigpO1xyXG4gICAgICQuYWpheCh7XHJcbiAgICAgICB1cmw6IHVybCxcclxuICAgICAgIHR5cGU6ICdHRVQnLFxyXG4gICAgICAgZGF0YVR5cGU6ICdqc29uJyxcclxuICAgICB9KS5kb25lKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICB2YXIgZmVhdHVyZXMgPSBnZW9KU09ORm9ybWF0LnJlYWRGZWF0dXJlcyhyZXNwb25zZSwge1xyXG4gICAgICAgICBmZWF0dXJlUHJvamVjdGlvbjogJ0VQU0c6Mzg1NydcclxuICAgICAgIH0pO1xyXG4gICAgICAgdGhhdC5hZGRGZWF0dXJlcyhmZWF0dXJlcyk7XHJcbiAgICAgfSkuZmFpbChmdW5jdGlvbigpIHtcclxuICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3JcIik7XHJcbiAgICAgfSk7XHJcbiAgIH0sXHJcbiAgIHN0cmF0ZWd5OiBvbC5sb2FkaW5nc3RyYXRlZ3kuYmJveFxyXG4gfSk7XHJcbiB2YXIgcHJvcGVydHlDbHVzdGVyU291cmNlID0gbmV3IG9sLnNvdXJjZS5DbHVzdGVyKHtcclxuICAgZGlzdGFuY2U6IDQwLFxyXG4gICBzb3VyY2U6IHByb3BlcnR5U291cmNlLFxyXG4gICBhdHRyaWJ1dGlvbnM6IFtuZXcgb2wuQXR0cmlidXRpb24oe1xyXG4gICAgIGh0bWw6ICdBbGwgbWFwcyDCqSAnICsgJzxhIGhyZWY9XCJodHRwOi8vd3d3LnRlcnJhY29nbml0YS5nci9cIj5UZXJyYSBDb2duaXRhPC9hPidcclxuICAgfSldXHJcbiB9KTtcclxuIHZhciBwcm9wZXJ0eSA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xyXG4gICBzb3VyY2U6IHByb3BlcnR5Q2x1c3RlclNvdXJjZSxcclxuICAgaWQ6ICdlc3RhdGVzJyxcclxuICAgdmlzaWJsZTogdHJ1ZSxcclxuICAgc3R5bGU6IHByb3BlcnR5U3R5bGVGdW5jdGlvblxyXG4gfSk7XHJcbiBwcm9wZXJ0eS5zZXRaSW5kZXgoMik7XHJcbiB2YXIgUFNBU3R5bGVGdW5jdGlvbiA9IGZ1bmN0aW9uKGZlYXR1cmUsIHJlc29sdXRpb24pIHtcclxuICAgdmFyIHN5bWJvbCA9IGZlYXR1cmUuZ2V0KCdzdHlsZScpO1xyXG4gICB2YXIgdGV4dDtcclxuICAgaWYgKGxhbmcgPT09ICdlbCcpIHtcclxuICAgICB0ZXh0ID0gZmVhdHVyZS5nZXQoJ25hbWVfZWwnKTtcclxuICAgfSBlbHNlIHtcclxuICAgICB0ZXh0ID0gZmVhdHVyZS5nZXQoJ25hbWVfZW4nKTtcclxuICAgfVxyXG4gICBpZiAoIXN0eWxlQ2FjaGVbc3ltYm9sXSkge1xyXG4gICAgIHN0eWxlQ2FjaGUgPSBbbmV3IG9sLnN0eWxlLlN0eWxlKHtcclxuICAgICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuSWNvbigoe1xyXG4gICAgICAgICBzcmM6ICcuLi9pbWFnZXMvbWFraS9yZW5kZXJzLycgKyBzeW1ib2wgKyAnLTI0LnBuZycsXHJcbiAgICAgICAgIGFuY2hvck9yaWdpbjogJ2JvdHRvbS1sZWZ0JyxcclxuICAgICAgICAgYW5jaG9yOiBbMC41LCAwLjVdLFxyXG4gICAgICAgICBzY2FsZTogMSxcclxuICAgICAgIH0pKSxcclxuICAgICAgIHRleHQ6IG5ldyBvbC5zdHlsZS5UZXh0KHtcclxuICAgICAgICAgdGV4dDogdGV4dCxcclxuICAgICAgICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcclxuICAgICAgICAgICBjb2xvcjogWzE1NiwgMzksIDE3NiwgMC44XSxcclxuICAgICAgICAgICB3aWR0aDogMVxyXG4gICAgICAgICB9KSxcclxuICAgICAgICAgb2Zmc2V0WTogMTJcclxuICAgICAgIH0pXHJcbiAgICAgfSldO1xyXG4gICB9XHJcbiAgIHJldHVybiBzdHlsZUNhY2hlO1xyXG4gfTtcclxuIHZhciBQU0EgPSBuZXcgb2wubGF5ZXIuVmVjdG9yKHtcclxuICAgc3R5bGU6IFBTQVN0eWxlRnVuY3Rpb24sXHJcbiAgIG1heFJlc29sdXRpb246IDNcclxuIH0pO1xyXG4gUFNBLnNldFpJbmRleCgxKTtcclxuXHJcbiBmdW5jdGlvbiBmaWx0ZXJlZEVzYXRlU3R5bGUoZmVhdHVyZSwgcmVzb2x1dGlvbikge1xyXG4gICBzdHlsZUNhY2hlID0gW25ldyBvbC5zdHlsZS5TdHlsZSh7XHJcbiAgICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5JY29uKCh7XHJcbiAgICAgICBzcmM6ICcuLi9pbWFnZXMvbWFwLWljb25zL3BpbnMvNDgvcGluNC5wbmcnLFxyXG4gICAgICAgYW5jaG9yT3JpZ2luOiAnYm90dG9tLWxlZnQnLFxyXG4gICAgICAgYW5jaG9yOiBbMC41LCAwLjVdLFxyXG4gICAgICAgc2NhbGU6IDAuNyxcclxuICAgICB9KSlcclxuICAgfSldO1xyXG4gICByZXR1cm4gc3R5bGVDYWNoZTtcclxuIH1cclxuIHZhciBmaWx0ZXJlZEVzdGF0ZXMgPSBuZXcgb2wubGF5ZXIuVmVjdG9yKHtcclxuICAgc291cmNlOiBuZXcgb2wuc291cmNlLlZlY3Rvcih7XHJcbiAgICAgZm9ybWF0OiBnZW9KU09ORm9ybWF0XHJcbiAgIH0pLFxyXG4gICBpZDogJ2ZpbHRlcmVkRXN0YXRlcycsXHJcbiAgIHZpc2libGU6IHRydWUsXHJcbiAgIHN0eWxlOiBmaWx0ZXJlZEVzYXRlU3R5bGVcclxuIH0pO1xyXG4gZmlsdGVyZWRFc3RhdGVzLnNldFpJbmRleCgyKTtcclxuIHZhciBzZWxlY3RTb3VyY2UgPSBuZXcgb2wuc291cmNlLlZlY3Rvcih7fSk7XHJcblxyXG52YXIgc2VsZWN0Qm94ID0gbmV3IG9sLmxheWVyLlZlY3Rvcih7XHJcbiAgc291cmNlOiBzZWxlY3RTb3VyY2UsXHJcbiAgc3R5bGU6IG5ldyBvbC5zdHlsZS5TdHlsZSh7XHJcbiAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XHJcbiAgICAgIGNvbG9yOiAncmdiYSgyMjcsIDcyLCAyNywgMC4yKSdcclxuICAgIH0pLFxyXG4gICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcclxuICAgICAgY29sb3I6ICcjRTM0ODFCJyxcclxuICAgICAgd2lkdGg6IDJcclxuICAgIH0pLFxyXG4gICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5DaXJjbGUoe1xyXG4gICAgICByYWRpdXM6IDcsXHJcbiAgICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcclxuICAgICAgICBjb2xvcjogJyNFMzQ4MUInXHJcbiAgICAgIH0pXHJcbiAgICB9KVxyXG4gIH0pXHJcbn0pO1xyXG5zZWxlY3RCb3guc2V0WkluZGV4KDMpO1xyXG4gdmFyIG1hcCA9IG5ldyBvbC5NYXAoe1xyXG4gICB0YXJnZXQ6ICdtYXAnLFxyXG4gICBsYXllcnM6IFttYXBib3gsIHByb3BlcnR5LCBQU0EsIGZpbHRlcmVkRXN0YXRlcyxzZWxlY3RCb3hdLFxyXG4gICAvLyBpbnRlcmFjdGlvbnM6IG9sLmludGVyYWN0aW9uLmRlZmF1bHRzKCkuZXh0ZW5kKFtuZXcgb2wuaW50ZXJhY3Rpb24uU2VsZWN0KHtcclxuICAgLy8gICBjb25kaXRpb246IGZ1bmN0aW9uKGV2dCkge1xyXG4gICAvLyAgICAgcmV0dXJuIGV2dC50eXBlID09PSAnc2luZ2xlY2xpY2snICYmIG9sLmV2ZW50cy5jb25kaXRpb24uc2hpZnRLZXlPbmx5KGV2dCk7XHJcbiAgIC8vICAgfSxcclxuICAgLy8gICBzdHlsZTogc2VsZWN0U3R5bGVGdW5jdGlvblxyXG4gICAvLyB9KV0pLFxyXG4gICBsb2FkVGlsZXNXaGlsZUFuaW1hdGluZzogdHJ1ZSxcclxuICAgbG9hZFRpbGVzV2hpbGVJbnRlcmFjdGluZzogdHJ1ZSxcclxuICAgcmVuZGVyZXI6ICdjYW52YXMnLFxyXG4gICBjb250cm9sczogb2wuY29udHJvbC5kZWZhdWx0cyh7XHJcbiAgICAgYXR0cmlidXRpb25PcHRpb25zOiB7XHJcbiAgICAgICBjb2xsYXBzaWJsZTogZmFsc2UsXHJcbiAgICAgICBjb2xsYXBzZWQ6IGZhbHNlXHJcbiAgICAgfVxyXG4gICB9KS5leHRlbmQoW1xyXG4gICAgIG5ldyBvbC5jb250cm9sLlNjYWxlTGluZSh7XHJcbiAgICAgICB1bml0czogJ21ldHJpYydcclxuICAgICB9KSwgbmV3IG9sLmNvbnRyb2wuT3ZlcnZpZXdNYXAoe1xyXG4gICAgICAgY2xhc3NOYW1lOiAnb2wtb3ZlcnZpZXdtYXAgb2wtY3VzdG9tLW92ZXJ2aWV3bWFwJyxcclxuICAgICAgIGNvbGxhcHNpYmxlOiB0cnVlLFxyXG4gICAgICAgY29sbGFwc2VkOiB0cnVlLFxyXG4gICAgICAgbGF5ZXJzOiBbYmluZ11cclxuICAgICB9KSxcclxuICAgICBuZXcgb2wuY29udHJvbC5ab29tVG9FeHRlbnQoe1xyXG4gICAgICAgZXh0ZW50OiBleHRlbnRcclxuICAgICB9KVxyXG4gICBdKSxcclxuICAgdmlldzogbmV3IG9sLlZpZXcoe1xyXG4gICAgIGNlbnRlcjogY2VudGVyLFxyXG4gICAgIGV4dGVudDogZXh0ZW50LFxyXG4gICAgIHByb2plY3Rpb246ICdFUFNHOjM4NTcnLFxyXG4gICAgIHpvb206IDE0LFxyXG4gICAgIG1heFpvb206IDE5LFxyXG4gICAgIG1pblpvb206IDEwXHJcbiAgIH0pLFxyXG4gfSk7XHJcbiBpZiAobGFuZyA9PT0gJ2VsJykge1xyXG4gICBiaW5nLnNldCgnbmFtZScsICfOlM6/z4HPhc+Gzr/Pgc65zrrOriDOtc65zrrPjM69zrEnKTtcclxuICAgbWFwYm94LnNldCgnbmFtZScsICfOp86sz4HPhM63z4InKTtcclxuICAgcHJvcGVydHkuc2V0KCduYW1lJywgJ86RzrrOr869zrfPhM6xJyk7XHJcbiB9IGVsc2Uge1xyXG4gICBiaW5nLnNldCgnbmFtZScsICdTYXR0ZWxpdGUgSW1hZ2UnKTtcclxuICAgbWFwYm94LnNldCgnbmFtZScsICdNYXAnKTtcclxuICAgcHJvcGVydHkuc2V0KCduYW1lJywgJ1Byb3BlcnRpZXMnKTtcclxuIH1cclxuIiwiIGZ1bmN0aW9uIHNlbGVjdEJ5RmlsdGVycygpIHtcclxuICAgUFNBLnNldFNvdXJjZShudWxsKTtcclxuICAgdmFyIHBhcmFtcyA9IHt9O1xyXG4gICB2YXIgZXBzZzQzMjZFeHRlbnQ7XHJcbiAgIHBhcmFtcy5sZWFzZVR5cGUgPSAkKFwiaW5wdXRbbmFtZT1vcHRpb25zXTpjaGVja2VkXCIpLnZhbCgpO1xyXG4gICBwYXJhbXMuc3RhcnRQcmljZSA9ICQoJyNzdGFydFByaWNlJykudmFsKCk7XHJcbiAgIHBhcmFtcy5lbmRQcmljZSA9ICQoJyNlbmRQcmljZScpLnZhbCgpO1xyXG4gICBwYXJhbXMucGFya2luZyA9ICQoJyNjaGVja2JveC0xJykucHJvcCgnY2hlY2tlZCcpO1xyXG4gICBwYXJhbXMuZnVybmlzaGVkID0gJCgnI2NoZWNrYm94LTInKS5wcm9wKCdjaGVja2VkJyk7XHJcbiAgIHBhcmFtcy5oZWF0aW5nID0gJCgnI2NoZWNrYm94LTMnKS5wcm9wKCdjaGVja2VkJyk7XHJcbiAgIHBhcmFtcy5jb29saW5nID0gJCgnI2NoZWNrYm94LTQnKS5wcm9wKCdjaGVja2VkJyk7XHJcbiAgIHBhcmFtcy52aWV3ID0gJCgnI2NoZWNrYm94LTUnKS5wcm9wKCdjaGVja2VkJyk7XHJcbiAgIGlmIChzZWxlY3RTb3VyY2UuZ2V0RmVhdHVyZXMoKS5sZW5ndGggPT09IDApIHtcclxuICAgICBlcHNnNDMyNkV4dGVudCA9IG9sLnByb2oudHJhbnNmb3JtRXh0ZW50KGV4dGVudCwgJ0VQU0c6Mzg1NycsICdFUFNHOjQzMjYnKTtcclxuICAgfSBlbHNlIHtcclxuICAgICBlcHNnNDMyNkV4dGVudCA9IG9sLnByb2oudHJhbnNmb3JtRXh0ZW50KHNlbGVjdFNvdXJjZS5nZXRGZWF0dXJlcygpWzBdLmdldEdlb21ldHJ5KCkuZ2V0RXh0ZW50KCksICdFUFNHOjM4NTcnLCAnRVBTRzo0MzI2Jyk7XHJcbiAgIH1cclxuICAgdG9hc3RyLm9wdGlvbnMgPSB7XHJcbiAgICAgXCJjbG9zZUJ1dHRvblwiOiBmYWxzZSxcclxuICAgICBcImRlYnVnXCI6IGZhbHNlLFxyXG4gICAgIFwibmV3ZXN0T25Ub3BcIjogZmFsc2UsXHJcbiAgICAgXCJwcm9ncmVzc0JhclwiOiBmYWxzZSxcclxuICAgICBcInBvc2l0aW9uQ2xhc3NcIjogXCJ0b2FzdC10b3AtY2VudGVyXCIsXHJcbiAgICAgXCJwcmV2ZW50RHVwbGljYXRlc1wiOiBmYWxzZSxcclxuICAgICBcIm9uY2xpY2tcIjogbnVsbCxcclxuICAgICBcInNob3dEdXJhdGlvblwiOiBcIjMwMFwiLFxyXG4gICAgIFwiaGlkZUR1cmF0aW9uXCI6IFwiMTAwMFwiLFxyXG4gICAgIFwidGltZU91dFwiOiBcIjUwMDBcIixcclxuICAgICBcImV4dGVuZGVkVGltZU91dFwiOiBcIjEwMDBcIixcclxuICAgICBcInNob3dFYXNpbmdcIjogXCJzd2luZ1wiLFxyXG4gICAgIFwiaGlkZUVhc2luZ1wiOiBcImxpbmVhclwiLFxyXG4gICAgIFwic2hvd01ldGhvZFwiOiBcImZhZGVJblwiLFxyXG4gICAgIFwiaGlkZU1ldGhvZFwiOiBcImZhZGVPdXRcIlxyXG4gICB9O1xyXG4gICAkLmFqYXgoe1xyXG4gICAgIHVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9kYi9maWx0ZXJlZHByb3BlcnR5P2Jib3hbeDFdPScgKyBlcHNnNDMyNkV4dGVudFswXSArICcmYmJveFt5MV09JyArIGVwc2c0MzI2RXh0ZW50WzFdICsgJyZiYm94W3gyXT0nICsgZXBzZzQzMjZFeHRlbnRbMl0gKyAnJmJib3hbeTJdPScgKyBlcHNnNDMyNkV4dGVudFszXSxcclxuICAgICB0eXBlOiAnR0VUJyxcclxuICAgICBkYXRhVHlwZTogJ2pzb24nLFxyXG4gICAgIGRhdGE6IHtcclxuICAgICAgIGxlYXNlVHlwZTogcGFyYW1zLmxlYXNlVHlwZSxcclxuICAgICAgIGZ1cm5pc2hlZDogcGFyYW1zLmZ1cm5pc2hlZCxcclxuICAgICAgIGhlYXRpbmc6IHBhcmFtcy5oZWF0aW5nLFxyXG4gICAgICAgcGFya2luZzogcGFyYW1zLnBhcmtpbmcsXHJcbiAgICAgICBjb29saW5nOiBwYXJhbXMuY29vbGluZyxcclxuICAgICAgIHZpZXc6IHBhcmFtcy52aWV3LFxyXG4gICAgICAgc3RhcnRQcmljZTogcGFyYW1zLnN0YXJ0UHJpY2UsXHJcbiAgICAgICBlbmRQcmljZTogcGFyYW1zLmVuZFByaWNlXHJcbiAgICAgfSxcclxuICAgfSkuZG9uZShmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgIHZhciBmZWF0dXJlcyA9IGdlb0pTT05Gb3JtYXQucmVhZEZlYXR1cmVzKHJlc3BvbnNlLCB7XHJcbiAgICAgICBmZWF0dXJlUHJvamVjdGlvbjogJ0VQU0c6Mzg1NydcclxuICAgICB9KTtcclxuXHJcbiAgICAgaWYgKGZlYXR1cmVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgIHRvYXN0ci5jbGVhcigpO1xyXG4gICAgICAgZmlsdGVyZWRFc3RhdGVzLmdldFNvdXJjZSgpLmNsZWFyKCk7XHJcbiAgICAgICBmaWx0ZXJlZEVzdGF0ZXMuZ2V0U291cmNlKCkuYWRkRmVhdHVyZXMoZmVhdHVyZXMpO1xyXG4gICAgICAgZmlsdGVyZWRFc3RhdGVzLnNldFZpc2libGUodHJ1ZSk7XHJcbiAgICAgICBwcm9wZXJ0eS5zZXRWaXNpYmxlKGZhbHNlKTtcclxuICAgICAgIHZhciBleHRlbnQgPSBmaWx0ZXJlZEVzdGF0ZXMuZ2V0U291cmNlKCkuZ2V0RXh0ZW50KCk7XHJcbiAgICAgICB2YXIgY2VudGVyID0gW107XHJcbiAgICAgfSBlbHNlIHtcclxuICAgICAgIHRvYXN0ci5lcnJvcihcIk5vIEluZm8gRm91bmQhXCIpO1xyXG4gICAgICAgZmlsdGVyZWRFc3RhdGVzLnNldFZpc2libGUoZmFsc2UpO1xyXG4gICAgICAgcHJvcGVydHkuc2V0VmlzaWJsZSh0cnVlKTtcclxuICAgICB9XHJcbiAgIH0pO1xyXG4gfVxyXG4gJChcIiNjbGVhckZpbHRlcnNcIikuY2xpY2soZnVuY3Rpb24oKSB7XHJcbiAgICQoXCJpbnB1dFtuYW1lPW9wdGlvbnNdXCIpLnByb3AoJ2NoZWNrZWQnLCBmYWxzZSk7XHJcbiAgICQoJ2xhYmVsW2Zvcj1vcHRpb24tMV0nKS5yZW1vdmVDbGFzcygnaXMtY2hlY2tlZCcpO1xyXG4gICAkKCdsYWJlbFtmb3I9b3B0aW9uLTJdJykucmVtb3ZlQ2xhc3MoJ2lzLWNoZWNrZWQnKTtcclxuICAgJCgnbGFiZWxbZm9yPWNoZWNrYm94LTFdJykucmVtb3ZlQ2xhc3MoJ2lzLWNoZWNrZWQnKTtcclxuICAgJCgnbGFiZWxbZm9yPWNoZWNrYm94LTJdJykucmVtb3ZlQ2xhc3MoJ2lzLWNoZWNrZWQnKTtcclxuICAgJCgnbGFiZWxbZm9yPWNoZWNrYm94LTNdJykucmVtb3ZlQ2xhc3MoJ2lzLWNoZWNrZWQnKTtcclxuICAgJCgnbGFiZWxbZm9yPWNoZWNrYm94LTRdJykucmVtb3ZlQ2xhc3MoJ2lzLWNoZWNrZWQnKTtcclxuICAgJCgnbGFiZWxbZm9yPWNoZWNrYm94LTVdJykucmVtb3ZlQ2xhc3MoJ2lzLWNoZWNrZWQnKTtcclxuICAgJCgnbGFiZWxbZm9yPWNoZWNrYm94LTZdJykucmVtb3ZlQ2xhc3MoJ2lzLWNoZWNrZWQnKTtcclxuICAgZmlsdGVyZWRFc3RhdGVzLmdldFNvdXJjZSgpLmNsZWFyKCk7XHJcbiAgIHByb3BlcnR5LnNldFZpc2libGUodHJ1ZSk7XHJcbiAgIFBTQS5zZXRTb3VyY2UobnVsbCk7XHJcbiAgIHNlbGVjdFNvdXJjZS5jbGVhcigpO1xyXG4gICBtYXAucmVtb3ZlSW50ZXJhY3Rpb24oZHJhdyk7XHJcbiB9KTtcclxuIHZhciBkcmF3O1xyXG5cclxuIGZ1bmN0aW9uIGFkZEludGVyYWN0aW9uKCkge1xyXG4gICBzZWxlY3RTb3VyY2UuY2xlYXIoKTtcclxuICAgZHJhdyA9IG5ldyBvbC5pbnRlcmFjdGlvbi5EcmF3KHtcclxuICAgICBzb3VyY2U6IHNlbGVjdFNvdXJjZSxcclxuICAgICB0eXBlOiAnTGluZVN0cmluZycsXHJcbiAgICAgZ2VvbWV0cnlGdW5jdGlvbjogZ2VvbWV0cnlGdW5jdGlvbixcclxuICAgICBtYXhQb2ludHM6IDJcclxuICAgfSk7XHJcbiAgIGRyYXcub24oJ2RyYXdzdGFydCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgIHNlbGVjdFNvdXJjZS5jbGVhcigpO1xyXG4gICB9KTtcclxuICAgbWFwLmFkZEludGVyYWN0aW9uKGRyYXcpO1xyXG4gfVxyXG5cclxuIGZ1bmN0aW9uIGdlb21ldHJ5RnVuY3Rpb24oY29vcmRpbmF0ZXMsIGdlb21ldHJ5KSB7XHJcbiAgIGlmICghZ2VvbWV0cnkpIHtcclxuICAgICBnZW9tZXRyeSA9IG5ldyBvbC5nZW9tLlBvbHlnb24obnVsbCk7XHJcbiAgIH1cclxuICAgdmFyIHN0YXJ0ID0gY29vcmRpbmF0ZXNbMF07XHJcbiAgIHZhciBlbmQgPSBjb29yZGluYXRlc1sxXTtcclxuICAgZ2VvbWV0cnkuc2V0Q29vcmRpbmF0ZXMoW1xyXG4gICAgIFtzdGFydCwgW3N0YXJ0WzBdLCBlbmRbMV1dLCBlbmQsIFtlbmRbMF0sIHN0YXJ0WzFdXSwgc3RhcnRdXHJcbiAgIF0pO1xyXG4gICByZXR1cm4gZ2VvbWV0cnk7XHJcbiB9XHJcbiAkKFwiI2NoZWNrYm94LTZcIikuY2hhbmdlKGZ1bmN0aW9uKCkge1xyXG4gICBpZiAodGhpcy5jaGVja2VkKSB7XHJcbiAgICAgYWRkSW50ZXJhY3Rpb24oKTtcclxuICAgfSBlbHNlIHtcclxuICAgICBtYXAucmVtb3ZlSW50ZXJhY3Rpb24oZHJhdyk7XHJcbiAgICAgc2VsZWN0U291cmNlLmNsZWFyKCk7XHJcbiAgIH1cclxuIH0pO1xyXG4iLCIoZnVuY3Rpb24oKSB7XHJcbiAgdmFyIGdlb2xvY2F0aW9uID0gbmV3IG9sLkdlb2xvY2F0aW9uKHtcclxuICAgIC8vIHRha2UgdGhlIHByb2plY3Rpb24gdG8gdXNlIGZyb20gdGhlIG1hcCdzIHZpZXdcclxuICAgIHByb2plY3Rpb246IG1hcC5nZXRWaWV3KCkuZ2V0UHJvamVjdGlvbigpLFxyXG4gICAgdHJhY2tpbmdPcHRpb25zOiB7XHJcbiAgICAgIG1heGltdW1BZ2U6IDEwMDAwLFxyXG4gICAgICBlbmFibGVIaWdoQWNjdXJhY3k6IHRydWUsXHJcbiAgICAgIHRpbWVvdXQ6IDYwMDAwMFxyXG4gICAgfVxyXG4gIH0pO1xyXG4gIHZhciBhY2N1cmFjeUZlYXR1cmUgPSBuZXcgb2wuRmVhdHVyZSgpO1xyXG4gIGdlb2xvY2F0aW9uLm9uKCdjaGFuZ2U6YWNjdXJhY3lHZW9tZXRyeScsIGZ1bmN0aW9uKCkge1xyXG4gICAgYWNjdXJhY3lGZWF0dXJlLnNldEdlb21ldHJ5KGdlb2xvY2F0aW9uLmdldEFjY3VyYWN5R2VvbWV0cnkoKSk7XHJcbiAgfSk7XHJcbiAgdmFyIHBvc2l0aW9uRmVhdHVyZSA9IG5ldyBvbC5GZWF0dXJlKCk7XHJcbiAgcG9zaXRpb25GZWF0dXJlLnNldFN0eWxlKG5ldyBvbC5zdHlsZS5TdHlsZSh7XHJcbiAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkNpcmNsZSh7XHJcbiAgICAgIHJhZGl1czogNixcclxuICAgICAgZmlsbDogbmV3IG9sLnN0eWxlLkZpbGwoe1xyXG4gICAgICAgIGNvbG9yOiAnIzMzOTlDQydcclxuICAgICAgfSksXHJcbiAgICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XHJcbiAgICAgICAgY29sb3I6ICcjZmZmJyxcclxuICAgICAgICB3aWR0aDogMlxyXG4gICAgICB9KVxyXG4gICAgfSlcclxuICB9KSk7XHJcbiAgLy8gbGlzdGVuIHRvIGNoYW5nZXMgaW4gcG9zaXRpb25cclxuICBnZW9sb2NhdGlvbi5vbignY2hhbmdlOnBvc2l0aW9uJywgZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgY29vcmRpbmF0ZXMgPSBnZW9sb2NhdGlvbi5nZXRQb3NpdGlvbigpO1xyXG4gICAgcG9zaXRpb25GZWF0dXJlLnNldEdlb21ldHJ5KGNvb3JkaW5hdGVzID8gbmV3IG9sLmdlb20uUG9pbnQoY29vcmRpbmF0ZXMpIDogbnVsbCk7XHJcbiAgfSk7XHJcbiAgZmVhdHVyZXNPdmVybGF5U291cmNlID0gbmV3IG9sLnNvdXJjZS5WZWN0b3Ioe30pO1xyXG4gIHZhciBmZWF0dXJlc092ZXJsYXkgPSBuZXcgb2wubGF5ZXIuVmVjdG9yKHtcclxuICAgIG1hcDogbWFwLFxyXG4gICAgc291cmNlOiBmZWF0dXJlc092ZXJsYXlTb3VyY2VcclxuICB9KTtcclxuICAkKCcuZ2VvbG9jYXRpb24nKS5vbignY2hhbmdlJywgZnVuY3Rpb24oZSkge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgaWYgKCQodGhpcykucHJvcCgnY2hlY2tlZCcpID09PSB0cnVlKSB7XHJcbiAgICAgIGdlb2xvY2F0aW9uLnNldFRyYWNraW5nKHRydWUpO1xyXG4gICAgICBmZWF0dXJlc092ZXJsYXlTb3VyY2UuYWRkRmVhdHVyZXMoW3Bvc2l0aW9uRmVhdHVyZSxhY2N1cmFjeUZlYXR1cmVdKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGdlb2xvY2F0aW9uLnNldFRyYWNraW5nKGZhbHNlKTtcclxuICAgICAgZmVhdHVyZXNPdmVybGF5U291cmNlLmNsZWFyKCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn0oKSk7XHJcbiIsImZ1bmN0aW9uIGhhbmRsZUluZm8oZXZ0KSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgbWFwLnJlbW92ZUludGVyYWN0aW9uKGRyYXcpO1xyXG4gIHZhciBjb29yZGluYXRlID0gZXZ0LmNvb3JkaW5hdGU7XHJcbiAgdmFyIG9iaiA9IHt9O1xyXG4gIHZhciB0aXRsZSA9IHt9O1xyXG4gIHZhciBvd25lciA9IHt9O1xyXG4gIHZhciBmZWF0dXJlcyA9IFtdO1xyXG4gIG9iai50aXRsZSA9IHRpdGxlO1xyXG4gIGlmIChsYW5nID09PSAnZWwnKSB7XHJcbiAgICB0aXRsZS5lc3RhdGVDb2RlID0gJ86az4nOtM65zrrPjM+CIM6ZzrTOuc6/zrrPhM63z4POr86xz4InO1xyXG4gICAgdGl0bGUudHlwZSA9ICfOpM+Nz4DOv8+CJztcclxuICAgIHRpdGxlLmFyZWEgPSAnzpXOvM6yzrHOtM+MJztcclxuICAgIHRpdGxlLmFkZHJlc3MgPSAnzpTOuc61z4XOuM+Fzr3Pg863JztcclxuICAgIHRpdGxlLmJlZHJvb21zID0gJ86lz4DOvc6/zrTPic68zqzPhM65zrEnO1xyXG4gICAgdGl0bGUucHJpY2UgPSAnzqTOuc68zq4nO1xyXG4gICAgdGl0bGUubmV3ID0gJ86dzrXPjM60zrzOt8+Ezr8nO1xyXG4gICAgdGl0bGUucGFya2luZyA9ICfOo8+EzqzOuM68zrXPg863JztcclxuICAgIHRpdGxlLmZ1cm5pc2hlZCA9ICfOlc+AzrnPgM67z4nOvM6tzr3Ovyc7XHJcbiAgICB0aXRsZS5wZXRzID0gJ86azrHPhM6/zrnOus6vzrTOuc6xJztcclxuICAgIHRpdGxlLnZpZXcgPSAnzpjOrc6xJztcclxuICAgIHRpdGxlLmhlYXRpbmcgPSAnzpjOrc+BzrzOsc69z4POtyc7XHJcbiAgICB0aXRsZS5jb29saW5nID0gJ86oz43Ovs63JztcclxuICAgIHRpdGxlLmNvbnRhY3RJbmZvID0gJ86jz4TOv865z4fOtc6vzrEgzpXPgM65zrrOv865zr3Pic69zq/Osc+CJztcclxuICAgIHRpdGxlLm5hbWUgPSAnzozOvc6/zrzOsSc7XHJcbiAgICB0aXRsZS5sYXN0bmFtZSA9ICfOlc+Azq/OuM61z4TOvyc7XHJcbiAgICB0aXRsZS5waG9uZSA9ICfOpM63zrvOrc+Gz4nOvc6/JztcclxuICAgIHRpdGxlLmVtYWlsID0gJ86XzrvOtc66z4TPgc6/zr3Ouc66zq4gzpTOuc61z43OuM+Fzr3Pg863JztcclxuICB9IGVsc2Uge1xyXG4gICAgdGl0bGUuZXN0YXRlQ29kZSA9ICdFc3RhdGUgQ29kZSc7XHJcbiAgICB0aXRsZS50eXBlID0gJ1R5cGUnO1xyXG4gICAgdGl0bGUuYXJlYSA9ICdTaXplJztcclxuICAgIHRpdGxlLmFkZHJlc3MgPSAnQWRkcmVzcyc7XHJcbiAgICB0aXRsZS5iZWRyb29tcyA9ICdCZWRyb29tcyc7XHJcbiAgICB0aXRsZS5wcmljZSA9ICdQcmljZSc7XHJcbiAgICB0aXRsZS5uZXcgPSAnTmV3bHkgQnVpbGQnO1xyXG4gICAgdGl0bGUucGFya2luZyA9ICdQYXJraW5nJztcclxuICAgIHRpdGxlLmZ1cm5pc2hlZCA9ICdGdXJuaXNoZWQnO1xyXG4gICAgdGl0bGUucGV0cyA9ICdQZXRzIEFsbG93ZWQnO1xyXG4gICAgdGl0bGUudmlldyA9ICdWaWV3JztcclxuICAgIHRpdGxlLmhlYXRpbmcgPSAnSGVhdGluZyc7XHJcbiAgICB0aXRsZS5jb29saW5nID0gJ0Nvb2xpbmcnO1xyXG4gICAgdGl0bGUuY29udGFjdEluZm8gPSAnQ29udGFjdCBJbmZvJztcclxuICAgIHRpdGxlLm5hbWUgPSAnTmFtZSc7XHJcbiAgICB0aXRsZS5sYXN0bmFtZSA9ICdMYXN0IE5hbWUnO1xyXG4gICAgdGl0bGUucGhvbmUgPSAnVGVsZXBob25lJztcclxuICAgIHRpdGxlLmVtYWlsID0gJ0VtYWlsJztcclxuICB9XHJcbiAgY2xpY2tlZEZlYXR1cmUgPSBtYXAuZm9yRWFjaEZlYXR1cmVBdFBpeGVsKGV2dC5waXhlbCwgZnVuY3Rpb24oZmVhdHVyZSwgbGF5ZXIpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGZlYXR1cmU6IGZlYXR1cmUsXHJcbiAgICAgIGxheWVyOiBsYXllclxyXG4gICAgfTtcclxuICB9LCB0aGlzLCBmdW5jdGlvbihsYXllcikge1xyXG4gICAgaWYgKGxheWVyLmdldCgnaWQnKSA9PT0gJ2VzdGF0ZXMnIHx8IGxheWVyLmdldCgnaWQnKSA9PT0gJ2ZpbHRlcmVkRXN0YXRlcycpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgfSwgdGhpcyk7XHJcbiAgdmFyIGY7XHJcbiAgaWYgKGNsaWNrZWRGZWF0dXJlKSB7XHJcbiAgICBpZiAoY2xpY2tlZEZlYXR1cmUubGF5ZXIuZ2V0KCdpZCcpID09PSAnZXN0YXRlcycgJiYgY2xpY2tlZEZlYXR1cmUuZmVhdHVyZS5nZXQoJ2ZlYXR1cmVzJykubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgIGYgPSBjbGlja2VkRmVhdHVyZS5mZWF0dXJlLmdldFByb3BlcnRpZXMoKS5mZWF0dXJlc1swXTtcclxuICAgICAgY3JlYXRlUFNBYW5kQ2FyZChmLCBvYmopO1xyXG4gICAgfSBlbHNlIGlmIChjbGlja2VkRmVhdHVyZS5sYXllci5nZXQoJ2lkJykgPT09ICdmaWx0ZXJlZEVzdGF0ZXMnKSB7XHJcbiAgICAgIGYgPSBjbGlja2VkRmVhdHVyZS5mZWF0dXJlO1xyXG4gICAgICBjcmVhdGVQU0FhbmRDYXJkKGYsIG9iaik7XHJcbiAgICB9XHJcbiAgfSBlbHNlIHtcclxuICAgIFBTQS5zZXRTb3VyY2UobnVsbCk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVQU0FhbmRDYXJkKGYsIG9iaikge1xyXG4gIHZhciBmZWF0dXJlID0ge307XHJcbiAgZmVhdHVyZS5naWQgPSBmLmdldCgnZ2lkJyk7XHJcbiAgZmVhdHVyZS50eXBlID0gZi5nZXQoJ2VzdGF0ZXR5cGUnKTtcclxuICBmZWF0dXJlLmFyZWEgPSBmLmdldCgnZXN0YXRlYXJlYScpO1xyXG4gIGlmIChsYW5nID09PSAnZWwnKSB7XHJcbiAgICBmZWF0dXJlLmFkZHJlc3MgPSBmLmdldCgnc3RyZWV0X2VsJykgKyAnICcgKyBmLmdldCgnaF9udW1fZWwnKTtcclxuICB9IGVsc2Uge1xyXG4gICAgZmVhdHVyZS5hZGRyZXNzID0gZi5nZXQoJ3N0cmVldF9lbicpICsgJyAnICsgZi5nZXQoJ2hfbnVtX2VuJyk7XHJcbiAgfVxyXG4gIGZlYXR1cmUuYmVkcm9vbXMgPSBmLmdldCgnYmVkcm9vbXMnKTtcclxuICBmZWF0dXJlLnByaWNlID0gZi5nZXQoJ3ByaWNlJyk7XHJcbiAgZmVhdHVyZS5uZXcgPSBmLmdldCgnbmV3Jyk7XHJcbiAgZmVhdHVyZS5wYXJraW5nID0gZi5nZXQoJ3BhcmtpbmcnKTtcclxuICBmZWF0dXJlLmZ1cm5pc2hlZCA9IGYuZ2V0KCdmdXJuaXNoZWQnKTtcclxuICBmZWF0dXJlLnBldHMgPSBmLmdldCgncGV0cycpO1xyXG4gIGZlYXR1cmUudmlldyA9IGYuZ2V0KCd2aWV3Jyk7XHJcbiAgZmVhdHVyZS5oZWF0aW5nID0gZi5nZXQoJ2hlYXRpbmcnKTtcclxuICBmZWF0dXJlLmNvb2xpbmcgPSBmLmdldCgnY29vbGluZycpO1xyXG4gIGlmIChsYW5nID09PSAnZWwnKSB7XHJcbiAgICBmZWF0dXJlLm5hbWUgPSBmLmdldCgnbmFtZV9lbCcpO1xyXG4gICAgZmVhdHVyZS5sYXN0bmFtZSA9IGYuZ2V0KCdsYXN0bmFtZV9lbCcpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBmZWF0dXJlLm5hbWUgPSBmLmdldCgnbmFtZV9lbicpO1xyXG4gICAgZmVhdHVyZS5sYXN0bmFtZSA9IGYuZ2V0KCdsYXN0bmFtZV9lbicpO1xyXG4gIH1cclxuICBmZWF0dXJlLnBob25lID0gZi5nZXQoJ3Bob25lMScpO1xyXG4gIGZlYXR1cmUuZW1haWwgPSBmLmdldCgnZW1haWwnKTtcclxuICBmZWF0dXJlLmNvb3JkaW5hdGUgPSBmLmdldCgnZ2VvbWV0cnknKS5nZXRDb29yZGluYXRlcygpO1xyXG4gIHZhciBQU0FTb3VyY2UgPSBuZXcgb2wuc291cmNlLlZlY3Rvcih7XHJcbiAgICBhdHRyaWJ1dGlvbnM6IFtuZXcgb2wuQXR0cmlidXRpb24oe1xyXG4gICAgICBodG1sOiAnUE9JIGJ5ICcgKyAnPGEgaHJlZj1cImh0dHA6Ly93d3cudGVycmFjb2duaXRhLmdyL1wiPlRlcnJhIENvZ25pdGE8L2E+J1xyXG4gICAgfSldLFxyXG4gICAgZm9ybWF0OiBnZW9KU09ORm9ybWF0LFxyXG4gICAgbG9hZGVyOiBmdW5jdGlvbihleHRlbnQsIHJlc29sdXRpb24sIHByb2plY3Rpb24pIHtcclxuICAgICAgdmFyIHVybCA9ICdodHRwOi8vbG9jYWxob3N0OjMwMDAvZGIvdXNlcy8nICsgZmVhdHVyZS5naWQ7XHJcbiAgICAgIHZhciB0aGF0ID0gdGhpcztcclxuICAgICAgJC5hamF4KHtcclxuICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICB0eXBlOiAnR0VUJyxcclxuICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxyXG4gICAgICB9KS5kb25lKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgdmFyIGZlYXR1cmVzID0gZ2VvSlNPTkZvcm1hdC5yZWFkRmVhdHVyZXMocmVzcG9uc2UucHJvcGVydHlfc2VydmljZXNfYW5hbHlzaXMsIHtcclxuICAgICAgICAgIGZlYXR1cmVQcm9qZWN0aW9uOiAnRVBTRzozODU3J1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHZhciBhcmVhID0gbmV3IG9sLnN0eWxlLlN0eWxlKHtcclxuICAgICAgICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcclxuICAgICAgICAgICAgY29sb3I6IFsxNTYsIDM5LCAxNzYsIDAuMV1cclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgZmVhdHVyZXNbMF0uc2V0U3R5bGUoYXJlYSk7XHJcbiAgICAgICAgdGhhdC5hZGRGZWF0dXJlcyhmZWF0dXJlcyk7XHJcbiAgICAgIH0pLmZhaWwoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJlcnJvclwiKTtcclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgc3RyYXRlZ3k6IG9sLmxvYWRpbmdzdHJhdGVneS5hbGxcclxuICB9KTtcclxuICBQU0Euc2V0U291cmNlKFBTQVNvdXJjZSk7XHJcbiAgbWFwLmdldFZpZXcoKS5zZXRDZW50ZXIoZmVhdHVyZS5jb29yZGluYXRlKTtcclxuICBtYXAuZ2V0VmlldygpLnNldFJlc29sdXRpb24oMS4yKTtcclxuICBvYmouZmVhdHVyZSA9IGZlYXR1cmU7XHJcbiAgZHVzdC5yZW5kZXIoJ2VzdGF0ZUNhcmRzLmR1c3QnLCBvYmosIGZ1bmN0aW9uKGVyciwgb3V0KSB7XHJcbiAgICAkKCcuZXN0YXRlLWNhcmRzJykuaHRtbChvdXQpO1xyXG4gICAgJCgnLmVzdGF0ZS1jYXJkcycpLnJlbW92ZUNsYXNzKCd2aXN1YWxseWhpZGRlbicpO1xyXG4gIH0pO1xyXG4gICQoJ2FbaHJlZj1cIiNvcGVuTW9kYWxcIl0nKS5jbGljayhmdW5jdGlvbigpIHtcclxuICAgIGR1c3QucmVuZGVyKCdtb2RhbEluZm8uZHVzdCcsIG9iaiwgZnVuY3Rpb24oZXJyLCBvdXQpIHtcclxuICAgICAgJCgnLm1vZGFsLWNvbnRlbnQnKS5odG1sKG91dCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufVxyXG4kKCcuaW5mbycpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihlKSB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIFBTQS5zZXRTb3VyY2UobnVsbCk7XHJcbiAgICBcclxuICBpZiAoJCh0aGlzKS5wcm9wKCdjaGVja2VkJykgPT09IHRydWUpIHtcclxuICAgIG1hcC5vbignY2xpY2snLCBoYW5kbGVJbmZvKTtcclxuICB9IGVsc2Uge1xyXG4gICAgbWFwLnVuKCdjbGljaycsIGhhbmRsZUluZm8pO1xyXG4gIH1cclxufSk7XHJcbiIsIihmdW5jdGlvbigpIHtcclxuICB2YXIgbWFya2VyID0gbmV3IG9sLkZlYXR1cmUoKTtcclxuICB2YXIgaWNvblN0eWxlID0gbmV3IG9sLnN0eWxlLlN0eWxlKHtcclxuICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuSWNvbiggLyoqIEB0eXBlIHtvbHguc3R5bGUuSWNvbk9wdGlvbnN9ICovICh7XHJcbiAgICAgIGFuY2hvcjogWzAuNSwgMV0sXHJcbiAgICAgIGFuY2hvclhVbml0czogJ2ZyYWN0aW9uJyxcclxuICAgICAgYW5jaG9yWVVuaXRzOiAnZnJhY3Rpb24nLFxyXG4gICAgICBvcGFjaXR5OiAxLFxyXG4gICAgICBzY2FsZTogMSxcclxuICAgICAgc3JjOiAnLi4vaW1hZ2VzL21hcC1pY29ucy9waW5zLzI0L3BpbjEucG5nJyxcclxuICAgICAgc25hcFRvUGl4ZWw6IGZhbHNlXHJcbiAgICB9KSksXHJcbiAgICB6SW5kZXg6IDEwMFxyXG4gIH0pO1xyXG4gIG1hcmtlci5zZXRTdHlsZShpY29uU3R5bGUpO1xyXG4gIHZhciBmZWF0dXJlc092ZXJsYXlTdHlsZSA9IG5ldyBvbC5zdHlsZS5TdHlsZSh7XHJcbiAgICBzdHJva2U6IG5ldyBvbC5zdHlsZS5TdHJva2Uoe1xyXG4gICAgICBjb2xvcjogJyM0MDgwODAnLFxyXG4gICAgICB3aWR0aDogNSxcclxuICAgICAgbGluZURhc2g6IFs0LCA0XVxyXG4gICAgfSlcclxuICB9KTtcclxuICB2YXIgZmVhdHVyZXNPdmVybGF5ID0gbmV3IG9sLmxheWVyLlZlY3Rvcih7XHJcbiAgICBtYXA6IG1hcCxcclxuICAgIHNvdXJjZTogbmV3IG9sLnNvdXJjZS5WZWN0b3IoKSxcclxuICAgIHN0eWxlOiBmZWF0dXJlc092ZXJsYXlTdHlsZSxcclxuICAgIGlkOiAncm91dGUnLFxyXG4gICAgbmFtZUVsOiAnzpTOuc6xzrTPgc6/zrzOricsXHJcbiAgICBOYW1lRW46ICdSb3V0ZSdcclxuICB9KTtcclxuICB2YXIgcm91dGVDb29yZHMgPSBbXTtcclxuXHJcbiAgZnVuY3Rpb24gaGFuZGxlTWFya2VyKGV2ZW50KSB7XHJcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgdmFyIGZlYXR1cmVDb3VudCA9IGZlYXR1cmVzT3ZlcmxheS5nZXRTb3VyY2UoKS5nZXRGZWF0dXJlcygpLmxlbmd0aDtcclxuICAgIHZhciBjb29yZGluYXRlcyA9IGV2ZW50LmNvb3JkaW5hdGU7XHJcbiAgICBpZiAoZmVhdHVyZUNvdW50ID09PSAwKSB7XHJcbiAgICAgIG1hcmtlci5zZXRHZW9tZXRyeShuZXcgb2wuZ2VvbS5Qb2ludChjb29yZGluYXRlcykpO1xyXG4gICAgICBtYXJrZXIuc2V0SWQoJ2ZpcnN0Jyk7XHJcbiAgICAgIGZlYXR1cmVzT3ZlcmxheS5nZXRTb3VyY2UoKS5hZGRGZWF0dXJlKG1hcmtlcik7XHJcbiAgICAgIHJvdXRlQ29vcmRzWzBdID0gY29vcmRpbmF0ZXNbMF07XHJcbiAgICAgIHJvdXRlQ29vcmRzWzFdID0gY29vcmRpbmF0ZXNbMV07XHJcbiAgICB9IGVsc2UgaWYgKGZlYXR1cmVDb3VudCA9PT0gMSkge1xyXG4gICAgICB2YXIgY2xvbmUgPSBtYXJrZXIuY2xvbmUoKTtcclxuICAgICAgY2xvbmUuc2V0R2VvbWV0cnkobmV3IG9sLmdlb20uUG9pbnQoY29vcmRpbmF0ZXMpKTtcclxuICAgICAgY2xvbmUuc2V0SWQoJ3NlY29uZCcpO1xyXG4gICAgICBmZWF0dXJlc092ZXJsYXkuZ2V0U291cmNlKCkuYWRkRmVhdHVyZShjbG9uZSk7XHJcbiAgICAgIHJvdXRlQ29vcmRzWzJdID0gY29vcmRpbmF0ZXNbMF07XHJcbiAgICAgIHJvdXRlQ29vcmRzWzNdID0gY29vcmRpbmF0ZXNbMV07XHJcbiAgICAgIGNhbGxSb3V0ZShyb3V0ZUNvb3Jkcyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBmZWF0dXJlc092ZXJsYXkuZ2V0U291cmNlKCkuY2xlYXIoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdlb0pTT05Gb3JtYXQgPSBuZXcgb2wuZm9ybWF0Lkdlb0pTT04oe1xyXG4gICAgZGVmYXVsdERhdGFQcm9qZWN0aW9uOiAnRVBTRzo0MzI2JyxcclxuICAgIGdlb21ldHJ5TmFtZTogJ2dlb21ldHJ5J1xyXG4gIH0pO1xyXG5cclxuICBmdW5jdGlvbiBjYWxsUm91dGUocm91dGVDb29yZHMpIHtcclxuICAgIHZhciBmaXJzdCA9IG9sLnByb2oudHJhbnNmb3JtKFtyb3V0ZUNvb3Jkc1swXSwgcm91dGVDb29yZHNbMV1dLCAnRVBTRzozODU3JywgJ0VQU0c6NDMyNicpO1xyXG4gICAgdmFyIHNlY29uZCA9IG9sLnByb2oudHJhbnNmb3JtKFtyb3V0ZUNvb3Jkc1syXSwgcm91dGVDb29yZHNbM11dLCAnRVBTRzozODU3JywgJ0VQU0c6NDMyNicpO1xyXG4gICAgdmFyIHgxID0gZmlyc3RbMF07XHJcbiAgICB2YXIgeTEgPSBmaXJzdFsxXTtcclxuICAgIHZhciB4MiA9IHNlY29uZFswXTtcclxuICAgIHZhciB5MiA9IHNlY29uZFsxXTtcclxuICAgICQuYWpheCh7XHJcbiAgICAgIHVybDogJ2h0dHBzOi8vYXBpLm1hcGJveC5jb20vdjQvZGlyZWN0aW9ucy9tYXBib3guZHJpdmluZy8nICsgeDEgKyAnLCcgKyB5MSArICc7JyArIHgyICsgJywnICsgeTIgKyAnLmpzb24/YWx0ZXJuYXRpdmVzPWZhbHNlJmFjY2Vzc190b2tlbj1way5leUoxSWpvaVptbHlkbUZwYmlJc0ltRWlPaUpsT1dZeVlUTTBOVGhpTldNMFlqSmpPREpqTkRFNE9EUXpOekEyTUdReU5pSjkuLU5WRE8yN0h6dC13X25Rb3NVUGZMQScsXHJcbiAgICAgIHR5cGU6ICdHRVQnLFxyXG4gICAgICBkYXRhVHlwZTogJ2pzb24nXHJcbiAgICB9KS5kb25lKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgdmFyIHJvdXRlPXt9O1xyXG4gICAgICByb3V0ZS50eXBlID1cIkZlYXR1cmVcIjtcclxuICAgICAgcm91dGUuZ2VvbWV0cnkgPSBkYXRhLnJvdXRlc1swXS5nZW9tZXRyeTtcclxuICAgICAgZmVhdHVyZXNPdmVybGF5LmdldFNvdXJjZSgpLmFkZEZlYXR1cmVzKGdlb0pTT05Gb3JtYXQucmVhZEZlYXR1cmVzKHJvdXRlLCB7XHJcbiAgICAgICAgZGF0YVByb2plY3Rpb246ICdFUFNHOjQzMjYnLFxyXG4gICAgICAgIGZlYXR1cmVQcm9qZWN0aW9uOiAnRVBTRzozODU3J1xyXG4gICAgICB9KSk7XHJcbiAgICAgIG1hcC5nZXRWaWV3KCkuZml0KGZlYXR1cmVzT3ZlcmxheS5nZXRTb3VyY2UoKS5nZXRFeHRlbnQoKSwgbWFwLmdldFNpemUoKSk7XHJcbiAgICB9KS5mYWlsKGZ1bmN0aW9uKCkge1xyXG4gICAgICBjb25zb2xlLmxvZyhcImVycm9yXCIpO1xyXG4gICAgfSkuYWx3YXlzKGZ1bmN0aW9uKCkge1xyXG4gICAgICBjb25zb2xlLmxvZyhcImNvbXBsZXRlXCIpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gICQoJy5tYXJrZXInKS5vbignY2hhbmdlJywgZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAvKiBBY3Qgb24gdGhlIGV2ZW50ICovXHJcbiAgICBpZiAoJCh0aGlzKS5wcm9wKCdjaGVja2VkJykgPT09IHRydWUpIHtcclxuICAgICAgbWFwLm9uKCdzaW5nbGVjbGljaycsIGhhbmRsZU1hcmtlcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBtYXAudW4oJ3NpbmdsZWNsaWNrJywgaGFuZGxlTWFya2VyKTtcclxuICAgICAgZmVhdHVyZXNPdmVybGF5LmdldFNvdXJjZSgpLmNsZWFyKCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn0oKSk7XHJcbiIsIihmdW5jdGlvbigpIHtcclxuICAkKCcud2VhdGhlcicpLmNoYW5nZShmdW5jdGlvbigpIHtcclxuICAgIGlmICgkKHRoaXMpLnByb3AoJ2NoZWNrZWQnKSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgIG1hcC5nZXRPdmVybGF5cygpLmZvckVhY2goZnVuY3Rpb24ob3ZsKSB7XHJcbiAgICAgICAgaWYgKG92bC5nZXQoJ25hbWUnKSA9PT0gJ3dlYXRoZXInKSB7XHJcbiAgICAgICAgICAoJChvdmwuZ2V0RWxlbWVudCgpKS5wYXJlbnQoKSkucmVtb3ZlKCk7XHJcbiAgICAgICAgICAkKG92bC5nZXRFbGVtZW50KCkpLnJlbW92ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIHZhciBjZW50ZXIgPSBvbC5wcm9qLnRyYW5zZm9ybShtYXAuZ2V0VmlldygpLmdldENlbnRlcigpLCAnRVBTRzozODU3JywgJ0VQU0c6NDMyNicpO1xyXG4gICAgICB2YXIgbGF0ID0gY2VudGVyWzFdO1xyXG4gICAgICB2YXIgbG9uID0gY2VudGVyWzBdO1xyXG4gICAgICAkLmFqYXgoe1xyXG4gICAgICAgIHVybDogJ2h0dHA6Ly9hcGkub3BlbndlYXRoZXJtYXAub3JnL2RhdGEvMi41L2ZpbmQ/bGF0PScgKyBsYXQgKyAnJmxvbj0nICsgbG9uICsgJyZjbnQ9NSZjbHVzdGVyPW5vJnVuaXRzPW1ldHJpYyZ0eXBlPWFjY3VyYXRlJkFQUElEPWY5Y2Q5ZmEyYzQyN2MzYjExNWU4N2U0ODYyNjE5YzVjJyxcclxuICAgICAgICB0eXBlOiAnR0VUJyxcclxuICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxyXG4gICAgICB9KS5kb25lKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVXZWF0aGVyT3ZlcmxheShwb3NpdGlvbiwgaW5kZXgpIHtcclxuICAgICAgICAgIHZhciBlbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICBlbGVtLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnd2VhdGhlci1wb3B1cCBkZWZhdWx0LXByaW1hcnktY29sb3IgbWRsLXNoYWRvdy0tNmRwJyk7XHJcbiAgICAgICAgICBlbGVtLnNldEF0dHJpYnV0ZSgnaWQnLCBpbmRleCk7XHJcbiAgICAgICAgICBlbGVtLnNldEF0dHJpYnV0ZSgnZGF0YS1uYW1lJywgJ3dlYXRoZXInKTtcclxuICAgICAgICAgIHJldHVybiBuZXcgb2wuT3ZlcmxheSh7XHJcbiAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW0sXHJcbiAgICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgb2JqcyA9IGRhdGEubGlzdDtcclxuICAgICAgICB2YXIgb3ZlcmxheSwgY29vcmRpbmF0ZXM7XHJcbiAgICAgICAgJC5lYWNoKG9ianMsIGZ1bmN0aW9uKGluZGV4LCB2YWwpIHtcclxuICAgICAgICAgIGNvb3JkaW5hdGVzID0gb2wucHJvai50cmFuc2Zvcm0oW3ZhbC5jb29yZC5sb24sIHZhbC5jb29yZC5sYXRdLCAnRVBTRzo0MzI2JywgJ0VQU0c6Mzg1NycpO1xyXG4gICAgICAgICAgb3ZlcmxheSA9IGNyZWF0ZVdlYXRoZXJPdmVybGF5KGNvb3JkaW5hdGVzLCBpbmRleCk7XHJcbiAgICAgICAgICBtYXAuYWRkT3ZlcmxheShvdmVybGF5KTtcclxuICAgICAgICAgIG92ZXJsYXkuc2V0KCduYW1lJywgJ3dlYXRoZXInKTtcclxuICAgICAgICAgIHdlYXRoZXJEYXRhID0ge1xyXG4gICAgICAgICAgICAnbmFtZSc6IHZhbC5uYW1lLFxyXG4gICAgICAgICAgICAndGVtcCc6IHZhbC5tYWluLnRlbXAsXHJcbiAgICAgICAgICAgICdwcmVzc3VyZSc6IHZhbC5tYWluLnByZXNzdXJlLFxyXG4gICAgICAgICAgICAnaHVtaWRpdHknOiB2YWwubWFpbi5odW1pZGl0eVxyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIGR1c3QucmVuZGVyKCd3ZWF0aGVyUG9wdXAuZHVzdCcsIHdlYXRoZXJEYXRhLCBmdW5jdGlvbihlcnIsIG91dCkge1xyXG4gICAgICAgICAgICAkKFwiI1wiICsgaW5kZXgpLmh0bWwob3V0KTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KS5mYWlsKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIHRvYXN0ci5lcnJvcihcIs6UzrXOvSDOss+Bzq3OuM63zrrOsc69IM+AzrvOt8+Bzr/Phs6/z4HOr861z4IgzrPOuc6xIM+EzrnPgiDOus6xzrnPgc65zrrOrc+CIM+Dz4XOvc64zq7Ous61z4IhXCIpO1xyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSBpZiAoJCh0aGlzKS5wcm9wKCdjaGVja2VkJykgPT09IGZhbHNlKSB7XHJcbiAgICAgIG1hcC5nZXRPdmVybGF5cygpLmZvckVhY2goZnVuY3Rpb24ob3ZsKSB7XHJcbiAgICAgICAgaWYgKG92bC5nZXQoJ25hbWUnKSA9PT0gJ3dlYXRoZXInKSB7XHJcbiAgICAgICAgICAoJChvdmwuZ2V0RWxlbWVudCgpKS5wYXJlbnQoKSkucmVtb3ZlKCk7XHJcbiAgICAgICAgICAkKG92bC5nZXRFbGVtZW50KCkpLnJlbW92ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn0oKSk7XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
