 var center = [3677385, 4120949],
   extent = [3590094, 4102833, 3855483, 4261211],
   lang = document.documentElement.lang,
   styleCache = {},
   geoJSONFormat = new ol.format.GeoJSON({
     defaultDataProjection: 'EPSG:4326'
   });
 var bing = new ol.layer.Tile({
   visible: true,
   source: new ol.source.BingMaps({
     key: 'Ak2Gq8VUfICsPpuf7LRANXmXt2sHWmSLPhohmVLFtFIEwYjs_5MCyAhAFwRSVpLj',
     imagerySet: 'Aerial'
   }),
   maxZoom: 19,
   crossOrigin: 'anonymous',
   preload: Infinity,
   id: 'bing'
 });
 var mapbox = new ol.layer.Tile({
   source: new ol.source.XYZ({
     attributions: [new ol.Attribution({
       html: '<a href=\"https://www.mapbox.com/about/maps/\" target=\"_blank\">&copy; Mapbox &copy; OpenStreetMap</a>'
     })],
     url: 'https://api.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZmlydmFpbiIsImEiOiJlOWYyYTM0NThiNWM0YjJjODJjNDE4ODQzNzA2MGQyNiJ9.-NVDO27Hzt-w_nQosUPfLA'
   }),
   id: 'mapbox'
 });

 function createPropertyStyle(feature) {
   var src;
   if (feature.get('type_en') === 'Sale') {
     src = '../images/map-icons/pins/48/pin2.png';
   } else {
     src = '../images/map-icons/pins/48/pin5.png';
   }
   return new ol.style.Style({
     geometry: feature.getGeometry(),
     image: new ol.style.Icon(({
       src: src,
       anchorOrigin: 'bottom-left',
       anchor: [0, 0],
       scale: 0.7,
     }))
   });
 }

 function propertyStyleFunction(feature, resolution) {
   var size = feature.get('features').length;
   if (size > 1) {
     style = [new ol.style.Style({
       image: new ol.style.Circle({
         radius: 20,
         stroke: new ol.style.Stroke({
           color: [156, 39, 176, 1],
           width: 5
         }),
         fill: new ol.style.Fill({
           color: [68, 138, 255, 0.8]
         })
       }),
       text: new ol.style.Text({
         text: size.toString(),
         fill: new ol.style.Fill({
           color: '#FFFFFF'
         })
       }),
       zIndex: 101
     })];
   } else {
     var originalFeature = feature.get('features')[0];
     style = [createPropertyStyle(originalFeature)];
   }
   return style;
 }

 function selectStyleFunction(feature, resolution) {
   var styles = [new ol.style.Style({})];
   var originalFeatures = feature.get('features');
   var originaFeature;
   for (var i = originalFeatures.length - 1; i >= 0; --i) {
     originalFeature = originalFeatures[i];
     styles.push(createPropertyStyle(originalFeature));
   }
   return styles;
 }
 var propertySource = new ol.source.Vector({
   format: geoJSONFormat,
   loader: function(extent, resolution, projection) {
    console.log(resolution);
     var epsg4326Extent = ol.proj.transformExtent(extent, 'EPSG:3857', 'EPSG:4326');
     var url = 'http://localhost:3000/db/property?bbox[x1]=' + epsg4326Extent[0] + '&bbox[y1]=' + epsg4326Extent[1] + '&bbox[x2]=' + epsg4326Extent[2] + '&bbox[y2]=' + epsg4326Extent[3];
     var that = this;
     this.clear();
     console.log(extent);
     $.ajax({
       url: url,
       type: 'GET',
       dataType: 'json',
     }).done(function(response) {
       var features = geoJSONFormat.readFeatures(response, {
         featureProjection: 'EPSG:3857'
       });

       that.addFeatures(features);
     }).fail(function() {
       console.log("error");
     });
   },
   strategy: ol.loadingstrategy.bbox
 });
 var propertyClusterSource = new ol.source.Cluster({
   distance: 40,
   source: propertySource,
   attributions: [new ol.Attribution({
     html: 'All maps © ' + '<a href="http://www.terracognita.gr/">Terra Cognita</a>'
   })]
 });
 var property = new ol.layer.Vector({
   source: propertyClusterSource,
   id: 'estates',
   visible: true,
   style: propertyStyleFunction
 });
 property.setZIndex(2);
 var PSAStyleFunction = function(feature, resolution) {
   var symbol = feature.get('style');
   var text;
   if (lang === 'el') {
     text = feature.get('name_el');
   } else {
     text = feature.get('name_en');
   }
   if (!styleCache[symbol]) {
     styleCache = [new ol.style.Style({
       image: new ol.style.Icon(({
         src: '../images/maki/renders/' + symbol + '-24.png',
         anchorOrigin: 'bottom-left',
         anchor: [0.5, 0.5],
         scale: 1,
       })),
       text: new ol.style.Text({
         text: text,
         stroke: new ol.style.Stroke({
           color: [156, 39, 176, 0.8],
           width: 1
         }),
         offsetY: 12
       })
     })];
   }
   return styleCache;
 };
 var PSA = new ol.layer.Vector({
   style: PSAStyleFunction,
   maxResolution: 3
 });
 PSA.setZIndex(1);

 function filteredEsateStyle(feature, resolution) {
   styleCache = [new ol.style.Style({
     image: new ol.style.Icon(({
       src: '../images/map-icons/pins/48/pin4.png',
       anchorOrigin: 'bottom-left',
       anchor: [0.5, 0.5],
       scale: 0.7,
     }))
   })];
   return styleCache;
 }
 var filteredEstates = new ol.layer.Vector({
   source: new ol.source.Vector({
     format: geoJSONFormat
   }),
   id: 'filteredEstates',
   visible: true,
   style: filteredEsateStyle
 });
 filteredEstates.setZIndex(2);
 var selectSource = new ol.source.Vector({});

var selectBox = new ol.layer.Vector({
  source: selectSource,
  style: new ol.style.Style({
    fill: new ol.style.Fill({
      color: 'rgba(227, 72, 27, 0.2)'
    }),
    stroke: new ol.style.Stroke({
      color: '#E3481B',
      width: 2
    }),
    image: new ol.style.Circle({
      radius: 7,
      fill: new ol.style.Fill({
        color: '#E3481B'
      })
    })
  })
});
selectBox.setZIndex(3);
 var map = new ol.Map({
   target: 'map',
   layers: [mapbox, property, PSA, filteredEstates,selectBox],
   // interactions: ol.interaction.defaults().extend([new ol.interaction.Select({
   //   condition: function(evt) {
   //     return evt.type === 'singleclick' && ol.events.condition.shiftKeyOnly(evt);
   //   },
   //   style: selectStyleFunction
   // })]),
   loadTilesWhileAnimating: true,
   loadTilesWhileInteracting: true,
   renderer: 'canvas',
   controls: ol.control.defaults({
     attributionOptions: {
       collapsible: false,
       collapsed: false
     }
   }).extend([
     new ol.control.ScaleLine({
       units: 'metric'
     }), new ol.control.OverviewMap({
       className: 'ol-overviewmap ol-custom-overviewmap',
       collapsible: true,
       collapsed: true,
       layers: [bing]
     }),
     new ol.control.ZoomToExtent({
       extent: extent
     })
   ]),
   view: new ol.View({
     center: center,
     // extent: extent,
     projection: 'EPSG:3857',
     zoom: 14,
     maxZoom: 19,
     minZoom: 10
   }),
 });
 if (lang === 'el') {
   bing.set('name', 'Δορυφορική εικόνα');
   mapbox.set('name', 'Χάρτης');
   property.set('name', 'Ακίνητα');
 } else {
   bing.set('name', 'Sattelite Image');
   mapbox.set('name', 'Map');
   property.set('name', 'Properties');
 }

 function selectByFilters() {
   PSA.setSource(null);
   var params = {};
   var epsg4326Extent;
   params.leaseType = $("input[name=options]:checked").val();
   params.startPrice = $('#startPrice').val();
   params.endPrice = $('#endPrice').val();
   params.parking = $('#checkbox-1').prop('checked');
   params.furnished = $('#checkbox-2').prop('checked');
   params.heating = $('#checkbox-3').prop('checked');
   params.cooling = $('#checkbox-4').prop('checked');
   params.view = $('#checkbox-5').prop('checked');
   if (selectSource.getFeatures().length === 0) {
     epsg4326Extent = ol.proj.transformExtent(extent, 'EPSG:3857', 'EPSG:4326');
   } else {
     epsg4326Extent = ol.proj.transformExtent(selectSource.getFeatures()[0].getGeometry().getExtent(), 'EPSG:3857', 'EPSG:4326');
   }
   toastr.options = {
     "closeButton": false,
     "debug": false,
     "newestOnTop": false,
     "progressBar": false,
     "positionClass": "toast-top-center",
     "preventDuplicates": false,
     "onclick": null,
     "showDuration": "300",
     "hideDuration": "1000",
     "timeOut": "5000",
     "extendedTimeOut": "1000",
     "showEasing": "swing",
     "hideEasing": "linear",
     "showMethod": "fadeIn",
     "hideMethod": "fadeOut"
   };
   $.ajax({
     url: 'http://localhost:3000/db/filteredproperty?bbox[x1]=' + epsg4326Extent[0] + '&bbox[y1]=' + epsg4326Extent[1] + '&bbox[x2]=' + epsg4326Extent[2] + '&bbox[y2]=' + epsg4326Extent[3],
     type: 'GET',
     dataType: 'json',
     data: {
       leaseType: params.leaseType,
       furnished: params.furnished,
       heating: params.heating,
       parking: params.parking,
       cooling: params.cooling,
       view: params.view,
       startPrice: params.startPrice,
       endPrice: params.endPrice
     },
   }).done(function(response) {
     var features = geoJSONFormat.readFeatures(response, {
       featureProjection: 'EPSG:3857'
     });

     if (features.length > 0) {
       toastr.clear();
       filteredEstates.getSource().clear();
       filteredEstates.getSource().addFeatures(features);
       filteredEstates.setVisible(true);
       property.setVisible(false);
       var extent = filteredEstates.getSource().getExtent();
       var center = [];
     } else {
       toastr.error("No Info Found!");
       filteredEstates.setVisible(false);
       property.setVisible(true);
     }
   });
 }
 $("#clearFilters").click(function() {
   $("input[name=options]").prop('checked', false);
   $('label[for=option-1]').removeClass('is-checked');
   $('label[for=option-2]').removeClass('is-checked');
   $('label[for=checkbox-1]').removeClass('is-checked');
   $('label[for=checkbox-2]').removeClass('is-checked');
   $('label[for=checkbox-3]').removeClass('is-checked');
   $('label[for=checkbox-4]').removeClass('is-checked');
   $('label[for=checkbox-5]').removeClass('is-checked');
   $('label[for=checkbox-6]').removeClass('is-checked');
   filteredEstates.getSource().clear();
   property.setVisible(true);
   PSA.setSource(null);
   selectSource.clear();
   map.removeInteraction(draw);
 });
 var draw;

 function addInteraction() {
   selectSource.clear();
   draw = new ol.interaction.Draw({
     source: selectSource,
     type: 'LineString',
     geometryFunction: geometryFunction,
     maxPoints: 2
   });
   draw.on('drawstart', function() {
     selectSource.clear();
   });
   map.addInteraction(draw);
 }

 function geometryFunction(coordinates, geometry) {
   if (!geometry) {
     geometry = new ol.geom.Polygon(null);
   }
   var start = coordinates[0];
   var end = coordinates[1];
   geometry.setCoordinates([
     [start, [start[0], end[1]], end, [end[0], start[1]], start]
   ]);
   return geometry;
 }
 $("#checkbox-6").change(function() {
   if (this.checked) {
     addInteraction();
   } else {
     map.removeInteraction(draw);
     selectSource.clear();
   }
 });

(function() {
  var geolocation = new ol.Geolocation({
    // take the projection to use from the map's view
    projection: map.getView().getProjection(),
    trackingOptions: {
      maximumAge: 10000,
      enableHighAccuracy: true,
      timeout: 600000
    }
  });
  var accuracyFeature = new ol.Feature();
  geolocation.on('change:accuracyGeometry', function() {
    accuracyFeature.setGeometry(geolocation.getAccuracyGeometry());
  });
  var positionFeature = new ol.Feature();
  positionFeature.setStyle(new ol.style.Style({
    image: new ol.style.Circle({
      radius: 6,
      fill: new ol.style.Fill({
        color: '#3399CC'
      }),
      stroke: new ol.style.Stroke({
        color: '#fff',
        width: 2
      })
    })
  }));
  // listen to changes in position
  geolocation.on('change:position', function() {
    var coordinates = geolocation.getPosition();
    positionFeature.setGeometry(coordinates ? new ol.geom.Point(coordinates) : null);
  });
  featuresOverlaySource = new ol.source.Vector({});
  var featuresOverlay = new ol.layer.Vector({
    map: map,
    source: featuresOverlaySource
  });
  $('.geolocation').on('change', function(e) {
    e.preventDefault();
    if ($(this).prop('checked') === true) {
      geolocation.setTracking(true);
      featuresOverlaySource.addFeatures([positionFeature,accuracyFeature]);
    } else {
      geolocation.setTracking(false);
      featuresOverlaySource.clear();
    }
  });
}());

function handleInfo(evt) {
  evt.preventDefault();
  map.removeInteraction(draw);
  var coordinate = evt.coordinate;
  var obj = {};
  var title = {};
  var owner = {};
  var features = [];
  obj.title = title;
  if (lang === 'el') {
    title.estateCode = 'Κωδικός Ιδιοκτησίας';
    title.type = 'Τύπος';
    title.area = 'Εμβαδό';
    title.address = 'Διευθυνση';
    title.bedrooms = 'Υπνοδωμάτια';
    title.price = 'Τιμή';
    title.new = 'Νεόδμητο';
    title.parking = 'Στάθμεση';
    title.furnished = 'Επιπλωμένο';
    title.pets = 'Κατοικίδια';
    title.view = 'Θέα';
    title.heating = 'Θέρμανση';
    title.cooling = 'Ψύξη';
    title.contactInfo = 'Στοιχεία Επικοινωνίας';
    title.name = 'Όνομα';
    title.lastname = 'Επίθετο';
    title.phone = 'Τηλέφωνο';
    title.email = 'Ηλεκτρονική Διεύθυνση';
  } else {
    title.estateCode = 'Estate Code';
    title.type = 'Type';
    title.area = 'Size';
    title.address = 'Address';
    title.bedrooms = 'Bedrooms';
    title.price = 'Price';
    title.new = 'Newly Build';
    title.parking = 'Parking';
    title.furnished = 'Furnished';
    title.pets = 'Pets Allowed';
    title.view = 'View';
    title.heating = 'Heating';
    title.cooling = 'Cooling';
    title.contactInfo = 'Contact Info';
    title.name = 'Name';
    title.lastname = 'Last Name';
    title.phone = 'Telephone';
    title.email = 'Email';
  }
  clickedFeature = map.forEachFeatureAtPixel(evt.pixel, function(feature, layer) {
    return {
      feature: feature,
      layer: layer
    };
  }, this, function(layer) {
    if (layer.get('id') === 'estates' || layer.get('id') === 'filteredEstates') {
      return true;
    }
  }, this);
  var f;
  if (clickedFeature) {
    if (clickedFeature.layer.get('id') === 'estates' && clickedFeature.feature.get('features').length === 1) {
      f = clickedFeature.feature.getProperties().features[0];
      createPSAandCard(f, obj);
    } else if (clickedFeature.layer.get('id') === 'filteredEstates') {
      f = clickedFeature.feature;
      createPSAandCard(f, obj);
    }
  } else {
    PSA.setSource(null);
  }
}

function createPSAandCard(f, obj) {
  var feature = {};
  feature.gid = f.get('gid');
  feature.type = f.get('estatetype');
  feature.area = f.get('estatearea');
  if (lang === 'el') {
    feature.address = f.get('street_el') + ' ' + f.get('h_num_el');
  } else {
    feature.address = f.get('street_en') + ' ' + f.get('h_num_en');
  }
  feature.bedrooms = f.get('bedrooms');
  feature.price = f.get('price');
  feature.new = f.get('new');
  feature.parking = f.get('parking');
  feature.furnished = f.get('furnished');
  feature.pets = f.get('pets');
  feature.view = f.get('view');
  feature.heating = f.get('heating');
  feature.cooling = f.get('cooling');
  if (lang === 'el') {
    feature.name = f.get('name_el');
    feature.lastname = f.get('lastname_el');
  } else {
    feature.name = f.get('name_en');
    feature.lastname = f.get('lastname_en');
  }
  feature.phone = f.get('phone1');
  feature.email = f.get('email');
  feature.coordinate = f.get('geometry').getCoordinates();
  var PSASource = new ol.source.Vector({
    attributions: [new ol.Attribution({
      html: 'POI by ' + '<a href="http://www.terracognita.gr/">Terra Cognita</a>'
    })],
    format: geoJSONFormat,
    loader: function(extent, resolution, projection) {
      var url = 'http://localhost:3000/db/uses/' + feature.gid;
      var that = this;
      $.ajax({
        url: url,
        type: 'GET',
        dataType: 'json',
      }).done(function(response) {
        var features = geoJSONFormat.readFeatures(response.property_services_analysis, {
          featureProjection: 'EPSG:3857'
        });
        var area = new ol.style.Style({
          fill: new ol.style.Fill({
            color: [156, 39, 176, 0.1]
          })
        });
        features[0].setStyle(area);
        that.addFeatures(features);
      }).fail(function() {
        console.log("error");
      });
    },
    strategy: ol.loadingstrategy.all
  });
  PSA.setSource(PSASource);
  map.getView().setCenter(feature.coordinate);
  map.getView().setResolution(1.2);
  obj.feature = feature;
  dust.render('estateCards.dust', obj, function(err, out) {
    $('.estate-cards').html(out);
    $('.estate-cards').removeClass('visuallyhidden');
  });
  $('a[href="#openModal"]').click(function() {
    dust.render('modalInfo.dust', obj, function(err, out) {
      $('.modal-content').html(out);
    });
  });
}
$('.info').on('change', function(e) {
  e.preventDefault();
  PSA.setSource(null);
    
  if ($(this).prop('checked') === true) {
    map.on('click', handleInfo);
  } else {
    map.un('click', handleInfo);
  }
});

(function() {
  var marker = new ol.Feature();
  var iconStyle = new ol.style.Style({
    image: new ol.style.Icon( /** @type {olx.style.IconOptions} */ ({
      anchor: [0.5, 1],
      anchorXUnits: 'fraction',
      anchorYUnits: 'fraction',
      opacity: 1,
      scale: 1,
      src: '../images/map-icons/pins/24/pin1.png',
      snapToPixel: false
    })),
    zIndex: 100
  });
  marker.setStyle(iconStyle);
  var featuresOverlayStyle = new ol.style.Style({
    stroke: new ol.style.Stroke({
      color: '#408080',
      width: 5,
      lineDash: [4, 4]
    })
  });
  var featuresOverlay = new ol.layer.Vector({
    map: map,
    source: new ol.source.Vector(),
    style: featuresOverlayStyle,
    id: 'route',
    nameEl: 'Διαδρομή',
    NameEn: 'Route'
  });
  var routeCoords = [];

  function handleMarker(event) {
    event.preventDefault();
    var featureCount = featuresOverlay.getSource().getFeatures().length;
    var coordinates = event.coordinate;
    if (featureCount === 0) {
      marker.setGeometry(new ol.geom.Point(coordinates));
      marker.setId('first');
      featuresOverlay.getSource().addFeature(marker);
      routeCoords[0] = coordinates[0];
      routeCoords[1] = coordinates[1];
    } else if (featureCount === 1) {
      var clone = marker.clone();
      clone.setGeometry(new ol.geom.Point(coordinates));
      clone.setId('second');
      featuresOverlay.getSource().addFeature(clone);
      routeCoords[2] = coordinates[0];
      routeCoords[3] = coordinates[1];
      callRoute(routeCoords);
    } else {
      featuresOverlay.getSource().clear();
    }
  }

  geoJSONFormat = new ol.format.GeoJSON({
    defaultDataProjection: 'EPSG:4326',
    geometryName: 'geometry'
  });

  function callRoute(routeCoords) {
    var first = ol.proj.transform([routeCoords[0], routeCoords[1]], 'EPSG:3857', 'EPSG:4326');
    var second = ol.proj.transform([routeCoords[2], routeCoords[3]], 'EPSG:3857', 'EPSG:4326');
    var x1 = first[0];
    var y1 = first[1];
    var x2 = second[0];
    var y2 = second[1];
    $.ajax({
      url: 'https://api.mapbox.com/v4/directions/mapbox.driving/' + x1 + ',' + y1 + ';' + x2 + ',' + y2 + '.json?alternatives=false&access_token=pk.eyJ1IjoiZmlydmFpbiIsImEiOiJlOWYyYTM0NThiNWM0YjJjODJjNDE4ODQzNzA2MGQyNiJ9.-NVDO27Hzt-w_nQosUPfLA',
      type: 'GET',
      dataType: 'json'
    }).done(function(data) {
      var route={};
      route.type ="Feature";
      route.geometry = data.routes[0].geometry;
      featuresOverlay.getSource().addFeatures(geoJSONFormat.readFeatures(route, {
        dataProjection: 'EPSG:4326',
        featureProjection: 'EPSG:3857'
      }));
      map.getView().fit(featuresOverlay.getSource().getExtent(), map.getSize());
    }).fail(function() {
      console.log("error");
    }).always(function() {
      console.log("complete");
    });
  }
  $('.marker').on('change', function(event) {
    event.preventDefault();
    /* Act on the event */
    if ($(this).prop('checked') === true) {
      map.on('singleclick', handleMarker);
    } else {
      map.un('singleclick', handleMarker);
      featuresOverlay.getSource().clear();
    }
  });
}());

(function() {
  $('.weather').change(function() {
    if ($(this).prop('checked') === true) {
        map.getOverlays().forEach(function(ovl) {
        if (ovl.get('name') === 'weather') {
          ($(ovl.getElement()).parent()).remove();
          $(ovl.getElement()).remove();
        }
      });
      var center = ol.proj.transform(map.getView().getCenter(), 'EPSG:3857', 'EPSG:4326');
      var lat = center[1];
      var lon = center[0];
      $.ajax({
        url: 'http://api.openweathermap.org/data/2.5/find?lat=' + lat + '&lon=' + lon + '&cnt=5&cluster=no&units=metric&type=accurate&APPID=f9cd9fa2c427c3b115e87e4862619c5c',
        type: 'GET',
        dataType: 'json',
      }).done(function(data) {
        function createWeatherOverlay(position, index) {
          var elem = document.createElement('div');
          elem.setAttribute('class', 'weather-popup default-primary-color mdl-shadow--6dp');
          elem.setAttribute('id', index);
          elem.setAttribute('data-name', 'weather');
          return new ol.Overlay({
            element: elem,
            position: position,
          });
        }
        var objs = data.list;
        var overlay, coordinates;
        $.each(objs, function(index, val) {
          coordinates = ol.proj.transform([val.coord.lon, val.coord.lat], 'EPSG:4326', 'EPSG:3857');
          overlay = createWeatherOverlay(coordinates, index);
          map.addOverlay(overlay);
          overlay.set('name', 'weather');
          weatherData = {
            'name': val.name,
            'temp': val.main.temp,
            'pressure': val.main.pressure,
            'humidity': val.main.humidity
          };
          dust.render('weatherPopup.dust', weatherData, function(err, out) {
            $("#" + index).html(out);
          });
        });
      }).fail(function() {
        // toastr.error("Δεν βρέθηκαν πληροφορίες για τις καιρικές συνθήκες!");
      });
    } else if ($(this).prop('checked') === false) {
      map.getOverlays().forEach(function(ovl) {
        if (ovl.get('name') === 'weather') {
          ($(ovl.getElement()).parent()).remove();
          $(ovl.getElement()).remove();
        }
      });
    }
  });
}());

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hcC5qcyIsImZpbHRlcnMuanMiLCJnZW9sb2NhdGlvbi5qcyIsImluZm8uanMiLCJyb3V0aW5nLmpzIiwid2VhdGhlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdlBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoic2NyaXB0cy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIgdmFyIGNlbnRlciA9IFszNjc3Mzg1LCA0MTIwOTQ5XSxcclxuICAgZXh0ZW50ID0gWzM1OTAwOTQsIDQxMDI4MzMsIDM4NTU0ODMsIDQyNjEyMTFdLFxyXG4gICBsYW5nID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmxhbmcsXHJcbiAgIHN0eWxlQ2FjaGUgPSB7fSxcclxuICAgZ2VvSlNPTkZvcm1hdCA9IG5ldyBvbC5mb3JtYXQuR2VvSlNPTih7XHJcbiAgICAgZGVmYXVsdERhdGFQcm9qZWN0aW9uOiAnRVBTRzo0MzI2J1xyXG4gICB9KTtcclxuIHZhciBiaW5nID0gbmV3IG9sLmxheWVyLlRpbGUoe1xyXG4gICB2aXNpYmxlOiB0cnVlLFxyXG4gICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuQmluZ01hcHMoe1xyXG4gICAgIGtleTogJ0FrMkdxOFZVZklDc1BwdWY3TFJBTlhtWHQyc0hXbVNMUGhvaG1WTEZ0RklFd1lqc181TUN5QWhBRndSU1ZwTGonLFxyXG4gICAgIGltYWdlcnlTZXQ6ICdBZXJpYWwnXHJcbiAgIH0pLFxyXG4gICBtYXhab29tOiAxOSxcclxuICAgY3Jvc3NPcmlnaW46ICdhbm9ueW1vdXMnLFxyXG4gICBwcmVsb2FkOiBJbmZpbml0eSxcclxuICAgaWQ6ICdiaW5nJ1xyXG4gfSk7XHJcbiB2YXIgbWFwYm94ID0gbmV3IG9sLmxheWVyLlRpbGUoe1xyXG4gICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuWFlaKHtcclxuICAgICBhdHRyaWJ1dGlvbnM6IFtuZXcgb2wuQXR0cmlidXRpb24oe1xyXG4gICAgICAgaHRtbDogJzxhIGhyZWY9XFxcImh0dHBzOi8vd3d3Lm1hcGJveC5jb20vYWJvdXQvbWFwcy9cXFwiIHRhcmdldD1cXFwiX2JsYW5rXFxcIj4mY29weTsgTWFwYm94ICZjb3B5OyBPcGVuU3RyZWV0TWFwPC9hPidcclxuICAgICB9KV0sXHJcbiAgICAgdXJsOiAnaHR0cHM6Ly9hcGkubWFwYm94LmNvbS92NC9tYXBib3guc3RyZWV0cy97en0ve3h9L3t5fS5wbmc/YWNjZXNzX3Rva2VuPXBrLmV5SjFJam9pWm1seWRtRnBiaUlzSW1FaU9pSmxPV1l5WVRNME5UaGlOV00wWWpKak9ESmpOREU0T0RRek56QTJNR1F5TmlKOS4tTlZETzI3SHp0LXdfblFvc1VQZkxBJ1xyXG4gICB9KSxcclxuICAgaWQ6ICdtYXBib3gnXHJcbiB9KTtcclxuXHJcbiBmdW5jdGlvbiBjcmVhdGVQcm9wZXJ0eVN0eWxlKGZlYXR1cmUpIHtcclxuICAgdmFyIHNyYztcclxuICAgaWYgKGZlYXR1cmUuZ2V0KCd0eXBlX2VuJykgPT09ICdTYWxlJykge1xyXG4gICAgIHNyYyA9ICcuLi9pbWFnZXMvbWFwLWljb25zL3BpbnMvNDgvcGluMi5wbmcnO1xyXG4gICB9IGVsc2Uge1xyXG4gICAgIHNyYyA9ICcuLi9pbWFnZXMvbWFwLWljb25zL3BpbnMvNDgvcGluNS5wbmcnO1xyXG4gICB9XHJcbiAgIHJldHVybiBuZXcgb2wuc3R5bGUuU3R5bGUoe1xyXG4gICAgIGdlb21ldHJ5OiBmZWF0dXJlLmdldEdlb21ldHJ5KCksXHJcbiAgICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5JY29uKCh7XHJcbiAgICAgICBzcmM6IHNyYyxcclxuICAgICAgIGFuY2hvck9yaWdpbjogJ2JvdHRvbS1sZWZ0JyxcclxuICAgICAgIGFuY2hvcjogWzAsIDBdLFxyXG4gICAgICAgc2NhbGU6IDAuNyxcclxuICAgICB9KSlcclxuICAgfSk7XHJcbiB9XHJcblxyXG4gZnVuY3Rpb24gcHJvcGVydHlTdHlsZUZ1bmN0aW9uKGZlYXR1cmUsIHJlc29sdXRpb24pIHtcclxuICAgdmFyIHNpemUgPSBmZWF0dXJlLmdldCgnZmVhdHVyZXMnKS5sZW5ndGg7XHJcbiAgIGlmIChzaXplID4gMSkge1xyXG4gICAgIHN0eWxlID0gW25ldyBvbC5zdHlsZS5TdHlsZSh7XHJcbiAgICAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkNpcmNsZSh7XHJcbiAgICAgICAgIHJhZGl1czogMjAsXHJcbiAgICAgICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XHJcbiAgICAgICAgICAgY29sb3I6IFsxNTYsIDM5LCAxNzYsIDFdLFxyXG4gICAgICAgICAgIHdpZHRoOiA1XHJcbiAgICAgICAgIH0pLFxyXG4gICAgICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XHJcbiAgICAgICAgICAgY29sb3I6IFs2OCwgMTM4LCAyNTUsIDAuOF1cclxuICAgICAgICAgfSlcclxuICAgICAgIH0pLFxyXG4gICAgICAgdGV4dDogbmV3IG9sLnN0eWxlLlRleHQoe1xyXG4gICAgICAgICB0ZXh0OiBzaXplLnRvU3RyaW5nKCksXHJcbiAgICAgICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcclxuICAgICAgICAgICBjb2xvcjogJyNGRkZGRkYnXHJcbiAgICAgICAgIH0pXHJcbiAgICAgICB9KSxcclxuICAgICAgIHpJbmRleDogMTAxXHJcbiAgICAgfSldO1xyXG4gICB9IGVsc2Uge1xyXG4gICAgIHZhciBvcmlnaW5hbEZlYXR1cmUgPSBmZWF0dXJlLmdldCgnZmVhdHVyZXMnKVswXTtcclxuICAgICBzdHlsZSA9IFtjcmVhdGVQcm9wZXJ0eVN0eWxlKG9yaWdpbmFsRmVhdHVyZSldO1xyXG4gICB9XHJcbiAgIHJldHVybiBzdHlsZTtcclxuIH1cclxuXHJcbiBmdW5jdGlvbiBzZWxlY3RTdHlsZUZ1bmN0aW9uKGZlYXR1cmUsIHJlc29sdXRpb24pIHtcclxuICAgdmFyIHN0eWxlcyA9IFtuZXcgb2wuc3R5bGUuU3R5bGUoe30pXTtcclxuICAgdmFyIG9yaWdpbmFsRmVhdHVyZXMgPSBmZWF0dXJlLmdldCgnZmVhdHVyZXMnKTtcclxuICAgdmFyIG9yaWdpbmFGZWF0dXJlO1xyXG4gICBmb3IgKHZhciBpID0gb3JpZ2luYWxGZWF0dXJlcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xyXG4gICAgIG9yaWdpbmFsRmVhdHVyZSA9IG9yaWdpbmFsRmVhdHVyZXNbaV07XHJcbiAgICAgc3R5bGVzLnB1c2goY3JlYXRlUHJvcGVydHlTdHlsZShvcmlnaW5hbEZlYXR1cmUpKTtcclxuICAgfVxyXG4gICByZXR1cm4gc3R5bGVzO1xyXG4gfVxyXG4gdmFyIHByb3BlcnR5U291cmNlID0gbmV3IG9sLnNvdXJjZS5WZWN0b3Ioe1xyXG4gICBmb3JtYXQ6IGdlb0pTT05Gb3JtYXQsXHJcbiAgIGxvYWRlcjogZnVuY3Rpb24oZXh0ZW50LCByZXNvbHV0aW9uLCBwcm9qZWN0aW9uKSB7XHJcbiAgICBjb25zb2xlLmxvZyhyZXNvbHV0aW9uKTtcclxuICAgICB2YXIgZXBzZzQzMjZFeHRlbnQgPSBvbC5wcm9qLnRyYW5zZm9ybUV4dGVudChleHRlbnQsICdFUFNHOjM4NTcnLCAnRVBTRzo0MzI2Jyk7XHJcbiAgICAgdmFyIHVybCA9ICdodHRwOi8vbG9jYWxob3N0OjMwMDAvZGIvcHJvcGVydHk/YmJveFt4MV09JyArIGVwc2c0MzI2RXh0ZW50WzBdICsgJyZiYm94W3kxXT0nICsgZXBzZzQzMjZFeHRlbnRbMV0gKyAnJmJib3hbeDJdPScgKyBlcHNnNDMyNkV4dGVudFsyXSArICcmYmJveFt5Ml09JyArIGVwc2c0MzI2RXh0ZW50WzNdO1xyXG4gICAgIHZhciB0aGF0ID0gdGhpcztcclxuICAgICB0aGlzLmNsZWFyKCk7XHJcbiAgICAgY29uc29sZS5sb2coZXh0ZW50KTtcclxuICAgICAkLmFqYXgoe1xyXG4gICAgICAgdXJsOiB1cmwsXHJcbiAgICAgICB0eXBlOiAnR0VUJyxcclxuICAgICAgIGRhdGFUeXBlOiAnanNvbicsXHJcbiAgICAgfSkuZG9uZShmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgdmFyIGZlYXR1cmVzID0gZ2VvSlNPTkZvcm1hdC5yZWFkRmVhdHVyZXMocmVzcG9uc2UsIHtcclxuICAgICAgICAgZmVhdHVyZVByb2plY3Rpb246ICdFUFNHOjM4NTcnXHJcbiAgICAgICB9KTtcclxuXHJcbiAgICAgICB0aGF0LmFkZEZlYXR1cmVzKGZlYXR1cmVzKTtcclxuICAgICB9KS5mYWlsKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgY29uc29sZS5sb2coXCJlcnJvclwiKTtcclxuICAgICB9KTtcclxuICAgfSxcclxuICAgc3RyYXRlZ3k6IG9sLmxvYWRpbmdzdHJhdGVneS5iYm94XHJcbiB9KTtcclxuIHZhciBwcm9wZXJ0eUNsdXN0ZXJTb3VyY2UgPSBuZXcgb2wuc291cmNlLkNsdXN0ZXIoe1xyXG4gICBkaXN0YW5jZTogNDAsXHJcbiAgIHNvdXJjZTogcHJvcGVydHlTb3VyY2UsXHJcbiAgIGF0dHJpYnV0aW9uczogW25ldyBvbC5BdHRyaWJ1dGlvbih7XHJcbiAgICAgaHRtbDogJ0FsbCBtYXBzIMKpICcgKyAnPGEgaHJlZj1cImh0dHA6Ly93d3cudGVycmFjb2duaXRhLmdyL1wiPlRlcnJhIENvZ25pdGE8L2E+J1xyXG4gICB9KV1cclxuIH0pO1xyXG4gdmFyIHByb3BlcnR5ID0gbmV3IG9sLmxheWVyLlZlY3Rvcih7XHJcbiAgIHNvdXJjZTogcHJvcGVydHlDbHVzdGVyU291cmNlLFxyXG4gICBpZDogJ2VzdGF0ZXMnLFxyXG4gICB2aXNpYmxlOiB0cnVlLFxyXG4gICBzdHlsZTogcHJvcGVydHlTdHlsZUZ1bmN0aW9uXHJcbiB9KTtcclxuIHByb3BlcnR5LnNldFpJbmRleCgyKTtcclxuIHZhciBQU0FTdHlsZUZ1bmN0aW9uID0gZnVuY3Rpb24oZmVhdHVyZSwgcmVzb2x1dGlvbikge1xyXG4gICB2YXIgc3ltYm9sID0gZmVhdHVyZS5nZXQoJ3N0eWxlJyk7XHJcbiAgIHZhciB0ZXh0O1xyXG4gICBpZiAobGFuZyA9PT0gJ2VsJykge1xyXG4gICAgIHRleHQgPSBmZWF0dXJlLmdldCgnbmFtZV9lbCcpO1xyXG4gICB9IGVsc2Uge1xyXG4gICAgIHRleHQgPSBmZWF0dXJlLmdldCgnbmFtZV9lbicpO1xyXG4gICB9XHJcbiAgIGlmICghc3R5bGVDYWNoZVtzeW1ib2xdKSB7XHJcbiAgICAgc3R5bGVDYWNoZSA9IFtuZXcgb2wuc3R5bGUuU3R5bGUoe1xyXG4gICAgICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5JY29uKCh7XHJcbiAgICAgICAgIHNyYzogJy4uL2ltYWdlcy9tYWtpL3JlbmRlcnMvJyArIHN5bWJvbCArICctMjQucG5nJyxcclxuICAgICAgICAgYW5jaG9yT3JpZ2luOiAnYm90dG9tLWxlZnQnLFxyXG4gICAgICAgICBhbmNob3I6IFswLjUsIDAuNV0sXHJcbiAgICAgICAgIHNjYWxlOiAxLFxyXG4gICAgICAgfSkpLFxyXG4gICAgICAgdGV4dDogbmV3IG9sLnN0eWxlLlRleHQoe1xyXG4gICAgICAgICB0ZXh0OiB0ZXh0LFxyXG4gICAgICAgICBzdHJva2U6IG5ldyBvbC5zdHlsZS5TdHJva2Uoe1xyXG4gICAgICAgICAgIGNvbG9yOiBbMTU2LCAzOSwgMTc2LCAwLjhdLFxyXG4gICAgICAgICAgIHdpZHRoOiAxXHJcbiAgICAgICAgIH0pLFxyXG4gICAgICAgICBvZmZzZXRZOiAxMlxyXG4gICAgICAgfSlcclxuICAgICB9KV07XHJcbiAgIH1cclxuICAgcmV0dXJuIHN0eWxlQ2FjaGU7XHJcbiB9O1xyXG4gdmFyIFBTQSA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xyXG4gICBzdHlsZTogUFNBU3R5bGVGdW5jdGlvbixcclxuICAgbWF4UmVzb2x1dGlvbjogM1xyXG4gfSk7XHJcbiBQU0Euc2V0WkluZGV4KDEpO1xyXG5cclxuIGZ1bmN0aW9uIGZpbHRlcmVkRXNhdGVTdHlsZShmZWF0dXJlLCByZXNvbHV0aW9uKSB7XHJcbiAgIHN0eWxlQ2FjaGUgPSBbbmV3IG9sLnN0eWxlLlN0eWxlKHtcclxuICAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkljb24oKHtcclxuICAgICAgIHNyYzogJy4uL2ltYWdlcy9tYXAtaWNvbnMvcGlucy80OC9waW40LnBuZycsXHJcbiAgICAgICBhbmNob3JPcmlnaW46ICdib3R0b20tbGVmdCcsXHJcbiAgICAgICBhbmNob3I6IFswLjUsIDAuNV0sXHJcbiAgICAgICBzY2FsZTogMC43LFxyXG4gICAgIH0pKVxyXG4gICB9KV07XHJcbiAgIHJldHVybiBzdHlsZUNhY2hlO1xyXG4gfVxyXG4gdmFyIGZpbHRlcmVkRXN0YXRlcyA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xyXG4gICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuVmVjdG9yKHtcclxuICAgICBmb3JtYXQ6IGdlb0pTT05Gb3JtYXRcclxuICAgfSksXHJcbiAgIGlkOiAnZmlsdGVyZWRFc3RhdGVzJyxcclxuICAgdmlzaWJsZTogdHJ1ZSxcclxuICAgc3R5bGU6IGZpbHRlcmVkRXNhdGVTdHlsZVxyXG4gfSk7XHJcbiBmaWx0ZXJlZEVzdGF0ZXMuc2V0WkluZGV4KDIpO1xyXG4gdmFyIHNlbGVjdFNvdXJjZSA9IG5ldyBvbC5zb3VyY2UuVmVjdG9yKHt9KTtcclxuXHJcbnZhciBzZWxlY3RCb3ggPSBuZXcgb2wubGF5ZXIuVmVjdG9yKHtcclxuICBzb3VyY2U6IHNlbGVjdFNvdXJjZSxcclxuICBzdHlsZTogbmV3IG9sLnN0eWxlLlN0eWxlKHtcclxuICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcclxuICAgICAgY29sb3I6ICdyZ2JhKDIyNywgNzIsIDI3LCAwLjIpJ1xyXG4gICAgfSksXHJcbiAgICBzdHJva2U6IG5ldyBvbC5zdHlsZS5TdHJva2Uoe1xyXG4gICAgICBjb2xvcjogJyNFMzQ4MUInLFxyXG4gICAgICB3aWR0aDogMlxyXG4gICAgfSksXHJcbiAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkNpcmNsZSh7XHJcbiAgICAgIHJhZGl1czogNyxcclxuICAgICAgZmlsbDogbmV3IG9sLnN0eWxlLkZpbGwoe1xyXG4gICAgICAgIGNvbG9yOiAnI0UzNDgxQidcclxuICAgICAgfSlcclxuICAgIH0pXHJcbiAgfSlcclxufSk7XHJcbnNlbGVjdEJveC5zZXRaSW5kZXgoMyk7XHJcbiB2YXIgbWFwID0gbmV3IG9sLk1hcCh7XHJcbiAgIHRhcmdldDogJ21hcCcsXHJcbiAgIGxheWVyczogW21hcGJveCwgcHJvcGVydHksIFBTQSwgZmlsdGVyZWRFc3RhdGVzLHNlbGVjdEJveF0sXHJcbiAgIC8vIGludGVyYWN0aW9uczogb2wuaW50ZXJhY3Rpb24uZGVmYXVsdHMoKS5leHRlbmQoW25ldyBvbC5pbnRlcmFjdGlvbi5TZWxlY3Qoe1xyXG4gICAvLyAgIGNvbmRpdGlvbjogZnVuY3Rpb24oZXZ0KSB7XHJcbiAgIC8vICAgICByZXR1cm4gZXZ0LnR5cGUgPT09ICdzaW5nbGVjbGljaycgJiYgb2wuZXZlbnRzLmNvbmRpdGlvbi5zaGlmdEtleU9ubHkoZXZ0KTtcclxuICAgLy8gICB9LFxyXG4gICAvLyAgIHN0eWxlOiBzZWxlY3RTdHlsZUZ1bmN0aW9uXHJcbiAgIC8vIH0pXSksXHJcbiAgIGxvYWRUaWxlc1doaWxlQW5pbWF0aW5nOiB0cnVlLFxyXG4gICBsb2FkVGlsZXNXaGlsZUludGVyYWN0aW5nOiB0cnVlLFxyXG4gICByZW5kZXJlcjogJ2NhbnZhcycsXHJcbiAgIGNvbnRyb2xzOiBvbC5jb250cm9sLmRlZmF1bHRzKHtcclxuICAgICBhdHRyaWJ1dGlvbk9wdGlvbnM6IHtcclxuICAgICAgIGNvbGxhcHNpYmxlOiBmYWxzZSxcclxuICAgICAgIGNvbGxhcHNlZDogZmFsc2VcclxuICAgICB9XHJcbiAgIH0pLmV4dGVuZChbXHJcbiAgICAgbmV3IG9sLmNvbnRyb2wuU2NhbGVMaW5lKHtcclxuICAgICAgIHVuaXRzOiAnbWV0cmljJ1xyXG4gICAgIH0pLCBuZXcgb2wuY29udHJvbC5PdmVydmlld01hcCh7XHJcbiAgICAgICBjbGFzc05hbWU6ICdvbC1vdmVydmlld21hcCBvbC1jdXN0b20tb3ZlcnZpZXdtYXAnLFxyXG4gICAgICAgY29sbGFwc2libGU6IHRydWUsXHJcbiAgICAgICBjb2xsYXBzZWQ6IHRydWUsXHJcbiAgICAgICBsYXllcnM6IFtiaW5nXVxyXG4gICAgIH0pLFxyXG4gICAgIG5ldyBvbC5jb250cm9sLlpvb21Ub0V4dGVudCh7XHJcbiAgICAgICBleHRlbnQ6IGV4dGVudFxyXG4gICAgIH0pXHJcbiAgIF0pLFxyXG4gICB2aWV3OiBuZXcgb2wuVmlldyh7XHJcbiAgICAgY2VudGVyOiBjZW50ZXIsXHJcbiAgICAgLy8gZXh0ZW50OiBleHRlbnQsXHJcbiAgICAgcHJvamVjdGlvbjogJ0VQU0c6Mzg1NycsXHJcbiAgICAgem9vbTogMTQsXHJcbiAgICAgbWF4Wm9vbTogMTksXHJcbiAgICAgbWluWm9vbTogMTBcclxuICAgfSksXHJcbiB9KTtcclxuIGlmIChsYW5nID09PSAnZWwnKSB7XHJcbiAgIGJpbmcuc2V0KCduYW1lJywgJ86Uzr/Pgc+Fz4bOv8+BzrnOus6uIM61zrnOus+Mzr3OsScpO1xyXG4gICBtYXBib3guc2V0KCduYW1lJywgJ86nzqzPgc+EzrfPgicpO1xyXG4gICBwcm9wZXJ0eS5zZXQoJ25hbWUnLCAnzpHOus6vzr3Ot8+EzrEnKTtcclxuIH0gZWxzZSB7XHJcbiAgIGJpbmcuc2V0KCduYW1lJywgJ1NhdHRlbGl0ZSBJbWFnZScpO1xyXG4gICBtYXBib3guc2V0KCduYW1lJywgJ01hcCcpO1xyXG4gICBwcm9wZXJ0eS5zZXQoJ25hbWUnLCAnUHJvcGVydGllcycpO1xyXG4gfVxyXG4iLCIgZnVuY3Rpb24gc2VsZWN0QnlGaWx0ZXJzKCkge1xyXG4gICBQU0Euc2V0U291cmNlKG51bGwpO1xyXG4gICB2YXIgcGFyYW1zID0ge307XHJcbiAgIHZhciBlcHNnNDMyNkV4dGVudDtcclxuICAgcGFyYW1zLmxlYXNlVHlwZSA9ICQoXCJpbnB1dFtuYW1lPW9wdGlvbnNdOmNoZWNrZWRcIikudmFsKCk7XHJcbiAgIHBhcmFtcy5zdGFydFByaWNlID0gJCgnI3N0YXJ0UHJpY2UnKS52YWwoKTtcclxuICAgcGFyYW1zLmVuZFByaWNlID0gJCgnI2VuZFByaWNlJykudmFsKCk7XHJcbiAgIHBhcmFtcy5wYXJraW5nID0gJCgnI2NoZWNrYm94LTEnKS5wcm9wKCdjaGVja2VkJyk7XHJcbiAgIHBhcmFtcy5mdXJuaXNoZWQgPSAkKCcjY2hlY2tib3gtMicpLnByb3AoJ2NoZWNrZWQnKTtcclxuICAgcGFyYW1zLmhlYXRpbmcgPSAkKCcjY2hlY2tib3gtMycpLnByb3AoJ2NoZWNrZWQnKTtcclxuICAgcGFyYW1zLmNvb2xpbmcgPSAkKCcjY2hlY2tib3gtNCcpLnByb3AoJ2NoZWNrZWQnKTtcclxuICAgcGFyYW1zLnZpZXcgPSAkKCcjY2hlY2tib3gtNScpLnByb3AoJ2NoZWNrZWQnKTtcclxuICAgaWYgKHNlbGVjdFNvdXJjZS5nZXRGZWF0dXJlcygpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgIGVwc2c0MzI2RXh0ZW50ID0gb2wucHJvai50cmFuc2Zvcm1FeHRlbnQoZXh0ZW50LCAnRVBTRzozODU3JywgJ0VQU0c6NDMyNicpO1xyXG4gICB9IGVsc2Uge1xyXG4gICAgIGVwc2c0MzI2RXh0ZW50ID0gb2wucHJvai50cmFuc2Zvcm1FeHRlbnQoc2VsZWN0U291cmNlLmdldEZlYXR1cmVzKClbMF0uZ2V0R2VvbWV0cnkoKS5nZXRFeHRlbnQoKSwgJ0VQU0c6Mzg1NycsICdFUFNHOjQzMjYnKTtcclxuICAgfVxyXG4gICB0b2FzdHIub3B0aW9ucyA9IHtcclxuICAgICBcImNsb3NlQnV0dG9uXCI6IGZhbHNlLFxyXG4gICAgIFwiZGVidWdcIjogZmFsc2UsXHJcbiAgICAgXCJuZXdlc3RPblRvcFwiOiBmYWxzZSxcclxuICAgICBcInByb2dyZXNzQmFyXCI6IGZhbHNlLFxyXG4gICAgIFwicG9zaXRpb25DbGFzc1wiOiBcInRvYXN0LXRvcC1jZW50ZXJcIixcclxuICAgICBcInByZXZlbnREdXBsaWNhdGVzXCI6IGZhbHNlLFxyXG4gICAgIFwib25jbGlja1wiOiBudWxsLFxyXG4gICAgIFwic2hvd0R1cmF0aW9uXCI6IFwiMzAwXCIsXHJcbiAgICAgXCJoaWRlRHVyYXRpb25cIjogXCIxMDAwXCIsXHJcbiAgICAgXCJ0aW1lT3V0XCI6IFwiNTAwMFwiLFxyXG4gICAgIFwiZXh0ZW5kZWRUaW1lT3V0XCI6IFwiMTAwMFwiLFxyXG4gICAgIFwic2hvd0Vhc2luZ1wiOiBcInN3aW5nXCIsXHJcbiAgICAgXCJoaWRlRWFzaW5nXCI6IFwibGluZWFyXCIsXHJcbiAgICAgXCJzaG93TWV0aG9kXCI6IFwiZmFkZUluXCIsXHJcbiAgICAgXCJoaWRlTWV0aG9kXCI6IFwiZmFkZU91dFwiXHJcbiAgIH07XHJcbiAgICQuYWpheCh7XHJcbiAgICAgdXJsOiAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2RiL2ZpbHRlcmVkcHJvcGVydHk/YmJveFt4MV09JyArIGVwc2c0MzI2RXh0ZW50WzBdICsgJyZiYm94W3kxXT0nICsgZXBzZzQzMjZFeHRlbnRbMV0gKyAnJmJib3hbeDJdPScgKyBlcHNnNDMyNkV4dGVudFsyXSArICcmYmJveFt5Ml09JyArIGVwc2c0MzI2RXh0ZW50WzNdLFxyXG4gICAgIHR5cGU6ICdHRVQnLFxyXG4gICAgIGRhdGFUeXBlOiAnanNvbicsXHJcbiAgICAgZGF0YToge1xyXG4gICAgICAgbGVhc2VUeXBlOiBwYXJhbXMubGVhc2VUeXBlLFxyXG4gICAgICAgZnVybmlzaGVkOiBwYXJhbXMuZnVybmlzaGVkLFxyXG4gICAgICAgaGVhdGluZzogcGFyYW1zLmhlYXRpbmcsXHJcbiAgICAgICBwYXJraW5nOiBwYXJhbXMucGFya2luZyxcclxuICAgICAgIGNvb2xpbmc6IHBhcmFtcy5jb29saW5nLFxyXG4gICAgICAgdmlldzogcGFyYW1zLnZpZXcsXHJcbiAgICAgICBzdGFydFByaWNlOiBwYXJhbXMuc3RhcnRQcmljZSxcclxuICAgICAgIGVuZFByaWNlOiBwYXJhbXMuZW5kUHJpY2VcclxuICAgICB9LFxyXG4gICB9KS5kb25lKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgdmFyIGZlYXR1cmVzID0gZ2VvSlNPTkZvcm1hdC5yZWFkRmVhdHVyZXMocmVzcG9uc2UsIHtcclxuICAgICAgIGZlYXR1cmVQcm9qZWN0aW9uOiAnRVBTRzozODU3J1xyXG4gICAgIH0pO1xyXG5cclxuICAgICBpZiAoZmVhdHVyZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgdG9hc3RyLmNsZWFyKCk7XHJcbiAgICAgICBmaWx0ZXJlZEVzdGF0ZXMuZ2V0U291cmNlKCkuY2xlYXIoKTtcclxuICAgICAgIGZpbHRlcmVkRXN0YXRlcy5nZXRTb3VyY2UoKS5hZGRGZWF0dXJlcyhmZWF0dXJlcyk7XHJcbiAgICAgICBmaWx0ZXJlZEVzdGF0ZXMuc2V0VmlzaWJsZSh0cnVlKTtcclxuICAgICAgIHByb3BlcnR5LnNldFZpc2libGUoZmFsc2UpO1xyXG4gICAgICAgdmFyIGV4dGVudCA9IGZpbHRlcmVkRXN0YXRlcy5nZXRTb3VyY2UoKS5nZXRFeHRlbnQoKTtcclxuICAgICAgIHZhciBjZW50ZXIgPSBbXTtcclxuICAgICB9IGVsc2Uge1xyXG4gICAgICAgdG9hc3RyLmVycm9yKFwiTm8gSW5mbyBGb3VuZCFcIik7XHJcbiAgICAgICBmaWx0ZXJlZEVzdGF0ZXMuc2V0VmlzaWJsZShmYWxzZSk7XHJcbiAgICAgICBwcm9wZXJ0eS5zZXRWaXNpYmxlKHRydWUpO1xyXG4gICAgIH1cclxuICAgfSk7XHJcbiB9XHJcbiAkKFwiI2NsZWFyRmlsdGVyc1wiKS5jbGljayhmdW5jdGlvbigpIHtcclxuICAgJChcImlucHV0W25hbWU9b3B0aW9uc11cIikucHJvcCgnY2hlY2tlZCcsIGZhbHNlKTtcclxuICAgJCgnbGFiZWxbZm9yPW9wdGlvbi0xXScpLnJlbW92ZUNsYXNzKCdpcy1jaGVja2VkJyk7XHJcbiAgICQoJ2xhYmVsW2Zvcj1vcHRpb24tMl0nKS5yZW1vdmVDbGFzcygnaXMtY2hlY2tlZCcpO1xyXG4gICAkKCdsYWJlbFtmb3I9Y2hlY2tib3gtMV0nKS5yZW1vdmVDbGFzcygnaXMtY2hlY2tlZCcpO1xyXG4gICAkKCdsYWJlbFtmb3I9Y2hlY2tib3gtMl0nKS5yZW1vdmVDbGFzcygnaXMtY2hlY2tlZCcpO1xyXG4gICAkKCdsYWJlbFtmb3I9Y2hlY2tib3gtM10nKS5yZW1vdmVDbGFzcygnaXMtY2hlY2tlZCcpO1xyXG4gICAkKCdsYWJlbFtmb3I9Y2hlY2tib3gtNF0nKS5yZW1vdmVDbGFzcygnaXMtY2hlY2tlZCcpO1xyXG4gICAkKCdsYWJlbFtmb3I9Y2hlY2tib3gtNV0nKS5yZW1vdmVDbGFzcygnaXMtY2hlY2tlZCcpO1xyXG4gICAkKCdsYWJlbFtmb3I9Y2hlY2tib3gtNl0nKS5yZW1vdmVDbGFzcygnaXMtY2hlY2tlZCcpO1xyXG4gICBmaWx0ZXJlZEVzdGF0ZXMuZ2V0U291cmNlKCkuY2xlYXIoKTtcclxuICAgcHJvcGVydHkuc2V0VmlzaWJsZSh0cnVlKTtcclxuICAgUFNBLnNldFNvdXJjZShudWxsKTtcclxuICAgc2VsZWN0U291cmNlLmNsZWFyKCk7XHJcbiAgIG1hcC5yZW1vdmVJbnRlcmFjdGlvbihkcmF3KTtcclxuIH0pO1xyXG4gdmFyIGRyYXc7XHJcblxyXG4gZnVuY3Rpb24gYWRkSW50ZXJhY3Rpb24oKSB7XHJcbiAgIHNlbGVjdFNvdXJjZS5jbGVhcigpO1xyXG4gICBkcmF3ID0gbmV3IG9sLmludGVyYWN0aW9uLkRyYXcoe1xyXG4gICAgIHNvdXJjZTogc2VsZWN0U291cmNlLFxyXG4gICAgIHR5cGU6ICdMaW5lU3RyaW5nJyxcclxuICAgICBnZW9tZXRyeUZ1bmN0aW9uOiBnZW9tZXRyeUZ1bmN0aW9uLFxyXG4gICAgIG1heFBvaW50czogMlxyXG4gICB9KTtcclxuICAgZHJhdy5vbignZHJhd3N0YXJ0JywgZnVuY3Rpb24oKSB7XHJcbiAgICAgc2VsZWN0U291cmNlLmNsZWFyKCk7XHJcbiAgIH0pO1xyXG4gICBtYXAuYWRkSW50ZXJhY3Rpb24oZHJhdyk7XHJcbiB9XHJcblxyXG4gZnVuY3Rpb24gZ2VvbWV0cnlGdW5jdGlvbihjb29yZGluYXRlcywgZ2VvbWV0cnkpIHtcclxuICAgaWYgKCFnZW9tZXRyeSkge1xyXG4gICAgIGdlb21ldHJ5ID0gbmV3IG9sLmdlb20uUG9seWdvbihudWxsKTtcclxuICAgfVxyXG4gICB2YXIgc3RhcnQgPSBjb29yZGluYXRlc1swXTtcclxuICAgdmFyIGVuZCA9IGNvb3JkaW5hdGVzWzFdO1xyXG4gICBnZW9tZXRyeS5zZXRDb29yZGluYXRlcyhbXHJcbiAgICAgW3N0YXJ0LCBbc3RhcnRbMF0sIGVuZFsxXV0sIGVuZCwgW2VuZFswXSwgc3RhcnRbMV1dLCBzdGFydF1cclxuICAgXSk7XHJcbiAgIHJldHVybiBnZW9tZXRyeTtcclxuIH1cclxuICQoXCIjY2hlY2tib3gtNlwiKS5jaGFuZ2UoZnVuY3Rpb24oKSB7XHJcbiAgIGlmICh0aGlzLmNoZWNrZWQpIHtcclxuICAgICBhZGRJbnRlcmFjdGlvbigpO1xyXG4gICB9IGVsc2Uge1xyXG4gICAgIG1hcC5yZW1vdmVJbnRlcmFjdGlvbihkcmF3KTtcclxuICAgICBzZWxlY3RTb3VyY2UuY2xlYXIoKTtcclxuICAgfVxyXG4gfSk7XHJcbiIsIihmdW5jdGlvbigpIHtcclxuICB2YXIgZ2VvbG9jYXRpb24gPSBuZXcgb2wuR2VvbG9jYXRpb24oe1xyXG4gICAgLy8gdGFrZSB0aGUgcHJvamVjdGlvbiB0byB1c2UgZnJvbSB0aGUgbWFwJ3Mgdmlld1xyXG4gICAgcHJvamVjdGlvbjogbWFwLmdldFZpZXcoKS5nZXRQcm9qZWN0aW9uKCksXHJcbiAgICB0cmFja2luZ09wdGlvbnM6IHtcclxuICAgICAgbWF4aW11bUFnZTogMTAwMDAsXHJcbiAgICAgIGVuYWJsZUhpZ2hBY2N1cmFjeTogdHJ1ZSxcclxuICAgICAgdGltZW91dDogNjAwMDAwXHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgdmFyIGFjY3VyYWN5RmVhdHVyZSA9IG5ldyBvbC5GZWF0dXJlKCk7XHJcbiAgZ2VvbG9jYXRpb24ub24oJ2NoYW5nZTphY2N1cmFjeUdlb21ldHJ5JywgZnVuY3Rpb24oKSB7XHJcbiAgICBhY2N1cmFjeUZlYXR1cmUuc2V0R2VvbWV0cnkoZ2VvbG9jYXRpb24uZ2V0QWNjdXJhY3lHZW9tZXRyeSgpKTtcclxuICB9KTtcclxuICB2YXIgcG9zaXRpb25GZWF0dXJlID0gbmV3IG9sLkZlYXR1cmUoKTtcclxuICBwb3NpdGlvbkZlYXR1cmUuc2V0U3R5bGUobmV3IG9sLnN0eWxlLlN0eWxlKHtcclxuICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuQ2lyY2xlKHtcclxuICAgICAgcmFkaXVzOiA2LFxyXG4gICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XHJcbiAgICAgICAgY29sb3I6ICcjMzM5OUNDJ1xyXG4gICAgICB9KSxcclxuICAgICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcclxuICAgICAgICBjb2xvcjogJyNmZmYnLFxyXG4gICAgICAgIHdpZHRoOiAyXHJcbiAgICAgIH0pXHJcbiAgICB9KVxyXG4gIH0pKTtcclxuICAvLyBsaXN0ZW4gdG8gY2hhbmdlcyBpbiBwb3NpdGlvblxyXG4gIGdlb2xvY2F0aW9uLm9uKCdjaGFuZ2U6cG9zaXRpb24nLCBmdW5jdGlvbigpIHtcclxuICAgIHZhciBjb29yZGluYXRlcyA9IGdlb2xvY2F0aW9uLmdldFBvc2l0aW9uKCk7XHJcbiAgICBwb3NpdGlvbkZlYXR1cmUuc2V0R2VvbWV0cnkoY29vcmRpbmF0ZXMgPyBuZXcgb2wuZ2VvbS5Qb2ludChjb29yZGluYXRlcykgOiBudWxsKTtcclxuICB9KTtcclxuICBmZWF0dXJlc092ZXJsYXlTb3VyY2UgPSBuZXcgb2wuc291cmNlLlZlY3Rvcih7fSk7XHJcbiAgdmFyIGZlYXR1cmVzT3ZlcmxheSA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xyXG4gICAgbWFwOiBtYXAsXHJcbiAgICBzb3VyY2U6IGZlYXR1cmVzT3ZlcmxheVNvdXJjZVxyXG4gIH0pO1xyXG4gICQoJy5nZW9sb2NhdGlvbicpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihlKSB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBpZiAoJCh0aGlzKS5wcm9wKCdjaGVja2VkJykgPT09IHRydWUpIHtcclxuICAgICAgZ2VvbG9jYXRpb24uc2V0VHJhY2tpbmcodHJ1ZSk7XHJcbiAgICAgIGZlYXR1cmVzT3ZlcmxheVNvdXJjZS5hZGRGZWF0dXJlcyhbcG9zaXRpb25GZWF0dXJlLGFjY3VyYWN5RmVhdHVyZV0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZ2VvbG9jYXRpb24uc2V0VHJhY2tpbmcoZmFsc2UpO1xyXG4gICAgICBmZWF0dXJlc092ZXJsYXlTb3VyY2UuY2xlYXIoKTtcclxuICAgIH1cclxuICB9KTtcclxufSgpKTtcclxuIiwiZnVuY3Rpb24gaGFuZGxlSW5mbyhldnQpIHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICBtYXAucmVtb3ZlSW50ZXJhY3Rpb24oZHJhdyk7XHJcbiAgdmFyIGNvb3JkaW5hdGUgPSBldnQuY29vcmRpbmF0ZTtcclxuICB2YXIgb2JqID0ge307XHJcbiAgdmFyIHRpdGxlID0ge307XHJcbiAgdmFyIG93bmVyID0ge307XHJcbiAgdmFyIGZlYXR1cmVzID0gW107XHJcbiAgb2JqLnRpdGxlID0gdGl0bGU7XHJcbiAgaWYgKGxhbmcgPT09ICdlbCcpIHtcclxuICAgIHRpdGxlLmVzdGF0ZUNvZGUgPSAnzprPic60zrnOus+Mz4IgzpnOtM65zr/Ous+EzrfPg86vzrHPgic7XHJcbiAgICB0aXRsZS50eXBlID0gJ86kz43PgM6/z4InO1xyXG4gICAgdGl0bGUuYXJlYSA9ICfOlc68zrLOsc60z4wnO1xyXG4gICAgdGl0bGUuYWRkcmVzcyA9ICfOlM65zrXPhc64z4XOvc+DzrcnO1xyXG4gICAgdGl0bGUuYmVkcm9vbXMgPSAnzqXPgM69zr/OtM+JzrzOrM+EzrnOsSc7XHJcbiAgICB0aXRsZS5wcmljZSA9ICfOpM65zrzOric7XHJcbiAgICB0aXRsZS5uZXcgPSAnzp3Otc+MzrTOvM63z4TOvyc7XHJcbiAgICB0aXRsZS5wYXJraW5nID0gJ86jz4TOrM64zrzOtc+DzrcnO1xyXG4gICAgdGl0bGUuZnVybmlzaGVkID0gJ86Vz4DOuc+AzrvPic68zq3Ovc6/JztcclxuICAgIHRpdGxlLnBldHMgPSAnzprOsc+Ezr/Ouc66zq/OtM65zrEnO1xyXG4gICAgdGl0bGUudmlldyA9ICfOmM6tzrEnO1xyXG4gICAgdGl0bGUuaGVhdGluZyA9ICfOmM6tz4HOvM6xzr3Pg863JztcclxuICAgIHRpdGxlLmNvb2xpbmcgPSAnzqjPjc6+zrcnO1xyXG4gICAgdGl0bGUuY29udGFjdEluZm8gPSAnzqPPhM6/zrnPh861zq/OsSDOlc+AzrnOus6/zrnOvc+Jzr3Or86xz4InO1xyXG4gICAgdGl0bGUubmFtZSA9ICfOjM69zr/OvM6xJztcclxuICAgIHRpdGxlLmxhc3RuYW1lID0gJ86Vz4DOr864zrXPhM6/JztcclxuICAgIHRpdGxlLnBob25lID0gJ86kzrfOu86tz4bPic69zr8nO1xyXG4gICAgdGl0bGUuZW1haWwgPSAnzpfOu861zrrPhM+Bzr/Ovc65zrrOriDOlM65zrXPjc64z4XOvc+DzrcnO1xyXG4gIH0gZWxzZSB7XHJcbiAgICB0aXRsZS5lc3RhdGVDb2RlID0gJ0VzdGF0ZSBDb2RlJztcclxuICAgIHRpdGxlLnR5cGUgPSAnVHlwZSc7XHJcbiAgICB0aXRsZS5hcmVhID0gJ1NpemUnO1xyXG4gICAgdGl0bGUuYWRkcmVzcyA9ICdBZGRyZXNzJztcclxuICAgIHRpdGxlLmJlZHJvb21zID0gJ0JlZHJvb21zJztcclxuICAgIHRpdGxlLnByaWNlID0gJ1ByaWNlJztcclxuICAgIHRpdGxlLm5ldyA9ICdOZXdseSBCdWlsZCc7XHJcbiAgICB0aXRsZS5wYXJraW5nID0gJ1BhcmtpbmcnO1xyXG4gICAgdGl0bGUuZnVybmlzaGVkID0gJ0Z1cm5pc2hlZCc7XHJcbiAgICB0aXRsZS5wZXRzID0gJ1BldHMgQWxsb3dlZCc7XHJcbiAgICB0aXRsZS52aWV3ID0gJ1ZpZXcnO1xyXG4gICAgdGl0bGUuaGVhdGluZyA9ICdIZWF0aW5nJztcclxuICAgIHRpdGxlLmNvb2xpbmcgPSAnQ29vbGluZyc7XHJcbiAgICB0aXRsZS5jb250YWN0SW5mbyA9ICdDb250YWN0IEluZm8nO1xyXG4gICAgdGl0bGUubmFtZSA9ICdOYW1lJztcclxuICAgIHRpdGxlLmxhc3RuYW1lID0gJ0xhc3QgTmFtZSc7XHJcbiAgICB0aXRsZS5waG9uZSA9ICdUZWxlcGhvbmUnO1xyXG4gICAgdGl0bGUuZW1haWwgPSAnRW1haWwnO1xyXG4gIH1cclxuICBjbGlja2VkRmVhdHVyZSA9IG1hcC5mb3JFYWNoRmVhdHVyZUF0UGl4ZWwoZXZ0LnBpeGVsLCBmdW5jdGlvbihmZWF0dXJlLCBsYXllcikge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgZmVhdHVyZTogZmVhdHVyZSxcclxuICAgICAgbGF5ZXI6IGxheWVyXHJcbiAgICB9O1xyXG4gIH0sIHRoaXMsIGZ1bmN0aW9uKGxheWVyKSB7XHJcbiAgICBpZiAobGF5ZXIuZ2V0KCdpZCcpID09PSAnZXN0YXRlcycgfHwgbGF5ZXIuZ2V0KCdpZCcpID09PSAnZmlsdGVyZWRFc3RhdGVzJykge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICB9LCB0aGlzKTtcclxuICB2YXIgZjtcclxuICBpZiAoY2xpY2tlZEZlYXR1cmUpIHtcclxuICAgIGlmIChjbGlja2VkRmVhdHVyZS5sYXllci5nZXQoJ2lkJykgPT09ICdlc3RhdGVzJyAmJiBjbGlja2VkRmVhdHVyZS5mZWF0dXJlLmdldCgnZmVhdHVyZXMnKS5sZW5ndGggPT09IDEpIHtcclxuICAgICAgZiA9IGNsaWNrZWRGZWF0dXJlLmZlYXR1cmUuZ2V0UHJvcGVydGllcygpLmZlYXR1cmVzWzBdO1xyXG4gICAgICBjcmVhdGVQU0FhbmRDYXJkKGYsIG9iaik7XHJcbiAgICB9IGVsc2UgaWYgKGNsaWNrZWRGZWF0dXJlLmxheWVyLmdldCgnaWQnKSA9PT0gJ2ZpbHRlcmVkRXN0YXRlcycpIHtcclxuICAgICAgZiA9IGNsaWNrZWRGZWF0dXJlLmZlYXR1cmU7XHJcbiAgICAgIGNyZWF0ZVBTQWFuZENhcmQoZiwgb2JqKTtcclxuICAgIH1cclxuICB9IGVsc2Uge1xyXG4gICAgUFNBLnNldFNvdXJjZShudWxsKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZVBTQWFuZENhcmQoZiwgb2JqKSB7XHJcbiAgdmFyIGZlYXR1cmUgPSB7fTtcclxuICBmZWF0dXJlLmdpZCA9IGYuZ2V0KCdnaWQnKTtcclxuICBmZWF0dXJlLnR5cGUgPSBmLmdldCgnZXN0YXRldHlwZScpO1xyXG4gIGZlYXR1cmUuYXJlYSA9IGYuZ2V0KCdlc3RhdGVhcmVhJyk7XHJcbiAgaWYgKGxhbmcgPT09ICdlbCcpIHtcclxuICAgIGZlYXR1cmUuYWRkcmVzcyA9IGYuZ2V0KCdzdHJlZXRfZWwnKSArICcgJyArIGYuZ2V0KCdoX251bV9lbCcpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBmZWF0dXJlLmFkZHJlc3MgPSBmLmdldCgnc3RyZWV0X2VuJykgKyAnICcgKyBmLmdldCgnaF9udW1fZW4nKTtcclxuICB9XHJcbiAgZmVhdHVyZS5iZWRyb29tcyA9IGYuZ2V0KCdiZWRyb29tcycpO1xyXG4gIGZlYXR1cmUucHJpY2UgPSBmLmdldCgncHJpY2UnKTtcclxuICBmZWF0dXJlLm5ldyA9IGYuZ2V0KCduZXcnKTtcclxuICBmZWF0dXJlLnBhcmtpbmcgPSBmLmdldCgncGFya2luZycpO1xyXG4gIGZlYXR1cmUuZnVybmlzaGVkID0gZi5nZXQoJ2Z1cm5pc2hlZCcpO1xyXG4gIGZlYXR1cmUucGV0cyA9IGYuZ2V0KCdwZXRzJyk7XHJcbiAgZmVhdHVyZS52aWV3ID0gZi5nZXQoJ3ZpZXcnKTtcclxuICBmZWF0dXJlLmhlYXRpbmcgPSBmLmdldCgnaGVhdGluZycpO1xyXG4gIGZlYXR1cmUuY29vbGluZyA9IGYuZ2V0KCdjb29saW5nJyk7XHJcbiAgaWYgKGxhbmcgPT09ICdlbCcpIHtcclxuICAgIGZlYXR1cmUubmFtZSA9IGYuZ2V0KCduYW1lX2VsJyk7XHJcbiAgICBmZWF0dXJlLmxhc3RuYW1lID0gZi5nZXQoJ2xhc3RuYW1lX2VsJyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGZlYXR1cmUubmFtZSA9IGYuZ2V0KCduYW1lX2VuJyk7XHJcbiAgICBmZWF0dXJlLmxhc3RuYW1lID0gZi5nZXQoJ2xhc3RuYW1lX2VuJyk7XHJcbiAgfVxyXG4gIGZlYXR1cmUucGhvbmUgPSBmLmdldCgncGhvbmUxJyk7XHJcbiAgZmVhdHVyZS5lbWFpbCA9IGYuZ2V0KCdlbWFpbCcpO1xyXG4gIGZlYXR1cmUuY29vcmRpbmF0ZSA9IGYuZ2V0KCdnZW9tZXRyeScpLmdldENvb3JkaW5hdGVzKCk7XHJcbiAgdmFyIFBTQVNvdXJjZSA9IG5ldyBvbC5zb3VyY2UuVmVjdG9yKHtcclxuICAgIGF0dHJpYnV0aW9uczogW25ldyBvbC5BdHRyaWJ1dGlvbih7XHJcbiAgICAgIGh0bWw6ICdQT0kgYnkgJyArICc8YSBocmVmPVwiaHR0cDovL3d3dy50ZXJyYWNvZ25pdGEuZ3IvXCI+VGVycmEgQ29nbml0YTwvYT4nXHJcbiAgICB9KV0sXHJcbiAgICBmb3JtYXQ6IGdlb0pTT05Gb3JtYXQsXHJcbiAgICBsb2FkZXI6IGZ1bmN0aW9uKGV4dGVudCwgcmVzb2x1dGlvbiwgcHJvamVjdGlvbikge1xyXG4gICAgICB2YXIgdXJsID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9kYi91c2VzLycgKyBmZWF0dXJlLmdpZDtcclxuICAgICAgdmFyIHRoYXQgPSB0aGlzO1xyXG4gICAgICAkLmFqYXgoe1xyXG4gICAgICAgIHVybDogdXJsLFxyXG4gICAgICAgIHR5cGU6ICdHRVQnLFxyXG4gICAgICAgIGRhdGFUeXBlOiAnanNvbicsXHJcbiAgICAgIH0pLmRvbmUoZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICB2YXIgZmVhdHVyZXMgPSBnZW9KU09ORm9ybWF0LnJlYWRGZWF0dXJlcyhyZXNwb25zZS5wcm9wZXJ0eV9zZXJ2aWNlc19hbmFseXNpcywge1xyXG4gICAgICAgICAgZmVhdHVyZVByb2plY3Rpb246ICdFUFNHOjM4NTcnXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdmFyIGFyZWEgPSBuZXcgb2wuc3R5bGUuU3R5bGUoe1xyXG4gICAgICAgICAgZmlsbDogbmV3IG9sLnN0eWxlLkZpbGwoe1xyXG4gICAgICAgICAgICBjb2xvcjogWzE1NiwgMzksIDE3NiwgMC4xXVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9KTtcclxuICAgICAgICBmZWF0dXJlc1swXS5zZXRTdHlsZShhcmVhKTtcclxuICAgICAgICB0aGF0LmFkZEZlYXR1cmVzKGZlYXR1cmVzKTtcclxuICAgICAgfSkuZmFpbChmdW5jdGlvbigpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yXCIpO1xyXG4gICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBzdHJhdGVneTogb2wubG9hZGluZ3N0cmF0ZWd5LmFsbFxyXG4gIH0pO1xyXG4gIFBTQS5zZXRTb3VyY2UoUFNBU291cmNlKTtcclxuICBtYXAuZ2V0VmlldygpLnNldENlbnRlcihmZWF0dXJlLmNvb3JkaW5hdGUpO1xyXG4gIG1hcC5nZXRWaWV3KCkuc2V0UmVzb2x1dGlvbigxLjIpO1xyXG4gIG9iai5mZWF0dXJlID0gZmVhdHVyZTtcclxuICBkdXN0LnJlbmRlcignZXN0YXRlQ2FyZHMuZHVzdCcsIG9iaiwgZnVuY3Rpb24oZXJyLCBvdXQpIHtcclxuICAgICQoJy5lc3RhdGUtY2FyZHMnKS5odG1sKG91dCk7XHJcbiAgICAkKCcuZXN0YXRlLWNhcmRzJykucmVtb3ZlQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7XHJcbiAgfSk7XHJcbiAgJCgnYVtocmVmPVwiI29wZW5Nb2RhbFwiXScpLmNsaWNrKGZ1bmN0aW9uKCkge1xyXG4gICAgZHVzdC5yZW5kZXIoJ21vZGFsSW5mby5kdXN0Jywgb2JqLCBmdW5jdGlvbihlcnIsIG91dCkge1xyXG4gICAgICAkKCcubW9kYWwtY29udGVudCcpLmh0bWwob3V0KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59XHJcbiQoJy5pbmZvJykub24oJ2NoYW5nZScsIGZ1bmN0aW9uKGUpIHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgUFNBLnNldFNvdXJjZShudWxsKTtcclxuICAgIFxyXG4gIGlmICgkKHRoaXMpLnByb3AoJ2NoZWNrZWQnKSA9PT0gdHJ1ZSkge1xyXG4gICAgbWFwLm9uKCdjbGljaycsIGhhbmRsZUluZm8pO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBtYXAudW4oJ2NsaWNrJywgaGFuZGxlSW5mbyk7XHJcbiAgfVxyXG59KTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gIHZhciBtYXJrZXIgPSBuZXcgb2wuRmVhdHVyZSgpO1xyXG4gIHZhciBpY29uU3R5bGUgPSBuZXcgb2wuc3R5bGUuU3R5bGUoe1xyXG4gICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5JY29uKCAvKiogQHR5cGUge29seC5zdHlsZS5JY29uT3B0aW9uc30gKi8gKHtcclxuICAgICAgYW5jaG9yOiBbMC41LCAxXSxcclxuICAgICAgYW5jaG9yWFVuaXRzOiAnZnJhY3Rpb24nLFxyXG4gICAgICBhbmNob3JZVW5pdHM6ICdmcmFjdGlvbicsXHJcbiAgICAgIG9wYWNpdHk6IDEsXHJcbiAgICAgIHNjYWxlOiAxLFxyXG4gICAgICBzcmM6ICcuLi9pbWFnZXMvbWFwLWljb25zL3BpbnMvMjQvcGluMS5wbmcnLFxyXG4gICAgICBzbmFwVG9QaXhlbDogZmFsc2VcclxuICAgIH0pKSxcclxuICAgIHpJbmRleDogMTAwXHJcbiAgfSk7XHJcbiAgbWFya2VyLnNldFN0eWxlKGljb25TdHlsZSk7XHJcbiAgdmFyIGZlYXR1cmVzT3ZlcmxheVN0eWxlID0gbmV3IG9sLnN0eWxlLlN0eWxlKHtcclxuICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XHJcbiAgICAgIGNvbG9yOiAnIzQwODA4MCcsXHJcbiAgICAgIHdpZHRoOiA1LFxyXG4gICAgICBsaW5lRGFzaDogWzQsIDRdXHJcbiAgICB9KVxyXG4gIH0pO1xyXG4gIHZhciBmZWF0dXJlc092ZXJsYXkgPSBuZXcgb2wubGF5ZXIuVmVjdG9yKHtcclxuICAgIG1hcDogbWFwLFxyXG4gICAgc291cmNlOiBuZXcgb2wuc291cmNlLlZlY3RvcigpLFxyXG4gICAgc3R5bGU6IGZlYXR1cmVzT3ZlcmxheVN0eWxlLFxyXG4gICAgaWQ6ICdyb3V0ZScsXHJcbiAgICBuYW1lRWw6ICfOlM65zrHOtM+Bzr/OvM6uJyxcclxuICAgIE5hbWVFbjogJ1JvdXRlJ1xyXG4gIH0pO1xyXG4gIHZhciByb3V0ZUNvb3JkcyA9IFtdO1xyXG5cclxuICBmdW5jdGlvbiBoYW5kbGVNYXJrZXIoZXZlbnQpIHtcclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB2YXIgZmVhdHVyZUNvdW50ID0gZmVhdHVyZXNPdmVybGF5LmdldFNvdXJjZSgpLmdldEZlYXR1cmVzKCkubGVuZ3RoO1xyXG4gICAgdmFyIGNvb3JkaW5hdGVzID0gZXZlbnQuY29vcmRpbmF0ZTtcclxuICAgIGlmIChmZWF0dXJlQ291bnQgPT09IDApIHtcclxuICAgICAgbWFya2VyLnNldEdlb21ldHJ5KG5ldyBvbC5nZW9tLlBvaW50KGNvb3JkaW5hdGVzKSk7XHJcbiAgICAgIG1hcmtlci5zZXRJZCgnZmlyc3QnKTtcclxuICAgICAgZmVhdHVyZXNPdmVybGF5LmdldFNvdXJjZSgpLmFkZEZlYXR1cmUobWFya2VyKTtcclxuICAgICAgcm91dGVDb29yZHNbMF0gPSBjb29yZGluYXRlc1swXTtcclxuICAgICAgcm91dGVDb29yZHNbMV0gPSBjb29yZGluYXRlc1sxXTtcclxuICAgIH0gZWxzZSBpZiAoZmVhdHVyZUNvdW50ID09PSAxKSB7XHJcbiAgICAgIHZhciBjbG9uZSA9IG1hcmtlci5jbG9uZSgpO1xyXG4gICAgICBjbG9uZS5zZXRHZW9tZXRyeShuZXcgb2wuZ2VvbS5Qb2ludChjb29yZGluYXRlcykpO1xyXG4gICAgICBjbG9uZS5zZXRJZCgnc2Vjb25kJyk7XHJcbiAgICAgIGZlYXR1cmVzT3ZlcmxheS5nZXRTb3VyY2UoKS5hZGRGZWF0dXJlKGNsb25lKTtcclxuICAgICAgcm91dGVDb29yZHNbMl0gPSBjb29yZGluYXRlc1swXTtcclxuICAgICAgcm91dGVDb29yZHNbM10gPSBjb29yZGluYXRlc1sxXTtcclxuICAgICAgY2FsbFJvdXRlKHJvdXRlQ29vcmRzKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGZlYXR1cmVzT3ZlcmxheS5nZXRTb3VyY2UoKS5jbGVhcigpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2VvSlNPTkZvcm1hdCA9IG5ldyBvbC5mb3JtYXQuR2VvSlNPTih7XHJcbiAgICBkZWZhdWx0RGF0YVByb2plY3Rpb246ICdFUFNHOjQzMjYnLFxyXG4gICAgZ2VvbWV0cnlOYW1lOiAnZ2VvbWV0cnknXHJcbiAgfSk7XHJcblxyXG4gIGZ1bmN0aW9uIGNhbGxSb3V0ZShyb3V0ZUNvb3Jkcykge1xyXG4gICAgdmFyIGZpcnN0ID0gb2wucHJvai50cmFuc2Zvcm0oW3JvdXRlQ29vcmRzWzBdLCByb3V0ZUNvb3Jkc1sxXV0sICdFUFNHOjM4NTcnLCAnRVBTRzo0MzI2Jyk7XHJcbiAgICB2YXIgc2Vjb25kID0gb2wucHJvai50cmFuc2Zvcm0oW3JvdXRlQ29vcmRzWzJdLCByb3V0ZUNvb3Jkc1szXV0sICdFUFNHOjM4NTcnLCAnRVBTRzo0MzI2Jyk7XHJcbiAgICB2YXIgeDEgPSBmaXJzdFswXTtcclxuICAgIHZhciB5MSA9IGZpcnN0WzFdO1xyXG4gICAgdmFyIHgyID0gc2Vjb25kWzBdO1xyXG4gICAgdmFyIHkyID0gc2Vjb25kWzFdO1xyXG4gICAgJC5hamF4KHtcclxuICAgICAgdXJsOiAnaHR0cHM6Ly9hcGkubWFwYm94LmNvbS92NC9kaXJlY3Rpb25zL21hcGJveC5kcml2aW5nLycgKyB4MSArICcsJyArIHkxICsgJzsnICsgeDIgKyAnLCcgKyB5MiArICcuanNvbj9hbHRlcm5hdGl2ZXM9ZmFsc2UmYWNjZXNzX3Rva2VuPXBrLmV5SjFJam9pWm1seWRtRnBiaUlzSW1FaU9pSmxPV1l5WVRNME5UaGlOV00wWWpKak9ESmpOREU0T0RRek56QTJNR1F5TmlKOS4tTlZETzI3SHp0LXdfblFvc1VQZkxBJyxcclxuICAgICAgdHlwZTogJ0dFVCcsXHJcbiAgICAgIGRhdGFUeXBlOiAnanNvbidcclxuICAgIH0pLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICB2YXIgcm91dGU9e307XHJcbiAgICAgIHJvdXRlLnR5cGUgPVwiRmVhdHVyZVwiO1xyXG4gICAgICByb3V0ZS5nZW9tZXRyeSA9IGRhdGEucm91dGVzWzBdLmdlb21ldHJ5O1xyXG4gICAgICBmZWF0dXJlc092ZXJsYXkuZ2V0U291cmNlKCkuYWRkRmVhdHVyZXMoZ2VvSlNPTkZvcm1hdC5yZWFkRmVhdHVyZXMocm91dGUsIHtcclxuICAgICAgICBkYXRhUHJvamVjdGlvbjogJ0VQU0c6NDMyNicsXHJcbiAgICAgICAgZmVhdHVyZVByb2plY3Rpb246ICdFUFNHOjM4NTcnXHJcbiAgICAgIH0pKTtcclxuICAgICAgbWFwLmdldFZpZXcoKS5maXQoZmVhdHVyZXNPdmVybGF5LmdldFNvdXJjZSgpLmdldEV4dGVudCgpLCBtYXAuZ2V0U2l6ZSgpKTtcclxuICAgIH0pLmZhaWwoZnVuY3Rpb24oKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3JcIik7XHJcbiAgICB9KS5hbHdheXMoZnVuY3Rpb24oKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiY29tcGxldGVcIik7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgJCgnLm1hcmtlcicpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihldmVudCkge1xyXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIC8qIEFjdCBvbiB0aGUgZXZlbnQgKi9cclxuICAgIGlmICgkKHRoaXMpLnByb3AoJ2NoZWNrZWQnKSA9PT0gdHJ1ZSkge1xyXG4gICAgICBtYXAub24oJ3NpbmdsZWNsaWNrJywgaGFuZGxlTWFya2VyKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIG1hcC51bignc2luZ2xlY2xpY2snLCBoYW5kbGVNYXJrZXIpO1xyXG4gICAgICBmZWF0dXJlc092ZXJsYXkuZ2V0U291cmNlKCkuY2xlYXIoKTtcclxuICAgIH1cclxuICB9KTtcclxufSgpKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICQoJy53ZWF0aGVyJykuY2hhbmdlKGZ1bmN0aW9uKCkge1xyXG4gICAgaWYgKCQodGhpcykucHJvcCgnY2hlY2tlZCcpID09PSB0cnVlKSB7XHJcbiAgICAgICAgbWFwLmdldE92ZXJsYXlzKCkuZm9yRWFjaChmdW5jdGlvbihvdmwpIHtcclxuICAgICAgICBpZiAob3ZsLmdldCgnbmFtZScpID09PSAnd2VhdGhlcicpIHtcclxuICAgICAgICAgICgkKG92bC5nZXRFbGVtZW50KCkpLnBhcmVudCgpKS5yZW1vdmUoKTtcclxuICAgICAgICAgICQob3ZsLmdldEVsZW1lbnQoKSkucmVtb3ZlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgdmFyIGNlbnRlciA9IG9sLnByb2oudHJhbnNmb3JtKG1hcC5nZXRWaWV3KCkuZ2V0Q2VudGVyKCksICdFUFNHOjM4NTcnLCAnRVBTRzo0MzI2Jyk7XHJcbiAgICAgIHZhciBsYXQgPSBjZW50ZXJbMV07XHJcbiAgICAgIHZhciBsb24gPSBjZW50ZXJbMF07XHJcbiAgICAgICQuYWpheCh7XHJcbiAgICAgICAgdXJsOiAnaHR0cDovL2FwaS5vcGVud2VhdGhlcm1hcC5vcmcvZGF0YS8yLjUvZmluZD9sYXQ9JyArIGxhdCArICcmbG9uPScgKyBsb24gKyAnJmNudD01JmNsdXN0ZXI9bm8mdW5pdHM9bWV0cmljJnR5cGU9YWNjdXJhdGUmQVBQSUQ9ZjljZDlmYTJjNDI3YzNiMTE1ZTg3ZTQ4NjI2MTljNWMnLFxyXG4gICAgICAgIHR5cGU6ICdHRVQnLFxyXG4gICAgICAgIGRhdGFUeXBlOiAnanNvbicsXHJcbiAgICAgIH0pLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVdlYXRoZXJPdmVybGF5KHBvc2l0aW9uLCBpbmRleCkge1xyXG4gICAgICAgICAgdmFyIGVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgIGVsZW0uc2V0QXR0cmlidXRlKCdjbGFzcycsICd3ZWF0aGVyLXBvcHVwIGRlZmF1bHQtcHJpbWFyeS1jb2xvciBtZGwtc2hhZG93LS02ZHAnKTtcclxuICAgICAgICAgIGVsZW0uc2V0QXR0cmlidXRlKCdpZCcsIGluZGV4KTtcclxuICAgICAgICAgIGVsZW0uc2V0QXR0cmlidXRlKCdkYXRhLW5hbWUnLCAnd2VhdGhlcicpO1xyXG4gICAgICAgICAgcmV0dXJuIG5ldyBvbC5PdmVybGF5KHtcclxuICAgICAgICAgICAgZWxlbWVudDogZWxlbSxcclxuICAgICAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uLFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBvYmpzID0gZGF0YS5saXN0O1xyXG4gICAgICAgIHZhciBvdmVybGF5LCBjb29yZGluYXRlcztcclxuICAgICAgICAkLmVhY2gob2JqcywgZnVuY3Rpb24oaW5kZXgsIHZhbCkge1xyXG4gICAgICAgICAgY29vcmRpbmF0ZXMgPSBvbC5wcm9qLnRyYW5zZm9ybShbdmFsLmNvb3JkLmxvbiwgdmFsLmNvb3JkLmxhdF0sICdFUFNHOjQzMjYnLCAnRVBTRzozODU3Jyk7XHJcbiAgICAgICAgICBvdmVybGF5ID0gY3JlYXRlV2VhdGhlck92ZXJsYXkoY29vcmRpbmF0ZXMsIGluZGV4KTtcclxuICAgICAgICAgIG1hcC5hZGRPdmVybGF5KG92ZXJsYXkpO1xyXG4gICAgICAgICAgb3ZlcmxheS5zZXQoJ25hbWUnLCAnd2VhdGhlcicpO1xyXG4gICAgICAgICAgd2VhdGhlckRhdGEgPSB7XHJcbiAgICAgICAgICAgICduYW1lJzogdmFsLm5hbWUsXHJcbiAgICAgICAgICAgICd0ZW1wJzogdmFsLm1haW4udGVtcCxcclxuICAgICAgICAgICAgJ3ByZXNzdXJlJzogdmFsLm1haW4ucHJlc3N1cmUsXHJcbiAgICAgICAgICAgICdodW1pZGl0eSc6IHZhbC5tYWluLmh1bWlkaXR5XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgZHVzdC5yZW5kZXIoJ3dlYXRoZXJQb3B1cC5kdXN0Jywgd2VhdGhlckRhdGEsIGZ1bmN0aW9uKGVyciwgb3V0KSB7XHJcbiAgICAgICAgICAgICQoXCIjXCIgKyBpbmRleCkuaHRtbChvdXQpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pLmZhaWwoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgLy8gdG9hc3RyLmVycm9yKFwizpTOtc69IM6yz4HOrc64zrfOus6xzr0gz4DOu863z4HOv8+Gzr/Pgc6vzrXPgiDOs865zrEgz4TOuc+CIM66zrHOuc+BzrnOus6tz4Igz4PPhc69zrjOrs66zrXPgiFcIik7XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIGlmICgkKHRoaXMpLnByb3AoJ2NoZWNrZWQnKSA9PT0gZmFsc2UpIHtcclxuICAgICAgbWFwLmdldE92ZXJsYXlzKCkuZm9yRWFjaChmdW5jdGlvbihvdmwpIHtcclxuICAgICAgICBpZiAob3ZsLmdldCgnbmFtZScpID09PSAnd2VhdGhlcicpIHtcclxuICAgICAgICAgICgkKG92bC5nZXRFbGVtZW50KCkpLnBhcmVudCgpKS5yZW1vdmUoKTtcclxuICAgICAgICAgICQob3ZsLmdldEVsZW1lbnQoKSkucmVtb3ZlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9KTtcclxufSgpKTtcclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
